function S0(r,o){for(var l=0;l<o.length;l++){const f=o[l];if(typeof f!="string"&&!Array.isArray(f)){for(const _ in f)if(_!=="default"&&!(_ in r)){const S=Object.getOwnPropertyDescriptor(f,_);S&&Object.defineProperty(r,_,S.get?S:{enumerable:!0,get:()=>f[_]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))f(_);new MutationObserver(_=>{for(const S of _)if(S.type==="childList")for(const x of S.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&f(x)}).observe(document,{childList:!0,subtree:!0});function l(_){const S={};return _.integrity&&(S.integrity=_.integrity),_.referrerPolicy&&(S.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?S.credentials="include":_.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function f(_){if(_.ep)return;_.ep=!0;const S=l(_);fetch(_.href,S)}})();var Hb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vg(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var T0={exports:{}},xp={},I0={exports:{}},jt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ah=Symbol.for("react.element"),Wb=Symbol.for("react.portal"),Yb=Symbol.for("react.fragment"),Kb=Symbol.for("react.strict_mode"),Xb=Symbol.for("react.profiler"),Jb=Symbol.for("react.provider"),Qb=Symbol.for("react.context"),e2=Symbol.for("react.forward_ref"),t2=Symbol.for("react.suspense"),r2=Symbol.for("react.memo"),i2=Symbol.for("react.lazy"),W_=Symbol.iterator;function n2(r){return r===null||typeof r!="object"?null:(r=W_&&r[W_]||r["@@iterator"],typeof r=="function"?r:null)}var k0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E0=Object.assign,C0={};function Jl(r,o,l){this.props=r,this.context=o,this.refs=C0,this.updater=l||k0}Jl.prototype.isReactComponent={};Jl.prototype.setState=function(r,o){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,o,"setState")};Jl.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function P0(){}P0.prototype=Jl.prototype;function xg(r,o,l){this.props=r,this.context=o,this.refs=C0,this.updater=l||k0}var wg=xg.prototype=new P0;wg.constructor=xg;E0(wg,Jl.prototype);wg.isPureReactComponent=!0;var Y_=Array.isArray,M0=Object.prototype.hasOwnProperty,bg={current:null},z0={key:!0,ref:!0,__self:!0,__source:!0};function A0(r,o,l){var f,_={},S=null,x=null;if(o!=null)for(f in o.ref!==void 0&&(x=o.ref),o.key!==void 0&&(S=""+o.key),o)M0.call(o,f)&&!z0.hasOwnProperty(f)&&(_[f]=o[f]);var d=arguments.length-2;if(d===1)_.children=l;else if(1<d){for(var F=Array(d),Z=0;Z<d;Z++)F[Z]=arguments[Z+2];_.children=F}if(r&&r.defaultProps)for(f in d=r.defaultProps,d)_[f]===void 0&&(_[f]=d[f]);return{$$typeof:ah,type:r,key:S,ref:x,props:_,_owner:bg.current}}function o2(r,o){return{$$typeof:ah,type:r.type,key:o,ref:r.ref,props:r.props,_owner:r._owner}}function Sg(r){return typeof r=="object"&&r!==null&&r.$$typeof===ah}function a2(r){var o={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(l){return o[l]})}var K_=/\/+/g;function Vf(r,o){return typeof r=="object"&&r!==null&&r.key!=null?a2(""+r.key):o.toString(36)}function Bd(r,o,l,f,_){var S=typeof r;(S==="undefined"||S==="boolean")&&(r=null);var x=!1;if(r===null)x=!0;else switch(S){case"string":case"number":x=!0;break;case"object":switch(r.$$typeof){case ah:case Wb:x=!0}}if(x)return x=r,_=_(x),r=f===""?"."+Vf(x,0):f,Y_(_)?(l="",r!=null&&(l=r.replace(K_,"$&/")+"/"),Bd(_,o,l,"",function(Z){return Z})):_!=null&&(Sg(_)&&(_=o2(_,l+(!_.key||x&&x.key===_.key?"":(""+_.key).replace(K_,"$&/")+"/")+r)),o.push(_)),1;if(x=0,f=f===""?".":f+":",Y_(r))for(var d=0;d<r.length;d++){S=r[d];var F=f+Vf(S,d);x+=Bd(S,o,l,F,_)}else if(F=n2(r),typeof F=="function")for(r=F.call(r),d=0;!(S=r.next()).done;)S=S.value,F=f+Vf(S,d++),x+=Bd(S,o,l,F,_);else if(S==="object")throw o=String(r),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return x}function xd(r,o,l){if(r==null)return r;var f=[],_=0;return Bd(r,f,"","",function(S){return o.call(l,S,_++)}),f}function s2(r){if(r._status===-1){var o=r._result;o=o(),o.then(function(l){(r._status===0||r._status===-1)&&(r._status=1,r._result=l)},function(l){(r._status===0||r._status===-1)&&(r._status=2,r._result=l)}),r._status===-1&&(r._status=0,r._result=o)}if(r._status===1)return r._result.default;throw r._result}var Yi={current:null},Od={transition:null},l2={ReactCurrentDispatcher:Yi,ReactCurrentBatchConfig:Od,ReactCurrentOwner:bg};jt.Children={map:xd,forEach:function(r,o,l){xd(r,function(){o.apply(this,arguments)},l)},count:function(r){var o=0;return xd(r,function(){o++}),o},toArray:function(r){return xd(r,function(o){return o})||[]},only:function(r){if(!Sg(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};jt.Component=Jl;jt.Fragment=Yb;jt.Profiler=Xb;jt.PureComponent=xg;jt.StrictMode=Kb;jt.Suspense=t2;jt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=l2;jt.cloneElement=function(r,o,l){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var f=E0({},r.props),_=r.key,S=r.ref,x=r._owner;if(o!=null){if(o.ref!==void 0&&(S=o.ref,x=bg.current),o.key!==void 0&&(_=""+o.key),r.type&&r.type.defaultProps)var d=r.type.defaultProps;for(F in o)M0.call(o,F)&&!z0.hasOwnProperty(F)&&(f[F]=o[F]===void 0&&d!==void 0?d[F]:o[F])}var F=arguments.length-2;if(F===1)f.children=l;else if(1<F){d=Array(F);for(var Z=0;Z<F;Z++)d[Z]=arguments[Z+2];f.children=d}return{$$typeof:ah,type:r.type,key:_,ref:S,props:f,_owner:x}};jt.createContext=function(r){return r={$$typeof:Qb,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:Jb,_context:r},r.Consumer=r};jt.createElement=A0;jt.createFactory=function(r){var o=A0.bind(null,r);return o.type=r,o};jt.createRef=function(){return{current:null}};jt.forwardRef=function(r){return{$$typeof:e2,render:r}};jt.isValidElement=Sg;jt.lazy=function(r){return{$$typeof:i2,_payload:{_status:-1,_result:r},_init:s2}};jt.memo=function(r,o){return{$$typeof:r2,type:r,compare:o===void 0?null:o}};jt.startTransition=function(r){var o=Od.transition;Od.transition={};try{r()}finally{Od.transition=o}};jt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};jt.useCallback=function(r,o){return Yi.current.useCallback(r,o)};jt.useContext=function(r){return Yi.current.useContext(r)};jt.useDebugValue=function(){};jt.useDeferredValue=function(r){return Yi.current.useDeferredValue(r)};jt.useEffect=function(r,o){return Yi.current.useEffect(r,o)};jt.useId=function(){return Yi.current.useId()};jt.useImperativeHandle=function(r,o,l){return Yi.current.useImperativeHandle(r,o,l)};jt.useInsertionEffect=function(r,o){return Yi.current.useInsertionEffect(r,o)};jt.useLayoutEffect=function(r,o){return Yi.current.useLayoutEffect(r,o)};jt.useMemo=function(r,o){return Yi.current.useMemo(r,o)};jt.useReducer=function(r,o,l){return Yi.current.useReducer(r,o,l)};jt.useRef=function(r){return Yi.current.useRef(r)};jt.useState=function(r){return Yi.current.useState(r)};jt.useSyncExternalStore=function(r,o,l){return Yi.current.useSyncExternalStore(r,o,l)};jt.useTransition=function(){return Yi.current.useTransition()};jt.version="18.2.0";I0.exports=jt;var Le=I0.exports;const D0=vg(Le),u2=S0({__proto__:null,default:D0},[Le]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var c2=Le,h2=Symbol.for("react.element"),d2=Symbol.for("react.fragment"),p2=Object.prototype.hasOwnProperty,f2=c2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,m2={key:!0,ref:!0,__self:!0,__source:!0};function L0(r,o,l){var f,_={},S=null,x=null;l!==void 0&&(S=""+l),o.key!==void 0&&(S=""+o.key),o.ref!==void 0&&(x=o.ref);for(f in o)p2.call(o,f)&&!m2.hasOwnProperty(f)&&(_[f]=o[f]);if(r&&r.defaultProps)for(f in o=r.defaultProps,o)_[f]===void 0&&(_[f]=o[f]);return{$$typeof:h2,type:r,key:S,ref:x,props:_,_owner:f2.current}}xp.Fragment=d2;xp.jsx=L0;xp.jsxs=L0;T0.exports=xp;var It=T0.exports,wm={},R0={exports:{}},Tn={},F0={exports:{}},B0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function o(We,pt){var ht=We.length;We.push(pt);e:for(;0<ht;){var xt=ht-1>>>1,Ct=We[xt];if(0<_(Ct,pt))We[xt]=pt,We[ht]=Ct,ht=xt;else break e}}function l(We){return We.length===0?null:We[0]}function f(We){if(We.length===0)return null;var pt=We[0],ht=We.pop();if(ht!==pt){We[0]=ht;e:for(var xt=0,Ct=We.length,Hr=Ct>>>1;xt<Hr;){var Wt=2*(xt+1)-1,Br=We[Wt],or=Wt+1,Pr=We[or];if(0>_(Br,ht))or<Ct&&0>_(Pr,Br)?(We[xt]=Pr,We[or]=ht,xt=or):(We[xt]=Br,We[Wt]=ht,xt=Wt);else if(or<Ct&&0>_(Pr,ht))We[xt]=Pr,We[or]=ht,xt=or;else break e}}return pt}function _(We,pt){var ht=We.sortIndex-pt.sortIndex;return ht!==0?ht:We.id-pt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var S=performance;r.unstable_now=function(){return S.now()}}else{var x=Date,d=x.now();r.unstable_now=function(){return x.now()-d}}var F=[],Z=[],Q=1,q=null,U=3,we=!1,be=!1,xe=!1,Ee=typeof setTimeout=="function"?setTimeout:null,ne=typeof clearTimeout=="function"?clearTimeout:null,te=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ue(We){for(var pt=l(Z);pt!==null;){if(pt.callback===null)f(Z);else if(pt.startTime<=We)f(Z),pt.sortIndex=pt.expirationTime,o(F,pt);else break;pt=l(Z)}}function Te(We){if(xe=!1,ue(We),!be)if(l(F)!==null)be=!0,Gr(Ne);else{var pt=l(Z);pt!==null&&Vt(Te,pt.startTime-We)}}function Ne(We,pt){be=!1,xe&&(xe=!1,ne(Ze),Ze=-1),we=!0;var ht=U;try{for(ue(pt),q=l(F);q!==null&&(!(q.expirationTime>pt)||We&&!vt());){var xt=q.callback;if(typeof xt=="function"){q.callback=null,U=q.priorityLevel;var Ct=xt(q.expirationTime<=pt);pt=r.unstable_now(),typeof Ct=="function"?q.callback=Ct:q===l(F)&&f(F),ue(pt)}else f(F);q=l(F)}if(q!==null)var Hr=!0;else{var Wt=l(Z);Wt!==null&&Vt(Te,Wt.startTime-pt),Hr=!1}return Hr}finally{q=null,U=ht,we=!1}}var pe=!1,Me=null,Ze=-1,tt=5,ct=-1;function vt(){return!(r.unstable_now()-ct<tt)}function kt(){if(Me!==null){var We=r.unstable_now();ct=We;var pt=!0;try{pt=Me(!0,We)}finally{pt?Dt():(pe=!1,Me=null)}}else pe=!1}var Dt;if(typeof te=="function")Dt=function(){te(kt)};else if(typeof MessageChannel<"u"){var lr=new MessageChannel,wi=lr.port2;lr.port1.onmessage=kt,Dt=function(){wi.postMessage(null)}}else Dt=function(){Ee(kt,0)};function Gr(We){Me=We,pe||(pe=!0,Dt())}function Vt(We,pt){Ze=Ee(function(){We(r.unstable_now())},pt)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(We){We.callback=null},r.unstable_continueExecution=function(){be||we||(be=!0,Gr(Ne))},r.unstable_forceFrameRate=function(We){0>We||125<We?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):tt=0<We?Math.floor(1e3/We):5},r.unstable_getCurrentPriorityLevel=function(){return U},r.unstable_getFirstCallbackNode=function(){return l(F)},r.unstable_next=function(We){switch(U){case 1:case 2:case 3:var pt=3;break;default:pt=U}var ht=U;U=pt;try{return We()}finally{U=ht}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(We,pt){switch(We){case 1:case 2:case 3:case 4:case 5:break;default:We=3}var ht=U;U=We;try{return pt()}finally{U=ht}},r.unstable_scheduleCallback=function(We,pt,ht){var xt=r.unstable_now();switch(typeof ht=="object"&&ht!==null?(ht=ht.delay,ht=typeof ht=="number"&&0<ht?xt+ht:xt):ht=xt,We){case 1:var Ct=-1;break;case 2:Ct=250;break;case 5:Ct=1073741823;break;case 4:Ct=1e4;break;default:Ct=5e3}return Ct=ht+Ct,We={id:Q++,callback:pt,priorityLevel:We,startTime:ht,expirationTime:Ct,sortIndex:-1},ht>xt?(We.sortIndex=ht,o(Z,We),l(F)===null&&We===l(Z)&&(xe?(ne(Ze),Ze=-1):xe=!0,Vt(Te,ht-xt))):(We.sortIndex=Ct,o(F,We),be||we||(be=!0,Gr(Ne))),We},r.unstable_shouldYield=vt,r.unstable_wrapCallback=function(We){var pt=U;return function(){var ht=U;U=pt;try{return We.apply(this,arguments)}finally{U=ht}}}})(B0);F0.exports=B0;var g2=F0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O0=Le,Sn=g2;function je(r){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+r,l=1;l<arguments.length;l++)o+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+r+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var N0=new Set,jc={};function Rs(r,o){$l(r,o),$l(r+"Capture",o)}function $l(r,o){for(jc[r]=o,r=0;r<o.length;r++)N0.add(o[r])}var Xo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),bm=Object.prototype.hasOwnProperty,y2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,X_={},J_={};function _2(r){return bm.call(J_,r)?!0:bm.call(X_,r)?!1:y2.test(r)?J_[r]=!0:(X_[r]=!0,!1)}function v2(r,o,l,f){if(l!==null&&l.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return f?!1:l!==null?!l.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function x2(r,o,l,f){if(o===null||typeof o>"u"||v2(r,o,l,f))return!0;if(f)return!1;if(l!==null)switch(l.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function Ki(r,o,l,f,_,S,x){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=f,this.attributeNamespace=_,this.mustUseProperty=l,this.propertyName=r,this.type=o,this.sanitizeURL=S,this.removeEmptyString=x}var xi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){xi[r]=new Ki(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var o=r[0];xi[o]=new Ki(o,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){xi[r]=new Ki(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){xi[r]=new Ki(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){xi[r]=new Ki(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){xi[r]=new Ki(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){xi[r]=new Ki(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){xi[r]=new Ki(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){xi[r]=new Ki(r,5,!1,r.toLowerCase(),null,!1,!1)});var Tg=/[\-:]([a-z])/g;function Ig(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var o=r.replace(Tg,Ig);xi[o]=new Ki(o,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var o=r.replace(Tg,Ig);xi[o]=new Ki(o,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var o=r.replace(Tg,Ig);xi[o]=new Ki(o,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){xi[r]=new Ki(r,1,!1,r.toLowerCase(),null,!1,!1)});xi.xlinkHref=new Ki("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){xi[r]=new Ki(r,1,!1,r.toLowerCase(),null,!0,!0)});function kg(r,o,l,f){var _=xi.hasOwnProperty(o)?xi[o]:null;(_!==null?_.type!==0:f||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(x2(o,l,_,f)&&(l=null),f||_===null?_2(o)&&(l===null?r.removeAttribute(o):r.setAttribute(o,""+l)):_.mustUseProperty?r[_.propertyName]=l===null?_.type===3?!1:"":l:(o=_.attributeName,f=_.attributeNamespace,l===null?r.removeAttribute(o):(_=_.type,l=_===3||_===4&&l===!0?"":""+l,f?r.setAttributeNS(f,o,l):r.setAttribute(o,l))))}var ta=O0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,wd=Symbol.for("react.element"),Sl=Symbol.for("react.portal"),Tl=Symbol.for("react.fragment"),Eg=Symbol.for("react.strict_mode"),Sm=Symbol.for("react.profiler"),j0=Symbol.for("react.provider"),U0=Symbol.for("react.context"),Cg=Symbol.for("react.forward_ref"),Tm=Symbol.for("react.suspense"),Im=Symbol.for("react.suspense_list"),Pg=Symbol.for("react.memo"),za=Symbol.for("react.lazy"),V0=Symbol.for("react.offscreen"),Q_=Symbol.iterator;function cc(r){return r===null||typeof r!="object"?null:(r=Q_&&r[Q_]||r["@@iterator"],typeof r=="function"?r:null)}var Cr=Object.assign,$f;function kc(r){if($f===void 0)try{throw Error()}catch(l){var o=l.stack.trim().match(/\n( *(at )?)/);$f=o&&o[1]||""}return`
`+$f+r}var Zf=!1;function qf(r,o){if(!r||Zf)return"";Zf=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(Z){var f=Z}Reflect.construct(r,[],o)}else{try{o.call()}catch(Z){f=Z}r.call(o.prototype)}else{try{throw Error()}catch(Z){f=Z}r()}}catch(Z){if(Z&&f&&typeof Z.stack=="string"){for(var _=Z.stack.split(`
`),S=f.stack.split(`
`),x=_.length-1,d=S.length-1;1<=x&&0<=d&&_[x]!==S[d];)d--;for(;1<=x&&0<=d;x--,d--)if(_[x]!==S[d]){if(x!==1||d!==1)do if(x--,d--,0>d||_[x]!==S[d]){var F=`
`+_[x].replace(" at new "," at ");return r.displayName&&F.includes("<anonymous>")&&(F=F.replace("<anonymous>",r.displayName)),F}while(1<=x&&0<=d);break}}}finally{Zf=!1,Error.prepareStackTrace=l}return(r=r?r.displayName||r.name:"")?kc(r):""}function w2(r){switch(r.tag){case 5:return kc(r.type);case 16:return kc("Lazy");case 13:return kc("Suspense");case 19:return kc("SuspenseList");case 0:case 2:case 15:return r=qf(r.type,!1),r;case 11:return r=qf(r.type.render,!1),r;case 1:return r=qf(r.type,!0),r;default:return""}}function km(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Tl:return"Fragment";case Sl:return"Portal";case Sm:return"Profiler";case Eg:return"StrictMode";case Tm:return"Suspense";case Im:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case U0:return(r.displayName||"Context")+".Consumer";case j0:return(r._context.displayName||"Context")+".Provider";case Cg:var o=r.render;return r=r.displayName,r||(r=o.displayName||o.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case Pg:return o=r.displayName||null,o!==null?o:km(r.type)||"Memo";case za:o=r._payload,r=r._init;try{return km(r(o))}catch{}}return null}function b2(r){var o=r.type;switch(r.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=o.render,r=r.displayName||r.name||"",o.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return km(o);case 8:return o===Eg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function qa(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function $0(r){var o=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function S2(r){var o=$0(r)?"checked":"value",l=Object.getOwnPropertyDescriptor(r.constructor.prototype,o),f=""+r[o];if(!r.hasOwnProperty(o)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var _=l.get,S=l.set;return Object.defineProperty(r,o,{configurable:!0,get:function(){return _.call(this)},set:function(x){f=""+x,S.call(this,x)}}),Object.defineProperty(r,o,{enumerable:l.enumerable}),{getValue:function(){return f},setValue:function(x){f=""+x},stopTracking:function(){r._valueTracker=null,delete r[o]}}}}function bd(r){r._valueTracker||(r._valueTracker=S2(r))}function Z0(r){if(!r)return!1;var o=r._valueTracker;if(!o)return!0;var l=o.getValue(),f="";return r&&(f=$0(r)?r.checked?"true":"false":r.value),r=f,r!==l?(o.setValue(r),!0):!1}function Yd(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function Em(r,o){var l=o.checked;return Cr({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??r._wrapperState.initialChecked})}function ev(r,o){var l=o.defaultValue==null?"":o.defaultValue,f=o.checked!=null?o.checked:o.defaultChecked;l=qa(o.value!=null?o.value:l),r._wrapperState={initialChecked:f,initialValue:l,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function q0(r,o){o=o.checked,o!=null&&kg(r,"checked",o,!1)}function Cm(r,o){q0(r,o);var l=qa(o.value),f=o.type;if(l!=null)f==="number"?(l===0&&r.value===""||r.value!=l)&&(r.value=""+l):r.value!==""+l&&(r.value=""+l);else if(f==="submit"||f==="reset"){r.removeAttribute("value");return}o.hasOwnProperty("value")?Pm(r,o.type,l):o.hasOwnProperty("defaultValue")&&Pm(r,o.type,qa(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(r.defaultChecked=!!o.defaultChecked)}function tv(r,o,l){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var f=o.type;if(!(f!=="submit"&&f!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+r._wrapperState.initialValue,l||o===r.value||(r.value=o),r.defaultValue=o}l=r.name,l!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,l!==""&&(r.name=l)}function Pm(r,o,l){(o!=="number"||Yd(r.ownerDocument)!==r)&&(l==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+l&&(r.defaultValue=""+l))}var Ec=Array.isArray;function Bl(r,o,l,f){if(r=r.options,o){o={};for(var _=0;_<l.length;_++)o["$"+l[_]]=!0;for(l=0;l<r.length;l++)_=o.hasOwnProperty("$"+r[l].value),r[l].selected!==_&&(r[l].selected=_),_&&f&&(r[l].defaultSelected=!0)}else{for(l=""+qa(l),o=null,_=0;_<r.length;_++){if(r[_].value===l){r[_].selected=!0,f&&(r[_].defaultSelected=!0);return}o!==null||r[_].disabled||(o=r[_])}o!==null&&(o.selected=!0)}}function Mm(r,o){if(o.dangerouslySetInnerHTML!=null)throw Error(je(91));return Cr({},o,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function rv(r,o){var l=o.value;if(l==null){if(l=o.children,o=o.defaultValue,l!=null){if(o!=null)throw Error(je(92));if(Ec(l)){if(1<l.length)throw Error(je(93));l=l[0]}o=l}o==null&&(o=""),l=o}r._wrapperState={initialValue:qa(l)}}function G0(r,o){var l=qa(o.value),f=qa(o.defaultValue);l!=null&&(l=""+l,l!==r.value&&(r.value=l),o.defaultValue==null&&r.defaultValue!==l&&(r.defaultValue=l)),f!=null&&(r.defaultValue=""+f)}function iv(r){var o=r.textContent;o===r._wrapperState.initialValue&&o!==""&&o!==null&&(r.value=o)}function H0(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function zm(r,o){return r==null||r==="http://www.w3.org/1999/xhtml"?H0(o):r==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var Sd,W0=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,l,f,_){MSApp.execUnsafeLocalFunction(function(){return r(o,l,f,_)})}:r}(function(r,o){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=o;else{for(Sd=Sd||document.createElement("div"),Sd.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=Sd.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;o.firstChild;)r.appendChild(o.firstChild)}});function Uc(r,o){if(o){var l=r.firstChild;if(l&&l===r.lastChild&&l.nodeType===3){l.nodeValue=o;return}}r.textContent=o}var Mc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},T2=["Webkit","ms","Moz","O"];Object.keys(Mc).forEach(function(r){T2.forEach(function(o){o=o+r.charAt(0).toUpperCase()+r.substring(1),Mc[o]=Mc[r]})});function Y0(r,o,l){return o==null||typeof o=="boolean"||o===""?"":l||typeof o!="number"||o===0||Mc.hasOwnProperty(r)&&Mc[r]?(""+o).trim():o+"px"}function K0(r,o){r=r.style;for(var l in o)if(o.hasOwnProperty(l)){var f=l.indexOf("--")===0,_=Y0(l,o[l],f);l==="float"&&(l="cssFloat"),f?r.setProperty(l,_):r[l]=_}}var I2=Cr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Am(r,o){if(o){if(I2[r]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(je(137,r));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(je(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(je(61))}if(o.style!=null&&typeof o.style!="object")throw Error(je(62))}}function Dm(r,o){if(r.indexOf("-")===-1)return typeof o.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Lm=null;function Mg(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Rm=null,Ol=null,Nl=null;function nv(r){if(r=uh(r)){if(typeof Rm!="function")throw Error(je(280));var o=r.stateNode;o&&(o=Ip(o),Rm(r.stateNode,r.type,o))}}function X0(r){Ol?Nl?Nl.push(r):Nl=[r]:Ol=r}function J0(){if(Ol){var r=Ol,o=Nl;if(Nl=Ol=null,nv(r),o)for(r=0;r<o.length;r++)nv(o[r])}}function Q0(r,o){return r(o)}function ex(){}var Gf=!1;function tx(r,o,l){if(Gf)return r(o,l);Gf=!0;try{return Q0(r,o,l)}finally{Gf=!1,(Ol!==null||Nl!==null)&&(ex(),J0())}}function Vc(r,o){var l=r.stateNode;if(l===null)return null;var f=Ip(l);if(f===null)return null;l=f[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(r=r.type,f=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!f;break e;default:r=!1}if(r)return null;if(l&&typeof l!="function")throw Error(je(231,o,typeof l));return l}var Fm=!1;if(Xo)try{var hc={};Object.defineProperty(hc,"passive",{get:function(){Fm=!0}}),window.addEventListener("test",hc,hc),window.removeEventListener("test",hc,hc)}catch{Fm=!1}function k2(r,o,l,f,_,S,x,d,F){var Z=Array.prototype.slice.call(arguments,3);try{o.apply(l,Z)}catch(Q){this.onError(Q)}}var zc=!1,Kd=null,Xd=!1,Bm=null,E2={onError:function(r){zc=!0,Kd=r}};function C2(r,o,l,f,_,S,x,d,F){zc=!1,Kd=null,k2.apply(E2,arguments)}function P2(r,o,l,f,_,S,x,d,F){if(C2.apply(this,arguments),zc){if(zc){var Z=Kd;zc=!1,Kd=null}else throw Error(je(198));Xd||(Xd=!0,Bm=Z)}}function Fs(r){var o=r,l=r;if(r.alternate)for(;o.return;)o=o.return;else{r=o;do o=r,o.flags&4098&&(l=o.return),r=o.return;while(r)}return o.tag===3?l:null}function rx(r){if(r.tag===13){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function ov(r){if(Fs(r)!==r)throw Error(je(188))}function M2(r){var o=r.alternate;if(!o){if(o=Fs(r),o===null)throw Error(je(188));return o!==r?null:r}for(var l=r,f=o;;){var _=l.return;if(_===null)break;var S=_.alternate;if(S===null){if(f=_.return,f!==null){l=f;continue}break}if(_.child===S.child){for(S=_.child;S;){if(S===l)return ov(_),r;if(S===f)return ov(_),o;S=S.sibling}throw Error(je(188))}if(l.return!==f.return)l=_,f=S;else{for(var x=!1,d=_.child;d;){if(d===l){x=!0,l=_,f=S;break}if(d===f){x=!0,f=_,l=S;break}d=d.sibling}if(!x){for(d=S.child;d;){if(d===l){x=!0,l=S,f=_;break}if(d===f){x=!0,f=S,l=_;break}d=d.sibling}if(!x)throw Error(je(189))}}if(l.alternate!==f)throw Error(je(190))}if(l.tag!==3)throw Error(je(188));return l.stateNode.current===l?r:o}function ix(r){return r=M2(r),r!==null?nx(r):null}function nx(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var o=nx(r);if(o!==null)return o;r=r.sibling}return null}var ox=Sn.unstable_scheduleCallback,av=Sn.unstable_cancelCallback,z2=Sn.unstable_shouldYield,A2=Sn.unstable_requestPaint,qr=Sn.unstable_now,D2=Sn.unstable_getCurrentPriorityLevel,zg=Sn.unstable_ImmediatePriority,ax=Sn.unstable_UserBlockingPriority,Jd=Sn.unstable_NormalPriority,L2=Sn.unstable_LowPriority,sx=Sn.unstable_IdlePriority,wp=null,bo=null;function R2(r){if(bo&&typeof bo.onCommitFiberRoot=="function")try{bo.onCommitFiberRoot(wp,r,void 0,(r.current.flags&128)===128)}catch{}}var ao=Math.clz32?Math.clz32:O2,F2=Math.log,B2=Math.LN2;function O2(r){return r>>>=0,r===0?32:31-(F2(r)/B2|0)|0}var Td=64,Id=4194304;function Cc(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function Qd(r,o){var l=r.pendingLanes;if(l===0)return 0;var f=0,_=r.suspendedLanes,S=r.pingedLanes,x=l&268435455;if(x!==0){var d=x&~_;d!==0?f=Cc(d):(S&=x,S!==0&&(f=Cc(S)))}else x=l&~_,x!==0?f=Cc(x):S!==0&&(f=Cc(S));if(f===0)return 0;if(o!==0&&o!==f&&!(o&_)&&(_=f&-f,S=o&-o,_>=S||_===16&&(S&4194240)!==0))return o;if(f&4&&(f|=l&16),o=r.entangledLanes,o!==0)for(r=r.entanglements,o&=f;0<o;)l=31-ao(o),_=1<<l,f|=r[l],o&=~_;return f}function N2(r,o){switch(r){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function j2(r,o){for(var l=r.suspendedLanes,f=r.pingedLanes,_=r.expirationTimes,S=r.pendingLanes;0<S;){var x=31-ao(S),d=1<<x,F=_[x];F===-1?(!(d&l)||d&f)&&(_[x]=N2(d,o)):F<=o&&(r.expiredLanes|=d),S&=~d}}function Om(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function lx(){var r=Td;return Td<<=1,!(Td&4194240)&&(Td=64),r}function Hf(r){for(var o=[],l=0;31>l;l++)o.push(r);return o}function sh(r,o,l){r.pendingLanes|=o,o!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,o=31-ao(o),r[o]=l}function U2(r,o){var l=r.pendingLanes&~o;r.pendingLanes=o,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=o,r.mutableReadLanes&=o,r.entangledLanes&=o,o=r.entanglements;var f=r.eventTimes;for(r=r.expirationTimes;0<l;){var _=31-ao(l),S=1<<_;o[_]=0,f[_]=-1,r[_]=-1,l&=~S}}function Ag(r,o){var l=r.entangledLanes|=o;for(r=r.entanglements;l;){var f=31-ao(l),_=1<<f;_&o|r[f]&o&&(r[f]|=o),l&=~_}}var tr=0;function ux(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var cx,Dg,hx,dx,px,Nm=!1,kd=[],Ba=null,Oa=null,Na=null,$c=new Map,Zc=new Map,Da=[],V2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function sv(r,o){switch(r){case"focusin":case"focusout":Ba=null;break;case"dragenter":case"dragleave":Oa=null;break;case"mouseover":case"mouseout":Na=null;break;case"pointerover":case"pointerout":$c.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zc.delete(o.pointerId)}}function dc(r,o,l,f,_,S){return r===null||r.nativeEvent!==S?(r={blockedOn:o,domEventName:l,eventSystemFlags:f,nativeEvent:S,targetContainers:[_]},o!==null&&(o=uh(o),o!==null&&Dg(o)),r):(r.eventSystemFlags|=f,o=r.targetContainers,_!==null&&o.indexOf(_)===-1&&o.push(_),r)}function $2(r,o,l,f,_){switch(o){case"focusin":return Ba=dc(Ba,r,o,l,f,_),!0;case"dragenter":return Oa=dc(Oa,r,o,l,f,_),!0;case"mouseover":return Na=dc(Na,r,o,l,f,_),!0;case"pointerover":var S=_.pointerId;return $c.set(S,dc($c.get(S)||null,r,o,l,f,_)),!0;case"gotpointercapture":return S=_.pointerId,Zc.set(S,dc(Zc.get(S)||null,r,o,l,f,_)),!0}return!1}function fx(r){var o=bs(r.target);if(o!==null){var l=Fs(o);if(l!==null){if(o=l.tag,o===13){if(o=rx(l),o!==null){r.blockedOn=o,px(r.priority,function(){hx(l)});return}}else if(o===3&&l.stateNode.current.memoizedState.isDehydrated){r.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Nd(r){if(r.blockedOn!==null)return!1;for(var o=r.targetContainers;0<o.length;){var l=jm(r.domEventName,r.eventSystemFlags,o[0],r.nativeEvent);if(l===null){l=r.nativeEvent;var f=new l.constructor(l.type,l);Lm=f,l.target.dispatchEvent(f),Lm=null}else return o=uh(l),o!==null&&Dg(o),r.blockedOn=l,!1;o.shift()}return!0}function lv(r,o,l){Nd(r)&&l.delete(o)}function Z2(){Nm=!1,Ba!==null&&Nd(Ba)&&(Ba=null),Oa!==null&&Nd(Oa)&&(Oa=null),Na!==null&&Nd(Na)&&(Na=null),$c.forEach(lv),Zc.forEach(lv)}function pc(r,o){r.blockedOn===o&&(r.blockedOn=null,Nm||(Nm=!0,Sn.unstable_scheduleCallback(Sn.unstable_NormalPriority,Z2)))}function qc(r){function o(_){return pc(_,r)}if(0<kd.length){pc(kd[0],r);for(var l=1;l<kd.length;l++){var f=kd[l];f.blockedOn===r&&(f.blockedOn=null)}}for(Ba!==null&&pc(Ba,r),Oa!==null&&pc(Oa,r),Na!==null&&pc(Na,r),$c.forEach(o),Zc.forEach(o),l=0;l<Da.length;l++)f=Da[l],f.blockedOn===r&&(f.blockedOn=null);for(;0<Da.length&&(l=Da[0],l.blockedOn===null);)fx(l),l.blockedOn===null&&Da.shift()}var jl=ta.ReactCurrentBatchConfig,ep=!0;function q2(r,o,l,f){var _=tr,S=jl.transition;jl.transition=null;try{tr=1,Lg(r,o,l,f)}finally{tr=_,jl.transition=S}}function G2(r,o,l,f){var _=tr,S=jl.transition;jl.transition=null;try{tr=4,Lg(r,o,l,f)}finally{tr=_,jl.transition=S}}function Lg(r,o,l,f){if(ep){var _=jm(r,o,l,f);if(_===null)im(r,o,f,tp,l),sv(r,f);else if($2(_,r,o,l,f))f.stopPropagation();else if(sv(r,f),o&4&&-1<V2.indexOf(r)){for(;_!==null;){var S=uh(_);if(S!==null&&cx(S),S=jm(r,o,l,f),S===null&&im(r,o,f,tp,l),S===_)break;_=S}_!==null&&f.stopPropagation()}else im(r,o,f,null,l)}}var tp=null;function jm(r,o,l,f){if(tp=null,r=Mg(f),r=bs(r),r!==null)if(o=Fs(r),o===null)r=null;else if(l=o.tag,l===13){if(r=rx(o),r!==null)return r;r=null}else if(l===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;r=null}else o!==r&&(r=null);return tp=r,null}function mx(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(D2()){case zg:return 1;case ax:return 4;case Jd:case L2:return 16;case sx:return 536870912;default:return 16}default:return 16}}var Ra=null,Rg=null,jd=null;function gx(){if(jd)return jd;var r,o=Rg,l=o.length,f,_="value"in Ra?Ra.value:Ra.textContent,S=_.length;for(r=0;r<l&&o[r]===_[r];r++);var x=l-r;for(f=1;f<=x&&o[l-f]===_[S-f];f++);return jd=_.slice(r,1<f?1-f:void 0)}function Ud(r){var o=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&o===13&&(r=13)):r=o,r===10&&(r=13),32<=r||r===13?r:0}function Ed(){return!0}function uv(){return!1}function In(r){function o(l,f,_,S,x){this._reactName=l,this._targetInst=_,this.type=f,this.nativeEvent=S,this.target=x,this.currentTarget=null;for(var d in r)r.hasOwnProperty(d)&&(l=r[d],this[d]=l?l(S):S[d]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?Ed:uv,this.isPropagationStopped=uv,this}return Cr(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Ed)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Ed)},persist:function(){},isPersistent:Ed}),o}var Ql={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Fg=In(Ql),lh=Cr({},Ql,{view:0,detail:0}),H2=In(lh),Wf,Yf,fc,bp=Cr({},lh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bg,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==fc&&(fc&&r.type==="mousemove"?(Wf=r.screenX-fc.screenX,Yf=r.screenY-fc.screenY):Yf=Wf=0,fc=r),Wf)},movementY:function(r){return"movementY"in r?r.movementY:Yf}}),cv=In(bp),W2=Cr({},bp,{dataTransfer:0}),Y2=In(W2),K2=Cr({},lh,{relatedTarget:0}),Kf=In(K2),X2=Cr({},Ql,{animationName:0,elapsedTime:0,pseudoElement:0}),J2=In(X2),Q2=Cr({},Ql,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),eS=In(Q2),tS=Cr({},Ql,{data:0}),hv=In(tS),rS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},iS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},nS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function oS(r){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(r):(r=nS[r])?!!o[r]:!1}function Bg(){return oS}var aS=Cr({},lh,{key:function(r){if(r.key){var o=rS[r.key]||r.key;if(o!=="Unidentified")return o}return r.type==="keypress"?(r=Ud(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?iS[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bg,charCode:function(r){return r.type==="keypress"?Ud(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Ud(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),sS=In(aS),lS=Cr({},bp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),dv=In(lS),uS=Cr({},lh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bg}),cS=In(uS),hS=Cr({},Ql,{propertyName:0,elapsedTime:0,pseudoElement:0}),dS=In(hS),pS=Cr({},bp,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),fS=In(pS),mS=[9,13,27,32],Og=Xo&&"CompositionEvent"in window,Ac=null;Xo&&"documentMode"in document&&(Ac=document.documentMode);var gS=Xo&&"TextEvent"in window&&!Ac,yx=Xo&&(!Og||Ac&&8<Ac&&11>=Ac),pv=" ",fv=!1;function _x(r,o){switch(r){case"keyup":return mS.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function vx(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Il=!1;function yS(r,o){switch(r){case"compositionend":return vx(o);case"keypress":return o.which!==32?null:(fv=!0,pv);case"textInput":return r=o.data,r===pv&&fv?null:r;default:return null}}function _S(r,o){if(Il)return r==="compositionend"||!Og&&_x(r,o)?(r=gx(),jd=Rg=Ra=null,Il=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return yx&&o.locale!=="ko"?null:o.data;default:return null}}var vS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mv(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o==="input"?!!vS[r.type]:o==="textarea"}function xx(r,o,l,f){X0(f),o=rp(o,"onChange"),0<o.length&&(l=new Fg("onChange","change",null,l,f),r.push({event:l,listeners:o}))}var Dc=null,Gc=null;function xS(r){zx(r,0)}function Sp(r){var o=Cl(r);if(Z0(o))return r}function wS(r,o){if(r==="change")return o}var wx=!1;if(Xo){var Xf;if(Xo){var Jf="oninput"in document;if(!Jf){var gv=document.createElement("div");gv.setAttribute("oninput","return;"),Jf=typeof gv.oninput=="function"}Xf=Jf}else Xf=!1;wx=Xf&&(!document.documentMode||9<document.documentMode)}function yv(){Dc&&(Dc.detachEvent("onpropertychange",bx),Gc=Dc=null)}function bx(r){if(r.propertyName==="value"&&Sp(Gc)){var o=[];xx(o,Gc,r,Mg(r)),tx(xS,o)}}function bS(r,o,l){r==="focusin"?(yv(),Dc=o,Gc=l,Dc.attachEvent("onpropertychange",bx)):r==="focusout"&&yv()}function SS(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Sp(Gc)}function TS(r,o){if(r==="click")return Sp(o)}function IS(r,o){if(r==="input"||r==="change")return Sp(o)}function kS(r,o){return r===o&&(r!==0||1/r===1/o)||r!==r&&o!==o}var lo=typeof Object.is=="function"?Object.is:kS;function Hc(r,o){if(lo(r,o))return!0;if(typeof r!="object"||r===null||typeof o!="object"||o===null)return!1;var l=Object.keys(r),f=Object.keys(o);if(l.length!==f.length)return!1;for(f=0;f<l.length;f++){var _=l[f];if(!bm.call(o,_)||!lo(r[_],o[_]))return!1}return!0}function _v(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function vv(r,o){var l=_v(r);r=0;for(var f;l;){if(l.nodeType===3){if(f=r+l.textContent.length,r<=o&&f>=o)return{node:l,offset:o-r};r=f}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=_v(l)}}function Sx(r,o){return r&&o?r===o?!0:r&&r.nodeType===3?!1:o&&o.nodeType===3?Sx(r,o.parentNode):"contains"in r?r.contains(o):r.compareDocumentPosition?!!(r.compareDocumentPosition(o)&16):!1:!1}function Tx(){for(var r=window,o=Yd();o instanceof r.HTMLIFrameElement;){try{var l=typeof o.contentWindow.location.href=="string"}catch{l=!1}if(l)r=o.contentWindow;else break;o=Yd(r.document)}return o}function Ng(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o&&(o==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||o==="textarea"||r.contentEditable==="true")}function ES(r){var o=Tx(),l=r.focusedElem,f=r.selectionRange;if(o!==l&&l&&l.ownerDocument&&Sx(l.ownerDocument.documentElement,l)){if(f!==null&&Ng(l)){if(o=f.start,r=f.end,r===void 0&&(r=o),"selectionStart"in l)l.selectionStart=o,l.selectionEnd=Math.min(r,l.value.length);else if(r=(o=l.ownerDocument||document)&&o.defaultView||window,r.getSelection){r=r.getSelection();var _=l.textContent.length,S=Math.min(f.start,_);f=f.end===void 0?S:Math.min(f.end,_),!r.extend&&S>f&&(_=f,f=S,S=_),_=vv(l,S);var x=vv(l,f);_&&x&&(r.rangeCount!==1||r.anchorNode!==_.node||r.anchorOffset!==_.offset||r.focusNode!==x.node||r.focusOffset!==x.offset)&&(o=o.createRange(),o.setStart(_.node,_.offset),r.removeAllRanges(),S>f?(r.addRange(o),r.extend(x.node,x.offset)):(o.setEnd(x.node,x.offset),r.addRange(o)))}}for(o=[],r=l;r=r.parentNode;)r.nodeType===1&&o.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<o.length;l++)r=o[l],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var CS=Xo&&"documentMode"in document&&11>=document.documentMode,kl=null,Um=null,Lc=null,Vm=!1;function xv(r,o,l){var f=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Vm||kl==null||kl!==Yd(f)||(f=kl,"selectionStart"in f&&Ng(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Lc&&Hc(Lc,f)||(Lc=f,f=rp(Um,"onSelect"),0<f.length&&(o=new Fg("onSelect","select",null,o,l),r.push({event:o,listeners:f}),o.target=kl)))}function Cd(r,o){var l={};return l[r.toLowerCase()]=o.toLowerCase(),l["Webkit"+r]="webkit"+o,l["Moz"+r]="moz"+o,l}var El={animationend:Cd("Animation","AnimationEnd"),animationiteration:Cd("Animation","AnimationIteration"),animationstart:Cd("Animation","AnimationStart"),transitionend:Cd("Transition","TransitionEnd")},Qf={},Ix={};Xo&&(Ix=document.createElement("div").style,"AnimationEvent"in window||(delete El.animationend.animation,delete El.animationiteration.animation,delete El.animationstart.animation),"TransitionEvent"in window||delete El.transitionend.transition);function Tp(r){if(Qf[r])return Qf[r];if(!El[r])return r;var o=El[r],l;for(l in o)if(o.hasOwnProperty(l)&&l in Ix)return Qf[r]=o[l];return r}var kx=Tp("animationend"),Ex=Tp("animationiteration"),Cx=Tp("animationstart"),Px=Tp("transitionend"),Mx=new Map,wv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ha(r,o){Mx.set(r,o),Rs(o,[r])}for(var em=0;em<wv.length;em++){var tm=wv[em],PS=tm.toLowerCase(),MS=tm[0].toUpperCase()+tm.slice(1);Ha(PS,"on"+MS)}Ha(kx,"onAnimationEnd");Ha(Ex,"onAnimationIteration");Ha(Cx,"onAnimationStart");Ha("dblclick","onDoubleClick");Ha("focusin","onFocus");Ha("focusout","onBlur");Ha(Px,"onTransitionEnd");$l("onMouseEnter",["mouseout","mouseover"]);$l("onMouseLeave",["mouseout","mouseover"]);$l("onPointerEnter",["pointerout","pointerover"]);$l("onPointerLeave",["pointerout","pointerover"]);Rs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Rs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Rs("onBeforeInput",["compositionend","keypress","textInput","paste"]);Rs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Rs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Rs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zS=new Set("cancel close invalid load scroll toggle".split(" ").concat(Pc));function bv(r,o,l){var f=r.type||"unknown-event";r.currentTarget=l,P2(f,o,void 0,r),r.currentTarget=null}function zx(r,o){o=(o&4)!==0;for(var l=0;l<r.length;l++){var f=r[l],_=f.event;f=f.listeners;e:{var S=void 0;if(o)for(var x=f.length-1;0<=x;x--){var d=f[x],F=d.instance,Z=d.currentTarget;if(d=d.listener,F!==S&&_.isPropagationStopped())break e;bv(_,d,Z),S=F}else for(x=0;x<f.length;x++){if(d=f[x],F=d.instance,Z=d.currentTarget,d=d.listener,F!==S&&_.isPropagationStopped())break e;bv(_,d,Z),S=F}}}if(Xd)throw r=Bm,Xd=!1,Bm=null,r}function gr(r,o){var l=o[Hm];l===void 0&&(l=o[Hm]=new Set);var f=r+"__bubble";l.has(f)||(Ax(o,r,2,!1),l.add(f))}function rm(r,o,l){var f=0;o&&(f|=4),Ax(l,r,f,o)}var Pd="_reactListening"+Math.random().toString(36).slice(2);function Wc(r){if(!r[Pd]){r[Pd]=!0,N0.forEach(function(l){l!=="selectionchange"&&(zS.has(l)||rm(l,!1,r),rm(l,!0,r))});var o=r.nodeType===9?r:r.ownerDocument;o===null||o[Pd]||(o[Pd]=!0,rm("selectionchange",!1,o))}}function Ax(r,o,l,f){switch(mx(o)){case 1:var _=q2;break;case 4:_=G2;break;default:_=Lg}l=_.bind(null,o,l,r),_=void 0,!Fm||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(_=!0),f?_!==void 0?r.addEventListener(o,l,{capture:!0,passive:_}):r.addEventListener(o,l,!0):_!==void 0?r.addEventListener(o,l,{passive:_}):r.addEventListener(o,l,!1)}function im(r,o,l,f,_){var S=f;if(!(o&1)&&!(o&2)&&f!==null)e:for(;;){if(f===null)return;var x=f.tag;if(x===3||x===4){var d=f.stateNode.containerInfo;if(d===_||d.nodeType===8&&d.parentNode===_)break;if(x===4)for(x=f.return;x!==null;){var F=x.tag;if((F===3||F===4)&&(F=x.stateNode.containerInfo,F===_||F.nodeType===8&&F.parentNode===_))return;x=x.return}for(;d!==null;){if(x=bs(d),x===null)return;if(F=x.tag,F===5||F===6){f=S=x;continue e}d=d.parentNode}}f=f.return}tx(function(){var Z=S,Q=Mg(l),q=[];e:{var U=Mx.get(r);if(U!==void 0){var we=Fg,be=r;switch(r){case"keypress":if(Ud(l)===0)break e;case"keydown":case"keyup":we=sS;break;case"focusin":be="focus",we=Kf;break;case"focusout":be="blur",we=Kf;break;case"beforeblur":case"afterblur":we=Kf;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":we=cv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":we=Y2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":we=cS;break;case kx:case Ex:case Cx:we=J2;break;case Px:we=dS;break;case"scroll":we=H2;break;case"wheel":we=fS;break;case"copy":case"cut":case"paste":we=eS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":we=dv}var xe=(o&4)!==0,Ee=!xe&&r==="scroll",ne=xe?U!==null?U+"Capture":null:U;xe=[];for(var te=Z,ue;te!==null;){ue=te;var Te=ue.stateNode;if(ue.tag===5&&Te!==null&&(ue=Te,ne!==null&&(Te=Vc(te,ne),Te!=null&&xe.push(Yc(te,Te,ue)))),Ee)break;te=te.return}0<xe.length&&(U=new we(U,be,null,l,Q),q.push({event:U,listeners:xe}))}}if(!(o&7)){e:{if(U=r==="mouseover"||r==="pointerover",we=r==="mouseout"||r==="pointerout",U&&l!==Lm&&(be=l.relatedTarget||l.fromElement)&&(bs(be)||be[Jo]))break e;if((we||U)&&(U=Q.window===Q?Q:(U=Q.ownerDocument)?U.defaultView||U.parentWindow:window,we?(be=l.relatedTarget||l.toElement,we=Z,be=be?bs(be):null,be!==null&&(Ee=Fs(be),be!==Ee||be.tag!==5&&be.tag!==6)&&(be=null)):(we=null,be=Z),we!==be)){if(xe=cv,Te="onMouseLeave",ne="onMouseEnter",te="mouse",(r==="pointerout"||r==="pointerover")&&(xe=dv,Te="onPointerLeave",ne="onPointerEnter",te="pointer"),Ee=we==null?U:Cl(we),ue=be==null?U:Cl(be),U=new xe(Te,te+"leave",we,l,Q),U.target=Ee,U.relatedTarget=ue,Te=null,bs(Q)===Z&&(xe=new xe(ne,te+"enter",be,l,Q),xe.target=ue,xe.relatedTarget=Ee,Te=xe),Ee=Te,we&&be)t:{for(xe=we,ne=be,te=0,ue=xe;ue;ue=bl(ue))te++;for(ue=0,Te=ne;Te;Te=bl(Te))ue++;for(;0<te-ue;)xe=bl(xe),te--;for(;0<ue-te;)ne=bl(ne),ue--;for(;te--;){if(xe===ne||ne!==null&&xe===ne.alternate)break t;xe=bl(xe),ne=bl(ne)}xe=null}else xe=null;we!==null&&Sv(q,U,we,xe,!1),be!==null&&Ee!==null&&Sv(q,Ee,be,xe,!0)}}e:{if(U=Z?Cl(Z):window,we=U.nodeName&&U.nodeName.toLowerCase(),we==="select"||we==="input"&&U.type==="file")var Ne=wS;else if(mv(U))if(wx)Ne=IS;else{Ne=SS;var pe=bS}else(we=U.nodeName)&&we.toLowerCase()==="input"&&(U.type==="checkbox"||U.type==="radio")&&(Ne=TS);if(Ne&&(Ne=Ne(r,Z))){xx(q,Ne,l,Q);break e}pe&&pe(r,U,Z),r==="focusout"&&(pe=U._wrapperState)&&pe.controlled&&U.type==="number"&&Pm(U,"number",U.value)}switch(pe=Z?Cl(Z):window,r){case"focusin":(mv(pe)||pe.contentEditable==="true")&&(kl=pe,Um=Z,Lc=null);break;case"focusout":Lc=Um=kl=null;break;case"mousedown":Vm=!0;break;case"contextmenu":case"mouseup":case"dragend":Vm=!1,xv(q,l,Q);break;case"selectionchange":if(CS)break;case"keydown":case"keyup":xv(q,l,Q)}var Me;if(Og)e:{switch(r){case"compositionstart":var Ze="onCompositionStart";break e;case"compositionend":Ze="onCompositionEnd";break e;case"compositionupdate":Ze="onCompositionUpdate";break e}Ze=void 0}else Il?_x(r,l)&&(Ze="onCompositionEnd"):r==="keydown"&&l.keyCode===229&&(Ze="onCompositionStart");Ze&&(yx&&l.locale!=="ko"&&(Il||Ze!=="onCompositionStart"?Ze==="onCompositionEnd"&&Il&&(Me=gx()):(Ra=Q,Rg="value"in Ra?Ra.value:Ra.textContent,Il=!0)),pe=rp(Z,Ze),0<pe.length&&(Ze=new hv(Ze,r,null,l,Q),q.push({event:Ze,listeners:pe}),Me?Ze.data=Me:(Me=vx(l),Me!==null&&(Ze.data=Me)))),(Me=gS?yS(r,l):_S(r,l))&&(Z=rp(Z,"onBeforeInput"),0<Z.length&&(Q=new hv("onBeforeInput","beforeinput",null,l,Q),q.push({event:Q,listeners:Z}),Q.data=Me))}zx(q,o)})}function Yc(r,o,l){return{instance:r,listener:o,currentTarget:l}}function rp(r,o){for(var l=o+"Capture",f=[];r!==null;){var _=r,S=_.stateNode;_.tag===5&&S!==null&&(_=S,S=Vc(r,l),S!=null&&f.unshift(Yc(r,S,_)),S=Vc(r,o),S!=null&&f.push(Yc(r,S,_))),r=r.return}return f}function bl(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function Sv(r,o,l,f,_){for(var S=o._reactName,x=[];l!==null&&l!==f;){var d=l,F=d.alternate,Z=d.stateNode;if(F!==null&&F===f)break;d.tag===5&&Z!==null&&(d=Z,_?(F=Vc(l,S),F!=null&&x.unshift(Yc(l,F,d))):_||(F=Vc(l,S),F!=null&&x.push(Yc(l,F,d)))),l=l.return}x.length!==0&&r.push({event:o,listeners:x})}var AS=/\r\n?/g,DS=/\u0000|\uFFFD/g;function Tv(r){return(typeof r=="string"?r:""+r).replace(AS,`
`).replace(DS,"")}function Md(r,o,l){if(o=Tv(o),Tv(r)!==o&&l)throw Error(je(425))}function ip(){}var $m=null,Zm=null;function qm(r,o){return r==="textarea"||r==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Gm=typeof setTimeout=="function"?setTimeout:void 0,LS=typeof clearTimeout=="function"?clearTimeout:void 0,Iv=typeof Promise=="function"?Promise:void 0,RS=typeof queueMicrotask=="function"?queueMicrotask:typeof Iv<"u"?function(r){return Iv.resolve(null).then(r).catch(FS)}:Gm;function FS(r){setTimeout(function(){throw r})}function nm(r,o){var l=o,f=0;do{var _=l.nextSibling;if(r.removeChild(l),_&&_.nodeType===8)if(l=_.data,l==="/$"){if(f===0){r.removeChild(_),qc(o);return}f--}else l!=="$"&&l!=="$?"&&l!=="$!"||f++;l=_}while(l);qc(o)}function ja(r){for(;r!=null;r=r.nextSibling){var o=r.nodeType;if(o===1||o===3)break;if(o===8){if(o=r.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return r}function kv(r){r=r.previousSibling;for(var o=0;r;){if(r.nodeType===8){var l=r.data;if(l==="$"||l==="$!"||l==="$?"){if(o===0)return r;o--}else l==="/$"&&o++}r=r.previousSibling}return null}var eu=Math.random().toString(36).slice(2),wo="__reactFiber$"+eu,Kc="__reactProps$"+eu,Jo="__reactContainer$"+eu,Hm="__reactEvents$"+eu,BS="__reactListeners$"+eu,OS="__reactHandles$"+eu;function bs(r){var o=r[wo];if(o)return o;for(var l=r.parentNode;l;){if(o=l[Jo]||l[wo]){if(l=o.alternate,o.child!==null||l!==null&&l.child!==null)for(r=kv(r);r!==null;){if(l=r[wo])return l;r=kv(r)}return o}r=l,l=r.parentNode}return null}function uh(r){return r=r[wo]||r[Jo],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Cl(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(je(33))}function Ip(r){return r[Kc]||null}var Wm=[],Pl=-1;function Wa(r){return{current:r}}function yr(r){0>Pl||(r.current=Wm[Pl],Wm[Pl]=null,Pl--)}function hr(r,o){Pl++,Wm[Pl]=r.current,r.current=o}var Ga={},Ri=Wa(Ga),an=Wa(!1),Ps=Ga;function Zl(r,o){var l=r.type.contextTypes;if(!l)return Ga;var f=r.stateNode;if(f&&f.__reactInternalMemoizedUnmaskedChildContext===o)return f.__reactInternalMemoizedMaskedChildContext;var _={},S;for(S in l)_[S]=o[S];return f&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=o,r.__reactInternalMemoizedMaskedChildContext=_),_}function sn(r){return r=r.childContextTypes,r!=null}function np(){yr(an),yr(Ri)}function Ev(r,o,l){if(Ri.current!==Ga)throw Error(je(168));hr(Ri,o),hr(an,l)}function Dx(r,o,l){var f=r.stateNode;if(o=o.childContextTypes,typeof f.getChildContext!="function")return l;f=f.getChildContext();for(var _ in f)if(!(_ in o))throw Error(je(108,b2(r)||"Unknown",_));return Cr({},l,f)}function op(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Ga,Ps=Ri.current,hr(Ri,r),hr(an,an.current),!0}function Cv(r,o,l){var f=r.stateNode;if(!f)throw Error(je(169));l?(r=Dx(r,o,Ps),f.__reactInternalMemoizedMergedChildContext=r,yr(an),yr(Ri),hr(Ri,r)):yr(an),hr(an,l)}var Go=null,kp=!1,om=!1;function Lx(r){Go===null?Go=[r]:Go.push(r)}function NS(r){kp=!0,Lx(r)}function Ya(){if(!om&&Go!==null){om=!0;var r=0,o=tr;try{var l=Go;for(tr=1;r<l.length;r++){var f=l[r];do f=f(!0);while(f!==null)}Go=null,kp=!1}catch(_){throw Go!==null&&(Go=Go.slice(r+1)),ox(zg,Ya),_}finally{tr=o,om=!1}}return null}var Ml=[],zl=0,ap=null,sp=0,jn=[],Un=0,Ms=null,Ho=1,Wo="";function xs(r,o){Ml[zl++]=sp,Ml[zl++]=ap,ap=r,sp=o}function Rx(r,o,l){jn[Un++]=Ho,jn[Un++]=Wo,jn[Un++]=Ms,Ms=r;var f=Ho;r=Wo;var _=32-ao(f)-1;f&=~(1<<_),l+=1;var S=32-ao(o)+_;if(30<S){var x=_-_%5;S=(f&(1<<x)-1).toString(32),f>>=x,_-=x,Ho=1<<32-ao(o)+_|l<<_|f,Wo=S+r}else Ho=1<<S|l<<_|f,Wo=r}function jg(r){r.return!==null&&(xs(r,1),Rx(r,1,0))}function Ug(r){for(;r===ap;)ap=Ml[--zl],Ml[zl]=null,sp=Ml[--zl],Ml[zl]=null;for(;r===Ms;)Ms=jn[--Un],jn[Un]=null,Wo=jn[--Un],jn[Un]=null,Ho=jn[--Un],jn[Un]=null}var bn=null,wn=null,wr=!1,oo=null;function Fx(r,o){var l=Vn(5,null,null,0);l.elementType="DELETED",l.stateNode=o,l.return=r,o=r.deletions,o===null?(r.deletions=[l],r.flags|=16):o.push(l)}function Pv(r,o){switch(r.tag){case 5:var l=r.type;return o=o.nodeType!==1||l.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(r.stateNode=o,bn=r,wn=ja(o.firstChild),!0):!1;case 6:return o=r.pendingProps===""||o.nodeType!==3?null:o,o!==null?(r.stateNode=o,bn=r,wn=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(l=Ms!==null?{id:Ho,overflow:Wo}:null,r.memoizedState={dehydrated:o,treeContext:l,retryLane:1073741824},l=Vn(18,null,null,0),l.stateNode=o,l.return=r,r.child=l,bn=r,wn=null,!0):!1;default:return!1}}function Ym(r){return(r.mode&1)!==0&&(r.flags&128)===0}function Km(r){if(wr){var o=wn;if(o){var l=o;if(!Pv(r,o)){if(Ym(r))throw Error(je(418));o=ja(l.nextSibling);var f=bn;o&&Pv(r,o)?Fx(f,l):(r.flags=r.flags&-4097|2,wr=!1,bn=r)}}else{if(Ym(r))throw Error(je(418));r.flags=r.flags&-4097|2,wr=!1,bn=r}}}function Mv(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;bn=r}function zd(r){if(r!==bn)return!1;if(!wr)return Mv(r),wr=!0,!1;var o;if((o=r.tag!==3)&&!(o=r.tag!==5)&&(o=r.type,o=o!=="head"&&o!=="body"&&!qm(r.type,r.memoizedProps)),o&&(o=wn)){if(Ym(r))throw Bx(),Error(je(418));for(;o;)Fx(r,o),o=ja(o.nextSibling)}if(Mv(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(je(317));e:{for(r=r.nextSibling,o=0;r;){if(r.nodeType===8){var l=r.data;if(l==="/$"){if(o===0){wn=ja(r.nextSibling);break e}o--}else l!=="$"&&l!=="$!"&&l!=="$?"||o++}r=r.nextSibling}wn=null}}else wn=bn?ja(r.stateNode.nextSibling):null;return!0}function Bx(){for(var r=wn;r;)r=ja(r.nextSibling)}function ql(){wn=bn=null,wr=!1}function Vg(r){oo===null?oo=[r]:oo.push(r)}var jS=ta.ReactCurrentBatchConfig;function ro(r,o){if(r&&r.defaultProps){o=Cr({},o),r=r.defaultProps;for(var l in r)o[l]===void 0&&(o[l]=r[l]);return o}return o}var lp=Wa(null),up=null,Al=null,$g=null;function Zg(){$g=Al=up=null}function qg(r){var o=lp.current;yr(lp),r._currentValue=o}function Xm(r,o,l){for(;r!==null;){var f=r.alternate;if((r.childLanes&o)!==o?(r.childLanes|=o,f!==null&&(f.childLanes|=o)):f!==null&&(f.childLanes&o)!==o&&(f.childLanes|=o),r===l)break;r=r.return}}function Ul(r,o){up=r,$g=Al=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&o&&(on=!0),r.firstContext=null)}function Zn(r){var o=r._currentValue;if($g!==r)if(r={context:r,memoizedValue:o,next:null},Al===null){if(up===null)throw Error(je(308));Al=r,up.dependencies={lanes:0,firstContext:r}}else Al=Al.next=r;return o}var Ss=null;function Gg(r){Ss===null?Ss=[r]:Ss.push(r)}function Ox(r,o,l,f){var _=o.interleaved;return _===null?(l.next=l,Gg(o)):(l.next=_.next,_.next=l),o.interleaved=l,Qo(r,f)}function Qo(r,o){r.lanes|=o;var l=r.alternate;for(l!==null&&(l.lanes|=o),l=r,r=r.return;r!==null;)r.childLanes|=o,l=r.alternate,l!==null&&(l.childLanes|=o),l=r,r=r.return;return l.tag===3?l.stateNode:null}var Aa=!1;function Hg(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Nx(r,o){r=r.updateQueue,o.updateQueue===r&&(o.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function Yo(r,o){return{eventTime:r,lane:o,tag:0,payload:null,callback:null,next:null}}function Ua(r,o,l){var f=r.updateQueue;if(f===null)return null;if(f=f.shared,Zt&2){var _=f.pending;return _===null?o.next=o:(o.next=_.next,_.next=o),f.pending=o,Qo(r,l)}return _=f.interleaved,_===null?(o.next=o,Gg(f)):(o.next=_.next,_.next=o),f.interleaved=o,Qo(r,l)}function Vd(r,o,l){if(o=o.updateQueue,o!==null&&(o=o.shared,(l&4194240)!==0)){var f=o.lanes;f&=r.pendingLanes,l|=f,o.lanes=l,Ag(r,l)}}function zv(r,o){var l=r.updateQueue,f=r.alternate;if(f!==null&&(f=f.updateQueue,l===f)){var _=null,S=null;if(l=l.firstBaseUpdate,l!==null){do{var x={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};S===null?_=S=x:S=S.next=x,l=l.next}while(l!==null);S===null?_=S=o:S=S.next=o}else _=S=o;l={baseState:f.baseState,firstBaseUpdate:_,lastBaseUpdate:S,shared:f.shared,effects:f.effects},r.updateQueue=l;return}r=l.lastBaseUpdate,r===null?l.firstBaseUpdate=o:r.next=o,l.lastBaseUpdate=o}function cp(r,o,l,f){var _=r.updateQueue;Aa=!1;var S=_.firstBaseUpdate,x=_.lastBaseUpdate,d=_.shared.pending;if(d!==null){_.shared.pending=null;var F=d,Z=F.next;F.next=null,x===null?S=Z:x.next=Z,x=F;var Q=r.alternate;Q!==null&&(Q=Q.updateQueue,d=Q.lastBaseUpdate,d!==x&&(d===null?Q.firstBaseUpdate=Z:d.next=Z,Q.lastBaseUpdate=F))}if(S!==null){var q=_.baseState;x=0,Q=Z=F=null,d=S;do{var U=d.lane,we=d.eventTime;if((f&U)===U){Q!==null&&(Q=Q.next={eventTime:we,lane:0,tag:d.tag,payload:d.payload,callback:d.callback,next:null});e:{var be=r,xe=d;switch(U=o,we=l,xe.tag){case 1:if(be=xe.payload,typeof be=="function"){q=be.call(we,q,U);break e}q=be;break e;case 3:be.flags=be.flags&-65537|128;case 0:if(be=xe.payload,U=typeof be=="function"?be.call(we,q,U):be,U==null)break e;q=Cr({},q,U);break e;case 2:Aa=!0}}d.callback!==null&&d.lane!==0&&(r.flags|=64,U=_.effects,U===null?_.effects=[d]:U.push(d))}else we={eventTime:we,lane:U,tag:d.tag,payload:d.payload,callback:d.callback,next:null},Q===null?(Z=Q=we,F=q):Q=Q.next=we,x|=U;if(d=d.next,d===null){if(d=_.shared.pending,d===null)break;U=d,d=U.next,U.next=null,_.lastBaseUpdate=U,_.shared.pending=null}}while(!0);if(Q===null&&(F=q),_.baseState=F,_.firstBaseUpdate=Z,_.lastBaseUpdate=Q,o=_.shared.interleaved,o!==null){_=o;do x|=_.lane,_=_.next;while(_!==o)}else S===null&&(_.shared.lanes=0);As|=x,r.lanes=x,r.memoizedState=q}}function Av(r,o,l){if(r=o.effects,o.effects=null,r!==null)for(o=0;o<r.length;o++){var f=r[o],_=f.callback;if(_!==null){if(f.callback=null,f=l,typeof _!="function")throw Error(je(191,_));_.call(f)}}}var jx=new O0.Component().refs;function Jm(r,o,l,f){o=r.memoizedState,l=l(f,o),l=l==null?o:Cr({},o,l),r.memoizedState=l,r.lanes===0&&(r.updateQueue.baseState=l)}var Ep={isMounted:function(r){return(r=r._reactInternals)?Fs(r)===r:!1},enqueueSetState:function(r,o,l){r=r._reactInternals;var f=Wi(),_=$a(r),S=Yo(f,_);S.payload=o,l!=null&&(S.callback=l),o=Ua(r,S,_),o!==null&&(so(o,r,_,f),Vd(o,r,_))},enqueueReplaceState:function(r,o,l){r=r._reactInternals;var f=Wi(),_=$a(r),S=Yo(f,_);S.tag=1,S.payload=o,l!=null&&(S.callback=l),o=Ua(r,S,_),o!==null&&(so(o,r,_,f),Vd(o,r,_))},enqueueForceUpdate:function(r,o){r=r._reactInternals;var l=Wi(),f=$a(r),_=Yo(l,f);_.tag=2,o!=null&&(_.callback=o),o=Ua(r,_,f),o!==null&&(so(o,r,f,l),Vd(o,r,f))}};function Dv(r,o,l,f,_,S,x){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(f,S,x):o.prototype&&o.prototype.isPureReactComponent?!Hc(l,f)||!Hc(_,S):!0}function Ux(r,o,l){var f=!1,_=Ga,S=o.contextType;return typeof S=="object"&&S!==null?S=Zn(S):(_=sn(o)?Ps:Ri.current,f=o.contextTypes,S=(f=f!=null)?Zl(r,_):Ga),o=new o(l,S),r.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=Ep,r.stateNode=o,o._reactInternals=r,f&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=_,r.__reactInternalMemoizedMaskedChildContext=S),o}function Lv(r,o,l,f){r=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(l,f),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(l,f),o.state!==r&&Ep.enqueueReplaceState(o,o.state,null)}function Qm(r,o,l,f){var _=r.stateNode;_.props=l,_.state=r.memoizedState,_.refs=jx,Hg(r);var S=o.contextType;typeof S=="object"&&S!==null?_.context=Zn(S):(S=sn(o)?Ps:Ri.current,_.context=Zl(r,S)),_.state=r.memoizedState,S=o.getDerivedStateFromProps,typeof S=="function"&&(Jm(r,o,S,l),_.state=r.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(o=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),o!==_.state&&Ep.enqueueReplaceState(_,_.state,null),cp(r,l,_,f),_.state=r.memoizedState),typeof _.componentDidMount=="function"&&(r.flags|=4194308)}function mc(r,o,l){if(r=l.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(je(309));var f=l.stateNode}if(!f)throw Error(je(147,r));var _=f,S=""+r;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===S?o.ref:(o=function(x){var d=_.refs;d===jx&&(d=_.refs={}),x===null?delete d[S]:d[S]=x},o._stringRef=S,o)}if(typeof r!="string")throw Error(je(284));if(!l._owner)throw Error(je(290,r))}return r}function Ad(r,o){throw r=Object.prototype.toString.call(o),Error(je(31,r==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":r))}function Rv(r){var o=r._init;return o(r._payload)}function Vx(r){function o(ne,te){if(r){var ue=ne.deletions;ue===null?(ne.deletions=[te],ne.flags|=16):ue.push(te)}}function l(ne,te){if(!r)return null;for(;te!==null;)o(ne,te),te=te.sibling;return null}function f(ne,te){for(ne=new Map;te!==null;)te.key!==null?ne.set(te.key,te):ne.set(te.index,te),te=te.sibling;return ne}function _(ne,te){return ne=Za(ne,te),ne.index=0,ne.sibling=null,ne}function S(ne,te,ue){return ne.index=ue,r?(ue=ne.alternate,ue!==null?(ue=ue.index,ue<te?(ne.flags|=2,te):ue):(ne.flags|=2,te)):(ne.flags|=1048576,te)}function x(ne){return r&&ne.alternate===null&&(ne.flags|=2),ne}function d(ne,te,ue,Te){return te===null||te.tag!==6?(te=dm(ue,ne.mode,Te),te.return=ne,te):(te=_(te,ue),te.return=ne,te)}function F(ne,te,ue,Te){var Ne=ue.type;return Ne===Tl?Q(ne,te,ue.props.children,Te,ue.key):te!==null&&(te.elementType===Ne||typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===za&&Rv(Ne)===te.type)?(Te=_(te,ue.props),Te.ref=mc(ne,te,ue),Te.return=ne,Te):(Te=Wd(ue.type,ue.key,ue.props,null,ne.mode,Te),Te.ref=mc(ne,te,ue),Te.return=ne,Te)}function Z(ne,te,ue,Te){return te===null||te.tag!==4||te.stateNode.containerInfo!==ue.containerInfo||te.stateNode.implementation!==ue.implementation?(te=pm(ue,ne.mode,Te),te.return=ne,te):(te=_(te,ue.children||[]),te.return=ne,te)}function Q(ne,te,ue,Te,Ne){return te===null||te.tag!==7?(te=Cs(ue,ne.mode,Te,Ne),te.return=ne,te):(te=_(te,ue),te.return=ne,te)}function q(ne,te,ue){if(typeof te=="string"&&te!==""||typeof te=="number")return te=dm(""+te,ne.mode,ue),te.return=ne,te;if(typeof te=="object"&&te!==null){switch(te.$$typeof){case wd:return ue=Wd(te.type,te.key,te.props,null,ne.mode,ue),ue.ref=mc(ne,null,te),ue.return=ne,ue;case Sl:return te=pm(te,ne.mode,ue),te.return=ne,te;case za:var Te=te._init;return q(ne,Te(te._payload),ue)}if(Ec(te)||cc(te))return te=Cs(te,ne.mode,ue,null),te.return=ne,te;Ad(ne,te)}return null}function U(ne,te,ue,Te){var Ne=te!==null?te.key:null;if(typeof ue=="string"&&ue!==""||typeof ue=="number")return Ne!==null?null:d(ne,te,""+ue,Te);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case wd:return ue.key===Ne?F(ne,te,ue,Te):null;case Sl:return ue.key===Ne?Z(ne,te,ue,Te):null;case za:return Ne=ue._init,U(ne,te,Ne(ue._payload),Te)}if(Ec(ue)||cc(ue))return Ne!==null?null:Q(ne,te,ue,Te,null);Ad(ne,ue)}return null}function we(ne,te,ue,Te,Ne){if(typeof Te=="string"&&Te!==""||typeof Te=="number")return ne=ne.get(ue)||null,d(te,ne,""+Te,Ne);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case wd:return ne=ne.get(Te.key===null?ue:Te.key)||null,F(te,ne,Te,Ne);case Sl:return ne=ne.get(Te.key===null?ue:Te.key)||null,Z(te,ne,Te,Ne);case za:var pe=Te._init;return we(ne,te,ue,pe(Te._payload),Ne)}if(Ec(Te)||cc(Te))return ne=ne.get(ue)||null,Q(te,ne,Te,Ne,null);Ad(te,Te)}return null}function be(ne,te,ue,Te){for(var Ne=null,pe=null,Me=te,Ze=te=0,tt=null;Me!==null&&Ze<ue.length;Ze++){Me.index>Ze?(tt=Me,Me=null):tt=Me.sibling;var ct=U(ne,Me,ue[Ze],Te);if(ct===null){Me===null&&(Me=tt);break}r&&Me&&ct.alternate===null&&o(ne,Me),te=S(ct,te,Ze),pe===null?Ne=ct:pe.sibling=ct,pe=ct,Me=tt}if(Ze===ue.length)return l(ne,Me),wr&&xs(ne,Ze),Ne;if(Me===null){for(;Ze<ue.length;Ze++)Me=q(ne,ue[Ze],Te),Me!==null&&(te=S(Me,te,Ze),pe===null?Ne=Me:pe.sibling=Me,pe=Me);return wr&&xs(ne,Ze),Ne}for(Me=f(ne,Me);Ze<ue.length;Ze++)tt=we(Me,ne,Ze,ue[Ze],Te),tt!==null&&(r&&tt.alternate!==null&&Me.delete(tt.key===null?Ze:tt.key),te=S(tt,te,Ze),pe===null?Ne=tt:pe.sibling=tt,pe=tt);return r&&Me.forEach(function(vt){return o(ne,vt)}),wr&&xs(ne,Ze),Ne}function xe(ne,te,ue,Te){var Ne=cc(ue);if(typeof Ne!="function")throw Error(je(150));if(ue=Ne.call(ue),ue==null)throw Error(je(151));for(var pe=Ne=null,Me=te,Ze=te=0,tt=null,ct=ue.next();Me!==null&&!ct.done;Ze++,ct=ue.next()){Me.index>Ze?(tt=Me,Me=null):tt=Me.sibling;var vt=U(ne,Me,ct.value,Te);if(vt===null){Me===null&&(Me=tt);break}r&&Me&&vt.alternate===null&&o(ne,Me),te=S(vt,te,Ze),pe===null?Ne=vt:pe.sibling=vt,pe=vt,Me=tt}if(ct.done)return l(ne,Me),wr&&xs(ne,Ze),Ne;if(Me===null){for(;!ct.done;Ze++,ct=ue.next())ct=q(ne,ct.value,Te),ct!==null&&(te=S(ct,te,Ze),pe===null?Ne=ct:pe.sibling=ct,pe=ct);return wr&&xs(ne,Ze),Ne}for(Me=f(ne,Me);!ct.done;Ze++,ct=ue.next())ct=we(Me,ne,Ze,ct.value,Te),ct!==null&&(r&&ct.alternate!==null&&Me.delete(ct.key===null?Ze:ct.key),te=S(ct,te,Ze),pe===null?Ne=ct:pe.sibling=ct,pe=ct);return r&&Me.forEach(function(kt){return o(ne,kt)}),wr&&xs(ne,Ze),Ne}function Ee(ne,te,ue,Te){if(typeof ue=="object"&&ue!==null&&ue.type===Tl&&ue.key===null&&(ue=ue.props.children),typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case wd:e:{for(var Ne=ue.key,pe=te;pe!==null;){if(pe.key===Ne){if(Ne=ue.type,Ne===Tl){if(pe.tag===7){l(ne,pe.sibling),te=_(pe,ue.props.children),te.return=ne,ne=te;break e}}else if(pe.elementType===Ne||typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===za&&Rv(Ne)===pe.type){l(ne,pe.sibling),te=_(pe,ue.props),te.ref=mc(ne,pe,ue),te.return=ne,ne=te;break e}l(ne,pe);break}else o(ne,pe);pe=pe.sibling}ue.type===Tl?(te=Cs(ue.props.children,ne.mode,Te,ue.key),te.return=ne,ne=te):(Te=Wd(ue.type,ue.key,ue.props,null,ne.mode,Te),Te.ref=mc(ne,te,ue),Te.return=ne,ne=Te)}return x(ne);case Sl:e:{for(pe=ue.key;te!==null;){if(te.key===pe)if(te.tag===4&&te.stateNode.containerInfo===ue.containerInfo&&te.stateNode.implementation===ue.implementation){l(ne,te.sibling),te=_(te,ue.children||[]),te.return=ne,ne=te;break e}else{l(ne,te);break}else o(ne,te);te=te.sibling}te=pm(ue,ne.mode,Te),te.return=ne,ne=te}return x(ne);case za:return pe=ue._init,Ee(ne,te,pe(ue._payload),Te)}if(Ec(ue))return be(ne,te,ue,Te);if(cc(ue))return xe(ne,te,ue,Te);Ad(ne,ue)}return typeof ue=="string"&&ue!==""||typeof ue=="number"?(ue=""+ue,te!==null&&te.tag===6?(l(ne,te.sibling),te=_(te,ue),te.return=ne,ne=te):(l(ne,te),te=dm(ue,ne.mode,Te),te.return=ne,ne=te),x(ne)):l(ne,te)}return Ee}var Gl=Vx(!0),$x=Vx(!1),ch={},So=Wa(ch),Xc=Wa(ch),Jc=Wa(ch);function Ts(r){if(r===ch)throw Error(je(174));return r}function Wg(r,o){switch(hr(Jc,o),hr(Xc,r),hr(So,ch),r=o.nodeType,r){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:zm(null,"");break;default:r=r===8?o.parentNode:o,o=r.namespaceURI||null,r=r.tagName,o=zm(o,r)}yr(So),hr(So,o)}function Hl(){yr(So),yr(Xc),yr(Jc)}function Zx(r){Ts(Jc.current);var o=Ts(So.current),l=zm(o,r.type);o!==l&&(hr(Xc,r),hr(So,l))}function Yg(r){Xc.current===r&&(yr(So),yr(Xc))}var kr=Wa(0);function hp(r){for(var o=r;o!==null;){if(o.tag===13){var l=o.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var am=[];function Kg(){for(var r=0;r<am.length;r++)am[r]._workInProgressVersionPrimary=null;am.length=0}var $d=ta.ReactCurrentDispatcher,sm=ta.ReactCurrentBatchConfig,zs=0,Er=null,ti=null,ci=null,dp=!1,Rc=!1,Qc=0,US=0;function Ai(){throw Error(je(321))}function Xg(r,o){if(o===null)return!1;for(var l=0;l<o.length&&l<r.length;l++)if(!lo(r[l],o[l]))return!1;return!0}function Jg(r,o,l,f,_,S){if(zs=S,Er=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,$d.current=r===null||r.memoizedState===null?qS:GS,r=l(f,_),Rc){S=0;do{if(Rc=!1,Qc=0,25<=S)throw Error(je(301));S+=1,ci=ti=null,o.updateQueue=null,$d.current=HS,r=l(f,_)}while(Rc)}if($d.current=pp,o=ti!==null&&ti.next!==null,zs=0,ci=ti=Er=null,dp=!1,o)throw Error(je(300));return r}function Qg(){var r=Qc!==0;return Qc=0,r}function xo(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ci===null?Er.memoizedState=ci=r:ci=ci.next=r,ci}function qn(){if(ti===null){var r=Er.alternate;r=r!==null?r.memoizedState:null}else r=ti.next;var o=ci===null?Er.memoizedState:ci.next;if(o!==null)ci=o,ti=r;else{if(r===null)throw Error(je(310));ti=r,r={memoizedState:ti.memoizedState,baseState:ti.baseState,baseQueue:ti.baseQueue,queue:ti.queue,next:null},ci===null?Er.memoizedState=ci=r:ci=ci.next=r}return ci}function eh(r,o){return typeof o=="function"?o(r):o}function lm(r){var o=qn(),l=o.queue;if(l===null)throw Error(je(311));l.lastRenderedReducer=r;var f=ti,_=f.baseQueue,S=l.pending;if(S!==null){if(_!==null){var x=_.next;_.next=S.next,S.next=x}f.baseQueue=_=S,l.pending=null}if(_!==null){S=_.next,f=f.baseState;var d=x=null,F=null,Z=S;do{var Q=Z.lane;if((zs&Q)===Q)F!==null&&(F=F.next={lane:0,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null}),f=Z.hasEagerState?Z.eagerState:r(f,Z.action);else{var q={lane:Q,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null};F===null?(d=F=q,x=f):F=F.next=q,Er.lanes|=Q,As|=Q}Z=Z.next}while(Z!==null&&Z!==S);F===null?x=f:F.next=d,lo(f,o.memoizedState)||(on=!0),o.memoizedState=f,o.baseState=x,o.baseQueue=F,l.lastRenderedState=f}if(r=l.interleaved,r!==null){_=r;do S=_.lane,Er.lanes|=S,As|=S,_=_.next;while(_!==r)}else _===null&&(l.lanes=0);return[o.memoizedState,l.dispatch]}function um(r){var o=qn(),l=o.queue;if(l===null)throw Error(je(311));l.lastRenderedReducer=r;var f=l.dispatch,_=l.pending,S=o.memoizedState;if(_!==null){l.pending=null;var x=_=_.next;do S=r(S,x.action),x=x.next;while(x!==_);lo(S,o.memoizedState)||(on=!0),o.memoizedState=S,o.baseQueue===null&&(o.baseState=S),l.lastRenderedState=S}return[S,f]}function qx(){}function Gx(r,o){var l=Er,f=qn(),_=o(),S=!lo(f.memoizedState,_);if(S&&(f.memoizedState=_,on=!0),f=f.queue,ey(Yx.bind(null,l,f,r),[r]),f.getSnapshot!==o||S||ci!==null&&ci.memoizedState.tag&1){if(l.flags|=2048,th(9,Wx.bind(null,l,f,_,o),void 0,null),hi===null)throw Error(je(349));zs&30||Hx(l,o,_)}return _}function Hx(r,o,l){r.flags|=16384,r={getSnapshot:o,value:l},o=Er.updateQueue,o===null?(o={lastEffect:null,stores:null},Er.updateQueue=o,o.stores=[r]):(l=o.stores,l===null?o.stores=[r]:l.push(r))}function Wx(r,o,l,f){o.value=l,o.getSnapshot=f,Kx(o)&&Xx(r)}function Yx(r,o,l){return l(function(){Kx(o)&&Xx(r)})}function Kx(r){var o=r.getSnapshot;r=r.value;try{var l=o();return!lo(r,l)}catch{return!0}}function Xx(r){var o=Qo(r,1);o!==null&&so(o,r,1,-1)}function Fv(r){var o=xo();return typeof r=="function"&&(r=r()),o.memoizedState=o.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:eh,lastRenderedState:r},o.queue=r,r=r.dispatch=ZS.bind(null,Er,r),[o.memoizedState,r]}function th(r,o,l,f){return r={tag:r,create:o,destroy:l,deps:f,next:null},o=Er.updateQueue,o===null?(o={lastEffect:null,stores:null},Er.updateQueue=o,o.lastEffect=r.next=r):(l=o.lastEffect,l===null?o.lastEffect=r.next=r:(f=l.next,l.next=r,r.next=f,o.lastEffect=r)),r}function Jx(){return qn().memoizedState}function Zd(r,o,l,f){var _=xo();Er.flags|=r,_.memoizedState=th(1|o,l,void 0,f===void 0?null:f)}function Cp(r,o,l,f){var _=qn();f=f===void 0?null:f;var S=void 0;if(ti!==null){var x=ti.memoizedState;if(S=x.destroy,f!==null&&Xg(f,x.deps)){_.memoizedState=th(o,l,S,f);return}}Er.flags|=r,_.memoizedState=th(1|o,l,S,f)}function Bv(r,o){return Zd(8390656,8,r,o)}function ey(r,o){return Cp(2048,8,r,o)}function Qx(r,o){return Cp(4,2,r,o)}function e1(r,o){return Cp(4,4,r,o)}function t1(r,o){if(typeof o=="function")return r=r(),o(r),function(){o(null)};if(o!=null)return r=r(),o.current=r,function(){o.current=null}}function r1(r,o,l){return l=l!=null?l.concat([r]):null,Cp(4,4,t1.bind(null,o,r),l)}function ty(){}function i1(r,o){var l=qn();o=o===void 0?null:o;var f=l.memoizedState;return f!==null&&o!==null&&Xg(o,f[1])?f[0]:(l.memoizedState=[r,o],r)}function n1(r,o){var l=qn();o=o===void 0?null:o;var f=l.memoizedState;return f!==null&&o!==null&&Xg(o,f[1])?f[0]:(r=r(),l.memoizedState=[r,o],r)}function o1(r,o,l){return zs&21?(lo(l,o)||(l=lx(),Er.lanes|=l,As|=l,r.baseState=!0),o):(r.baseState&&(r.baseState=!1,on=!0),r.memoizedState=l)}function VS(r,o){var l=tr;tr=l!==0&&4>l?l:4,r(!0);var f=sm.transition;sm.transition={};try{r(!1),o()}finally{tr=l,sm.transition=f}}function a1(){return qn().memoizedState}function $S(r,o,l){var f=$a(r);if(l={lane:f,action:l,hasEagerState:!1,eagerState:null,next:null},s1(r))l1(o,l);else if(l=Ox(r,o,l,f),l!==null){var _=Wi();so(l,r,f,_),u1(l,o,f)}}function ZS(r,o,l){var f=$a(r),_={lane:f,action:l,hasEagerState:!1,eagerState:null,next:null};if(s1(r))l1(o,_);else{var S=r.alternate;if(r.lanes===0&&(S===null||S.lanes===0)&&(S=o.lastRenderedReducer,S!==null))try{var x=o.lastRenderedState,d=S(x,l);if(_.hasEagerState=!0,_.eagerState=d,lo(d,x)){var F=o.interleaved;F===null?(_.next=_,Gg(o)):(_.next=F.next,F.next=_),o.interleaved=_;return}}catch{}finally{}l=Ox(r,o,_,f),l!==null&&(_=Wi(),so(l,r,f,_),u1(l,o,f))}}function s1(r){var o=r.alternate;return r===Er||o!==null&&o===Er}function l1(r,o){Rc=dp=!0;var l=r.pending;l===null?o.next=o:(o.next=l.next,l.next=o),r.pending=o}function u1(r,o,l){if(l&4194240){var f=o.lanes;f&=r.pendingLanes,l|=f,o.lanes=l,Ag(r,l)}}var pp={readContext:Zn,useCallback:Ai,useContext:Ai,useEffect:Ai,useImperativeHandle:Ai,useInsertionEffect:Ai,useLayoutEffect:Ai,useMemo:Ai,useReducer:Ai,useRef:Ai,useState:Ai,useDebugValue:Ai,useDeferredValue:Ai,useTransition:Ai,useMutableSource:Ai,useSyncExternalStore:Ai,useId:Ai,unstable_isNewReconciler:!1},qS={readContext:Zn,useCallback:function(r,o){return xo().memoizedState=[r,o===void 0?null:o],r},useContext:Zn,useEffect:Bv,useImperativeHandle:function(r,o,l){return l=l!=null?l.concat([r]):null,Zd(4194308,4,t1.bind(null,o,r),l)},useLayoutEffect:function(r,o){return Zd(4194308,4,r,o)},useInsertionEffect:function(r,o){return Zd(4,2,r,o)},useMemo:function(r,o){var l=xo();return o=o===void 0?null:o,r=r(),l.memoizedState=[r,o],r},useReducer:function(r,o,l){var f=xo();return o=l!==void 0?l(o):o,f.memoizedState=f.baseState=o,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:o},f.queue=r,r=r.dispatch=$S.bind(null,Er,r),[f.memoizedState,r]},useRef:function(r){var o=xo();return r={current:r},o.memoizedState=r},useState:Fv,useDebugValue:ty,useDeferredValue:function(r){return xo().memoizedState=r},useTransition:function(){var r=Fv(!1),o=r[0];return r=VS.bind(null,r[1]),xo().memoizedState=r,[o,r]},useMutableSource:function(){},useSyncExternalStore:function(r,o,l){var f=Er,_=xo();if(wr){if(l===void 0)throw Error(je(407));l=l()}else{if(l=o(),hi===null)throw Error(je(349));zs&30||Hx(f,o,l)}_.memoizedState=l;var S={value:l,getSnapshot:o};return _.queue=S,Bv(Yx.bind(null,f,S,r),[r]),f.flags|=2048,th(9,Wx.bind(null,f,S,l,o),void 0,null),l},useId:function(){var r=xo(),o=hi.identifierPrefix;if(wr){var l=Wo,f=Ho;l=(f&~(1<<32-ao(f)-1)).toString(32)+l,o=":"+o+"R"+l,l=Qc++,0<l&&(o+="H"+l.toString(32)),o+=":"}else l=US++,o=":"+o+"r"+l.toString(32)+":";return r.memoizedState=o},unstable_isNewReconciler:!1},GS={readContext:Zn,useCallback:i1,useContext:Zn,useEffect:ey,useImperativeHandle:r1,useInsertionEffect:Qx,useLayoutEffect:e1,useMemo:n1,useReducer:lm,useRef:Jx,useState:function(){return lm(eh)},useDebugValue:ty,useDeferredValue:function(r){var o=qn();return o1(o,ti.memoizedState,r)},useTransition:function(){var r=lm(eh)[0],o=qn().memoizedState;return[r,o]},useMutableSource:qx,useSyncExternalStore:Gx,useId:a1,unstable_isNewReconciler:!1},HS={readContext:Zn,useCallback:i1,useContext:Zn,useEffect:ey,useImperativeHandle:r1,useInsertionEffect:Qx,useLayoutEffect:e1,useMemo:n1,useReducer:um,useRef:Jx,useState:function(){return um(eh)},useDebugValue:ty,useDeferredValue:function(r){var o=qn();return ti===null?o.memoizedState=r:o1(o,ti.memoizedState,r)},useTransition:function(){var r=um(eh)[0],o=qn().memoizedState;return[r,o]},useMutableSource:qx,useSyncExternalStore:Gx,useId:a1,unstable_isNewReconciler:!1};function Wl(r,o){try{var l="",f=o;do l+=w2(f),f=f.return;while(f);var _=l}catch(S){_=`
Error generating stack: `+S.message+`
`+S.stack}return{value:r,source:o,stack:_,digest:null}}function cm(r,o,l){return{value:r,source:null,stack:l??null,digest:o??null}}function eg(r,o){try{console.error(o.value)}catch(l){setTimeout(function(){throw l})}}var WS=typeof WeakMap=="function"?WeakMap:Map;function c1(r,o,l){l=Yo(-1,l),l.tag=3,l.payload={element:null};var f=o.value;return l.callback=function(){mp||(mp=!0,cg=f),eg(r,o)},l}function h1(r,o,l){l=Yo(-1,l),l.tag=3;var f=r.type.getDerivedStateFromError;if(typeof f=="function"){var _=o.value;l.payload=function(){return f(_)},l.callback=function(){eg(r,o)}}var S=r.stateNode;return S!==null&&typeof S.componentDidCatch=="function"&&(l.callback=function(){eg(r,o),typeof f!="function"&&(Va===null?Va=new Set([this]):Va.add(this));var x=o.stack;this.componentDidCatch(o.value,{componentStack:x!==null?x:""})}),l}function Ov(r,o,l){var f=r.pingCache;if(f===null){f=r.pingCache=new WS;var _=new Set;f.set(o,_)}else _=f.get(o),_===void 0&&(_=new Set,f.set(o,_));_.has(l)||(_.add(l),r=lT.bind(null,r,o,l),o.then(r,r))}function Nv(r){do{var o;if((o=r.tag===13)&&(o=r.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return r;r=r.return}while(r!==null);return null}function jv(r,o,l,f,_){return r.mode&1?(r.flags|=65536,r.lanes=_,r):(r===o?r.flags|=65536:(r.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(o=Yo(-1,1),o.tag=2,Ua(l,o,1))),l.lanes|=1),r)}var YS=ta.ReactCurrentOwner,on=!1;function Hi(r,o,l,f){o.child=r===null?$x(o,null,l,f):Gl(o,r.child,l,f)}function Uv(r,o,l,f,_){l=l.render;var S=o.ref;return Ul(o,_),f=Jg(r,o,l,f,S,_),l=Qg(),r!==null&&!on?(o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~_,ea(r,o,_)):(wr&&l&&jg(o),o.flags|=1,Hi(r,o,f,_),o.child)}function Vv(r,o,l,f,_){if(r===null){var S=l.type;return typeof S=="function"&&!uy(S)&&S.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(o.tag=15,o.type=S,d1(r,o,S,f,_)):(r=Wd(l.type,null,f,o,o.mode,_),r.ref=o.ref,r.return=o,o.child=r)}if(S=r.child,!(r.lanes&_)){var x=S.memoizedProps;if(l=l.compare,l=l!==null?l:Hc,l(x,f)&&r.ref===o.ref)return ea(r,o,_)}return o.flags|=1,r=Za(S,f),r.ref=o.ref,r.return=o,o.child=r}function d1(r,o,l,f,_){if(r!==null){var S=r.memoizedProps;if(Hc(S,f)&&r.ref===o.ref)if(on=!1,o.pendingProps=f=S,(r.lanes&_)!==0)r.flags&131072&&(on=!0);else return o.lanes=r.lanes,ea(r,o,_)}return tg(r,o,l,f,_)}function p1(r,o,l){var f=o.pendingProps,_=f.children,S=r!==null?r.memoizedState:null;if(f.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},hr(Ll,xn),xn|=l;else{if(!(l&1073741824))return r=S!==null?S.baseLanes|l:l,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:r,cachePool:null,transitions:null},o.updateQueue=null,hr(Ll,xn),xn|=r,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},f=S!==null?S.baseLanes:l,hr(Ll,xn),xn|=f}else S!==null?(f=S.baseLanes|l,o.memoizedState=null):f=l,hr(Ll,xn),xn|=f;return Hi(r,o,_,l),o.child}function f1(r,o){var l=o.ref;(r===null&&l!==null||r!==null&&r.ref!==l)&&(o.flags|=512,o.flags|=2097152)}function tg(r,o,l,f,_){var S=sn(l)?Ps:Ri.current;return S=Zl(o,S),Ul(o,_),l=Jg(r,o,l,f,S,_),f=Qg(),r!==null&&!on?(o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~_,ea(r,o,_)):(wr&&f&&jg(o),o.flags|=1,Hi(r,o,l,_),o.child)}function $v(r,o,l,f,_){if(sn(l)){var S=!0;op(o)}else S=!1;if(Ul(o,_),o.stateNode===null)qd(r,o),Ux(o,l,f),Qm(o,l,f,_),f=!0;else if(r===null){var x=o.stateNode,d=o.memoizedProps;x.props=d;var F=x.context,Z=l.contextType;typeof Z=="object"&&Z!==null?Z=Zn(Z):(Z=sn(l)?Ps:Ri.current,Z=Zl(o,Z));var Q=l.getDerivedStateFromProps,q=typeof Q=="function"||typeof x.getSnapshotBeforeUpdate=="function";q||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(d!==f||F!==Z)&&Lv(o,x,f,Z),Aa=!1;var U=o.memoizedState;x.state=U,cp(o,f,x,_),F=o.memoizedState,d!==f||U!==F||an.current||Aa?(typeof Q=="function"&&(Jm(o,l,Q,f),F=o.memoizedState),(d=Aa||Dv(o,l,d,f,U,F,Z))?(q||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(o.flags|=4194308)):(typeof x.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=f,o.memoizedState=F),x.props=f,x.state=F,x.context=Z,f=d):(typeof x.componentDidMount=="function"&&(o.flags|=4194308),f=!1)}else{x=o.stateNode,Nx(r,o),d=o.memoizedProps,Z=o.type===o.elementType?d:ro(o.type,d),x.props=Z,q=o.pendingProps,U=x.context,F=l.contextType,typeof F=="object"&&F!==null?F=Zn(F):(F=sn(l)?Ps:Ri.current,F=Zl(o,F));var we=l.getDerivedStateFromProps;(Q=typeof we=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(d!==q||U!==F)&&Lv(o,x,f,F),Aa=!1,U=o.memoizedState,x.state=U,cp(o,f,x,_);var be=o.memoizedState;d!==q||U!==be||an.current||Aa?(typeof we=="function"&&(Jm(o,l,we,f),be=o.memoizedState),(Z=Aa||Dv(o,l,Z,f,U,be,F)||!1)?(Q||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(f,be,F),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(f,be,F)),typeof x.componentDidUpdate=="function"&&(o.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof x.componentDidUpdate!="function"||d===r.memoizedProps&&U===r.memoizedState||(o.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||d===r.memoizedProps&&U===r.memoizedState||(o.flags|=1024),o.memoizedProps=f,o.memoizedState=be),x.props=f,x.state=be,x.context=F,f=Z):(typeof x.componentDidUpdate!="function"||d===r.memoizedProps&&U===r.memoizedState||(o.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||d===r.memoizedProps&&U===r.memoizedState||(o.flags|=1024),f=!1)}return rg(r,o,l,f,S,_)}function rg(r,o,l,f,_,S){f1(r,o);var x=(o.flags&128)!==0;if(!f&&!x)return _&&Cv(o,l,!1),ea(r,o,S);f=o.stateNode,YS.current=o;var d=x&&typeof l.getDerivedStateFromError!="function"?null:f.render();return o.flags|=1,r!==null&&x?(o.child=Gl(o,r.child,null,S),o.child=Gl(o,null,d,S)):Hi(r,o,d,S),o.memoizedState=f.state,_&&Cv(o,l,!0),o.child}function m1(r){var o=r.stateNode;o.pendingContext?Ev(r,o.pendingContext,o.pendingContext!==o.context):o.context&&Ev(r,o.context,!1),Wg(r,o.containerInfo)}function Zv(r,o,l,f,_){return ql(),Vg(_),o.flags|=256,Hi(r,o,l,f),o.child}var ig={dehydrated:null,treeContext:null,retryLane:0};function ng(r){return{baseLanes:r,cachePool:null,transitions:null}}function g1(r,o,l){var f=o.pendingProps,_=kr.current,S=!1,x=(o.flags&128)!==0,d;if((d=x)||(d=r!==null&&r.memoizedState===null?!1:(_&2)!==0),d?(S=!0,o.flags&=-129):(r===null||r.memoizedState!==null)&&(_|=1),hr(kr,_&1),r===null)return Km(o),r=o.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(o.mode&1?r.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(x=f.children,r=f.fallback,S?(f=o.mode,S=o.child,x={mode:"hidden",children:x},!(f&1)&&S!==null?(S.childLanes=0,S.pendingProps=x):S=zp(x,f,0,null),r=Cs(r,f,l,null),S.return=o,r.return=o,S.sibling=r,o.child=S,o.child.memoizedState=ng(l),o.memoizedState=ig,r):ry(o,x));if(_=r.memoizedState,_!==null&&(d=_.dehydrated,d!==null))return KS(r,o,x,f,d,_,l);if(S){S=f.fallback,x=o.mode,_=r.child,d=_.sibling;var F={mode:"hidden",children:f.children};return!(x&1)&&o.child!==_?(f=o.child,f.childLanes=0,f.pendingProps=F,o.deletions=null):(f=Za(_,F),f.subtreeFlags=_.subtreeFlags&14680064),d!==null?S=Za(d,S):(S=Cs(S,x,l,null),S.flags|=2),S.return=o,f.return=o,f.sibling=S,o.child=f,f=S,S=o.child,x=r.child.memoizedState,x=x===null?ng(l):{baseLanes:x.baseLanes|l,cachePool:null,transitions:x.transitions},S.memoizedState=x,S.childLanes=r.childLanes&~l,o.memoizedState=ig,f}return S=r.child,r=S.sibling,f=Za(S,{mode:"visible",children:f.children}),!(o.mode&1)&&(f.lanes=l),f.return=o,f.sibling=null,r!==null&&(l=o.deletions,l===null?(o.deletions=[r],o.flags|=16):l.push(r)),o.child=f,o.memoizedState=null,f}function ry(r,o){return o=zp({mode:"visible",children:o},r.mode,0,null),o.return=r,r.child=o}function Dd(r,o,l,f){return f!==null&&Vg(f),Gl(o,r.child,null,l),r=ry(o,o.pendingProps.children),r.flags|=2,o.memoizedState=null,r}function KS(r,o,l,f,_,S,x){if(l)return o.flags&256?(o.flags&=-257,f=cm(Error(je(422))),Dd(r,o,x,f)):o.memoizedState!==null?(o.child=r.child,o.flags|=128,null):(S=f.fallback,_=o.mode,f=zp({mode:"visible",children:f.children},_,0,null),S=Cs(S,_,x,null),S.flags|=2,f.return=o,S.return=o,f.sibling=S,o.child=f,o.mode&1&&Gl(o,r.child,null,x),o.child.memoizedState=ng(x),o.memoizedState=ig,S);if(!(o.mode&1))return Dd(r,o,x,null);if(_.data==="$!"){if(f=_.nextSibling&&_.nextSibling.dataset,f)var d=f.dgst;return f=d,S=Error(je(419)),f=cm(S,f,void 0),Dd(r,o,x,f)}if(d=(x&r.childLanes)!==0,on||d){if(f=hi,f!==null){switch(x&-x){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(f.suspendedLanes|x)?0:_,_!==0&&_!==S.retryLane&&(S.retryLane=_,Qo(r,_),so(f,r,_,-1))}return ly(),f=cm(Error(je(421))),Dd(r,o,x,f)}return _.data==="$?"?(o.flags|=128,o.child=r.child,o=uT.bind(null,r),_._reactRetry=o,null):(r=S.treeContext,wn=ja(_.nextSibling),bn=o,wr=!0,oo=null,r!==null&&(jn[Un++]=Ho,jn[Un++]=Wo,jn[Un++]=Ms,Ho=r.id,Wo=r.overflow,Ms=o),o=ry(o,f.children),o.flags|=4096,o)}function qv(r,o,l){r.lanes|=o;var f=r.alternate;f!==null&&(f.lanes|=o),Xm(r.return,o,l)}function hm(r,o,l,f,_){var S=r.memoizedState;S===null?r.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:f,tail:l,tailMode:_}:(S.isBackwards=o,S.rendering=null,S.renderingStartTime=0,S.last=f,S.tail=l,S.tailMode=_)}function y1(r,o,l){var f=o.pendingProps,_=f.revealOrder,S=f.tail;if(Hi(r,o,f.children,l),f=kr.current,f&2)f=f&1|2,o.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=o.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&qv(r,l,o);else if(r.tag===19)qv(r,l,o);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break e;for(;r.sibling===null;){if(r.return===null||r.return===o)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}f&=1}if(hr(kr,f),!(o.mode&1))o.memoizedState=null;else switch(_){case"forwards":for(l=o.child,_=null;l!==null;)r=l.alternate,r!==null&&hp(r)===null&&(_=l),l=l.sibling;l=_,l===null?(_=o.child,o.child=null):(_=l.sibling,l.sibling=null),hm(o,!1,_,l,S);break;case"backwards":for(l=null,_=o.child,o.child=null;_!==null;){if(r=_.alternate,r!==null&&hp(r)===null){o.child=_;break}r=_.sibling,_.sibling=l,l=_,_=r}hm(o,!0,l,null,S);break;case"together":hm(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function qd(r,o){!(o.mode&1)&&r!==null&&(r.alternate=null,o.alternate=null,o.flags|=2)}function ea(r,o,l){if(r!==null&&(o.dependencies=r.dependencies),As|=o.lanes,!(l&o.childLanes))return null;if(r!==null&&o.child!==r.child)throw Error(je(153));if(o.child!==null){for(r=o.child,l=Za(r,r.pendingProps),o.child=l,l.return=o;r.sibling!==null;)r=r.sibling,l=l.sibling=Za(r,r.pendingProps),l.return=o;l.sibling=null}return o.child}function XS(r,o,l){switch(o.tag){case 3:m1(o),ql();break;case 5:Zx(o);break;case 1:sn(o.type)&&op(o);break;case 4:Wg(o,o.stateNode.containerInfo);break;case 10:var f=o.type._context,_=o.memoizedProps.value;hr(lp,f._currentValue),f._currentValue=_;break;case 13:if(f=o.memoizedState,f!==null)return f.dehydrated!==null?(hr(kr,kr.current&1),o.flags|=128,null):l&o.child.childLanes?g1(r,o,l):(hr(kr,kr.current&1),r=ea(r,o,l),r!==null?r.sibling:null);hr(kr,kr.current&1);break;case 19:if(f=(l&o.childLanes)!==0,r.flags&128){if(f)return y1(r,o,l);o.flags|=128}if(_=o.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),hr(kr,kr.current),f)break;return null;case 22:case 23:return o.lanes=0,p1(r,o,l)}return ea(r,o,l)}var _1,og,v1,x1;_1=function(r,o){for(var l=o.child;l!==null;){if(l.tag===5||l.tag===6)r.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===o)break;for(;l.sibling===null;){if(l.return===null||l.return===o)return;l=l.return}l.sibling.return=l.return,l=l.sibling}};og=function(){};v1=function(r,o,l,f){var _=r.memoizedProps;if(_!==f){r=o.stateNode,Ts(So.current);var S=null;switch(l){case"input":_=Em(r,_),f=Em(r,f),S=[];break;case"select":_=Cr({},_,{value:void 0}),f=Cr({},f,{value:void 0}),S=[];break;case"textarea":_=Mm(r,_),f=Mm(r,f),S=[];break;default:typeof _.onClick!="function"&&typeof f.onClick=="function"&&(r.onclick=ip)}Am(l,f);var x;l=null;for(Z in _)if(!f.hasOwnProperty(Z)&&_.hasOwnProperty(Z)&&_[Z]!=null)if(Z==="style"){var d=_[Z];for(x in d)d.hasOwnProperty(x)&&(l||(l={}),l[x]="")}else Z!=="dangerouslySetInnerHTML"&&Z!=="children"&&Z!=="suppressContentEditableWarning"&&Z!=="suppressHydrationWarning"&&Z!=="autoFocus"&&(jc.hasOwnProperty(Z)?S||(S=[]):(S=S||[]).push(Z,null));for(Z in f){var F=f[Z];if(d=_!=null?_[Z]:void 0,f.hasOwnProperty(Z)&&F!==d&&(F!=null||d!=null))if(Z==="style")if(d){for(x in d)!d.hasOwnProperty(x)||F&&F.hasOwnProperty(x)||(l||(l={}),l[x]="");for(x in F)F.hasOwnProperty(x)&&d[x]!==F[x]&&(l||(l={}),l[x]=F[x])}else l||(S||(S=[]),S.push(Z,l)),l=F;else Z==="dangerouslySetInnerHTML"?(F=F?F.__html:void 0,d=d?d.__html:void 0,F!=null&&d!==F&&(S=S||[]).push(Z,F)):Z==="children"?typeof F!="string"&&typeof F!="number"||(S=S||[]).push(Z,""+F):Z!=="suppressContentEditableWarning"&&Z!=="suppressHydrationWarning"&&(jc.hasOwnProperty(Z)?(F!=null&&Z==="onScroll"&&gr("scroll",r),S||d===F||(S=[])):(S=S||[]).push(Z,F))}l&&(S=S||[]).push("style",l);var Z=S;(o.updateQueue=Z)&&(o.flags|=4)}};x1=function(r,o,l,f){l!==f&&(o.flags|=4)};function gc(r,o){if(!wr)switch(r.tailMode){case"hidden":o=r.tail;for(var l=null;o!==null;)o.alternate!==null&&(l=o),o=o.sibling;l===null?r.tail=null:l.sibling=null;break;case"collapsed":l=r.tail;for(var f=null;l!==null;)l.alternate!==null&&(f=l),l=l.sibling;f===null?o||r.tail===null?r.tail=null:r.tail.sibling=null:f.sibling=null}}function Di(r){var o=r.alternate!==null&&r.alternate.child===r.child,l=0,f=0;if(o)for(var _=r.child;_!==null;)l|=_.lanes|_.childLanes,f|=_.subtreeFlags&14680064,f|=_.flags&14680064,_.return=r,_=_.sibling;else for(_=r.child;_!==null;)l|=_.lanes|_.childLanes,f|=_.subtreeFlags,f|=_.flags,_.return=r,_=_.sibling;return r.subtreeFlags|=f,r.childLanes=l,o}function JS(r,o,l){var f=o.pendingProps;switch(Ug(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Di(o),null;case 1:return sn(o.type)&&np(),Di(o),null;case 3:return f=o.stateNode,Hl(),yr(an),yr(Ri),Kg(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(r===null||r.child===null)&&(zd(o)?o.flags|=4:r===null||r.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,oo!==null&&(pg(oo),oo=null))),og(r,o),Di(o),null;case 5:Yg(o);var _=Ts(Jc.current);if(l=o.type,r!==null&&o.stateNode!=null)v1(r,o,l,f,_),r.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!f){if(o.stateNode===null)throw Error(je(166));return Di(o),null}if(r=Ts(So.current),zd(o)){f=o.stateNode,l=o.type;var S=o.memoizedProps;switch(f[wo]=o,f[Kc]=S,r=(o.mode&1)!==0,l){case"dialog":gr("cancel",f),gr("close",f);break;case"iframe":case"object":case"embed":gr("load",f);break;case"video":case"audio":for(_=0;_<Pc.length;_++)gr(Pc[_],f);break;case"source":gr("error",f);break;case"img":case"image":case"link":gr("error",f),gr("load",f);break;case"details":gr("toggle",f);break;case"input":ev(f,S),gr("invalid",f);break;case"select":f._wrapperState={wasMultiple:!!S.multiple},gr("invalid",f);break;case"textarea":rv(f,S),gr("invalid",f)}Am(l,S),_=null;for(var x in S)if(S.hasOwnProperty(x)){var d=S[x];x==="children"?typeof d=="string"?f.textContent!==d&&(S.suppressHydrationWarning!==!0&&Md(f.textContent,d,r),_=["children",d]):typeof d=="number"&&f.textContent!==""+d&&(S.suppressHydrationWarning!==!0&&Md(f.textContent,d,r),_=["children",""+d]):jc.hasOwnProperty(x)&&d!=null&&x==="onScroll"&&gr("scroll",f)}switch(l){case"input":bd(f),tv(f,S,!0);break;case"textarea":bd(f),iv(f);break;case"select":case"option":break;default:typeof S.onClick=="function"&&(f.onclick=ip)}f=_,o.updateQueue=f,f!==null&&(o.flags|=4)}else{x=_.nodeType===9?_:_.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=H0(l)),r==="http://www.w3.org/1999/xhtml"?l==="script"?(r=x.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof f.is=="string"?r=x.createElement(l,{is:f.is}):(r=x.createElement(l),l==="select"&&(x=r,f.multiple?x.multiple=!0:f.size&&(x.size=f.size))):r=x.createElementNS(r,l),r[wo]=o,r[Kc]=f,_1(r,o,!1,!1),o.stateNode=r;e:{switch(x=Dm(l,f),l){case"dialog":gr("cancel",r),gr("close",r),_=f;break;case"iframe":case"object":case"embed":gr("load",r),_=f;break;case"video":case"audio":for(_=0;_<Pc.length;_++)gr(Pc[_],r);_=f;break;case"source":gr("error",r),_=f;break;case"img":case"image":case"link":gr("error",r),gr("load",r),_=f;break;case"details":gr("toggle",r),_=f;break;case"input":ev(r,f),_=Em(r,f),gr("invalid",r);break;case"option":_=f;break;case"select":r._wrapperState={wasMultiple:!!f.multiple},_=Cr({},f,{value:void 0}),gr("invalid",r);break;case"textarea":rv(r,f),_=Mm(r,f),gr("invalid",r);break;default:_=f}Am(l,_),d=_;for(S in d)if(d.hasOwnProperty(S)){var F=d[S];S==="style"?K0(r,F):S==="dangerouslySetInnerHTML"?(F=F?F.__html:void 0,F!=null&&W0(r,F)):S==="children"?typeof F=="string"?(l!=="textarea"||F!=="")&&Uc(r,F):typeof F=="number"&&Uc(r,""+F):S!=="suppressContentEditableWarning"&&S!=="suppressHydrationWarning"&&S!=="autoFocus"&&(jc.hasOwnProperty(S)?F!=null&&S==="onScroll"&&gr("scroll",r):F!=null&&kg(r,S,F,x))}switch(l){case"input":bd(r),tv(r,f,!1);break;case"textarea":bd(r),iv(r);break;case"option":f.value!=null&&r.setAttribute("value",""+qa(f.value));break;case"select":r.multiple=!!f.multiple,S=f.value,S!=null?Bl(r,!!f.multiple,S,!1):f.defaultValue!=null&&Bl(r,!!f.multiple,f.defaultValue,!0);break;default:typeof _.onClick=="function"&&(r.onclick=ip)}switch(l){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}}f&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return Di(o),null;case 6:if(r&&o.stateNode!=null)x1(r,o,r.memoizedProps,f);else{if(typeof f!="string"&&o.stateNode===null)throw Error(je(166));if(l=Ts(Jc.current),Ts(So.current),zd(o)){if(f=o.stateNode,l=o.memoizedProps,f[wo]=o,(S=f.nodeValue!==l)&&(r=bn,r!==null))switch(r.tag){case 3:Md(f.nodeValue,l,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Md(f.nodeValue,l,(r.mode&1)!==0)}S&&(o.flags|=4)}else f=(l.nodeType===9?l:l.ownerDocument).createTextNode(f),f[wo]=o,o.stateNode=f}return Di(o),null;case 13:if(yr(kr),f=o.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(wr&&wn!==null&&o.mode&1&&!(o.flags&128))Bx(),ql(),o.flags|=98560,S=!1;else if(S=zd(o),f!==null&&f.dehydrated!==null){if(r===null){if(!S)throw Error(je(318));if(S=o.memoizedState,S=S!==null?S.dehydrated:null,!S)throw Error(je(317));S[wo]=o}else ql(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;Di(o),S=!1}else oo!==null&&(pg(oo),oo=null),S=!0;if(!S)return o.flags&65536?o:null}return o.flags&128?(o.lanes=l,o):(f=f!==null,f!==(r!==null&&r.memoizedState!==null)&&f&&(o.child.flags|=8192,o.mode&1&&(r===null||kr.current&1?ri===0&&(ri=3):ly())),o.updateQueue!==null&&(o.flags|=4),Di(o),null);case 4:return Hl(),og(r,o),r===null&&Wc(o.stateNode.containerInfo),Di(o),null;case 10:return qg(o.type._context),Di(o),null;case 17:return sn(o.type)&&np(),Di(o),null;case 19:if(yr(kr),S=o.memoizedState,S===null)return Di(o),null;if(f=(o.flags&128)!==0,x=S.rendering,x===null)if(f)gc(S,!1);else{if(ri!==0||r!==null&&r.flags&128)for(r=o.child;r!==null;){if(x=hp(r),x!==null){for(o.flags|=128,gc(S,!1),f=x.updateQueue,f!==null&&(o.updateQueue=f,o.flags|=4),o.subtreeFlags=0,f=l,l=o.child;l!==null;)S=l,r=f,S.flags&=14680066,x=S.alternate,x===null?(S.childLanes=0,S.lanes=r,S.child=null,S.subtreeFlags=0,S.memoizedProps=null,S.memoizedState=null,S.updateQueue=null,S.dependencies=null,S.stateNode=null):(S.childLanes=x.childLanes,S.lanes=x.lanes,S.child=x.child,S.subtreeFlags=0,S.deletions=null,S.memoizedProps=x.memoizedProps,S.memoizedState=x.memoizedState,S.updateQueue=x.updateQueue,S.type=x.type,r=x.dependencies,S.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),l=l.sibling;return hr(kr,kr.current&1|2),o.child}r=r.sibling}S.tail!==null&&qr()>Yl&&(o.flags|=128,f=!0,gc(S,!1),o.lanes=4194304)}else{if(!f)if(r=hp(x),r!==null){if(o.flags|=128,f=!0,l=r.updateQueue,l!==null&&(o.updateQueue=l,o.flags|=4),gc(S,!0),S.tail===null&&S.tailMode==="hidden"&&!x.alternate&&!wr)return Di(o),null}else 2*qr()-S.renderingStartTime>Yl&&l!==1073741824&&(o.flags|=128,f=!0,gc(S,!1),o.lanes=4194304);S.isBackwards?(x.sibling=o.child,o.child=x):(l=S.last,l!==null?l.sibling=x:o.child=x,S.last=x)}return S.tail!==null?(o=S.tail,S.rendering=o,S.tail=o.sibling,S.renderingStartTime=qr(),o.sibling=null,l=kr.current,hr(kr,f?l&1|2:l&1),o):(Di(o),null);case 22:case 23:return sy(),f=o.memoizedState!==null,r!==null&&r.memoizedState!==null!==f&&(o.flags|=8192),f&&o.mode&1?xn&1073741824&&(Di(o),o.subtreeFlags&6&&(o.flags|=8192)):Di(o),null;case 24:return null;case 25:return null}throw Error(je(156,o.tag))}function QS(r,o){switch(Ug(o),o.tag){case 1:return sn(o.type)&&np(),r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 3:return Hl(),yr(an),yr(Ri),Kg(),r=o.flags,r&65536&&!(r&128)?(o.flags=r&-65537|128,o):null;case 5:return Yg(o),null;case 13:if(yr(kr),r=o.memoizedState,r!==null&&r.dehydrated!==null){if(o.alternate===null)throw Error(je(340));ql()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 19:return yr(kr),null;case 4:return Hl(),null;case 10:return qg(o.type._context),null;case 22:case 23:return sy(),null;case 24:return null;default:return null}}var Ld=!1,Li=!1,eT=typeof WeakSet=="function"?WeakSet:Set,nt=null;function Dl(r,o){var l=r.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(f){Rr(r,o,f)}else l.current=null}function ag(r,o,l){try{l()}catch(f){Rr(r,o,f)}}var Gv=!1;function tT(r,o){if($m=ep,r=Tx(),Ng(r)){if("selectionStart"in r)var l={start:r.selectionStart,end:r.selectionEnd};else e:{l=(l=r.ownerDocument)&&l.defaultView||window;var f=l.getSelection&&l.getSelection();if(f&&f.rangeCount!==0){l=f.anchorNode;var _=f.anchorOffset,S=f.focusNode;f=f.focusOffset;try{l.nodeType,S.nodeType}catch{l=null;break e}var x=0,d=-1,F=-1,Z=0,Q=0,q=r,U=null;t:for(;;){for(var we;q!==l||_!==0&&q.nodeType!==3||(d=x+_),q!==S||f!==0&&q.nodeType!==3||(F=x+f),q.nodeType===3&&(x+=q.nodeValue.length),(we=q.firstChild)!==null;)U=q,q=we;for(;;){if(q===r)break t;if(U===l&&++Z===_&&(d=x),U===S&&++Q===f&&(F=x),(we=q.nextSibling)!==null)break;q=U,U=q.parentNode}q=we}l=d===-1||F===-1?null:{start:d,end:F}}else l=null}l=l||{start:0,end:0}}else l=null;for(Zm={focusedElem:r,selectionRange:l},ep=!1,nt=o;nt!==null;)if(o=nt,r=o.child,(o.subtreeFlags&1028)!==0&&r!==null)r.return=o,nt=r;else for(;nt!==null;){o=nt;try{var be=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(be!==null){var xe=be.memoizedProps,Ee=be.memoizedState,ne=o.stateNode,te=ne.getSnapshotBeforeUpdate(o.elementType===o.type?xe:ro(o.type,xe),Ee);ne.__reactInternalSnapshotBeforeUpdate=te}break;case 3:var ue=o.stateNode.containerInfo;ue.nodeType===1?ue.textContent="":ue.nodeType===9&&ue.documentElement&&ue.removeChild(ue.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(je(163))}}catch(Te){Rr(o,o.return,Te)}if(r=o.sibling,r!==null){r.return=o.return,nt=r;break}nt=o.return}return be=Gv,Gv=!1,be}function Fc(r,o,l){var f=o.updateQueue;if(f=f!==null?f.lastEffect:null,f!==null){var _=f=f.next;do{if((_.tag&r)===r){var S=_.destroy;_.destroy=void 0,S!==void 0&&ag(o,l,S)}_=_.next}while(_!==f)}}function Pp(r,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var l=o=o.next;do{if((l.tag&r)===r){var f=l.create;l.destroy=f()}l=l.next}while(l!==o)}}function sg(r){var o=r.ref;if(o!==null){var l=r.stateNode;switch(r.tag){case 5:r=l;break;default:r=l}typeof o=="function"?o(r):o.current=r}}function w1(r){var o=r.alternate;o!==null&&(r.alternate=null,w1(o)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(o=r.stateNode,o!==null&&(delete o[wo],delete o[Kc],delete o[Hm],delete o[BS],delete o[OS])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function b1(r){return r.tag===5||r.tag===3||r.tag===4}function Hv(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||b1(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function lg(r,o,l){var f=r.tag;if(f===5||f===6)r=r.stateNode,o?l.nodeType===8?l.parentNode.insertBefore(r,o):l.insertBefore(r,o):(l.nodeType===8?(o=l.parentNode,o.insertBefore(r,l)):(o=l,o.appendChild(r)),l=l._reactRootContainer,l!=null||o.onclick!==null||(o.onclick=ip));else if(f!==4&&(r=r.child,r!==null))for(lg(r,o,l),r=r.sibling;r!==null;)lg(r,o,l),r=r.sibling}function ug(r,o,l){var f=r.tag;if(f===5||f===6)r=r.stateNode,o?l.insertBefore(r,o):l.appendChild(r);else if(f!==4&&(r=r.child,r!==null))for(ug(r,o,l),r=r.sibling;r!==null;)ug(r,o,l),r=r.sibling}var _i=null,io=!1;function Pa(r,o,l){for(l=l.child;l!==null;)S1(r,o,l),l=l.sibling}function S1(r,o,l){if(bo&&typeof bo.onCommitFiberUnmount=="function")try{bo.onCommitFiberUnmount(wp,l)}catch{}switch(l.tag){case 5:Li||Dl(l,o);case 6:var f=_i,_=io;_i=null,Pa(r,o,l),_i=f,io=_,_i!==null&&(io?(r=_i,l=l.stateNode,r.nodeType===8?r.parentNode.removeChild(l):r.removeChild(l)):_i.removeChild(l.stateNode));break;case 18:_i!==null&&(io?(r=_i,l=l.stateNode,r.nodeType===8?nm(r.parentNode,l):r.nodeType===1&&nm(r,l),qc(r)):nm(_i,l.stateNode));break;case 4:f=_i,_=io,_i=l.stateNode.containerInfo,io=!0,Pa(r,o,l),_i=f,io=_;break;case 0:case 11:case 14:case 15:if(!Li&&(f=l.updateQueue,f!==null&&(f=f.lastEffect,f!==null))){_=f=f.next;do{var S=_,x=S.destroy;S=S.tag,x!==void 0&&(S&2||S&4)&&ag(l,o,x),_=_.next}while(_!==f)}Pa(r,o,l);break;case 1:if(!Li&&(Dl(l,o),f=l.stateNode,typeof f.componentWillUnmount=="function"))try{f.props=l.memoizedProps,f.state=l.memoizedState,f.componentWillUnmount()}catch(d){Rr(l,o,d)}Pa(r,o,l);break;case 21:Pa(r,o,l);break;case 22:l.mode&1?(Li=(f=Li)||l.memoizedState!==null,Pa(r,o,l),Li=f):Pa(r,o,l);break;default:Pa(r,o,l)}}function Wv(r){var o=r.updateQueue;if(o!==null){r.updateQueue=null;var l=r.stateNode;l===null&&(l=r.stateNode=new eT),o.forEach(function(f){var _=cT.bind(null,r,f);l.has(f)||(l.add(f),f.then(_,_))})}}function to(r,o){var l=o.deletions;if(l!==null)for(var f=0;f<l.length;f++){var _=l[f];try{var S=r,x=o,d=x;e:for(;d!==null;){switch(d.tag){case 5:_i=d.stateNode,io=!1;break e;case 3:_i=d.stateNode.containerInfo,io=!0;break e;case 4:_i=d.stateNode.containerInfo,io=!0;break e}d=d.return}if(_i===null)throw Error(je(160));S1(S,x,_),_i=null,io=!1;var F=_.alternate;F!==null&&(F.return=null),_.return=null}catch(Z){Rr(_,o,Z)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)T1(o,r),o=o.sibling}function T1(r,o){var l=r.alternate,f=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(to(o,r),vo(r),f&4){try{Fc(3,r,r.return),Pp(3,r)}catch(xe){Rr(r,r.return,xe)}try{Fc(5,r,r.return)}catch(xe){Rr(r,r.return,xe)}}break;case 1:to(o,r),vo(r),f&512&&l!==null&&Dl(l,l.return);break;case 5:if(to(o,r),vo(r),f&512&&l!==null&&Dl(l,l.return),r.flags&32){var _=r.stateNode;try{Uc(_,"")}catch(xe){Rr(r,r.return,xe)}}if(f&4&&(_=r.stateNode,_!=null)){var S=r.memoizedProps,x=l!==null?l.memoizedProps:S,d=r.type,F=r.updateQueue;if(r.updateQueue=null,F!==null)try{d==="input"&&S.type==="radio"&&S.name!=null&&q0(_,S),Dm(d,x);var Z=Dm(d,S);for(x=0;x<F.length;x+=2){var Q=F[x],q=F[x+1];Q==="style"?K0(_,q):Q==="dangerouslySetInnerHTML"?W0(_,q):Q==="children"?Uc(_,q):kg(_,Q,q,Z)}switch(d){case"input":Cm(_,S);break;case"textarea":G0(_,S);break;case"select":var U=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!S.multiple;var we=S.value;we!=null?Bl(_,!!S.multiple,we,!1):U!==!!S.multiple&&(S.defaultValue!=null?Bl(_,!!S.multiple,S.defaultValue,!0):Bl(_,!!S.multiple,S.multiple?[]:"",!1))}_[Kc]=S}catch(xe){Rr(r,r.return,xe)}}break;case 6:if(to(o,r),vo(r),f&4){if(r.stateNode===null)throw Error(je(162));_=r.stateNode,S=r.memoizedProps;try{_.nodeValue=S}catch(xe){Rr(r,r.return,xe)}}break;case 3:if(to(o,r),vo(r),f&4&&l!==null&&l.memoizedState.isDehydrated)try{qc(o.containerInfo)}catch(xe){Rr(r,r.return,xe)}break;case 4:to(o,r),vo(r);break;case 13:to(o,r),vo(r),_=r.child,_.flags&8192&&(S=_.memoizedState!==null,_.stateNode.isHidden=S,!S||_.alternate!==null&&_.alternate.memoizedState!==null||(oy=qr())),f&4&&Wv(r);break;case 22:if(Q=l!==null&&l.memoizedState!==null,r.mode&1?(Li=(Z=Li)||Q,to(o,r),Li=Z):to(o,r),vo(r),f&8192){if(Z=r.memoizedState!==null,(r.stateNode.isHidden=Z)&&!Q&&r.mode&1)for(nt=r,Q=r.child;Q!==null;){for(q=nt=Q;nt!==null;){switch(U=nt,we=U.child,U.tag){case 0:case 11:case 14:case 15:Fc(4,U,U.return);break;case 1:Dl(U,U.return);var be=U.stateNode;if(typeof be.componentWillUnmount=="function"){f=U,l=U.return;try{o=f,be.props=o.memoizedProps,be.state=o.memoizedState,be.componentWillUnmount()}catch(xe){Rr(f,l,xe)}}break;case 5:Dl(U,U.return);break;case 22:if(U.memoizedState!==null){Kv(q);continue}}we!==null?(we.return=U,nt=we):Kv(q)}Q=Q.sibling}e:for(Q=null,q=r;;){if(q.tag===5){if(Q===null){Q=q;try{_=q.stateNode,Z?(S=_.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none"):(d=q.stateNode,F=q.memoizedProps.style,x=F!=null&&F.hasOwnProperty("display")?F.display:null,d.style.display=Y0("display",x))}catch(xe){Rr(r,r.return,xe)}}}else if(q.tag===6){if(Q===null)try{q.stateNode.nodeValue=Z?"":q.memoizedProps}catch(xe){Rr(r,r.return,xe)}}else if((q.tag!==22&&q.tag!==23||q.memoizedState===null||q===r)&&q.child!==null){q.child.return=q,q=q.child;continue}if(q===r)break e;for(;q.sibling===null;){if(q.return===null||q.return===r)break e;Q===q&&(Q=null),q=q.return}Q===q&&(Q=null),q.sibling.return=q.return,q=q.sibling}}break;case 19:to(o,r),vo(r),f&4&&Wv(r);break;case 21:break;default:to(o,r),vo(r)}}function vo(r){var o=r.flags;if(o&2){try{e:{for(var l=r.return;l!==null;){if(b1(l)){var f=l;break e}l=l.return}throw Error(je(160))}switch(f.tag){case 5:var _=f.stateNode;f.flags&32&&(Uc(_,""),f.flags&=-33);var S=Hv(r);ug(r,S,_);break;case 3:case 4:var x=f.stateNode.containerInfo,d=Hv(r);lg(r,d,x);break;default:throw Error(je(161))}}catch(F){Rr(r,r.return,F)}r.flags&=-3}o&4096&&(r.flags&=-4097)}function rT(r,o,l){nt=r,I1(r)}function I1(r,o,l){for(var f=(r.mode&1)!==0;nt!==null;){var _=nt,S=_.child;if(_.tag===22&&f){var x=_.memoizedState!==null||Ld;if(!x){var d=_.alternate,F=d!==null&&d.memoizedState!==null||Li;d=Ld;var Z=Li;if(Ld=x,(Li=F)&&!Z)for(nt=_;nt!==null;)x=nt,F=x.child,x.tag===22&&x.memoizedState!==null?Xv(_):F!==null?(F.return=x,nt=F):Xv(_);for(;S!==null;)nt=S,I1(S),S=S.sibling;nt=_,Ld=d,Li=Z}Yv(r)}else _.subtreeFlags&8772&&S!==null?(S.return=_,nt=S):Yv(r)}}function Yv(r){for(;nt!==null;){var o=nt;if(o.flags&8772){var l=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:Li||Pp(5,o);break;case 1:var f=o.stateNode;if(o.flags&4&&!Li)if(l===null)f.componentDidMount();else{var _=o.elementType===o.type?l.memoizedProps:ro(o.type,l.memoizedProps);f.componentDidUpdate(_,l.memoizedState,f.__reactInternalSnapshotBeforeUpdate)}var S=o.updateQueue;S!==null&&Av(o,S,f);break;case 3:var x=o.updateQueue;if(x!==null){if(l=null,o.child!==null)switch(o.child.tag){case 5:l=o.child.stateNode;break;case 1:l=o.child.stateNode}Av(o,x,l)}break;case 5:var d=o.stateNode;if(l===null&&o.flags&4){l=d;var F=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":F.autoFocus&&l.focus();break;case"img":F.src&&(l.src=F.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var Z=o.alternate;if(Z!==null){var Q=Z.memoizedState;if(Q!==null){var q=Q.dehydrated;q!==null&&qc(q)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(je(163))}Li||o.flags&512&&sg(o)}catch(U){Rr(o,o.return,U)}}if(o===r){nt=null;break}if(l=o.sibling,l!==null){l.return=o.return,nt=l;break}nt=o.return}}function Kv(r){for(;nt!==null;){var o=nt;if(o===r){nt=null;break}var l=o.sibling;if(l!==null){l.return=o.return,nt=l;break}nt=o.return}}function Xv(r){for(;nt!==null;){var o=nt;try{switch(o.tag){case 0:case 11:case 15:var l=o.return;try{Pp(4,o)}catch(F){Rr(o,l,F)}break;case 1:var f=o.stateNode;if(typeof f.componentDidMount=="function"){var _=o.return;try{f.componentDidMount()}catch(F){Rr(o,_,F)}}var S=o.return;try{sg(o)}catch(F){Rr(o,S,F)}break;case 5:var x=o.return;try{sg(o)}catch(F){Rr(o,x,F)}}}catch(F){Rr(o,o.return,F)}if(o===r){nt=null;break}var d=o.sibling;if(d!==null){d.return=o.return,nt=d;break}nt=o.return}}var iT=Math.ceil,fp=ta.ReactCurrentDispatcher,iy=ta.ReactCurrentOwner,$n=ta.ReactCurrentBatchConfig,Zt=0,hi=null,Jr=null,vi=0,xn=0,Ll=Wa(0),ri=0,rh=null,As=0,Mp=0,ny=0,Bc=null,nn=null,oy=0,Yl=1/0,qo=null,mp=!1,cg=null,Va=null,Rd=!1,Fa=null,gp=0,Oc=0,hg=null,Gd=-1,Hd=0;function Wi(){return Zt&6?qr():Gd!==-1?Gd:Gd=qr()}function $a(r){return r.mode&1?Zt&2&&vi!==0?vi&-vi:jS.transition!==null?(Hd===0&&(Hd=lx()),Hd):(r=tr,r!==0||(r=window.event,r=r===void 0?16:mx(r.type)),r):1}function so(r,o,l,f){if(50<Oc)throw Oc=0,hg=null,Error(je(185));sh(r,l,f),(!(Zt&2)||r!==hi)&&(r===hi&&(!(Zt&2)&&(Mp|=l),ri===4&&La(r,vi)),ln(r,f),l===1&&Zt===0&&!(o.mode&1)&&(Yl=qr()+500,kp&&Ya()))}function ln(r,o){var l=r.callbackNode;j2(r,o);var f=Qd(r,r===hi?vi:0);if(f===0)l!==null&&av(l),r.callbackNode=null,r.callbackPriority=0;else if(o=f&-f,r.callbackPriority!==o){if(l!=null&&av(l),o===1)r.tag===0?NS(Jv.bind(null,r)):Lx(Jv.bind(null,r)),RS(function(){!(Zt&6)&&Ya()}),l=null;else{switch(ux(f)){case 1:l=zg;break;case 4:l=ax;break;case 16:l=Jd;break;case 536870912:l=sx;break;default:l=Jd}l=D1(l,k1.bind(null,r))}r.callbackPriority=o,r.callbackNode=l}}function k1(r,o){if(Gd=-1,Hd=0,Zt&6)throw Error(je(327));var l=r.callbackNode;if(Vl()&&r.callbackNode!==l)return null;var f=Qd(r,r===hi?vi:0);if(f===0)return null;if(f&30||f&r.expiredLanes||o)o=yp(r,f);else{o=f;var _=Zt;Zt|=2;var S=C1();(hi!==r||vi!==o)&&(qo=null,Yl=qr()+500,Es(r,o));do try{aT();break}catch(d){E1(r,d)}while(!0);Zg(),fp.current=S,Zt=_,Jr!==null?o=0:(hi=null,vi=0,o=ri)}if(o!==0){if(o===2&&(_=Om(r),_!==0&&(f=_,o=dg(r,_))),o===1)throw l=rh,Es(r,0),La(r,f),ln(r,qr()),l;if(o===6)La(r,f);else{if(_=r.current.alternate,!(f&30)&&!nT(_)&&(o=yp(r,f),o===2&&(S=Om(r),S!==0&&(f=S,o=dg(r,S))),o===1))throw l=rh,Es(r,0),La(r,f),ln(r,qr()),l;switch(r.finishedWork=_,r.finishedLanes=f,o){case 0:case 1:throw Error(je(345));case 2:ws(r,nn,qo);break;case 3:if(La(r,f),(f&130023424)===f&&(o=oy+500-qr(),10<o)){if(Qd(r,0)!==0)break;if(_=r.suspendedLanes,(_&f)!==f){Wi(),r.pingedLanes|=r.suspendedLanes&_;break}r.timeoutHandle=Gm(ws.bind(null,r,nn,qo),o);break}ws(r,nn,qo);break;case 4:if(La(r,f),(f&4194240)===f)break;for(o=r.eventTimes,_=-1;0<f;){var x=31-ao(f);S=1<<x,x=o[x],x>_&&(_=x),f&=~S}if(f=_,f=qr()-f,f=(120>f?120:480>f?480:1080>f?1080:1920>f?1920:3e3>f?3e3:4320>f?4320:1960*iT(f/1960))-f,10<f){r.timeoutHandle=Gm(ws.bind(null,r,nn,qo),f);break}ws(r,nn,qo);break;case 5:ws(r,nn,qo);break;default:throw Error(je(329))}}}return ln(r,qr()),r.callbackNode===l?k1.bind(null,r):null}function dg(r,o){var l=Bc;return r.current.memoizedState.isDehydrated&&(Es(r,o).flags|=256),r=yp(r,o),r!==2&&(o=nn,nn=l,o!==null&&pg(o)),r}function pg(r){nn===null?nn=r:nn.push.apply(nn,r)}function nT(r){for(var o=r;;){if(o.flags&16384){var l=o.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var f=0;f<l.length;f++){var _=l[f],S=_.getSnapshot;_=_.value;try{if(!lo(S(),_))return!1}catch{return!1}}}if(l=o.child,o.subtreeFlags&16384&&l!==null)l.return=o,o=l;else{if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function La(r,o){for(o&=~ny,o&=~Mp,r.suspendedLanes|=o,r.pingedLanes&=~o,r=r.expirationTimes;0<o;){var l=31-ao(o),f=1<<l;r[l]=-1,o&=~f}}function Jv(r){if(Zt&6)throw Error(je(327));Vl();var o=Qd(r,0);if(!(o&1))return ln(r,qr()),null;var l=yp(r,o);if(r.tag!==0&&l===2){var f=Om(r);f!==0&&(o=f,l=dg(r,f))}if(l===1)throw l=rh,Es(r,0),La(r,o),ln(r,qr()),l;if(l===6)throw Error(je(345));return r.finishedWork=r.current.alternate,r.finishedLanes=o,ws(r,nn,qo),ln(r,qr()),null}function ay(r,o){var l=Zt;Zt|=1;try{return r(o)}finally{Zt=l,Zt===0&&(Yl=qr()+500,kp&&Ya())}}function Ds(r){Fa!==null&&Fa.tag===0&&!(Zt&6)&&Vl();var o=Zt;Zt|=1;var l=$n.transition,f=tr;try{if($n.transition=null,tr=1,r)return r()}finally{tr=f,$n.transition=l,Zt=o,!(Zt&6)&&Ya()}}function sy(){xn=Ll.current,yr(Ll)}function Es(r,o){r.finishedWork=null,r.finishedLanes=0;var l=r.timeoutHandle;if(l!==-1&&(r.timeoutHandle=-1,LS(l)),Jr!==null)for(l=Jr.return;l!==null;){var f=l;switch(Ug(f),f.tag){case 1:f=f.type.childContextTypes,f!=null&&np();break;case 3:Hl(),yr(an),yr(Ri),Kg();break;case 5:Yg(f);break;case 4:Hl();break;case 13:yr(kr);break;case 19:yr(kr);break;case 10:qg(f.type._context);break;case 22:case 23:sy()}l=l.return}if(hi=r,Jr=r=Za(r.current,null),vi=xn=o,ri=0,rh=null,ny=Mp=As=0,nn=Bc=null,Ss!==null){for(o=0;o<Ss.length;o++)if(l=Ss[o],f=l.interleaved,f!==null){l.interleaved=null;var _=f.next,S=l.pending;if(S!==null){var x=S.next;S.next=_,f.next=x}l.pending=f}Ss=null}return r}function E1(r,o){do{var l=Jr;try{if(Zg(),$d.current=pp,dp){for(var f=Er.memoizedState;f!==null;){var _=f.queue;_!==null&&(_.pending=null),f=f.next}dp=!1}if(zs=0,ci=ti=Er=null,Rc=!1,Qc=0,iy.current=null,l===null||l.return===null){ri=1,rh=o,Jr=null;break}e:{var S=r,x=l.return,d=l,F=o;if(o=vi,d.flags|=32768,F!==null&&typeof F=="object"&&typeof F.then=="function"){var Z=F,Q=d,q=Q.tag;if(!(Q.mode&1)&&(q===0||q===11||q===15)){var U=Q.alternate;U?(Q.updateQueue=U.updateQueue,Q.memoizedState=U.memoizedState,Q.lanes=U.lanes):(Q.updateQueue=null,Q.memoizedState=null)}var we=Nv(x);if(we!==null){we.flags&=-257,jv(we,x,d,S,o),we.mode&1&&Ov(S,Z,o),o=we,F=Z;var be=o.updateQueue;if(be===null){var xe=new Set;xe.add(F),o.updateQueue=xe}else be.add(F);break e}else{if(!(o&1)){Ov(S,Z,o),ly();break e}F=Error(je(426))}}else if(wr&&d.mode&1){var Ee=Nv(x);if(Ee!==null){!(Ee.flags&65536)&&(Ee.flags|=256),jv(Ee,x,d,S,o),Vg(Wl(F,d));break e}}S=F=Wl(F,d),ri!==4&&(ri=2),Bc===null?Bc=[S]:Bc.push(S),S=x;do{switch(S.tag){case 3:S.flags|=65536,o&=-o,S.lanes|=o;var ne=c1(S,F,o);zv(S,ne);break e;case 1:d=F;var te=S.type,ue=S.stateNode;if(!(S.flags&128)&&(typeof te.getDerivedStateFromError=="function"||ue!==null&&typeof ue.componentDidCatch=="function"&&(Va===null||!Va.has(ue)))){S.flags|=65536,o&=-o,S.lanes|=o;var Te=h1(S,d,o);zv(S,Te);break e}}S=S.return}while(S!==null)}M1(l)}catch(Ne){o=Ne,Jr===l&&l!==null&&(Jr=l=l.return);continue}break}while(!0)}function C1(){var r=fp.current;return fp.current=pp,r===null?pp:r}function ly(){(ri===0||ri===3||ri===2)&&(ri=4),hi===null||!(As&268435455)&&!(Mp&268435455)||La(hi,vi)}function yp(r,o){var l=Zt;Zt|=2;var f=C1();(hi!==r||vi!==o)&&(qo=null,Es(r,o));do try{oT();break}catch(_){E1(r,_)}while(!0);if(Zg(),Zt=l,fp.current=f,Jr!==null)throw Error(je(261));return hi=null,vi=0,ri}function oT(){for(;Jr!==null;)P1(Jr)}function aT(){for(;Jr!==null&&!z2();)P1(Jr)}function P1(r){var o=A1(r.alternate,r,xn);r.memoizedProps=r.pendingProps,o===null?M1(r):Jr=o,iy.current=null}function M1(r){var o=r;do{var l=o.alternate;if(r=o.return,o.flags&32768){if(l=QS(l,o),l!==null){l.flags&=32767,Jr=l;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{ri=6,Jr=null;return}}else if(l=JS(l,o,xn),l!==null){Jr=l;return}if(o=o.sibling,o!==null){Jr=o;return}Jr=o=r}while(o!==null);ri===0&&(ri=5)}function ws(r,o,l){var f=tr,_=$n.transition;try{$n.transition=null,tr=1,sT(r,o,l,f)}finally{$n.transition=_,tr=f}return null}function sT(r,o,l,f){do Vl();while(Fa!==null);if(Zt&6)throw Error(je(327));l=r.finishedWork;var _=r.finishedLanes;if(l===null)return null;if(r.finishedWork=null,r.finishedLanes=0,l===r.current)throw Error(je(177));r.callbackNode=null,r.callbackPriority=0;var S=l.lanes|l.childLanes;if(U2(r,S),r===hi&&(Jr=hi=null,vi=0),!(l.subtreeFlags&2064)&&!(l.flags&2064)||Rd||(Rd=!0,D1(Jd,function(){return Vl(),null})),S=(l.flags&15990)!==0,l.subtreeFlags&15990||S){S=$n.transition,$n.transition=null;var x=tr;tr=1;var d=Zt;Zt|=4,iy.current=null,tT(r,l),T1(l,r),ES(Zm),ep=!!$m,Zm=$m=null,r.current=l,rT(l),A2(),Zt=d,tr=x,$n.transition=S}else r.current=l;if(Rd&&(Rd=!1,Fa=r,gp=_),S=r.pendingLanes,S===0&&(Va=null),R2(l.stateNode),ln(r,qr()),o!==null)for(f=r.onRecoverableError,l=0;l<o.length;l++)_=o[l],f(_.value,{componentStack:_.stack,digest:_.digest});if(mp)throw mp=!1,r=cg,cg=null,r;return gp&1&&r.tag!==0&&Vl(),S=r.pendingLanes,S&1?r===hg?Oc++:(Oc=0,hg=r):Oc=0,Ya(),null}function Vl(){if(Fa!==null){var r=ux(gp),o=$n.transition,l=tr;try{if($n.transition=null,tr=16>r?16:r,Fa===null)var f=!1;else{if(r=Fa,Fa=null,gp=0,Zt&6)throw Error(je(331));var _=Zt;for(Zt|=4,nt=r.current;nt!==null;){var S=nt,x=S.child;if(nt.flags&16){var d=S.deletions;if(d!==null){for(var F=0;F<d.length;F++){var Z=d[F];for(nt=Z;nt!==null;){var Q=nt;switch(Q.tag){case 0:case 11:case 15:Fc(8,Q,S)}var q=Q.child;if(q!==null)q.return=Q,nt=q;else for(;nt!==null;){Q=nt;var U=Q.sibling,we=Q.return;if(w1(Q),Q===Z){nt=null;break}if(U!==null){U.return=we,nt=U;break}nt=we}}}var be=S.alternate;if(be!==null){var xe=be.child;if(xe!==null){be.child=null;do{var Ee=xe.sibling;xe.sibling=null,xe=Ee}while(xe!==null)}}nt=S}}if(S.subtreeFlags&2064&&x!==null)x.return=S,nt=x;else e:for(;nt!==null;){if(S=nt,S.flags&2048)switch(S.tag){case 0:case 11:case 15:Fc(9,S,S.return)}var ne=S.sibling;if(ne!==null){ne.return=S.return,nt=ne;break e}nt=S.return}}var te=r.current;for(nt=te;nt!==null;){x=nt;var ue=x.child;if(x.subtreeFlags&2064&&ue!==null)ue.return=x,nt=ue;else e:for(x=te;nt!==null;){if(d=nt,d.flags&2048)try{switch(d.tag){case 0:case 11:case 15:Pp(9,d)}}catch(Ne){Rr(d,d.return,Ne)}if(d===x){nt=null;break e}var Te=d.sibling;if(Te!==null){Te.return=d.return,nt=Te;break e}nt=d.return}}if(Zt=_,Ya(),bo&&typeof bo.onPostCommitFiberRoot=="function")try{bo.onPostCommitFiberRoot(wp,r)}catch{}f=!0}return f}finally{tr=l,$n.transition=o}}return!1}function Qv(r,o,l){o=Wl(l,o),o=c1(r,o,1),r=Ua(r,o,1),o=Wi(),r!==null&&(sh(r,1,o),ln(r,o))}function Rr(r,o,l){if(r.tag===3)Qv(r,r,l);else for(;o!==null;){if(o.tag===3){Qv(o,r,l);break}else if(o.tag===1){var f=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Va===null||!Va.has(f))){r=Wl(l,r),r=h1(o,r,1),o=Ua(o,r,1),r=Wi(),o!==null&&(sh(o,1,r),ln(o,r));break}}o=o.return}}function lT(r,o,l){var f=r.pingCache;f!==null&&f.delete(o),o=Wi(),r.pingedLanes|=r.suspendedLanes&l,hi===r&&(vi&l)===l&&(ri===4||ri===3&&(vi&130023424)===vi&&500>qr()-oy?Es(r,0):ny|=l),ln(r,o)}function z1(r,o){o===0&&(r.mode&1?(o=Id,Id<<=1,!(Id&130023424)&&(Id=4194304)):o=1);var l=Wi();r=Qo(r,o),r!==null&&(sh(r,o,l),ln(r,l))}function uT(r){var o=r.memoizedState,l=0;o!==null&&(l=o.retryLane),z1(r,l)}function cT(r,o){var l=0;switch(r.tag){case 13:var f=r.stateNode,_=r.memoizedState;_!==null&&(l=_.retryLane);break;case 19:f=r.stateNode;break;default:throw Error(je(314))}f!==null&&f.delete(o),z1(r,l)}var A1;A1=function(r,o,l){if(r!==null)if(r.memoizedProps!==o.pendingProps||an.current)on=!0;else{if(!(r.lanes&l)&&!(o.flags&128))return on=!1,XS(r,o,l);on=!!(r.flags&131072)}else on=!1,wr&&o.flags&1048576&&Rx(o,sp,o.index);switch(o.lanes=0,o.tag){case 2:var f=o.type;qd(r,o),r=o.pendingProps;var _=Zl(o,Ri.current);Ul(o,l),_=Jg(null,o,f,r,_,l);var S=Qg();return o.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,sn(f)?(S=!0,op(o)):S=!1,o.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,Hg(o),_.updater=Ep,o.stateNode=_,_._reactInternals=o,Qm(o,f,r,l),o=rg(null,o,f,!0,S,l)):(o.tag=0,wr&&S&&jg(o),Hi(null,o,_,l),o=o.child),o;case 16:f=o.elementType;e:{switch(qd(r,o),r=o.pendingProps,_=f._init,f=_(f._payload),o.type=f,_=o.tag=dT(f),r=ro(f,r),_){case 0:o=tg(null,o,f,r,l);break e;case 1:o=$v(null,o,f,r,l);break e;case 11:o=Uv(null,o,f,r,l);break e;case 14:o=Vv(null,o,f,ro(f.type,r),l);break e}throw Error(je(306,f,""))}return o;case 0:return f=o.type,_=o.pendingProps,_=o.elementType===f?_:ro(f,_),tg(r,o,f,_,l);case 1:return f=o.type,_=o.pendingProps,_=o.elementType===f?_:ro(f,_),$v(r,o,f,_,l);case 3:e:{if(m1(o),r===null)throw Error(je(387));f=o.pendingProps,S=o.memoizedState,_=S.element,Nx(r,o),cp(o,f,null,l);var x=o.memoizedState;if(f=x.element,S.isDehydrated)if(S={element:f,isDehydrated:!1,cache:x.cache,pendingSuspenseBoundaries:x.pendingSuspenseBoundaries,transitions:x.transitions},o.updateQueue.baseState=S,o.memoizedState=S,o.flags&256){_=Wl(Error(je(423)),o),o=Zv(r,o,f,l,_);break e}else if(f!==_){_=Wl(Error(je(424)),o),o=Zv(r,o,f,l,_);break e}else for(wn=ja(o.stateNode.containerInfo.firstChild),bn=o,wr=!0,oo=null,l=$x(o,null,f,l),o.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(ql(),f===_){o=ea(r,o,l);break e}Hi(r,o,f,l)}o=o.child}return o;case 5:return Zx(o),r===null&&Km(o),f=o.type,_=o.pendingProps,S=r!==null?r.memoizedProps:null,x=_.children,qm(f,_)?x=null:S!==null&&qm(f,S)&&(o.flags|=32),f1(r,o),Hi(r,o,x,l),o.child;case 6:return r===null&&Km(o),null;case 13:return g1(r,o,l);case 4:return Wg(o,o.stateNode.containerInfo),f=o.pendingProps,r===null?o.child=Gl(o,null,f,l):Hi(r,o,f,l),o.child;case 11:return f=o.type,_=o.pendingProps,_=o.elementType===f?_:ro(f,_),Uv(r,o,f,_,l);case 7:return Hi(r,o,o.pendingProps,l),o.child;case 8:return Hi(r,o,o.pendingProps.children,l),o.child;case 12:return Hi(r,o,o.pendingProps.children,l),o.child;case 10:e:{if(f=o.type._context,_=o.pendingProps,S=o.memoizedProps,x=_.value,hr(lp,f._currentValue),f._currentValue=x,S!==null)if(lo(S.value,x)){if(S.children===_.children&&!an.current){o=ea(r,o,l);break e}}else for(S=o.child,S!==null&&(S.return=o);S!==null;){var d=S.dependencies;if(d!==null){x=S.child;for(var F=d.firstContext;F!==null;){if(F.context===f){if(S.tag===1){F=Yo(-1,l&-l),F.tag=2;var Z=S.updateQueue;if(Z!==null){Z=Z.shared;var Q=Z.pending;Q===null?F.next=F:(F.next=Q.next,Q.next=F),Z.pending=F}}S.lanes|=l,F=S.alternate,F!==null&&(F.lanes|=l),Xm(S.return,l,o),d.lanes|=l;break}F=F.next}}else if(S.tag===10)x=S.type===o.type?null:S.child;else if(S.tag===18){if(x=S.return,x===null)throw Error(je(341));x.lanes|=l,d=x.alternate,d!==null&&(d.lanes|=l),Xm(x,l,o),x=S.sibling}else x=S.child;if(x!==null)x.return=S;else for(x=S;x!==null;){if(x===o){x=null;break}if(S=x.sibling,S!==null){S.return=x.return,x=S;break}x=x.return}S=x}Hi(r,o,_.children,l),o=o.child}return o;case 9:return _=o.type,f=o.pendingProps.children,Ul(o,l),_=Zn(_),f=f(_),o.flags|=1,Hi(r,o,f,l),o.child;case 14:return f=o.type,_=ro(f,o.pendingProps),_=ro(f.type,_),Vv(r,o,f,_,l);case 15:return d1(r,o,o.type,o.pendingProps,l);case 17:return f=o.type,_=o.pendingProps,_=o.elementType===f?_:ro(f,_),qd(r,o),o.tag=1,sn(f)?(r=!0,op(o)):r=!1,Ul(o,l),Ux(o,f,_),Qm(o,f,_,l),rg(null,o,f,!0,r,l);case 19:return y1(r,o,l);case 22:return p1(r,o,l)}throw Error(je(156,o.tag))};function D1(r,o){return ox(r,o)}function hT(r,o,l,f){this.tag=r,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vn(r,o,l,f){return new hT(r,o,l,f)}function uy(r){return r=r.prototype,!(!r||!r.isReactComponent)}function dT(r){if(typeof r=="function")return uy(r)?1:0;if(r!=null){if(r=r.$$typeof,r===Cg)return 11;if(r===Pg)return 14}return 2}function Za(r,o){var l=r.alternate;return l===null?(l=Vn(r.tag,o,r.key,r.mode),l.elementType=r.elementType,l.type=r.type,l.stateNode=r.stateNode,l.alternate=r,r.alternate=l):(l.pendingProps=o,l.type=r.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=r.flags&14680064,l.childLanes=r.childLanes,l.lanes=r.lanes,l.child=r.child,l.memoizedProps=r.memoizedProps,l.memoizedState=r.memoizedState,l.updateQueue=r.updateQueue,o=r.dependencies,l.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},l.sibling=r.sibling,l.index=r.index,l.ref=r.ref,l}function Wd(r,o,l,f,_,S){var x=2;if(f=r,typeof r=="function")uy(r)&&(x=1);else if(typeof r=="string")x=5;else e:switch(r){case Tl:return Cs(l.children,_,S,o);case Eg:x=8,_|=8;break;case Sm:return r=Vn(12,l,o,_|2),r.elementType=Sm,r.lanes=S,r;case Tm:return r=Vn(13,l,o,_),r.elementType=Tm,r.lanes=S,r;case Im:return r=Vn(19,l,o,_),r.elementType=Im,r.lanes=S,r;case V0:return zp(l,_,S,o);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case j0:x=10;break e;case U0:x=9;break e;case Cg:x=11;break e;case Pg:x=14;break e;case za:x=16,f=null;break e}throw Error(je(130,r==null?r:typeof r,""))}return o=Vn(x,l,o,_),o.elementType=r,o.type=f,o.lanes=S,o}function Cs(r,o,l,f){return r=Vn(7,r,f,o),r.lanes=l,r}function zp(r,o,l,f){return r=Vn(22,r,f,o),r.elementType=V0,r.lanes=l,r.stateNode={isHidden:!1},r}function dm(r,o,l){return r=Vn(6,r,null,o),r.lanes=l,r}function pm(r,o,l){return o=Vn(4,r.children!==null?r.children:[],r.key,o),o.lanes=l,o.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},o}function pT(r,o,l,f,_){this.tag=o,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Hf(0),this.expirationTimes=Hf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Hf(0),this.identifierPrefix=f,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function cy(r,o,l,f,_,S,x,d,F){return r=new pT(r,o,l,d,F),o===1?(o=1,S===!0&&(o|=8)):o=0,S=Vn(3,null,null,o),r.current=S,S.stateNode=r,S.memoizedState={element:f,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},Hg(S),r}function fT(r,o,l){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Sl,key:f==null?null:""+f,children:r,containerInfo:o,implementation:l}}function L1(r){if(!r)return Ga;r=r._reactInternals;e:{if(Fs(r)!==r||r.tag!==1)throw Error(je(170));var o=r;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(sn(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(je(171))}if(r.tag===1){var l=r.type;if(sn(l))return Dx(r,l,o)}return o}function R1(r,o,l,f,_,S,x,d,F){return r=cy(l,f,!0,r,_,S,x,d,F),r.context=L1(null),l=r.current,f=Wi(),_=$a(l),S=Yo(f,_),S.callback=o??null,Ua(l,S,_),r.current.lanes=_,sh(r,_,f),ln(r,f),r}function Ap(r,o,l,f){var _=o.current,S=Wi(),x=$a(_);return l=L1(l),o.context===null?o.context=l:o.pendingContext=l,o=Yo(S,x),o.payload={element:r},f=f===void 0?null:f,f!==null&&(o.callback=f),r=Ua(_,o,x),r!==null&&(so(r,_,x,S),Vd(r,_,x)),x}function _p(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function e0(r,o){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var l=r.retryLane;r.retryLane=l!==0&&l<o?l:o}}function hy(r,o){e0(r,o),(r=r.alternate)&&e0(r,o)}function mT(){return null}var F1=typeof reportError=="function"?reportError:function(r){console.error(r)};function dy(r){this._internalRoot=r}Dp.prototype.render=dy.prototype.render=function(r){var o=this._internalRoot;if(o===null)throw Error(je(409));Ap(r,o,null,null)};Dp.prototype.unmount=dy.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var o=r.containerInfo;Ds(function(){Ap(null,r,null,null)}),o[Jo]=null}};function Dp(r){this._internalRoot=r}Dp.prototype.unstable_scheduleHydration=function(r){if(r){var o=dx();r={blockedOn:null,target:r,priority:o};for(var l=0;l<Da.length&&o!==0&&o<Da[l].priority;l++);Da.splice(l,0,r),l===0&&fx(r)}};function py(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Lp(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function t0(){}function gT(r,o,l,f,_){if(_){if(typeof f=="function"){var S=f;f=function(){var Z=_p(x);S.call(Z)}}var x=R1(o,f,r,0,null,!1,!1,"",t0);return r._reactRootContainer=x,r[Jo]=x.current,Wc(r.nodeType===8?r.parentNode:r),Ds(),x}for(;_=r.lastChild;)r.removeChild(_);if(typeof f=="function"){var d=f;f=function(){var Z=_p(F);d.call(Z)}}var F=cy(r,0,!1,null,null,!1,!1,"",t0);return r._reactRootContainer=F,r[Jo]=F.current,Wc(r.nodeType===8?r.parentNode:r),Ds(function(){Ap(o,F,l,f)}),F}function Rp(r,o,l,f,_){var S=l._reactRootContainer;if(S){var x=S;if(typeof _=="function"){var d=_;_=function(){var F=_p(x);d.call(F)}}Ap(o,x,r,_)}else x=gT(l,o,r,_,f);return _p(x)}cx=function(r){switch(r.tag){case 3:var o=r.stateNode;if(o.current.memoizedState.isDehydrated){var l=Cc(o.pendingLanes);l!==0&&(Ag(o,l|1),ln(o,qr()),!(Zt&6)&&(Yl=qr()+500,Ya()))}break;case 13:Ds(function(){var f=Qo(r,1);if(f!==null){var _=Wi();so(f,r,1,_)}}),hy(r,1)}};Dg=function(r){if(r.tag===13){var o=Qo(r,134217728);if(o!==null){var l=Wi();so(o,r,134217728,l)}hy(r,134217728)}};hx=function(r){if(r.tag===13){var o=$a(r),l=Qo(r,o);if(l!==null){var f=Wi();so(l,r,o,f)}hy(r,o)}};dx=function(){return tr};px=function(r,o){var l=tr;try{return tr=r,o()}finally{tr=l}};Rm=function(r,o,l){switch(o){case"input":if(Cm(r,l),o=l.name,l.type==="radio"&&o!=null){for(l=r;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<l.length;o++){var f=l[o];if(f!==r&&f.form===r.form){var _=Ip(f);if(!_)throw Error(je(90));Z0(f),Cm(f,_)}}}break;case"textarea":G0(r,l);break;case"select":o=l.value,o!=null&&Bl(r,!!l.multiple,o,!1)}};Q0=ay;ex=Ds;var yT={usingClientEntryPoint:!1,Events:[uh,Cl,Ip,X0,J0,ay]},yc={findFiberByHostInstance:bs,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},_T={bundleType:yc.bundleType,version:yc.version,rendererPackageName:yc.rendererPackageName,rendererConfig:yc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ta.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=ix(r),r===null?null:r.stateNode},findFiberByHostInstance:yc.findFiberByHostInstance||mT,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Fd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Fd.isDisabled&&Fd.supportsFiber)try{wp=Fd.inject(_T),bo=Fd}catch{}}Tn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yT;Tn.createPortal=function(r,o){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!py(o))throw Error(je(200));return fT(r,o,null,l)};Tn.createRoot=function(r,o){if(!py(r))throw Error(je(299));var l=!1,f="",_=F1;return o!=null&&(o.unstable_strictMode===!0&&(l=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onRecoverableError!==void 0&&(_=o.onRecoverableError)),o=cy(r,1,!1,null,null,l,!1,f,_),r[Jo]=o.current,Wc(r.nodeType===8?r.parentNode:r),new dy(o)};Tn.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var o=r._reactInternals;if(o===void 0)throw typeof r.render=="function"?Error(je(188)):(r=Object.keys(r).join(","),Error(je(268,r)));return r=ix(o),r=r===null?null:r.stateNode,r};Tn.flushSync=function(r){return Ds(r)};Tn.hydrate=function(r,o,l){if(!Lp(o))throw Error(je(200));return Rp(null,r,o,!0,l)};Tn.hydrateRoot=function(r,o,l){if(!py(r))throw Error(je(405));var f=l!=null&&l.hydratedSources||null,_=!1,S="",x=F1;if(l!=null&&(l.unstable_strictMode===!0&&(_=!0),l.identifierPrefix!==void 0&&(S=l.identifierPrefix),l.onRecoverableError!==void 0&&(x=l.onRecoverableError)),o=R1(o,null,r,1,l??null,_,!1,S,x),r[Jo]=o.current,Wc(r),f)for(r=0;r<f.length;r++)l=f[r],_=l._getVersion,_=_(l._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[l,_]:o.mutableSourceEagerHydrationData.push(l,_);return new Dp(o)};Tn.render=function(r,o,l){if(!Lp(o))throw Error(je(200));return Rp(null,r,o,!1,l)};Tn.unmountComponentAtNode=function(r){if(!Lp(r))throw Error(je(40));return r._reactRootContainer?(Ds(function(){Rp(null,null,r,!1,function(){r._reactRootContainer=null,r[Jo]=null})}),!0):!1};Tn.unstable_batchedUpdates=ay;Tn.unstable_renderSubtreeIntoContainer=function(r,o,l,f){if(!Lp(l))throw Error(je(200));if(r==null||r._reactInternals===void 0)throw Error(je(38));return Rp(r,o,l,!1,f)};Tn.version="18.2.0-next-9e3b772b8-20220608";function B1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(B1)}catch(r){console.error(r)}}B1(),R0.exports=Tn;var fy=R0.exports;const vT=vg(fy),xT=S0({__proto__:null,default:vT},[fy]);var r0=fy;wm.createRoot=r0.createRoot,wm.hydrateRoot=r0.hydrateRoot;/**
 * @remix-run/router v1.15.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Fr(){return Fr=Object.assign?Object.assign.bind():function(r){for(var o=1;o<arguments.length;o++){var l=arguments[o];for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(r[f]=l[f])}return r},Fr.apply(this,arguments)}var Zr;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(Zr||(Zr={}));const i0="popstate";function wT(r){r===void 0&&(r={});function o(f,_){let{pathname:S,search:x,hash:d}=f.location;return ih("",{pathname:S,search:x,hash:d},_.state&&_.state.usr||null,_.state&&_.state.key||"default")}function l(f,_){return typeof _=="string"?_:Ls(_)}return ST(o,l,null,r)}function Ot(r,o){if(r===!1||r===null||typeof r>"u")throw new Error(o)}function Kl(r,o){if(!r){typeof console<"u"&&console.warn(o);try{throw new Error(o)}catch{}}}function bT(){return Math.random().toString(36).substr(2,8)}function n0(r,o){return{usr:r.state,key:r.key,idx:o}}function ih(r,o,l,f){return l===void 0&&(l=null),Fr({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof o=="string"?ra(o):o,{state:l,key:o&&o.key||f||bT()})}function Ls(r){let{pathname:o="/",search:l="",hash:f=""}=r;return l&&l!=="?"&&(o+=l.charAt(0)==="?"?l:"?"+l),f&&f!=="#"&&(o+=f.charAt(0)==="#"?f:"#"+f),o}function ra(r){let o={};if(r){let l=r.indexOf("#");l>=0&&(o.hash=r.substr(l),r=r.substr(0,l));let f=r.indexOf("?");f>=0&&(o.search=r.substr(f),r=r.substr(0,f)),r&&(o.pathname=r)}return o}function ST(r,o,l,f){f===void 0&&(f={});let{window:_=document.defaultView,v5Compat:S=!1}=f,x=_.history,d=Zr.Pop,F=null,Z=Q();Z==null&&(Z=0,x.replaceState(Fr({},x.state,{idx:Z}),""));function Q(){return(x.state||{idx:null}).idx}function q(){d=Zr.Pop;let Ee=Q(),ne=Ee==null?null:Ee-Z;Z=Ee,F&&F({action:d,location:xe.location,delta:ne})}function U(Ee,ne){d=Zr.Push;let te=ih(xe.location,Ee,ne);l&&l(te,Ee),Z=Q()+1;let ue=n0(te,Z),Te=xe.createHref(te);try{x.pushState(ue,"",Te)}catch(Ne){if(Ne instanceof DOMException&&Ne.name==="DataCloneError")throw Ne;_.location.assign(Te)}S&&F&&F({action:d,location:xe.location,delta:1})}function we(Ee,ne){d=Zr.Replace;let te=ih(xe.location,Ee,ne);l&&l(te,Ee),Z=Q();let ue=n0(te,Z),Te=xe.createHref(te);x.replaceState(ue,"",Te),S&&F&&F({action:d,location:xe.location,delta:0})}function be(Ee){let ne=_.location.origin!=="null"?_.location.origin:_.location.href,te=typeof Ee=="string"?Ee:Ls(Ee);return te=te.replace(/ $/,"%20"),Ot(ne,"No window.location.(origin|href) available to create URL for href: "+te),new URL(te,ne)}let xe={get action(){return d},get location(){return r(_,x)},listen(Ee){if(F)throw new Error("A history only accepts one active listener");return _.addEventListener(i0,q),F=Ee,()=>{_.removeEventListener(i0,q),F=null}},createHref(Ee){return o(_,Ee)},createURL:be,encodeLocation(Ee){let ne=be(Ee);return{pathname:ne.pathname,search:ne.search,hash:ne.hash}},push:U,replace:we,go(Ee){return x.go(Ee)}};return xe}var Lr;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(Lr||(Lr={}));const TT=new Set(["lazy","caseSensitive","path","id","index","children"]);function IT(r){return r.index===!0}function fg(r,o,l,f){return l===void 0&&(l=[]),f===void 0&&(f={}),r.map((_,S)=>{let x=[...l,S],d=typeof _.id=="string"?_.id:x.join("-");if(Ot(_.index!==!0||!_.children,"Cannot specify children on an index route"),Ot(!f[d],'Found a route id collision on id "'+d+`".  Route id's must be globally unique within Data Router usages`),IT(_)){let F=Fr({},_,o(_),{id:d});return f[d]=F,F}else{let F=Fr({},_,o(_),{id:d,children:void 0});return f[d]=F,_.children&&(F.children=fg(_.children,o,x,f)),F}})}function Rl(r,o,l){l===void 0&&(l="/");let f=typeof o=="string"?ra(o):o,_=tu(f.pathname||"/",l);if(_==null)return null;let S=O1(r);ET(S);let x=null;for(let d=0;x==null&&d<S.length;++d){let F=NT(_);x=FT(S[d],F)}return x}function kT(r,o){let{route:l,pathname:f,params:_}=r;return{id:l.id,pathname:f,params:_,data:o[l.id],handle:l.handle}}function O1(r,o,l,f){o===void 0&&(o=[]),l===void 0&&(l=[]),f===void 0&&(f="");let _=(S,x,d)=>{let F={relativePath:d===void 0?S.path||"":d,caseSensitive:S.caseSensitive===!0,childrenIndex:x,route:S};F.relativePath.startsWith("/")&&(Ot(F.relativePath.startsWith(f),'Absolute route path "'+F.relativePath+'" nested under path '+('"'+f+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),F.relativePath=F.relativePath.slice(f.length));let Z=Ko([f,F.relativePath]),Q=l.concat(F);S.children&&S.children.length>0&&(Ot(S.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+Z+'".')),O1(S.children,o,Q,Z)),!(S.path==null&&!S.index)&&o.push({path:Z,score:LT(Z,S.index),routesMeta:Q})};return r.forEach((S,x)=>{var d;if(S.path===""||!((d=S.path)!=null&&d.includes("?")))_(S,x);else for(let F of N1(S.path))_(S,x,F)}),o}function N1(r){let o=r.split("/");if(o.length===0)return[];let[l,...f]=o,_=l.endsWith("?"),S=l.replace(/\?$/,"");if(f.length===0)return _?[S,""]:[S];let x=N1(f.join("/")),d=[];return d.push(...x.map(F=>F===""?S:[S,F].join("/"))),_&&d.push(...x),d.map(F=>r.startsWith("/")&&F===""?"/":F)}function ET(r){r.sort((o,l)=>o.score!==l.score?l.score-o.score:RT(o.routesMeta.map(f=>f.childrenIndex),l.routesMeta.map(f=>f.childrenIndex)))}const CT=/^:[\w-]+$/,PT=3,MT=2,zT=1,AT=10,DT=-2,o0=r=>r==="*";function LT(r,o){let l=r.split("/"),f=l.length;return l.some(o0)&&(f+=DT),o&&(f+=MT),l.filter(_=>!o0(_)).reduce((_,S)=>_+(CT.test(S)?PT:S===""?zT:AT),f)}function RT(r,o){return r.length===o.length&&r.slice(0,-1).every((f,_)=>f===o[_])?r[r.length-1]-o[o.length-1]:0}function FT(r,o){let{routesMeta:l}=r,f={},_="/",S=[];for(let x=0;x<l.length;++x){let d=l[x],F=x===l.length-1,Z=_==="/"?o:o.slice(_.length)||"/",Q=BT({path:d.relativePath,caseSensitive:d.caseSensitive,end:F},Z);if(!Q)return null;Object.assign(f,Q.params);let q=d.route;S.push({params:f,pathname:Ko([_,Q.pathname]),pathnameBase:VT(Ko([_,Q.pathnameBase])),route:q}),Q.pathnameBase!=="/"&&(_=Ko([_,Q.pathnameBase]))}return S}function BT(r,o){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[l,f]=OT(r.path,r.caseSensitive,r.end),_=o.match(l);if(!_)return null;let S=_[0],x=S.replace(/(.)\/+$/,"$1"),d=_.slice(1);return{params:f.reduce((Z,Q,q)=>{let{paramName:U,isOptional:we}=Q;if(U==="*"){let xe=d[q]||"";x=S.slice(0,S.length-xe.length).replace(/(.)\/+$/,"$1")}const be=d[q];return we&&!be?Z[U]=void 0:Z[U]=(be||"").replace(/%2F/g,"/"),Z},{}),pathname:S,pathnameBase:x,pattern:r}}function OT(r,o,l){o===void 0&&(o=!1),l===void 0&&(l=!0),Kl(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let f=[],_="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(x,d,F)=>(f.push({paramName:d,isOptional:F!=null}),F?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(f.push({paramName:"*"}),_+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):l?_+="\\/*$":r!==""&&r!=="/"&&(_+="(?:(?=\\/|$))"),[new RegExp(_,o?void 0:"i"),f]}function NT(r){try{return r.split("/").map(o=>decodeURIComponent(o).replace(/\//g,"%2F")).join("/")}catch(o){return Kl(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+o+").")),r}}function tu(r,o){if(o==="/")return r;if(!r.toLowerCase().startsWith(o.toLowerCase()))return null;let l=o.endsWith("/")?o.length-1:o.length,f=r.charAt(l);return f&&f!=="/"?null:r.slice(l)||"/"}function jT(r,o){o===void 0&&(o="/");let{pathname:l,search:f="",hash:_=""}=typeof r=="string"?ra(r):r;return{pathname:l?l.startsWith("/")?l:UT(l,o):o,search:$T(f),hash:ZT(_)}}function UT(r,o){let l=o.replace(/\/+$/,"").split("/");return r.split("/").forEach(_=>{_===".."?l.length>1&&l.pop():_!=="."&&l.push(_)}),l.length>1?l.join("/"):"/"}function fm(r,o,l,f){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+o+"` field ["+JSON.stringify(f)+"].  Please separate it out to the ")+("`to."+l+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function j1(r){return r.filter((o,l)=>l===0||o.route.path&&o.route.path.length>0)}function my(r,o){let l=j1(r);return o?l.map((f,_)=>_===r.length-1?f.pathname:f.pathnameBase):l.map(f=>f.pathnameBase)}function gy(r,o,l,f){f===void 0&&(f=!1);let _;typeof r=="string"?_=ra(r):(_=Fr({},r),Ot(!_.pathname||!_.pathname.includes("?"),fm("?","pathname","search",_)),Ot(!_.pathname||!_.pathname.includes("#"),fm("#","pathname","hash",_)),Ot(!_.search||!_.search.includes("#"),fm("#","search","hash",_)));let S=r===""||_.pathname==="",x=S?"/":_.pathname,d;if(x==null)d=l;else{let q=o.length-1;if(!f&&x.startsWith("..")){let U=x.split("/");for(;U[0]==="..";)U.shift(),q-=1;_.pathname=U.join("/")}d=q>=0?o[q]:"/"}let F=jT(_,d),Z=x&&x!=="/"&&x.endsWith("/"),Q=(S||x===".")&&l.endsWith("/");return!F.pathname.endsWith("/")&&(Z||Q)&&(F.pathname+="/"),F}const Ko=r=>r.join("/").replace(/\/\/+/g,"/"),VT=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),$T=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,ZT=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;class yy{constructor(o,l,f,_){_===void 0&&(_=!1),this.status=o,this.statusText=l||"",this.internal=_,f instanceof Error?(this.data=f.toString(),this.error=f):this.data=f}}function U1(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const V1=["post","put","patch","delete"],qT=new Set(V1),GT=["get",...V1],HT=new Set(GT),WT=new Set([301,302,303,307,308]),YT=new Set([307,308]),mm={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},KT={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},_c={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},$1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,XT=r=>({hasErrorBoundary:!!r.hasErrorBoundary}),Z1="remix-router-transitions";function JT(r){const o=r.window?r.window:typeof window<"u"?window:void 0,l=typeof o<"u"&&typeof o.document<"u"&&typeof o.document.createElement<"u",f=!l;Ot(r.routes.length>0,"You must provide a non-empty routes array to createRouter");let _;if(r.mapRouteProperties)_=r.mapRouteProperties;else if(r.detectErrorBoundary){let E=r.detectErrorBoundary;_=M=>({hasErrorBoundary:E(M)})}else _=XT;let S={},x=fg(r.routes,_,void 0,S),d,F=r.basename||"/",Z=Fr({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1},r.future),Q=null,q=new Set,U=null,we=null,be=null,xe=r.hydrationData!=null,Ee=Rl(x,r.history.location,F),ne=null;if(Ee==null){let E=Nn(404,{pathname:r.history.location.pathname}),{matches:M,route:D}=p0(x);Ee=M,ne={[D.id]:E}}let te,ue=Ee.some(E=>E.route.lazy),Te=Ee.some(E=>E.route.loader);if(ue)te=!1;else if(!Te)te=!0;else if(Z.v7_partialHydration){let E=r.hydrationData?r.hydrationData.loaderData:null,M=r.hydrationData?r.hydrationData.errors:null,D=O=>O.route.loader?O.route.loader.hydrate===!0?!1:E&&E[O.route.id]!==void 0||M&&M[O.route.id]!==void 0:!0;if(M){let O=Ee.findIndex(X=>M[X.route.id]!==void 0);te=Ee.slice(0,O+1).every(D)}else te=Ee.every(D)}else te=r.hydrationData!=null;let Ne,pe={historyAction:r.history.action,location:r.history.location,matches:Ee,initialized:te,navigation:mm,restoreScrollPosition:r.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:r.hydrationData&&r.hydrationData.loaderData||{},actionData:r.hydrationData&&r.hydrationData.actionData||null,errors:r.hydrationData&&r.hydrationData.errors||ne,fetchers:new Map,blockers:new Map},Me=Zr.Pop,Ze=!1,tt,ct=!1,vt=new Map,kt=null,Dt=!1,lr=!1,wi=[],Gr=[],Vt=new Map,We=0,pt=-1,ht=new Map,xt=new Set,Ct=new Map,Hr=new Map,Wt=new Set,Br=new Map,or=new Map,Pr=!1;function Fi(){if(Q=r.history.listen(E=>{let{action:M,location:D,delta:O}=E;if(Pr){Pr=!1;return}Kl(or.size===0||O!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let X=gt({currentLocation:pe.location,nextLocation:D,historyAction:M});if(X&&O!=null){Pr=!0,r.history.go(O*-1),mt(X,{state:"blocked",location:D,proceed(){mt(X,{state:"proceeding",proceed:void 0,reset:void 0,location:D}),r.history.go(O)},reset(){let re=new Map(pe.blockers);re.set(X,_c),Wr({blockers:re})}});return}return Xt(M,D)}),l){uI(o,vt);let E=()=>cI(o,vt);o.addEventListener("pagehide",E),kt=()=>o.removeEventListener("pagehide",E)}return pe.initialized||Xt(Zr.Pop,pe.location,{initialHydration:!0}),Ne}function uo(){Q&&Q(),kt&&kt(),q.clear(),tt&&tt.abort(),pe.fetchers.forEach((E,M)=>cn(M)),pe.blockers.forEach((E,M)=>Fe(M))}function kn(E){return q.add(E),()=>q.delete(E)}function Wr(E,M){M===void 0&&(M={}),pe=Fr({},pe,E);let D=[],O=[];Z.v7_fetcherPersist&&pe.fetchers.forEach((X,re)=>{X.state==="idle"&&(Wt.has(re)?O.push(re):D.push(re))}),[...q].forEach(X=>X(pe,{deletedFetchers:O,unstable_viewTransitionOpts:M.viewTransitionOpts,unstable_flushSync:M.flushSync===!0})),Z.v7_fetcherPersist&&(D.forEach(X=>pe.fetchers.delete(X)),O.forEach(X=>cn(X)))}function bi(E,M,D){var O,X;let{flushSync:re}=D===void 0?{}:D,oe=pe.actionData!=null&&pe.navigation.formMethod!=null&&no(pe.navigation.formMethod)&&pe.navigation.state==="loading"&&((O=E.state)==null?void 0:O._isRedirect)!==!0,W;M.actionData?Object.keys(M.actionData).length>0?W=M.actionData:W=null:oe?W=pe.actionData:W=null;let se=M.loaderData?d0(pe.loaderData,M.loaderData,M.matches||[],M.errors):pe.loaderData,_e=pe.blockers;_e.size>0&&(_e=new Map(_e),_e.forEach((Oe,Je)=>_e.set(Je,_c)));let ve=Ze===!0||pe.navigation.formMethod!=null&&no(pe.navigation.formMethod)&&((X=E.state)==null?void 0:X._isRedirect)!==!0;d&&(x=d,d=void 0),Dt||Me===Zr.Pop||(Me===Zr.Push?r.history.push(E,E.state):Me===Zr.Replace&&r.history.replace(E,E.state));let fe;if(Me===Zr.Pop){let Oe=vt.get(pe.location.pathname);Oe&&Oe.has(E.pathname)?fe={currentLocation:pe.location,nextLocation:E}:vt.has(E.pathname)&&(fe={currentLocation:E,nextLocation:pe.location})}else if(ct){let Oe=vt.get(pe.location.pathname);Oe?Oe.add(E.pathname):(Oe=new Set([E.pathname]),vt.set(pe.location.pathname,Oe)),fe={currentLocation:pe.location,nextLocation:E}}Wr(Fr({},M,{actionData:W,loaderData:se,historyAction:Me,location:E,initialized:!0,navigation:mm,revalidation:"idle",restoreScrollPosition:Ji(E,M.matches||pe.matches),preventScrollReset:ve,blockers:_e}),{viewTransitionOpts:fe,flushSync:re===!0}),Me=Zr.Pop,Ze=!1,ct=!1,Dt=!1,lr=!1,wi=[],Gr=[]}async function un(E,M){if(typeof E=="number"){r.history.go(E);return}let D=mg(pe.location,pe.matches,F,Z.v7_prependBasename,E,Z.v7_relativeSplatPath,M==null?void 0:M.fromRouteId,M==null?void 0:M.relative),{path:O,submission:X,error:re}=a0(Z.v7_normalizeFormMethod,!1,D,M),oe=pe.location,W=ih(pe.location,O,M&&M.state);W=Fr({},W,r.history.encodeLocation(W));let se=M&&M.replace!=null?M.replace:void 0,_e=Zr.Push;se===!0?_e=Zr.Replace:se===!1||X!=null&&no(X.formMethod)&&X.formAction===pe.location.pathname+pe.location.search&&(_e=Zr.Replace);let ve=M&&"preventScrollReset"in M?M.preventScrollReset===!0:void 0,fe=(M&&M.unstable_flushSync)===!0,Oe=gt({currentLocation:oe,nextLocation:W,historyAction:_e});if(Oe){mt(Oe,{state:"blocked",location:W,proceed(){mt(Oe,{state:"proceeding",proceed:void 0,reset:void 0,location:W}),un(E,M)},reset(){let Je=new Map(pe.blockers);Je.set(Oe,_c),Wr({blockers:Je})}});return}return await Xt(_e,W,{submission:X,pendingError:re,preventScrollReset:ve,replace:M&&M.replace,enableViewTransition:M&&M.unstable_viewTransition,flushSync:fe})}function En(){if(Cn(),Wr({revalidation:"loading"}),pe.navigation.state!=="submitting"){if(pe.navigation.state==="idle"){Xt(pe.historyAction,pe.location,{startUninterruptedRevalidation:!0});return}Xt(Me||pe.historyAction,pe.navigation.location,{overrideNavigation:pe.navigation})}}async function Xt(E,M,D){tt&&tt.abort(),tt=null,Me=E,Dt=(D&&D.startUninterruptedRevalidation)===!0,Mn(pe.location,pe.matches),Ze=(D&&D.preventScrollReset)===!0,ct=(D&&D.enableViewTransition)===!0;let O=d||x,X=D&&D.overrideNavigation,re=Rl(O,M,F),oe=(D&&D.flushSync)===!0;if(!re){let Je=Nn(404,{pathname:M.pathname}),{matches:Qe,route:st}=p0(O);br(),bi(M,{matches:Qe,loaderData:{},errors:{[st.id]:Je}},{flushSync:oe});return}if(pe.initialized&&!lr&&iI(pe.location,M)&&!(D&&D.submission&&no(D.submission.formMethod))){bi(M,{matches:re},{flushSync:oe});return}tt=new AbortController;let W=xc(r.history,M,tt.signal,D&&D.submission),se,_e;if(D&&D.pendingError)_e={[Nc(re).route.id]:D.pendingError};else if(D&&D.submission&&no(D.submission.formMethod)){let Je=await Gn(W,M,D.submission,re,{replace:D.replace,flushSync:oe});if(Je.shortCircuited)return;se=Je.pendingActionData,_e=Je.pendingActionError,X=gm(M,D.submission),oe=!1,W=new Request(W.url,{signal:W.signal})}let{shortCircuited:ve,loaderData:fe,errors:Oe}=await Ie(W,M,re,X,D&&D.submission,D&&D.fetcherSubmission,D&&D.replace,D&&D.initialHydration===!0,oe,se,_e);ve||(tt=null,bi(M,Fr({matches:re},se?{actionData:se}:{},{loaderData:fe,errors:Oe})))}async function Gn(E,M,D,O,X){X===void 0&&(X={}),Cn();let re=sI(M,D);Wr({navigation:re},{flushSync:X.flushSync===!0});let oe,W=yg(O,M);if(!W.route.action&&!W.route.lazy)oe={type:Lr.error,error:Nn(405,{method:E.method,pathname:M.pathname,routeId:W.route.id})};else if(oe=await vc("action",E,W,O,S,_,F,Z.v7_relativeSplatPath),E.signal.aborted)return{shortCircuited:!0};if(ks(oe)){let se;return X&&X.replace!=null?se=X.replace:se=oe.location===pe.location.pathname+pe.location.search,await dr(pe,oe,{submission:D,replace:se}),{shortCircuited:!0}}if(Fl(oe)){let se=Nc(O,W.route.id);return(X&&X.replace)!==!0&&(Me=Zr.Push),{pendingActionData:{},pendingActionError:{[se.route.id]:oe.error}}}if(Is(oe))throw Nn(400,{type:"defer-action"});return{pendingActionData:{[W.route.id]:oe.data}}}async function Ie(E,M,D,O,X,re,oe,W,se,_e,ve){let fe=O||gm(M,X),Oe=X||re||g0(fe),Je=d||x,[Qe,st]=s0(r.history,pe,D,Oe,M,Z.v7_partialHydration&&W===!0,lr,wi,Gr,Wt,Ct,xt,Je,F,_e,ve);if(br(bt=>!(D&&D.some($t=>$t.route.id===bt))||Qe&&Qe.some($t=>$t.route.id===bt)),pt=++We,Qe.length===0&&st.length===0){let bt=Qr();return bi(M,Fr({matches:D,loaderData:{},errors:ve||null},_e?{actionData:_e}:{},bt?{fetchers:new Map(pe.fetchers)}:{}),{flushSync:se}),{shortCircuited:!0}}if(!Dt&&(!Z.v7_partialHydration||!W)){st.forEach($t=>{let ni=pe.fetchers.get($t.key),Ft=wc(void 0,ni?ni.data:void 0);pe.fetchers.set($t.key,Ft)});let bt=_e||pe.actionData;Wr(Fr({navigation:fe},bt?Object.keys(bt).length===0?{actionData:null}:{actionData:bt}:{},st.length>0?{fetchers:new Map(pe.fetchers)}:{}),{flushSync:se})}st.forEach(bt=>{Vt.has(bt.key)&&Re(bt.key),bt.controller&&Vt.set(bt.key,bt.controller)});let lt=()=>st.forEach(bt=>Re(bt.key));tt&&tt.signal.addEventListener("abort",lt);let{results:qt,loaderResults:Rt,fetcherResults:Gt}=await Bi(pe.matches,D,Qe,st,E);if(E.signal.aborted)return{shortCircuited:!0};tt&&tt.signal.removeEventListener("abort",lt),st.forEach(bt=>Vt.delete(bt.key));let dt=f0(qt);if(dt){if(dt.idx>=Qe.length){let bt=st[dt.idx-Qe.length].key;xt.add(bt)}return await dr(pe,dt.result,{replace:oe}),{shortCircuited:!0}}let{loaderData:Jt,errors:ur}=h0(pe,D,Qe,Rt,ve,st,Gt,Br);Br.forEach((bt,$t)=>{bt.subscribe(ni=>{(ni||bt.done)&&Br.delete($t)})}),Z.v7_partialHydration&&W&&pe.errors&&Object.entries(pe.errors).filter(bt=>{let[$t]=bt;return!Qe.some(ni=>ni.route.id===$t)}).forEach(bt=>{let[$t,ni]=bt;ur=Object.assign(ur||{},{[$t]:ni})});let Yr=Qr(),pr=co(pt),Mr=Yr||pr||st.length>0;return Fr({loaderData:Jt,errors:ur},Mr?{fetchers:new Map(pe.fetchers)}:{})}function Hn(E,M,D,O){if(f)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");Vt.has(E)&&Re(E);let X=(O&&O.unstable_flushSync)===!0,re=d||x,oe=mg(pe.location,pe.matches,F,Z.v7_prependBasename,D,Z.v7_relativeSplatPath,M,O==null?void 0:O.relative),W=Rl(re,oe,F);if(!W){Xi(E,M,Nn(404,{pathname:oe}),{flushSync:X});return}let{path:se,submission:_e,error:ve}=a0(Z.v7_normalizeFormMethod,!0,oe,O);if(ve){Xi(E,M,ve,{flushSync:X});return}let fe=yg(W,se);if(Ze=(O&&O.preventScrollReset)===!0,_e&&no(_e.formMethod)){To(E,M,se,fe,W,X,_e);return}Ct.set(E,{routeId:M,path:se}),Pt(E,M,se,fe,W,X,_e)}async function To(E,M,D,O,X,re,oe){if(Cn(),Ct.delete(E),!O.route.action&&!O.route.lazy){let $t=Nn(405,{method:oe.formMethod,pathname:D,routeId:M});Xi(E,M,$t,{flushSync:re});return}let W=pe.fetchers.get(E);di(E,lI(oe,W),{flushSync:re});let se=new AbortController,_e=xc(r.history,D,se.signal,oe);Vt.set(E,se);let ve=We,fe=await vc("action",_e,O,X,S,_,F,Z.v7_relativeSplatPath);if(_e.signal.aborted){Vt.get(E)===se&&Vt.delete(E);return}if(Z.v7_fetcherPersist&&Wt.has(E)){if(ks(fe)||Fl(fe)){di(E,Ma(void 0));return}}else{if(ks(fe))if(Vt.delete(E),pt>ve){di(E,Ma(void 0));return}else return xt.add(E),di(E,wc(oe)),dr(pe,fe,{fetcherSubmission:oe});if(Fl(fe)){Xi(E,M,fe.error);return}}if(Is(fe))throw Nn(400,{type:"defer-action"});let Oe=pe.navigation.location||pe.location,Je=xc(r.history,Oe,se.signal),Qe=d||x,st=pe.navigation.state!=="idle"?Rl(Qe,pe.navigation.location,F):pe.matches;Ot(st,"Didn't find any matches after fetcher action");let lt=++We;ht.set(E,lt);let qt=wc(oe,fe.data);pe.fetchers.set(E,qt);let[Rt,Gt]=s0(r.history,pe,st,oe,Oe,!1,lr,wi,Gr,Wt,Ct,xt,Qe,F,{[O.route.id]:fe.data},void 0);Gt.filter($t=>$t.key!==E).forEach($t=>{let ni=$t.key,Ft=pe.fetchers.get(ni),Xa=wc(void 0,Ft?Ft.data:void 0);pe.fetchers.set(ni,Xa),Vt.has(ni)&&Re(ni),$t.controller&&Vt.set(ni,$t.controller)}),Wr({fetchers:new Map(pe.fetchers)});let dt=()=>Gt.forEach($t=>Re($t.key));se.signal.addEventListener("abort",dt);let{results:Jt,loaderResults:ur,fetcherResults:Yr}=await Bi(pe.matches,st,Rt,Gt,Je);if(se.signal.aborted)return;se.signal.removeEventListener("abort",dt),ht.delete(E),Vt.delete(E),Gt.forEach($t=>Vt.delete($t.key));let pr=f0(Jt);if(pr){if(pr.idx>=Rt.length){let $t=Gt[pr.idx-Rt.length].key;xt.add($t)}return dr(pe,pr.result)}let{loaderData:Mr,errors:bt}=h0(pe,pe.matches,Rt,ur,void 0,Gt,Yr,Br);if(pe.fetchers.has(E)){let $t=Ma(fe.data);pe.fetchers.set(E,$t)}co(lt),pe.navigation.state==="loading"&&lt>pt?(Ot(Me,"Expected pending action"),tt&&tt.abort(),bi(pe.navigation.location,{matches:st,loaderData:Mr,errors:bt,fetchers:new Map(pe.fetchers)})):(Wr({errors:bt,loaderData:d0(pe.loaderData,Mr,st,bt),fetchers:new Map(pe.fetchers)}),lr=!1)}async function Pt(E,M,D,O,X,re,oe){let W=pe.fetchers.get(E);di(E,wc(oe,W?W.data:void 0),{flushSync:re});let se=new AbortController,_e=xc(r.history,D,se.signal);Vt.set(E,se);let ve=We,fe=await vc("loader",_e,O,X,S,_,F,Z.v7_relativeSplatPath);if(Is(fe)&&(fe=await H1(fe,_e.signal,!0)||fe),Vt.get(E)===se&&Vt.delete(E),!_e.signal.aborted){if(Wt.has(E)){di(E,Ma(void 0));return}if(ks(fe))if(pt>ve){di(E,Ma(void 0));return}else{xt.add(E),await dr(pe,fe);return}if(Fl(fe)){Xi(E,M,fe.error);return}Ot(!Is(fe),"Unhandled fetcher deferred data"),di(E,Ma(fe.data))}}async function dr(E,M,D){let{submission:O,fetcherSubmission:X,replace:re}=D===void 0?{}:D;M.revalidate&&(lr=!0);let oe=ih(E.location,M.location,{_isRedirect:!0});if(Ot(oe,"Expected a location on the redirect navigation"),l){let Oe=!1;if(M.reloadDocument)Oe=!0;else if($1.test(M.location)){const Je=r.history.createURL(M.location);Oe=Je.origin!==o.location.origin||tu(Je.pathname,F)==null}if(Oe){re?o.location.replace(M.location):o.location.assign(M.location);return}}tt=null;let W=re===!0?Zr.Replace:Zr.Push,{formMethod:se,formAction:_e,formEncType:ve}=E.navigation;!O&&!X&&se&&_e&&ve&&(O=g0(E.navigation));let fe=O||X;if(YT.has(M.status)&&fe&&no(fe.formMethod))await Xt(W,oe,{submission:Fr({},fe,{formAction:M.location}),preventScrollReset:Ze});else{let Oe=gm(oe,O);await Xt(W,oe,{overrideNavigation:Oe,fetcherSubmission:X,preventScrollReset:Ze})}}async function Bi(E,M,D,O,X){let re=await Promise.all([...D.map(se=>vc("loader",X,se,M,S,_,F,Z.v7_relativeSplatPath)),...O.map(se=>se.matches&&se.match&&se.controller?vc("loader",xc(r.history,se.path,se.controller.signal),se.match,se.matches,S,_,F,Z.v7_relativeSplatPath):{type:Lr.error,error:Nn(404,{pathname:se.path})})]),oe=re.slice(0,D.length),W=re.slice(D.length);return await Promise.all([m0(E,D,oe,oe.map(()=>X.signal),!1,pe.loaderData),m0(E,O.map(se=>se.match),W,O.map(se=>se.controller?se.controller.signal:null),!0)]),{results:re,loaderResults:oe,fetcherResults:W}}function Cn(){lr=!0,wi.push(...br()),Ct.forEach((E,M)=>{Vt.has(M)&&(Gr.push(M),Re(M))})}function di(E,M,D){D===void 0&&(D={}),pe.fetchers.set(E,M),Wr({fetchers:new Map(pe.fetchers)},{flushSync:(D&&D.flushSync)===!0})}function Xi(E,M,D,O){O===void 0&&(O={});let X=Nc(pe.matches,M);cn(E),Wr({errors:{[X.route.id]:D},fetchers:new Map(pe.fetchers)},{flushSync:(O&&O.flushSync)===!0})}function Pn(E){return Z.v7_fetcherPersist&&(Hr.set(E,(Hr.get(E)||0)+1),Wt.has(E)&&Wt.delete(E)),pe.fetchers.get(E)||KT}function cn(E){let M=pe.fetchers.get(E);Vt.has(E)&&!(M&&M.state==="loading"&&ht.has(E))&&Re(E),Ct.delete(E),ht.delete(E),xt.delete(E),Wt.delete(E),pe.fetchers.delete(E)}function Io(E){if(Z.v7_fetcherPersist){let M=(Hr.get(E)||0)-1;M<=0?(Hr.delete(E),Wt.add(E)):Hr.set(E,M)}else cn(E);Wr({fetchers:new Map(pe.fetchers)})}function Re(E){let M=Vt.get(E);Ot(M,"Expected fetch controller: "+E),M.abort(),Vt.delete(E)}function ii(E){for(let M of E){let D=Pn(M),O=Ma(D.data);pe.fetchers.set(M,O)}}function Qr(){let E=[],M=!1;for(let D of xt){let O=pe.fetchers.get(D);Ot(O,"Expected fetcher: "+D),O.state==="loading"&&(xt.delete(D),E.push(D),M=!0)}return ii(E),M}function co(E){let M=[];for(let[D,O]of ht)if(O<E){let X=pe.fetchers.get(D);Ot(X,"Expected fetcher: "+D),X.state==="loading"&&(Re(D),ht.delete(D),M.push(D))}return ii(M),M.length>0}function Wn(E,M){let D=pe.blockers.get(E)||_c;return or.get(E)!==M&&or.set(E,M),D}function Fe(E){pe.blockers.delete(E),or.delete(E)}function mt(E,M){let D=pe.blockers.get(E)||_c;Ot(D.state==="unblocked"&&M.state==="blocked"||D.state==="blocked"&&M.state==="blocked"||D.state==="blocked"&&M.state==="proceeding"||D.state==="blocked"&&M.state==="unblocked"||D.state==="proceeding"&&M.state==="unblocked","Invalid blocker state transition: "+D.state+" -> "+M.state);let O=new Map(pe.blockers);O.set(E,M),Wr({blockers:O})}function gt(E){let{currentLocation:M,nextLocation:D,historyAction:O}=E;if(or.size===0)return;or.size>1&&Kl(!1,"A router only supports one blocker at a time");let X=Array.from(or.entries()),[re,oe]=X[X.length-1],W=pe.blockers.get(re);if(!(W&&W.state==="proceeding")&&oe({currentLocation:M,nextLocation:D,historyAction:O}))return re}function br(E){let M=[];return Br.forEach((D,O)=>{(!E||E(O))&&(D.cancel(),M.push(O),Br.delete(O))}),M}function Si(E,M,D){if(U=E,be=M,we=D||null,!xe&&pe.navigation===mm){xe=!0;let O=Ji(pe.location,pe.matches);O!=null&&Wr({restoreScrollPosition:O})}return()=>{U=null,be=null,we=null}}function yt(E,M){return we&&we(E,M.map(O=>kT(O,pe.loaderData)))||E.key}function Mn(E,M){if(U&&be){let D=yt(E,M);U[D]=be()}}function Ji(E,M){if(U){let D=yt(E,M),O=U[D];if(typeof O=="number")return O}return null}function H(E){S={},d=fg(E,_,void 0,S)}return Ne={get basename(){return F},get future(){return Z},get state(){return pe},get routes(){return x},get window(){return o},initialize:Fi,subscribe:kn,enableScrollRestoration:Si,navigate:un,fetch:Hn,revalidate:En,createHref:E=>r.history.createHref(E),encodeLocation:E=>r.history.encodeLocation(E),getFetcher:Pn,deleteFetcher:Io,dispose:uo,getBlocker:Wn,deleteBlocker:Fe,_internalFetchControllers:Vt,_internalActiveDeferreds:Br,_internalSetRoutes:H},Ne}function QT(r){return r!=null&&("formData"in r&&r.formData!=null||"body"in r&&r.body!==void 0)}function mg(r,o,l,f,_,S,x,d){let F,Z;if(x){F=[];for(let q of o)if(F.push(q),q.route.id===x){Z=q;break}}else F=o,Z=o[o.length-1];let Q=gy(_||".",my(F,S),tu(r.pathname,l)||r.pathname,d==="path");return _==null&&(Q.search=r.search,Q.hash=r.hash),(_==null||_===""||_===".")&&Z&&Z.route.index&&!_y(Q.search)&&(Q.search=Q.search?Q.search.replace(/^\?/,"?index&"):"?index"),f&&l!=="/"&&(Q.pathname=Q.pathname==="/"?l:Ko([l,Q.pathname])),Ls(Q)}function a0(r,o,l,f){if(!f||!QT(f))return{path:l};if(f.formMethod&&!aI(f.formMethod))return{path:l,error:Nn(405,{method:f.formMethod})};let _=()=>({path:l,error:Nn(400,{type:"invalid-body"})}),S=f.formMethod||"get",x=r?S.toUpperCase():S.toLowerCase(),d=G1(l);if(f.body!==void 0){if(f.formEncType==="text/plain"){if(!no(x))return _();let U=typeof f.body=="string"?f.body:f.body instanceof FormData||f.body instanceof URLSearchParams?Array.from(f.body.entries()).reduce((we,be)=>{let[xe,Ee]=be;return""+we+xe+"="+Ee+`
`},""):String(f.body);return{path:l,submission:{formMethod:x,formAction:d,formEncType:f.formEncType,formData:void 0,json:void 0,text:U}}}else if(f.formEncType==="application/json"){if(!no(x))return _();try{let U=typeof f.body=="string"?JSON.parse(f.body):f.body;return{path:l,submission:{formMethod:x,formAction:d,formEncType:f.formEncType,formData:void 0,json:U,text:void 0}}}catch{return _()}}}Ot(typeof FormData=="function","FormData is not available in this environment");let F,Z;if(f.formData)F=gg(f.formData),Z=f.formData;else if(f.body instanceof FormData)F=gg(f.body),Z=f.body;else if(f.body instanceof URLSearchParams)F=f.body,Z=c0(F);else if(f.body==null)F=new URLSearchParams,Z=new FormData;else try{F=new URLSearchParams(f.body),Z=c0(F)}catch{return _()}let Q={formMethod:x,formAction:d,formEncType:f&&f.formEncType||"application/x-www-form-urlencoded",formData:Z,json:void 0,text:void 0};if(no(Q.formMethod))return{path:l,submission:Q};let q=ra(l);return o&&q.search&&_y(q.search)&&F.append("index",""),q.search="?"+F,{path:Ls(q),submission:Q}}function eI(r,o){let l=r;if(o){let f=r.findIndex(_=>_.route.id===o);f>=0&&(l=r.slice(0,f))}return l}function s0(r,o,l,f,_,S,x,d,F,Z,Q,q,U,we,be,xe){let Ee=xe?Object.values(xe)[0]:be?Object.values(be)[0]:void 0,ne=r.createURL(o.location),te=r.createURL(_),ue=xe?Object.keys(xe)[0]:void 0,Ne=eI(l,ue).filter((Me,Ze)=>{let{route:tt}=Me;if(tt.lazy)return!0;if(tt.loader==null)return!1;if(S)return tt.loader.hydrate?!0:o.loaderData[tt.id]===void 0&&(!o.errors||o.errors[tt.id]===void 0);if(tI(o.loaderData,o.matches[Ze],Me)||d.some(kt=>kt===Me.route.id))return!0;let ct=o.matches[Ze],vt=Me;return l0(Me,Fr({currentUrl:ne,currentParams:ct.params,nextUrl:te,nextParams:vt.params},f,{actionResult:Ee,defaultShouldRevalidate:x||ne.pathname+ne.search===te.pathname+te.search||ne.search!==te.search||q1(ct,vt)}))}),pe=[];return Q.forEach((Me,Ze)=>{if(S||!l.some(Dt=>Dt.route.id===Me.routeId)||Z.has(Ze))return;let tt=Rl(U,Me.path,we);if(!tt){pe.push({key:Ze,routeId:Me.routeId,path:Me.path,matches:null,match:null,controller:null});return}let ct=o.fetchers.get(Ze),vt=yg(tt,Me.path),kt=!1;q.has(Ze)?kt=!1:F.includes(Ze)?kt=!0:ct&&ct.state!=="idle"&&ct.data===void 0?kt=x:kt=l0(vt,Fr({currentUrl:ne,currentParams:o.matches[o.matches.length-1].params,nextUrl:te,nextParams:l[l.length-1].params},f,{actionResult:Ee,defaultShouldRevalidate:x})),kt&&pe.push({key:Ze,routeId:Me.routeId,path:Me.path,matches:tt,match:vt,controller:new AbortController})}),[Ne,pe]}function tI(r,o,l){let f=!o||l.route.id!==o.route.id,_=r[l.route.id]===void 0;return f||_}function q1(r,o){let l=r.route.path;return r.pathname!==o.pathname||l!=null&&l.endsWith("*")&&r.params["*"]!==o.params["*"]}function l0(r,o){if(r.route.shouldRevalidate){let l=r.route.shouldRevalidate(o);if(typeof l=="boolean")return l}return o.defaultShouldRevalidate}async function u0(r,o,l){if(!r.lazy)return;let f=await r.lazy();if(!r.lazy)return;let _=l[r.id];Ot(_,"No route found in manifest");let S={};for(let x in f){let F=_[x]!==void 0&&x!=="hasErrorBoundary";Kl(!F,'Route "'+_.id+'" has a static property "'+x+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+x+'" will be ignored.')),!F&&!TT.has(x)&&(S[x]=f[x])}Object.assign(_,S),Object.assign(_,Fr({},o(_),{lazy:void 0}))}async function vc(r,o,l,f,_,S,x,d,F){F===void 0&&(F={});let Z,Q,q,U=xe=>{let Ee,ne=new Promise((te,ue)=>Ee=ue);return q=()=>Ee(),o.signal.addEventListener("abort",q),Promise.race([xe({request:o,params:l.params,context:F.requestContext}),ne])};try{let xe=l.route[r];if(l.route.lazy)if(xe){let Ee,ne=await Promise.all([U(xe).catch(te=>{Ee=te}),u0(l.route,S,_)]);if(Ee)throw Ee;Q=ne[0]}else if(await u0(l.route,S,_),xe=l.route[r],xe)Q=await U(xe);else if(r==="action"){let Ee=new URL(o.url),ne=Ee.pathname+Ee.search;throw Nn(405,{method:o.method,pathname:ne,routeId:l.route.id})}else return{type:Lr.data,data:void 0};else if(xe)Q=await U(xe);else{let Ee=new URL(o.url),ne=Ee.pathname+Ee.search;throw Nn(404,{pathname:ne})}Ot(Q!==void 0,"You defined "+(r==="action"?"an action":"a loader")+" for route "+('"'+l.route.id+"\" but didn't return anything from your `"+r+"` ")+"function. Please return a value or `null`.")}catch(xe){Z=Lr.error,Q=xe}finally{q&&o.signal.removeEventListener("abort",q)}if(oI(Q)){let xe=Q.status;if(WT.has(xe)){let ne=Q.headers.get("Location");if(Ot(ne,"Redirects returned/thrown from loaders/actions must have a Location header"),!$1.test(ne))ne=mg(new URL(o.url),f.slice(0,f.indexOf(l)+1),x,!0,ne,d);else if(!F.isStaticRequest){let te=new URL(o.url),ue=ne.startsWith("//")?new URL(te.protocol+ne):new URL(ne),Te=tu(ue.pathname,x)!=null;ue.origin===te.origin&&Te&&(ne=ue.pathname+ue.search+ue.hash)}if(F.isStaticRequest)throw Q.headers.set("Location",ne),Q;return{type:Lr.redirect,status:xe,location:ne,revalidate:Q.headers.get("X-Remix-Revalidate")!==null,reloadDocument:Q.headers.get("X-Remix-Reload-Document")!==null}}if(F.isRouteRequest)throw{type:Z===Lr.error?Lr.error:Lr.data,response:Q};let Ee;try{let ne=Q.headers.get("Content-Type");ne&&/\bapplication\/json\b/.test(ne)?Q.body==null?Ee=null:Ee=await Q.json():Ee=await Q.text()}catch(ne){return{type:Lr.error,error:ne}}return Z===Lr.error?{type:Z,error:new yy(xe,Q.statusText,Ee),headers:Q.headers}:{type:Lr.data,data:Ee,statusCode:Q.status,headers:Q.headers}}if(Z===Lr.error)return{type:Z,error:Q};if(nI(Q)){var we,be;return{type:Lr.deferred,deferredData:Q,statusCode:(we=Q.init)==null?void 0:we.status,headers:((be=Q.init)==null?void 0:be.headers)&&new Headers(Q.init.headers)}}return{type:Lr.data,data:Q}}function xc(r,o,l,f){let _=r.createURL(G1(o)).toString(),S={signal:l};if(f&&no(f.formMethod)){let{formMethod:x,formEncType:d}=f;S.method=x.toUpperCase(),d==="application/json"?(S.headers=new Headers({"Content-Type":d}),S.body=JSON.stringify(f.json)):d==="text/plain"?S.body=f.text:d==="application/x-www-form-urlencoded"&&f.formData?S.body=gg(f.formData):S.body=f.formData}return new Request(_,S)}function gg(r){let o=new URLSearchParams;for(let[l,f]of r.entries())o.append(l,typeof f=="string"?f:f.name);return o}function c0(r){let o=new FormData;for(let[l,f]of r.entries())o.append(l,f);return o}function rI(r,o,l,f,_){let S={},x=null,d,F=!1,Z={};return l.forEach((Q,q)=>{let U=o[q].route.id;if(Ot(!ks(Q),"Cannot handle redirect results in processLoaderData"),Fl(Q)){let we=Nc(r,U),be=Q.error;f&&(be=Object.values(f)[0],f=void 0),x=x||{},x[we.route.id]==null&&(x[we.route.id]=be),S[U]=void 0,F||(F=!0,d=U1(Q.error)?Q.error.status:500),Q.headers&&(Z[U]=Q.headers)}else Is(Q)?(_.set(U,Q.deferredData),S[U]=Q.deferredData.data):S[U]=Q.data,Q.statusCode!=null&&Q.statusCode!==200&&!F&&(d=Q.statusCode),Q.headers&&(Z[U]=Q.headers)}),f&&(x=f,S[Object.keys(f)[0]]=void 0),{loaderData:S,errors:x,statusCode:d||200,loaderHeaders:Z}}function h0(r,o,l,f,_,S,x,d){let{loaderData:F,errors:Z}=rI(o,l,f,_,d);for(let Q=0;Q<S.length;Q++){let{key:q,match:U,controller:we}=S[Q];Ot(x!==void 0&&x[Q]!==void 0,"Did not find corresponding fetcher result");let be=x[Q];if(!(we&&we.signal.aborted))if(Fl(be)){let xe=Nc(r.matches,U==null?void 0:U.route.id);Z&&Z[xe.route.id]||(Z=Fr({},Z,{[xe.route.id]:be.error})),r.fetchers.delete(q)}else if(ks(be))Ot(!1,"Unhandled fetcher revalidation redirect");else if(Is(be))Ot(!1,"Unhandled fetcher deferred data");else{let xe=Ma(be.data);r.fetchers.set(q,xe)}}return{loaderData:F,errors:Z}}function d0(r,o,l,f){let _=Fr({},o);for(let S of l){let x=S.route.id;if(o.hasOwnProperty(x)?o[x]!==void 0&&(_[x]=o[x]):r[x]!==void 0&&S.route.loader&&(_[x]=r[x]),f&&f.hasOwnProperty(x))break}return _}function Nc(r,o){return(o?r.slice(0,r.findIndex(f=>f.route.id===o)+1):[...r]).reverse().find(f=>f.route.hasErrorBoundary===!0)||r[0]}function p0(r){let o=r.length===1?r[0]:r.find(l=>l.index||!l.path||l.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:o}],route:o}}function Nn(r,o){let{pathname:l,routeId:f,method:_,type:S}=o===void 0?{}:o,x="Unknown Server Error",d="Unknown @remix-run/router error";return r===400?(x="Bad Request",_&&l&&f?d="You made a "+_+' request to "'+l+'" but '+('did not provide a `loader` for route "'+f+'", ')+"so there is no way to handle the request.":S==="defer-action"?d="defer() is not supported in actions":S==="invalid-body"&&(d="Unable to encode submission body")):r===403?(x="Forbidden",d='Route "'+f+'" does not match URL "'+l+'"'):r===404?(x="Not Found",d='No route matches URL "'+l+'"'):r===405&&(x="Method Not Allowed",_&&l&&f?d="You made a "+_.toUpperCase()+' request to "'+l+'" but '+('did not provide an `action` for route "'+f+'", ')+"so there is no way to handle the request.":_&&(d='Invalid request method "'+_.toUpperCase()+'"')),new yy(r||500,x,new Error(d),!0)}function f0(r){for(let o=r.length-1;o>=0;o--){let l=r[o];if(ks(l))return{result:l,idx:o}}}function G1(r){let o=typeof r=="string"?ra(r):r;return Ls(Fr({},o,{hash:""}))}function iI(r,o){return r.pathname!==o.pathname||r.search!==o.search?!1:r.hash===""?o.hash!=="":r.hash===o.hash?!0:o.hash!==""}function Is(r){return r.type===Lr.deferred}function Fl(r){return r.type===Lr.error}function ks(r){return(r&&r.type)===Lr.redirect}function nI(r){let o=r;return o&&typeof o=="object"&&typeof o.data=="object"&&typeof o.subscribe=="function"&&typeof o.cancel=="function"&&typeof o.resolveData=="function"}function oI(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.headers=="object"&&typeof r.body<"u"}function aI(r){return HT.has(r.toLowerCase())}function no(r){return qT.has(r.toLowerCase())}async function m0(r,o,l,f,_,S){for(let x=0;x<l.length;x++){let d=l[x],F=o[x];if(!F)continue;let Z=r.find(q=>q.route.id===F.route.id),Q=Z!=null&&!q1(Z,F)&&(S&&S[F.route.id])!==void 0;if(Is(d)&&(_||Q)){let q=f[x];Ot(q,"Expected an AbortSignal for revalidating fetcher deferred result"),await H1(d,q,_).then(U=>{U&&(l[x]=U||l[x])})}}}async function H1(r,o,l){if(l===void 0&&(l=!1),!await r.deferredData.resolveData(o)){if(l)try{return{type:Lr.data,data:r.deferredData.unwrappedData}}catch(_){return{type:Lr.error,error:_}}return{type:Lr.data,data:r.deferredData.data}}}function _y(r){return new URLSearchParams(r).getAll("index").some(o=>o==="")}function yg(r,o){let l=typeof o=="string"?ra(o).search:o.search;if(r[r.length-1].route.index&&_y(l||""))return r[r.length-1];let f=j1(r);return f[f.length-1]}function g0(r){let{formMethod:o,formAction:l,formEncType:f,text:_,formData:S,json:x}=r;if(!(!o||!l||!f)){if(_!=null)return{formMethod:o,formAction:l,formEncType:f,formData:void 0,json:void 0,text:_};if(S!=null)return{formMethod:o,formAction:l,formEncType:f,formData:S,json:void 0,text:void 0};if(x!==void 0)return{formMethod:o,formAction:l,formEncType:f,formData:void 0,json:x,text:void 0}}}function gm(r,o){return o?{state:"loading",location:r,formMethod:o.formMethod,formAction:o.formAction,formEncType:o.formEncType,formData:o.formData,json:o.json,text:o.text}:{state:"loading",location:r,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function sI(r,o){return{state:"submitting",location:r,formMethod:o.formMethod,formAction:o.formAction,formEncType:o.formEncType,formData:o.formData,json:o.json,text:o.text}}function wc(r,o){return r?{state:"loading",formMethod:r.formMethod,formAction:r.formAction,formEncType:r.formEncType,formData:r.formData,json:r.json,text:r.text,data:o}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:o}}function lI(r,o){return{state:"submitting",formMethod:r.formMethod,formAction:r.formAction,formEncType:r.formEncType,formData:r.formData,json:r.json,text:r.text,data:o?o.data:void 0}}function Ma(r){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:r}}function uI(r,o){try{let l=r.sessionStorage.getItem(Z1);if(l){let f=JSON.parse(l);for(let[_,S]of Object.entries(f||{}))S&&Array.isArray(S)&&o.set(_,new Set(S||[]))}}catch{}}function cI(r,o){if(o.size>0){let l={};for(let[f,_]of o)l[f]=[..._];try{r.sessionStorage.setItem(Z1,JSON.stringify(l))}catch(f){Kl(!1,"Failed to save applied view transitions in sessionStorage ("+f+").")}}}/**
 * React Router v6.22.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function nh(){return nh=Object.assign?Object.assign.bind():function(r){for(var o=1;o<arguments.length;o++){var l=arguments[o];for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(r[f]=l[f])}return r},nh.apply(this,arguments)}const Fp=Le.createContext(null),W1=Le.createContext(null),Bs=Le.createContext(null),Bp=Le.createContext(null),Ka=Le.createContext({outlet:null,matches:[],isDataRoute:!1}),Y1=Le.createContext(null);function hI(r,o){let{relative:l}=o===void 0?{}:o;hh()||Ot(!1);let{basename:f,navigator:_}=Le.useContext(Bs),{hash:S,pathname:x,search:d}=X1(r,{relative:l}),F=x;return f!=="/"&&(F=x==="/"?f:Ko([f,x])),_.createHref({pathname:F,search:d,hash:S})}function hh(){return Le.useContext(Bp)!=null}function dh(){return hh()||Ot(!1),Le.useContext(Bp).location}function K1(r){Le.useContext(Bs).static||Le.useLayoutEffect(r)}function dI(){let{isDataRoute:r}=Le.useContext(Ka);return r?II():pI()}function pI(){hh()||Ot(!1);let r=Le.useContext(Fp),{basename:o,future:l,navigator:f}=Le.useContext(Bs),{matches:_}=Le.useContext(Ka),{pathname:S}=dh(),x=JSON.stringify(my(_,l.v7_relativeSplatPath)),d=Le.useRef(!1);return K1(()=>{d.current=!0}),Le.useCallback(function(Z,Q){if(Q===void 0&&(Q={}),!d.current)return;if(typeof Z=="number"){f.go(Z);return}let q=gy(Z,JSON.parse(x),S,Q.relative==="path");r==null&&o!=="/"&&(q.pathname=q.pathname==="/"?o:Ko([o,q.pathname])),(Q.replace?f.replace:f.push)(q,Q.state,Q)},[o,f,x,S,r])}const fI=Le.createContext(null);function mI(r){let o=Le.useContext(Ka).outlet;return o&&Le.createElement(fI.Provider,{value:r},o)}function X1(r,o){let{relative:l}=o===void 0?{}:o,{future:f}=Le.useContext(Bs),{matches:_}=Le.useContext(Ka),{pathname:S}=dh(),x=JSON.stringify(my(_,f.v7_relativeSplatPath));return Le.useMemo(()=>gy(r,JSON.parse(x),S,l==="path"),[r,x,S,l])}function gI(r,o,l,f){hh()||Ot(!1);let{navigator:_}=Le.useContext(Bs),{matches:S}=Le.useContext(Ka),x=S[S.length-1],d=x?x.params:{};x&&x.pathname;let F=x?x.pathnameBase:"/";x&&x.route;let Z=dh(),Q;if(o){var q;let Ee=typeof o=="string"?ra(o):o;F==="/"||(q=Ee.pathname)!=null&&q.startsWith(F)||Ot(!1),Q=Ee}else Q=Z;let U=Q.pathname||"/",we=U;if(F!=="/"){let Ee=F.replace(/^\//,"").split("/");we="/"+U.replace(/^\//,"").split("/").slice(Ee.length).join("/")}let be=Rl(r,{pathname:we}),xe=wI(be&&be.map(Ee=>Object.assign({},Ee,{params:Object.assign({},d,Ee.params),pathname:Ko([F,_.encodeLocation?_.encodeLocation(Ee.pathname).pathname:Ee.pathname]),pathnameBase:Ee.pathnameBase==="/"?F:Ko([F,_.encodeLocation?_.encodeLocation(Ee.pathnameBase).pathname:Ee.pathnameBase])})),S,l,f);return o&&xe?Le.createElement(Bp.Provider,{value:{location:nh({pathname:"/",search:"",hash:"",state:null,key:"default"},Q),navigationType:Zr.Pop}},xe):xe}function yI(){let r=ew(),o=U1(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),l=r instanceof Error?r.stack:null,_={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Le.createElement(Le.Fragment,null,Le.createElement("h2",null,"Unexpected Application Error!"),Le.createElement("h3",{style:{fontStyle:"italic"}},o),l?Le.createElement("pre",{style:_},l):null,null)}const _I=Le.createElement(yI,null);class vI extends Le.Component{constructor(o){super(o),this.state={location:o.location,revalidation:o.revalidation,error:o.error}}static getDerivedStateFromError(o){return{error:o}}static getDerivedStateFromProps(o,l){return l.location!==o.location||l.revalidation!=="idle"&&o.revalidation==="idle"?{error:o.error,location:o.location,revalidation:o.revalidation}:{error:o.error!==void 0?o.error:l.error,location:l.location,revalidation:o.revalidation||l.revalidation}}componentDidCatch(o,l){console.error("React Router caught the following error during render",o,l)}render(){return this.state.error!==void 0?Le.createElement(Ka.Provider,{value:this.props.routeContext},Le.createElement(Y1.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function xI(r){let{routeContext:o,match:l,children:f}=r,_=Le.useContext(Fp);return _&&_.static&&_.staticContext&&(l.route.errorElement||l.route.ErrorBoundary)&&(_.staticContext._deepestRenderedBoundaryId=l.route.id),Le.createElement(Ka.Provider,{value:o},f)}function wI(r,o,l,f){var _;if(o===void 0&&(o=[]),l===void 0&&(l=null),f===void 0&&(f=null),r==null){var S;if((S=l)!=null&&S.errors)r=l.matches;else return null}let x=r,d=(_=l)==null?void 0:_.errors;if(d!=null){let Q=x.findIndex(q=>q.route.id&&(d==null?void 0:d[q.route.id]));Q>=0||Ot(!1),x=x.slice(0,Math.min(x.length,Q+1))}let F=!1,Z=-1;if(l&&f&&f.v7_partialHydration)for(let Q=0;Q<x.length;Q++){let q=x[Q];if((q.route.HydrateFallback||q.route.hydrateFallbackElement)&&(Z=Q),q.route.id){let{loaderData:U,errors:we}=l,be=q.route.loader&&U[q.route.id]===void 0&&(!we||we[q.route.id]===void 0);if(q.route.lazy||be){F=!0,Z>=0?x=x.slice(0,Z+1):x=[x[0]];break}}}return x.reduceRight((Q,q,U)=>{let we,be=!1,xe=null,Ee=null;l&&(we=d&&q.route.id?d[q.route.id]:void 0,xe=q.route.errorElement||_I,F&&(Z<0&&U===0?(kI("route-fallback",!1),be=!0,Ee=null):Z===U&&(be=!0,Ee=q.route.hydrateFallbackElement||null)));let ne=o.concat(x.slice(0,U+1)),te=()=>{let ue;return we?ue=xe:be?ue=Ee:q.route.Component?ue=Le.createElement(q.route.Component,null):q.route.element?ue=q.route.element:ue=Q,Le.createElement(xI,{match:q,routeContext:{outlet:Q,matches:ne,isDataRoute:l!=null},children:ue})};return l&&(q.route.ErrorBoundary||q.route.errorElement||U===0)?Le.createElement(vI,{location:l.location,revalidation:l.revalidation,component:xe,error:we,children:te(),routeContext:{outlet:null,matches:ne,isDataRoute:!0}}):te()},null)}var J1=function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r}(J1||{}),vp=function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r}(vp||{});function bI(r){let o=Le.useContext(Fp);return o||Ot(!1),o}function SI(r){let o=Le.useContext(W1);return o||Ot(!1),o}function TI(r){let o=Le.useContext(Ka);return o||Ot(!1),o}function Q1(r){let o=TI(),l=o.matches[o.matches.length-1];return l.route.id||Ot(!1),l.route.id}function ew(){var r;let o=Le.useContext(Y1),l=SI(vp.UseRouteError),f=Q1(vp.UseRouteError);return o!==void 0?o:(r=l.errors)==null?void 0:r[f]}function II(){let{router:r}=bI(J1.UseNavigateStable),o=Q1(vp.UseNavigateStable),l=Le.useRef(!1);return K1(()=>{l.current=!0}),Le.useCallback(function(_,S){S===void 0&&(S={}),l.current&&(typeof _=="number"?r.navigate(_):r.navigate(_,nh({fromRouteId:o},S)))},[r,o])}const y0={};function kI(r,o,l){!o&&!y0[r]&&(y0[r]=!0)}function EI(r){return mI(r.context)}function CI(r){let{basename:o="/",children:l=null,location:f,navigationType:_=Zr.Pop,navigator:S,static:x=!1,future:d}=r;hh()&&Ot(!1);let F=o.replace(/^\/*/,"/"),Z=Le.useMemo(()=>({basename:F,navigator:S,static:x,future:nh({v7_relativeSplatPath:!1},d)}),[F,d,S,x]);typeof f=="string"&&(f=ra(f));let{pathname:Q="/",search:q="",hash:U="",state:we=null,key:be="default"}=f,xe=Le.useMemo(()=>{let Ee=tu(Q,F);return Ee==null?null:{location:{pathname:Ee,search:q,hash:U,state:we,key:be},navigationType:_}},[F,Q,q,U,we,be,_]);return xe==null?null:Le.createElement(Bs.Provider,{value:Z},Le.createElement(Bp.Provider,{children:l,value:xe}))}new Promise(()=>{});function PI(r){let o={hasErrorBoundary:r.ErrorBoundary!=null||r.errorElement!=null};return r.Component&&Object.assign(o,{element:Le.createElement(r.Component),Component:void 0}),r.HydrateFallback&&Object.assign(o,{hydrateFallbackElement:Le.createElement(r.HydrateFallback),HydrateFallback:void 0}),r.ErrorBoundary&&Object.assign(o,{errorElement:Le.createElement(r.ErrorBoundary),ErrorBoundary:void 0}),o}/**
 * React Router DOM v6.22.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function oh(){return oh=Object.assign?Object.assign.bind():function(r){for(var o=1;o<arguments.length;o++){var l=arguments[o];for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(r[f]=l[f])}return r},oh.apply(this,arguments)}function MI(r,o){if(r==null)return{};var l={},f=Object.keys(r),_,S;for(S=0;S<f.length;S++)_=f[S],!(o.indexOf(_)>=0)&&(l[_]=r[_]);return l}function zI(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function AI(r,o){return r.button===0&&(!o||o==="_self")&&!zI(r)}const DI=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],LI="6";try{window.__reactRouterVersion=LI}catch{}function RI(r,o){return JT({basename:o==null?void 0:o.basename,future:oh({},o==null?void 0:o.future,{v7_prependBasename:!0}),history:wT({window:o==null?void 0:o.window}),hydrationData:(o==null?void 0:o.hydrationData)||FI(),routes:r,mapRouteProperties:PI,window:o==null?void 0:o.window}).initialize()}function FI(){var r;let o=(r=window)==null?void 0:r.__staticRouterHydrationData;return o&&o.errors&&(o=oh({},o,{errors:BI(o.errors)})),o}function BI(r){if(!r)return null;let o=Object.entries(r),l={};for(let[f,_]of o)if(_&&_.__type==="RouteErrorResponse")l[f]=new yy(_.status,_.statusText,_.data,_.internal===!0);else if(_&&_.__type==="Error"){if(_.__subType){let S=window[_.__subType];if(typeof S=="function")try{let x=new S(_.message);x.stack="",l[f]=x}catch{}}if(l[f]==null){let S=new Error(_.message);S.stack="",l[f]=S}}else l[f]=_;return l}const OI=Le.createContext({isTransitioning:!1}),NI=Le.createContext(new Map),jI="startTransition",_0=u2[jI],UI="flushSync",v0=xT[UI];function VI(r){_0?_0(r):r()}function bc(r){v0?v0(r):r()}class $I{constructor(){this.status="pending",this.promise=new Promise((o,l)=>{this.resolve=f=>{this.status==="pending"&&(this.status="resolved",o(f))},this.reject=f=>{this.status==="pending"&&(this.status="rejected",l(f))}})}}function ZI(r){let{fallbackElement:o,router:l,future:f}=r,[_,S]=Le.useState(l.state),[x,d]=Le.useState(),[F,Z]=Le.useState({isTransitioning:!1}),[Q,q]=Le.useState(),[U,we]=Le.useState(),[be,xe]=Le.useState(),Ee=Le.useRef(new Map),{v7_startTransition:ne}=f||{},te=Le.useCallback(Me=>{ne?VI(Me):Me()},[ne]),ue=Le.useCallback((Me,Ze)=>{let{deletedFetchers:tt,unstable_flushSync:ct,unstable_viewTransitionOpts:vt}=Ze;tt.forEach(Dt=>Ee.current.delete(Dt)),Me.fetchers.forEach((Dt,lr)=>{Dt.data!==void 0&&Ee.current.set(lr,Dt.data)});let kt=l.window==null||typeof l.window.document.startViewTransition!="function";if(!vt||kt){ct?bc(()=>S(Me)):te(()=>S(Me));return}if(ct){bc(()=>{U&&(Q&&Q.resolve(),U.skipTransition()),Z({isTransitioning:!0,flushSync:!0,currentLocation:vt.currentLocation,nextLocation:vt.nextLocation})});let Dt=l.window.document.startViewTransition(()=>{bc(()=>S(Me))});Dt.finished.finally(()=>{bc(()=>{q(void 0),we(void 0),d(void 0),Z({isTransitioning:!1})})}),bc(()=>we(Dt));return}U?(Q&&Q.resolve(),U.skipTransition(),xe({state:Me,currentLocation:vt.currentLocation,nextLocation:vt.nextLocation})):(d(Me),Z({isTransitioning:!0,flushSync:!1,currentLocation:vt.currentLocation,nextLocation:vt.nextLocation}))},[l.window,U,Q,Ee,te]);Le.useLayoutEffect(()=>l.subscribe(ue),[l,ue]),Le.useEffect(()=>{F.isTransitioning&&!F.flushSync&&q(new $I)},[F]),Le.useEffect(()=>{if(Q&&x&&l.window){let Me=x,Ze=Q.promise,tt=l.window.document.startViewTransition(async()=>{te(()=>S(Me)),await Ze});tt.finished.finally(()=>{q(void 0),we(void 0),d(void 0),Z({isTransitioning:!1})}),we(tt)}},[te,x,Q,l.window]),Le.useEffect(()=>{Q&&x&&_.location.key===x.location.key&&Q.resolve()},[Q,U,_.location,x]),Le.useEffect(()=>{!F.isTransitioning&&be&&(d(be.state),Z({isTransitioning:!0,flushSync:!1,currentLocation:be.currentLocation,nextLocation:be.nextLocation}),xe(void 0))},[F.isTransitioning,be]),Le.useEffect(()=>{},[]);let Te=Le.useMemo(()=>({createHref:l.createHref,encodeLocation:l.encodeLocation,go:Me=>l.navigate(Me),push:(Me,Ze,tt)=>l.navigate(Me,{state:Ze,preventScrollReset:tt==null?void 0:tt.preventScrollReset}),replace:(Me,Ze,tt)=>l.navigate(Me,{replace:!0,state:Ze,preventScrollReset:tt==null?void 0:tt.preventScrollReset})}),[l]),Ne=l.basename||"/",pe=Le.useMemo(()=>({router:l,navigator:Te,static:!1,basename:Ne}),[l,Te,Ne]);return Le.createElement(Le.Fragment,null,Le.createElement(Fp.Provider,{value:pe},Le.createElement(W1.Provider,{value:_},Le.createElement(NI.Provider,{value:Ee.current},Le.createElement(OI.Provider,{value:F},Le.createElement(CI,{basename:Ne,location:_.location,navigationType:_.historyAction,navigator:Te,future:{v7_relativeSplatPath:l.future.v7_relativeSplatPath}},_.initialized||l.future.v7_partialHydration?Le.createElement(qI,{routes:l.routes,future:l.future,state:_}):o))))),null)}function qI(r){let{routes:o,future:l,state:f}=r;return gI(o,void 0,f,l)}const GI=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",HI=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,_g=Le.forwardRef(function(o,l){let{onClick:f,relative:_,reloadDocument:S,replace:x,state:d,target:F,to:Z,preventScrollReset:Q,unstable_viewTransition:q}=o,U=MI(o,DI),{basename:we}=Le.useContext(Bs),be,xe=!1;if(typeof Z=="string"&&HI.test(Z)&&(be=Z,GI))try{let ue=new URL(window.location.href),Te=Z.startsWith("//")?new URL(ue.protocol+Z):new URL(Z),Ne=tu(Te.pathname,we);Te.origin===ue.origin&&Ne!=null?Z=Ne+Te.search+Te.hash:xe=!0}catch{}let Ee=hI(Z,{relative:_}),ne=WI(Z,{replace:x,state:d,target:F,preventScrollReset:Q,relative:_,unstable_viewTransition:q});function te(ue){f&&f(ue),ue.defaultPrevented||ne(ue)}return Le.createElement("a",oh({},U,{href:be||Ee,onClick:xe||S?f:te,ref:l,target:F}))});var x0;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(x0||(x0={}));var w0;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(w0||(w0={}));function WI(r,o){let{target:l,replace:f,state:_,preventScrollReset:S,relative:x,unstable_viewTransition:d}=o===void 0?{}:o,F=dI(),Z=dh(),Q=X1(r,{relative:x});return Le.useCallback(q=>{if(AI(q,l)){q.preventDefault();let U=f!==void 0?f:Ls(Z)===Ls(Q);F(r,{replace:U,state:_,preventScrollReset:S,relative:x,unstable_viewTransition:d})}},[Z,F,Q,f,_,l,r,S,x,d])}var tw={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.2/LICENSE.txt
 */(function(r,o){(function(l,f){r.exports=f()})(Hb,function(){var l={},f={};function _(x,d,F){if(f[x]=F,x==="index"){var Z="var sharedModule = {}; ("+f.shared+")(sharedModule); ("+f.worker+")(sharedModule);",Q={};return f.shared(Q),f.index(l,Q),typeof window<"u"&&l.setWorkerUrl(window.URL.createObjectURL(new Blob([Z],{type:"text/javascript"}))),l}}_("shared",["exports"],function(x){function d(i,e,n,s){return new(n||(n=Promise))(function(h,g){function y(k){try{T(s.next(k))}catch(P){g(P)}}function v(k){try{T(s.throw(k))}catch(P){g(P)}}function T(k){var P;k.done?h(k.value):(P=k.value,P instanceof n?P:new n(function(z){z(P)})).then(y,v)}T((s=s.apply(i,e||[])).next())})}function F(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var Z=Q;function Q(i,e){this.x=i,this.y=e}Q.prototype={clone:function(){return new Q(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),n=Math.sin(i),s=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=s,this},_rotateAround:function(i,e){var n=Math.cos(i),s=Math.sin(i),h=e.y+s*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-s*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Q.convert=function(i){return i instanceof Q?i:Array.isArray(i)?new Q(i[0],i[1]):i};var q=F(Z),U=we;function we(i,e,n,s){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=n,this.p2y=s}we.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,s=0;s<8;s++){var h=this.sampleCurveX(n)-i;if(Math.abs(h)<e)return n;var g=this.sampleCurveDerivativeX(n);if(Math.abs(g)<1e-6)break;n-=h/g}var y=0,v=1;for(n=i,s=0;s<20&&(h=this.sampleCurveX(n),!(Math.abs(h-i)<e));s++)i>h?y=n:v=n,n=.5*(v-y)+y;return n},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var be=F(U);let xe,Ee;function ne(){return xe==null&&(xe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),xe}function te(){if(Ee==null&&(Ee=!1,ne())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let s=0;s<5*5;s++){const h=4*s;e.fillStyle=`rgb(${h},${h+1},${h+2})`,e.fillRect(s%5,Math.floor(s/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let s=0;s<5*5*4;s++)if(s%4!=3&&n[s]!==s){Ee=!0;break}}}return Ee||!1}function ue(i,e,n,s){const h=new be(i,e,n,s);return function(g){return h.solve(g)}}const Te=ue(.25,.1,.25,1);function Ne(i,e,n){return Math.min(n,Math.max(e,i))}function pe(i,e,n){const s=n-e,h=((i-e)%s+s)%s+e;return h===e?n:h}function Me(i,...e){for(const n of e)for(const s in n)i[s]=n[s];return i}let Ze=1;function tt(i,e,n){const s={};for(const h in i)s[h]=e.call(n||this,i[h],h,i);return s}function ct(i,e,n){const s={};for(const h in i)e.call(n||this,i[h],h,i)&&(s[h]=i[h]);return s}function vt(i){return Array.isArray(i)?i.map(vt):typeof i=="object"&&i?tt(i,vt):i}const kt={};function Dt(i){kt[i]||(typeof console<"u"&&console.warn(i),kt[i]=!0)}function lr(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function wi(i){let e=0;for(let n,s,h=0,g=i.length,y=g-1;h<g;y=h++)n=i[h],s=i[y],e+=(s.x-n.x)*(n.y+s.y);return e}function Gr(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Vt=null;function We(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const pt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ht(i,e,n,s,h){return d(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(i,{timestamp:0});try{const y=g==null?void 0:g.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);const v=y.startsWith("BGR"),T=new Uint8ClampedArray(s*h*4);if(yield g.copyTo(T,function(k,P,z,R,B){const j=4*Math.max(-P,0),$=(Math.max(0,z)-z)*R*4+j,K=4*R,ie=Math.max(0,P),de=Math.max(0,z);return{rect:{x:ie,y:de,width:Math.min(k.width,P+R)-ie,height:Math.min(k.height,z+B)-de},layout:[{offset:$,stride:K}]}}(i,e,n,s,h)),v)for(let k=0;k<T.length;k+=4){const P=T[k];T[k]=T[k+2],T[k+2]=P}return T}finally{g.close()}})}let xt,Ct;const Hr="AbortError";function Wt(){return new Error(Hr)}const Br={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function or(i){return Br.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const Pr="global-dispatcher";class Fi extends Error{constructor(e,n,s,h){super(`AJAXError: ${n} (${e}): ${s}`),this.status=e,this.statusText=n,this.url=s,this.body=h}}const uo=()=>Gr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,kn=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const s=or(i.url);if(s)return s(i,e);if(Gr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:i,targetMapId:Pr},e)}if(!(/^file:/.test(n=i.url)||/^file:/.test(uo())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(s,h){return d(this,void 0,void 0,function*(){const g=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,cache:s.cache,referrer:uo(),signal:h.signal});s.type==="json"&&g.headers.set("Accept","application/json");const y=yield fetch(g);if(!y.ok){const k=yield y.blob();throw new Fi(y.status,y.statusText,s.url,k)}let v;v=s.type==="arrayBuffer"||s.type==="image"?y.arrayBuffer():s.type==="json"?y.json():y.text();const T=yield v;if(h.signal.aborted)throw Wt();return{data:T,cacheControl:y.headers.get("Cache-Control"),expires:y.headers.get("Expires")}})}(i,e);if(Gr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:i,mustQueue:!0,targetMapId:Pr},e)}var n;return function(s,h){return new Promise((g,y)=>{const v=new XMLHttpRequest;v.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(v.responseType="arraybuffer");for(const T in s.headers)v.setRequestHeader(T,s.headers[T]);s.type==="json"&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials=s.credentials==="include",v.onerror=()=>{y(new Error(v.statusText))},v.onload=()=>{if(!h.signal.aborted)if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let T=v.response;if(s.type==="json")try{T=JSON.parse(v.response)}catch(k){return void y(k)}g({data:T,cacheControl:v.getResponseHeader("Cache-Control"),expires:v.getResponseHeader("Expires")})}else{const T=new Blob([v.response],{type:v.getResponseHeader("Content-Type")});y(new Fi(v.status,v.statusText,s.url,T))}},h.signal.addEventListener("abort",()=>{v.abort(),y(Wt())}),v.send(s.body)})}(i,e)};function Wr(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function bi(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function un(i,e,n){if(n&&n[i]){const s=n[i].indexOf(e);s!==-1&&n[i].splice(s,1)}}class En{constructor(e,n={}){Me(this,n),this.type=e}}class Xt extends En{constructor(e,n={}){super("error",Me({error:e},n))}}class Gn{on(e,n){return this._listeners=this._listeners||{},bi(e,n,this._listeners),this}off(e,n){return un(e,n,this._listeners),un(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},bi(e,n,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,n){typeof e=="string"&&(e=new En(e,n||{}));const s=e.type;if(this.listens(s)){e.target=this;const h=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const v of h)v.call(this,e);const g=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const v of g)un(s,v,this._oneTimeListeners),v.call(this,e);const y=this._eventedParent;y&&(Me(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof Xt&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Ie={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Hn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function To(i,e){const n={};for(const s in i)s!=="ref"&&(n[s]=i[s]);return Hn.forEach(s=>{s in e&&(n[s]=e[s])}),n}function Pt(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(!Pt(i[n],e[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const n in i)if(!Pt(i[n],e[n]))return!1;return!0}return i===e}function dr(i,e){i.push(e)}function Bi(i,e,n){dr(n,{command:"addSource",args:[i,e[i]]})}function Cn(i,e,n){dr(e,{command:"removeSource",args:[i]}),n[i]=!0}function di(i,e,n,s){Cn(i,n,s),Bi(i,e,n)}function Xi(i,e,n){let s;for(s in i[n])if(Object.prototype.hasOwnProperty.call(i[n],s)&&s!=="data"&&!Pt(i[n][s],e[n][s]))return!1;for(s in e[n])if(Object.prototype.hasOwnProperty.call(e[n],s)&&s!=="data"&&!Pt(i[n][s],e[n][s]))return!1;return!0}function Pn(i,e,n,s,h,g){i=i||{},e=e||{};for(const y in i)Object.prototype.hasOwnProperty.call(i,y)&&(Pt(i[y],e[y])||n.push({command:g,args:[s,y,e[y],h]}));for(const y in e)Object.prototype.hasOwnProperty.call(e,y)&&!Object.prototype.hasOwnProperty.call(i,y)&&(Pt(i[y],e[y])||n.push({command:g,args:[s,y,e[y],h]}))}function cn(i){return i.id}function Io(i,e){return i[e.id]=e,i}class Re{constructor(e,n,s,h){this.message=(e?`${e}: `:"")+s,h&&(this.identifier=h),n!=null&&n.__line__&&(this.line=n.__line__)}}function ii(i,...e){for(const n of e)for(const s in n)i[s]=n[s];return i}class Qr extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class co{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[s,h]of n)this.bindings[s]=h}concat(e){return new co(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Wn={kind:"null"},Fe={kind:"number"},mt={kind:"string"},gt={kind:"boolean"},br={kind:"color"},Si={kind:"object"},yt={kind:"value"},Mn={kind:"collator"},Ji={kind:"formatted"},H={kind:"padding"},E={kind:"resolvedImage"},M={kind:"variableAnchorOffsetCollection"};function D(i,e){return{kind:"array",itemType:i,N:e}}function O(i){if(i.kind==="array"){const e=O(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const X=[Wn,Fe,mt,gt,br,Ji,Si,D(yt),H,E,M];function re(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!re(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of X)if(!re(n,e))return null}}return`Expected ${O(i)} but found ${O(e)} instead.`}function oe(i,e){return e.some(n=>n.kind===i.kind)}function W(i,e){return e.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}function se(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const _e=.96422,ve=.82521,fe=4/29,Oe=6/29,Je=3*Oe*Oe,Qe=Oe*Oe*Oe,st=Math.PI/180,lt=180/Math.PI;function qt(i){return(i%=360)<0&&(i+=360),i}function Rt([i,e,n,s]){let h,g;const y=dt((.2225045*(i=Gt(i))+.7168786*(e=Gt(e))+.0606169*(n=Gt(n)))/1);i===e&&e===n?h=g=y:(h=dt((.4360747*i+.3850649*e+.1430804*n)/_e),g=dt((.0139322*i+.0971045*e+.7141733*n)/ve));const v=116*y-16;return[v<0?0:v,500*(h-y),200*(y-g),s]}function Gt(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function dt(i){return i>Qe?Math.pow(i,1/3):i/Je+fe}function Jt([i,e,n,s]){let h=(i+16)/116,g=isNaN(e)?h:h+e/500,y=isNaN(n)?h:h-n/200;return h=1*Yr(h),g=_e*Yr(g),y=ve*Yr(y),[ur(3.1338561*g-1.6168667*h-.4906146*y),ur(-.9787684*g+1.9161415*h+.033454*y),ur(.0719453*g-.2289914*h+1.4052427*y),s]}function ur(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Yr(i){return i>Oe?i*i*i:Je*(i-fe)}function pr(i){return parseInt(i.padEnd(2,i),16)/255}function Mr(i,e){return bt(e?i/100:i,0,1)}function bt(i,e,n){return Math.min(Math.max(e,i),n)}function $t(i){return!i.some(Number.isNaN)}const ni={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ft{constructor(e,n,s,h=1,g=!0){this.r=e,this.g=n,this.b=s,this.a=h,g||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[e,n,s,h]))}static parse(e){if(e instanceof Ft)return e;if(typeof e!="string")return;const n=function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=ni[s];if(h){const[y,v,T]=h;return[y/255,v/255,T/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const y=s.length<6?1:2;let v=1;return[pr(s.slice(v,v+=y)),pr(s.slice(v,v+=y)),pr(s.slice(v,v+=y)),pr(s.slice(v,v+y)||"ff")]}if(s.startsWith("rgb")){const y=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[v,T,k,P,z,R,B,j,$,K,ie,de]=y,ae=[P||" ",B||" ",K].join("");if(ae==="  "||ae==="  /"||ae===",,"||ae===",,,"){const ce=[k,R,$].join(""),ke=ce==="%%%"?100:ce===""?255:0;if(ke){const Ce=[bt(+T/ke,0,1),bt(+z/ke,0,1),bt(+j/ke,0,1),ie?Mr(+ie,de):1];if($t(Ce))return Ce}}return}}const g=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[y,v,T,k,P,z,R,B,j]=g,$=[T||" ",P||" ",R].join("");if($==="  "||$==="  /"||$===",,"||$===",,,"){const K=[+v,bt(+k,0,100),bt(+z,0,100),B?Mr(+B,j):1];if($t(K))return function([ie,de,ae,ce]){function ke(Ce){const Ge=(Ce+ie/30)%12,et=de*Math.min(ae,1-ae);return ae-et*Math.max(-1,Math.min(Ge-3,9-Ge,1))}return ie=qt(ie),de/=100,ae/=100,[ke(0),ke(8),ke(4),ce]}(K)}}}(e);return n?new Ft(...n,!1):void 0}get rgb(){const{r:e,g:n,b:s,a:h}=this,g=h||1/0;return this.overwriteGetter("rgb",[e/g,n/g,s/g,h])}get hcl(){return this.overwriteGetter("hcl",function(e){const[n,s,h,g]=Rt(e),y=Math.sqrt(s*s+h*h);return[Math.round(1e4*y)?qt(Math.atan2(h,s)*lt):NaN,y,n,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Rt(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,s,h]=this.rgb;return`rgba(${[e,n,s].map(g=>Math.round(255*g)).join(",")},${h})`}}Ft.black=new Ft(0,0,0,1),Ft.white=new Ft(1,1,1,1),Ft.transparent=new Ft(0,0,0,0),Ft.red=new Ft(1,0,0,1);class Xa{constructor(e,n,s){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ru{constructor(e,n,s,h,g){this.text=e,this.image=n,this.scale=s,this.fontStack=h,this.textColor=g}}class Oi{constructor(e){this.sections=e}static fromString(e){return new Oi([new ru(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Oi?e:Oi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Ni{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ni)return e;if(typeof e=="number")return new Ni([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Ni(e)}}toString(){return JSON.stringify(this.values)}}const ph=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class oi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof oi)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const s=e[n],h=e[n+1];if(typeof s!="string"||!ph.has(s)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new oi(e)}}toString(){return JSON.stringify(this.values)}}class Qi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Qi({name:e,available:!1}):null}}function fh(i,e,n,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,n,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,n,s]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ho(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ft||i instanceof Xa||i instanceof Oi||i instanceof Ni||i instanceof oi||i instanceof Qi)return!0;if(Array.isArray(i)){for(const e of i)if(!ho(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!ho(i[e]))return!1;return!0}return!1}function zr(i){if(i===null)return Wn;if(typeof i=="string")return mt;if(typeof i=="boolean")return gt;if(typeof i=="number")return Fe;if(i instanceof Ft)return br;if(i instanceof Xa)return Mn;if(i instanceof Oi)return Ji;if(i instanceof Ni)return H;if(i instanceof oi)return M;if(i instanceof Qi)return E;if(Array.isArray(i)){const e=i.length;let n;for(const s of i){const h=zr(s);if(n){if(n===h)continue;n=yt;break}n=h}return D(n||yt,e)}return Si}function Ja(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Ft||i instanceof Oi||i instanceof Ni||i instanceof oi||i instanceof Qi?i.toString():JSON.stringify(i)}class ko{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ho(e[1]))return n.error("invalid value");const s=e[1];let h=zr(s);const g=n.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new ko(h,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class _r{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Eo={string:mt,number:Fe,boolean:gt,object:Si};class hn{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s,h=1;const g=e[0];if(g==="array"){let v,T;if(e.length>2){const k=e[1];if(typeof k!="string"||!(k in Eo)||k==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);v=Eo[k],h++}else v=yt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);T=e[2],h++}s=D(v,T)}else{if(!Eo[g])throw new Error(`Types doesn't contain name = ${g}`);s=Eo[g]}const y=[];for(;h<e.length;h++){const v=n.parse(e[h],h,yt);if(!v)return null;y.push(v)}return new hn(s,y)}evaluate(e){for(let n=0;n<this.args.length;n++){const s=this.args[n].evaluate(e);if(!re(this.type,zr(s)))return s;if(n===this.args.length-1)throw new _r(`Expected value to be of type ${O(this.type)}, but found ${O(zr(s))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Os={"to-boolean":gt,"to-color":br,"to-number":Fe,"to-string":mt};class zn{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[0];if(!Os[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&e.length!==2)return n.error("Expected one argument.");const h=Os[s],g=[];for(let y=1;y<e.length;y++){const v=n.parse(e[y],y,yt);if(!v)return null;g.push(v)}return new zn(h,g)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,s;for(const h of this.args){if(n=h.evaluate(e),s=null,n instanceof Ft)return n;if(typeof n=="string"){const g=e.parseColor(n);if(g)return g}else if(Array.isArray(n)&&(s=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:fh(n[0],n[1],n[2],n[3]),!s))return new Ft(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new _r(s||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const s of this.args){n=s.evaluate(e);const h=Ni.parse(n);if(h)return h}throw new _r(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const s of this.args){n=s.evaluate(e);const h=oi.parse(n);if(h)return h}throw new _r(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const s of this.args){if(n=s.evaluate(e),n===null)return 0;const h=Number(n);if(!isNaN(h))return h}throw new _r(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Oi.fromString(Ja(this.args[0].evaluate(e)));case"resolvedImage":return Qi.fromString(Ja(this.args[0].evaluate(e)));default:return Ja(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const iu=["Unknown","Point","LineString","Polygon"];class ia{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?iu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Ft.parse(e)),n}}class Ut{constructor(e,n,s=[],h,g=new co,y=[]){this.registry=e,this.path=s,this.key=s.map(v=>`[${v}]`).join(""),this.scope=g,this.errors=y,this.expectedType=h,this._isConstant=n}parse(e,n,s,h,g={}){return n?this.concat(n,s,h)._parse(e,g):this._parse(e,g)}_parse(e,n){function s(h,g,y){return y==="assert"?new hn(g,[h]):y==="coerce"?new zn(g,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[h];if(g){let y=g.parse(e,this);if(!y)return null;if(this.expectedType){const v=this.expectedType,T=y.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||T.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string")if(v.kind!=="padding"||T.kind!=="value"&&T.kind!=="number"&&T.kind!=="array")if(v.kind!=="variableAnchorOffsetCollection"||T.kind!=="value"&&T.kind!=="array"){if(this.checkSubtype(v,T))return null}else y=s(y,v,n.typeAnnotation||"coerce");else y=s(y,v,n.typeAnnotation||"coerce");else y=s(y,v,n.typeAnnotation||"coerce");else y=s(y,v,n.typeAnnotation||"assert")}if(!(y instanceof ko)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const v=new ia;try{y=new ko(y.type,y.evaluate(v))}catch(T){return this.error(T.message),null}}return y}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,s){const h=typeof e=="number"?this.path.concat(e):this.path,g=s?this.scope.concat(s):this.scope;return new Ut(this.registry,this._isConstant,h,n||null,g,this.errors)}error(e,...n){const s=`${this.key}${n.map(h=>`[${h}]`).join("")}`;this.errors.push(new Qr(s,e))}checkSubtype(e,n){const s=re(e,n);return s&&this.error(s),s}}class Ns{constructor(e,n,s){this.type=Mn,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return n.error("Collator options argument must be an object.");const h=n.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,gt);if(!h)return null;const g=n.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,gt);if(!g)return null;let y=null;return s.locale&&(y=n.parse(s.locale,1,mt),!y)?null:new Ns(h,g,y)}evaluate(e){return new Xa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const An=8192;function nu(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Qa(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function mh(i,e){const n=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(n*h*An),Math.round(s*h*An)]}function Np(i,e,n){const s=i[0]-e[0],h=i[1]-e[1],g=i[0]-n[0],y=i[1]-n[1];return s*y-g*h==0&&s*g<=0&&h*y<=0}function js(i,e){let n=!1;for(let y=0,v=e.length;y<v;y++){const T=e[y];for(let k=0,P=T.length;k<P-1;k++){if(Np(i,T[k],T[k+1]))return!1;(h=T[k])[1]>(s=i)[1]!=(g=T[k+1])[1]>s[1]&&s[0]<(g[0]-h[0])*(s[1]-h[1])/(g[1]-h[1])+h[0]&&(n=!n)}}var s,h,g;return n}function gh(i,e){for(let n=0;n<e.length;n++)if(js(i,e[n]))return!0;return!1}function yh(i,e,n,s){const h=s[0]-n[0],g=s[1]-n[1],y=(i[0]-n[0])*g-h*(i[1]-n[1]),v=(e[0]-n[0])*g-h*(e[1]-n[1]);return y>0&&v<0||y<0&&v>0}function jp(i,e,n){for(const k of n)for(let P=0;P<k.length-1;++P)if((v=[(y=k[P+1])[0]-(g=k[P])[0],y[1]-g[1]])[0]*(T=[(h=e)[0]-(s=i)[0],h[1]-s[1]])[1]-v[1]*T[0]!=0&&yh(s,h,g,y)&&yh(g,y,s,h))return!0;var s,h,g,y,v,T;return!1}function _h(i,e){for(let n=0;n<i.length;++n)if(!js(i[n],e))return!1;for(let n=0;n<i.length-1;++n)if(jp(i[n],i[n+1],e))return!1;return!0}function Up(i,e){for(let n=0;n<e.length;n++)if(_h(i,e[n]))return!0;return!1}function Us(i,e,n){const s=[];for(let h=0;h<i.length;h++){const g=[];for(let y=0;y<i[h].length;y++){const v=mh(i[h][y],n);nu(e,v),g.push(v)}s.push(g)}return s}function ou(i,e,n){const s=[];for(let h=0;h<i.length;h++){const g=Us(i[h],e,n);s.push(g)}return s}function vh(i,e,n,s){if(i[0]<n[0]||i[0]>n[2]){const h=.5*s;let g=i[0]-n[0]>h?-s:n[0]-i[0]>h?s:0;g===0&&(g=i[0]-n[2]>h?-s:n[2]-i[0]>h?s:0),i[0]+=g}nu(e,i)}function xh(i,e,n,s){const h=Math.pow(2,s.z)*An,g=[s.x*An,s.y*An],y=[];for(const v of i)for(const T of v){const k=[T.x+g[0],T.y+g[1]];vh(k,e,n,h),y.push(k)}return y}function Vs(i,e,n,s){const h=Math.pow(2,s.z)*An,g=[s.x*An,s.y*An],y=[];for(const T of i){const k=[];for(const P of T){const z=[P.x+g[0],P.y+g[1]];nu(e,z),k.push(z)}y.push(k)}if(e[2]-e[0]<=h/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const T of y)for(const k of T)vh(k,e,n,h)}var v;return y}class Co{constructor(e,n){this.type=gt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ho(e[1])){const s=e[1];if(s.type==="FeatureCollection"){const h=[];for(const g of s.features){const{type:y,coordinates:v}=g.geometry;y==="Polygon"&&h.push(v),y==="MultiPolygon"&&h.push(...v)}if(h.length)return new Co(s,{type:"MultiPolygon",coordinates:h})}else if(s.type==="Feature"){const h=s.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Co(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Co(s,s)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,s){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(s.type==="Polygon"){const v=Us(s.coordinates,g,y),T=xh(n.geometry(),h,g,y);if(!Qa(h,g))return!1;for(const k of T)if(!js(k,v))return!1}if(s.type==="MultiPolygon"){const v=ou(s.coordinates,g,y),T=xh(n.geometry(),h,g,y);if(!Qa(h,g))return!1;for(const k of T)if(!gh(k,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,s){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(s.type==="Polygon"){const v=Us(s.coordinates,g,y),T=Vs(n.geometry(),h,g,y);if(!Qa(h,g))return!1;for(const k of T)if(!_h(k,v))return!1}if(s.type==="MultiPolygon"){const v=ou(s.coordinates,g,y),T=Vs(n.geometry(),h,g,y);if(!Qa(h,g))return!1;for(const k of T)if(!Up(k,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class $s{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const s=e[1];return n.scope.has(s)?new $s(s,n.scope.get(s)):n.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class en{constructor(e,n,s,h){this.name=e,this.type=n,this._evaluate=s,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const s=e[0],h=en.definitions[s];if(!h)return n.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,y=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=y.filter(([k])=>!Array.isArray(k)||k.length===e.length-1);let T=null;for(const[k,P]of v){T=new Ut(n.registry,es,n.path,null,n.scope);const z=[];let R=!1;for(let B=1;B<e.length;B++){const j=e[B],$=Array.isArray(k)?k[B-1]:k.type,K=T.parse(j,1+z.length,$);if(!K){R=!0;break}z.push(K)}if(!R)if(Array.isArray(k)&&k.length!==z.length)T.error(`Expected ${k.length} arguments, but found ${z.length} instead.`);else{for(let B=0;B<z.length;B++){const j=Array.isArray(k)?k[B]:k.type,$=z[B];T.concat(B+1).checkSubtype(j,$.type)}if(T.errors.length===0)return new en(s,g,P,z)}}if(v.length===1)n.errors.push(...T.errors);else{const k=(v.length?v:y).map(([z])=>{return R=z,Array.isArray(R)?`(${R.map(O).join(", ")})`:`(${O(R.type)}...)`;var R}).join(" | "),P=[];for(let z=1;z<e.length;z++){const R=n.parse(e[z],1+P.length);if(!R)return null;P.push(O(R.type))}n.error(`Expected arguments of type ${k}, but found (${P.join(", ")}) instead.`)}return null}static register(e,n){en.definitions=n;for(const s in n)e[s]=en}}function es(i){if(i instanceof $s)return es(i.boundExpression);if(i instanceof en&&i.name==="error"||i instanceof Ns||i instanceof Co)return!1;const e=i instanceof zn||i instanceof hn;let n=!0;return i.eachChild(s=>{n=e?n&&es(s):n&&s instanceof ko}),!!n&&ts(i)&&Zs(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ts(i){if(i instanceof en&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Co)return!1;let e=!0;return i.eachChild(n=>{e&&!ts(n)&&(e=!1)}),e}function rs(i){if(i instanceof en&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(n=>{e&&!rs(n)&&(e=!1)}),e}function Zs(i,e){if(i instanceof en&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(s=>{n&&!Zs(s,e)&&(n=!1)}),n}function is(i,e){const n=i.length-1;let s,h,g=0,y=n,v=0;for(;g<=y;)if(v=Math.floor((g+y)/2),s=i[v],h=i[v+1],s<=e){if(v===n||e<h)return v;g=v+1}else{if(!(s>e))throw new _r("Input is not a number.");y=v-1}return 0}class na{constructor(e,n,s){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[h,g]of s)this.labels.push(h),this.outputs.push(g)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const s=n.parse(e[1],1,Fe);if(!s)return null;const h=[];let g=null;n.expectedType&&n.expectedType.kind!=="value"&&(g=n.expectedType);for(let y=1;y<e.length;y+=2){const v=y===1?-1/0:e[y],T=e[y+1],k=y,P=y+1;if(typeof v!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(h.length&&h[h.length-1][0]>=v)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const z=n.parse(T,P,g);if(!z)return null;g=g||z.type,h.push([v,z])}return new na(g,s,h)}evaluate(e){const n=this.labels,s=this.outputs;if(n.length===1)return s[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return s[0].evaluate(e);const g=n.length;return h>=n[g-1]?s[g-1].evaluate(e):s[is(n,h)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Vp(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var $p=wh;function wh(i,e,n,s){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=n,this.p2y=s}wh.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,s=0;s<8;s++){var h=this.sampleCurveX(n)-i;if(Math.abs(h)<e)return n;var g=this.sampleCurveDerivativeX(n);if(Math.abs(g)<1e-6)break;n-=h/g}var y=0,v=1;for(n=i,s=0;s<20&&(h=this.sampleCurveX(n),!(Math.abs(h-i)<e));s++)i>h?y=n:v=n,n=.5*(v-y)+y;return n},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var Zp=Vp($p);function Po(i,e,n){return i+n*(e-i)}function qs(i,e,n){return i.map((s,h)=>Po(s,e[h],n))}const ji={number:Po,color:function(i,e,n,s="rgb"){switch(s){case"rgb":{const[h,g,y,v]=qs(i.rgb,e.rgb,n);return new Ft(h,g,y,v,!1)}case"hcl":{const[h,g,y,v]=i.hcl,[T,k,P,z]=e.hcl;let R,B;if(isNaN(h)||isNaN(T))isNaN(h)?isNaN(T)?R=NaN:(R=T,y!==1&&y!==0||(B=k)):(R=h,P!==1&&P!==0||(B=g));else{let de=T-h;T>h&&de>180?de-=360:T<h&&h-T>180&&(de+=360),R=h+n*de}const[j,$,K,ie]=function([de,ae,ce,ke]){return de=isNaN(de)?0:de*st,Jt([ce,Math.cos(de)*ae,Math.sin(de)*ae,ke])}([R,B??Po(g,k,n),Po(y,P,n),Po(v,z,n)]);return new Ft(j,$,K,ie,!1)}case"lab":{const[h,g,y,v]=Jt(qs(i.lab,e.lab,n));return new Ft(h,g,y,v,!1)}}},array:qs,padding:function(i,e,n){return new Ni(qs(i.values,e.values,n))},variableAnchorOffsetCollection:function(i,e,n){const s=i.values,h=e.values;if(s.length!==h.length)throw new _r(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const g=[];for(let y=0;y<s.length;y+=2){if(s[y]!==h[y])throw new _r(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${s[y]}, to[${y}]: ${h[y]}`);g.push(s[y]);const[v,T]=s[y+1],[k,P]=h[y+1];g.push([Po(v,k,n),Po(T,P,n)])}return new oi(g)}};class pi{constructor(e,n,s,h,g){this.type=e,this.operator=n,this.interpolation=s,this.input=h,this.labels=[],this.outputs=[];for(const[y,v]of g)this.labels.push(y),this.outputs.push(v)}static interpolationFactor(e,n,s,h){let g=0;if(e.name==="exponential")g=oa(n,e.base,s,h);else if(e.name==="linear")g=oa(n,1,s,h);else if(e.name==="cubic-bezier"){const y=e.controlPoints;g=new Zp(y[0],y[1],y[2],y[3]).solve(oa(n,1,s,h))}return g}static parse(e,n){let[s,h,g,...y]=e;if(!Array.isArray(h)||h.length===0)return n.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const k=h[1];if(typeof k!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:k}}else{if(h[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const k=h.slice(1);if(k.length!==4||k.some(P=>typeof P!="number"||P<0||P>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:k}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(g=n.parse(g,2,Fe),!g)return null;const v=[];let T=null;s==="interpolate-hcl"||s==="interpolate-lab"?T=br:n.expectedType&&n.expectedType.kind!=="value"&&(T=n.expectedType);for(let k=0;k<y.length;k+=2){const P=y[k],z=y[k+1],R=k+3,B=k+4;if(typeof P!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(v.length&&v[v.length-1][0]>=P)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const j=n.parse(z,B,T);if(!j)return null;T=T||j.type,v.push([P,j])}return se(T,Fe)||se(T,br)||se(T,H)||se(T,M)||se(T,D(Fe))?new pi(T,s,h,g,v):n.error(`Type ${O(T)} is not interpolatable.`)}evaluate(e){const n=this.labels,s=this.outputs;if(n.length===1)return s[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return s[0].evaluate(e);const g=n.length;if(h>=n[g-1])return s[g-1].evaluate(e);const y=is(n,h),v=pi.interpolationFactor(this.interpolation,h,n[y],n[y+1]),T=s[y].evaluate(e),k=s[y+1].evaluate(e);switch(this.operator){case"interpolate":return ji[this.type.kind](T,k,v);case"interpolate-hcl":return ji.color(T,k,v,"hcl");case"interpolate-lab":return ji.color(T,k,v,"lab")}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function oa(i,e,n,s){const h=s-n,g=i-n;return h===0?0:e===1?g/h:(Math.pow(e,g)-1)/(Math.pow(e,h)-1)}class Bt{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let s=null;const h=n.expectedType;h&&h.kind!=="value"&&(s=h);const g=[];for(const v of e.slice(1)){const T=n.parse(v,1+g.length,s,void 0,{typeAnnotation:"omit"});if(!T)return null;s=s||T.type,g.push(T)}if(!s)throw new Error("No output type");const y=h&&g.some(v=>re(h,v.type));return new Bt(y?yt:s,g)}evaluate(e){let n,s=null,h=0;for(const g of this.args)if(h++,s=g.evaluate(e),s&&s instanceof Qi&&!s.available&&(n||(n=s.name),s=null,h===this.args.length&&(s=n)),s!==null)break;return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class Gs{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let g=1;g<e.length-1;g+=2){const y=e[g];if(typeof y!="string")return n.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return n.error("Variable names must contain only alphanumeric characters or '_'.",g);const v=n.parse(e[g+1],g+1);if(!v)return null;s.push([y,v])}const h=n.parse(e[e.length-1],e.length-1,n.expectedType,s);return h?new Gs(s,h):null}outputDefined(){return this.result.outputDefined()}}class au{constructor(e,n,s){this.type=e,this.index=n,this.input=s}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Fe),h=n.parse(e[2],2,D(n.expectedType||yt));return s&&h?new au(h.type.itemType,s,h):null}evaluate(e){const n=this.index.evaluate(e),s=this.input.evaluate(e);if(n<0)throw new _r(`Array index out of bounds: ${n} < 0.`);if(n>=s.length)throw new _r(`Array index out of bounds: ${n} > ${s.length-1}.`);if(n!==Math.floor(n))throw new _r(`Array index must be an integer, but found ${n} instead.`);return s[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class su{constructor(e,n){this.type=gt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,yt),h=n.parse(e[2],2,yt);return s&&h?oe(s.type,[gt,mt,Fe,Wn,yt])?new su(s,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${O(s.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!W(n,["boolean","string","number","null"]))throw new _r(`Expected first argument to be of type boolean, string, number or null, but found ${O(zr(n))} instead.`);if(!W(s,["string","array"]))throw new _r(`Expected second argument to be of type array or string, but found ${O(zr(s))} instead.`);return s.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Hs{constructor(e,n,s){this.type=Fe,this.needle=e,this.haystack=n,this.fromIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,yt),h=n.parse(e[2],2,yt);if(!s||!h)return null;if(!oe(s.type,[gt,mt,Fe,Wn,yt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${O(s.type)} instead`);if(e.length===4){const g=n.parse(e[3],3,Fe);return g?new Hs(s,h,g):null}return new Hs(s,h)}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!W(n,["boolean","string","number","null"]))throw new _r(`Expected first argument to be of type boolean, string, number or null, but found ${O(zr(n))} instead.`);if(!W(s,["string","array"]))throw new _r(`Expected second argument to be of type array or string, but found ${O(zr(s))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return s.indexOf(n,h)}return s.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class lu{constructor(e,n,s,h,g,y){this.inputType=e,this.type=n,this.input=s,this.cases=h,this.outputs=g,this.otherwise=y}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let s,h;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);const g={},y=[];for(let k=2;k<e.length-1;k+=2){let P=e[k];const z=e[k+1];Array.isArray(P)||(P=[P]);const R=n.concat(k);if(P.length===0)return R.error("Expected at least one branch label.");for(const j of P){if(typeof j!="number"&&typeof j!="string")return R.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return R.error("Numeric branch labels must be integer values.");if(s){if(R.checkSubtype(s,zr(j)))return null}else s=zr(j);if(g[String(j)]!==void 0)return R.error("Branch labels must be unique.");g[String(j)]=y.length}const B=n.parse(z,k,h);if(!B)return null;h=h||B.type,y.push(B)}const v=n.parse(e[1],1,yt);if(!v)return null;const T=n.parse(e[e.length-1],e.length-1,h);return T?v.type.kind!=="value"&&n.concat(1).checkSubtype(s,v.type)?null:new lu(s,h,v,g,y,T):null}evaluate(e){const n=this.input.evaluate(e);return(zr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class uu{constructor(e,n,s){this.type=e,this.branches=n,this.otherwise=s}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let s;n.expectedType&&n.expectedType.kind!=="value"&&(s=n.expectedType);const h=[];for(let y=1;y<e.length-1;y+=2){const v=n.parse(e[y],y,gt);if(!v)return null;const T=n.parse(e[y+1],y+1,s);if(!T)return null;h.push([v,T]),s=s||T.type}const g=n.parse(e[e.length-1],e.length-1,s);if(!g)return null;if(!s)throw new Error("Can't infer output type");return new uu(s,h,g)}evaluate(e){for(const[n,s]of this.branches)if(n.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,s]of this.branches)e(n),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class Ws{constructor(e,n,s,h){this.type=e,this.input=n,this.beginIndex=s,this.endIndex=h}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,yt),h=n.parse(e[2],2,Fe);if(!s||!h)return null;if(!oe(s.type,[D(yt),mt,yt]))return n.error(`Expected first argument to be of type array or string, but found ${O(s.type)} instead`);if(e.length===4){const g=n.parse(e[3],3,Fe);return g?new Ws(s.type,s,h,g):null}return new Ws(s.type,s,h)}evaluate(e){const n=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!W(n,["string","array"]))throw new _r(`Expected first argument to be of type array or string, but found ${O(zr(n))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return n.slice(s,h)}return n.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function bh(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Sh(i,e,n,s){return s.compare(e,n)===0}function aa(i,e,n){const s=i!=="=="&&i!=="!=";return class rw{constructor(g,y,v){this.type=gt,this.lhs=g,this.rhs=y,this.collator=v,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");const v=g[0];let T=y.parse(g[1],1,yt);if(!T)return null;if(!bh(v,T.type))return y.concat(1).error(`"${v}" comparisons are not supported for type '${O(T.type)}'.`);let k=y.parse(g[2],2,yt);if(!k)return null;if(!bh(v,k.type))return y.concat(2).error(`"${v}" comparisons are not supported for type '${O(k.type)}'.`);if(T.type.kind!==k.type.kind&&T.type.kind!=="value"&&k.type.kind!=="value")return y.error(`Cannot compare types '${O(T.type)}' and '${O(k.type)}'.`);s&&(T.type.kind==="value"&&k.type.kind!=="value"?T=new hn(k.type,[T]):T.type.kind!=="value"&&k.type.kind==="value"&&(k=new hn(T.type,[k])));let P=null;if(g.length===4){if(T.type.kind!=="string"&&k.type.kind!=="string"&&T.type.kind!=="value"&&k.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(P=y.parse(g[3],3,Mn),!P)return null}return new rw(T,k,P)}evaluate(g){const y=this.lhs.evaluate(g),v=this.rhs.evaluate(g);if(s&&this.hasUntypedArgument){const T=zr(y),k=zr(v);if(T.kind!==k.kind||T.kind!=="string"&&T.kind!=="number")throw new _r(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${T.kind}, ${k.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const T=zr(y),k=zr(v);if(T.kind!=="string"||k.kind!=="string")return e(g,y,v)}return this.collator?n(g,y,v,this.collator.evaluate(g)):e(g,y,v)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const qp=aa("==",function(i,e,n){return e===n},Sh),Gp=aa("!=",function(i,e,n){return e!==n},function(i,e,n,s){return!Sh(0,e,n,s)}),Hp=aa("<",function(i,e,n){return e<n},function(i,e,n,s){return s.compare(e,n)<0}),Wp=aa(">",function(i,e,n){return e>n},function(i,e,n,s){return s.compare(e,n)>0}),Yp=aa("<=",function(i,e,n){return e<=n},function(i,e,n,s){return s.compare(e,n)<=0}),Kp=aa(">=",function(i,e,n){return e>=n},function(i,e,n,s){return s.compare(e,n)>=0});class cu{constructor(e,n,s,h,g){this.type=mt,this.number=e,this.locale=n,this.currency=s,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const s=n.parse(e[1],1,Fe);if(!s)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=n.parse(h.locale,1,mt),!g))return null;let y=null;if(h.currency&&(y=n.parse(h.currency,1,mt),!y))return null;let v=null;if(h["min-fraction-digits"]&&(v=n.parse(h["min-fraction-digits"],1,Fe),!v))return null;let T=null;return h["max-fraction-digits"]&&(T=n.parse(h["max-fraction-digits"],1,Fe),!T)?null:new cu(s,g,y,v,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Ys{constructor(e){this.type=Ji,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return n.error("First argument must be an image or text section.");const h=[];let g=!1;for(let y=1;y<=e.length-1;++y){const v=e[y];if(g&&typeof v=="object"&&!Array.isArray(v)){g=!1;let T=null;if(v["font-scale"]&&(T=n.parse(v["font-scale"],1,Fe),!T))return null;let k=null;if(v["text-font"]&&(k=n.parse(v["text-font"],1,D(mt)),!k))return null;let P=null;if(v["text-color"]&&(P=n.parse(v["text-color"],1,br),!P))return null;const z=h[h.length-1];z.scale=T,z.font=k,z.textColor=P}else{const T=n.parse(e[y],1,yt);if(!T)return null;const k=T.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:T,scale:null,font:null,textColor:null})}}return new Ys(h)}evaluate(e){return new Oi(this.sections.map(n=>{const s=n.content.evaluate(e);return zr(s)===E?new ru("",s,null,null,null):new ru(Ja(s),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}}class hu{constructor(e){this.type=E,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const s=n.parse(e[1],1,mt);return s?new hu(s):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),s=Qi.fromString(n);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(n)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}}class du{constructor(e){this.type=Fe,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=n.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${O(s.type)} instead.`):new du(s):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new _r(`Expected value to be of type string or array, but found ${O(zr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const sa={"==":qp,"!=":Gp,">":Wp,"<":Hp,">=":Kp,"<=":Yp,array:hn,at:au,boolean:hn,case:uu,coalesce:Bt,collator:Ns,format:Ys,image:hu,in:su,"index-of":Hs,interpolate:pi,"interpolate-hcl":pi,"interpolate-lab":pi,length:du,let:Gs,literal:ko,match:lu,number:hn,"number-format":cu,object:hn,slice:Ws,step:na,string:hn,"to-boolean":zn,"to-color":zn,"to-number":zn,"to-string":zn,var:$s,within:Co};function Th(i,[e,n,s,h]){e=e.evaluate(i),n=n.evaluate(i),s=s.evaluate(i);const g=h?h.evaluate(i):1,y=fh(e,n,s,g);if(y)throw new _r(y);return new Ft(e/255,n/255,s/255,g,!1)}function Ih(i,e){return i in e}function pu(i,e){const n=e[i];return n===void 0?null:n}function Mo(i){return{type:i}}function kh(i){return{result:"success",value:i}}function la(i){return{result:"error",value:i}}function ua(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Eh(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function fu(i){return!!i.expression&&i.expression.interpolated}function Nt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function ca(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Xp(i){return i}function Ch(i,e){const n=e.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",h=s||!(s||i.property!==void 0),g=i.type||(fu(e)?"exponential":"interval");if(n||e.type==="padding"){const P=n?Ft.parse:Ni.parse;(i=ii({},i)).stops&&(i.stops=i.stops.map(z=>[z[0],P(z[1])])),i.default=P(i.default?i.default:e.default)}if(i.colorSpace&&(y=i.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var y;let v,T,k;if(g==="exponential")v=Ph;else if(g==="interval")v=Sr;else if(g==="categorical"){v=Jp,T=Object.create(null);for(const P of i.stops)T[P[0]]=P[1];k=typeof i.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);v=Lt}if(s){const P={},z=[];for(let j=0;j<i.stops.length;j++){const $=i.stops[j],K=$[0].zoom;P[K]===void 0&&(P[K]={zoom:K,type:i.type,property:i.property,default:i.default,stops:[]},z.push(K)),P[K].stops.push([$[0].value,$[1]])}const R=[];for(const j of z)R.push([P[j].zoom,Ch(P[j],e)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:pi.interpolationFactor.bind(void 0,B),zoomStops:R.map(j=>j[0]),evaluate:({zoom:j},$)=>Ph({stops:R,base:i.base},e,j).evaluate(j,$)}}if(h){const P=g==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:pi.interpolationFactor.bind(void 0,P),zoomStops:i.stops.map(z=>z[0]),evaluate:({zoom:z})=>v(i,e,z,T,k)}}return{kind:"source",evaluate(P,z){const R=z&&z.properties?z.properties[i.property]:void 0;return R===void 0?ns(i.default,e.default):v(i,e,R,T,k)}}}function ns(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function Jp(i,e,n,s,h){return ns(typeof n===h?s[n]:void 0,i.default,e.default)}function Sr(i,e,n){if(Nt(n)!=="number")return ns(i.default,e.default);const s=i.stops.length;if(s===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[s-1][0])return i.stops[s-1][1];const h=is(i.stops.map(g=>g[0]),n);return i.stops[h][1]}function Ph(i,e,n){const s=i.base!==void 0?i.base:1;if(Nt(n)!=="number")return ns(i.default,e.default);const h=i.stops.length;if(h===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[h-1][0])return i.stops[h-1][1];const g=is(i.stops.map(P=>P[0]),n),y=function(P,z,R,B){const j=B-R,$=P-R;return j===0?0:z===1?$/j:(Math.pow(z,$)-1)/(Math.pow(z,j)-1)}(n,s,i.stops[g][0],i.stops[g+1][0]),v=i.stops[g][1],T=i.stops[g+1][1],k=ji[e.type]||Xp;return typeof v.evaluate=="function"?{evaluate(...P){const z=v.evaluate.apply(void 0,P),R=T.evaluate.apply(void 0,P);if(z!==void 0&&R!==void 0)return k(z,R,y,i.colorSpace)}}:k(v,T,y,i.colorSpace)}function Lt(i,e,n){switch(e.type){case"color":n=Ft.parse(n);break;case"formatted":n=Oi.fromString(n.toString());break;case"resolvedImage":n=Qi.fromString(n.toString());break;case"padding":n=Ni.parse(n);break;default:Nt(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return ns(n,i.default,e.default)}en.register(sa,{error:[{kind:"error"},[mt],(i,[e])=>{throw new _r(e.evaluate(i))}],typeof:[mt,[yt],(i,[e])=>O(zr(e.evaluate(i)))],"to-rgba":[D(Fe,4),[br],(i,[e])=>{const[n,s,h,g]=e.evaluate(i).rgb;return[255*n,255*s,255*h,g]}],rgb:[br,[Fe,Fe,Fe],Th],rgba:[br,[Fe,Fe,Fe,Fe],Th],has:{type:gt,overloads:[[[mt],(i,[e])=>Ih(e.evaluate(i),i.properties())],[[mt,Si],(i,[e,n])=>Ih(e.evaluate(i),n.evaluate(i))]]},get:{type:yt,overloads:[[[mt],(i,[e])=>pu(e.evaluate(i),i.properties())],[[mt,Si],(i,[e,n])=>pu(e.evaluate(i),n.evaluate(i))]]},"feature-state":[yt,[mt],(i,[e])=>pu(e.evaluate(i),i.featureState||{})],properties:[Si,[],i=>i.properties()],"geometry-type":[mt,[],i=>i.geometryType()],id:[yt,[],i=>i.id()],zoom:[Fe,[],i=>i.globals.zoom],"heatmap-density":[Fe,[],i=>i.globals.heatmapDensity||0],"line-progress":[Fe,[],i=>i.globals.lineProgress||0],accumulated:[yt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Fe,Mo(Fe),(i,e)=>{let n=0;for(const s of e)n+=s.evaluate(i);return n}],"*":[Fe,Mo(Fe),(i,e)=>{let n=1;for(const s of e)n*=s.evaluate(i);return n}],"-":{type:Fe,overloads:[[[Fe,Fe],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[Fe],(i,[e])=>-e.evaluate(i)]]},"/":[Fe,[Fe,Fe],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[Fe,[Fe,Fe],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[Fe,[],()=>Math.LN2],pi:[Fe,[],()=>Math.PI],e:[Fe,[],()=>Math.E],"^":[Fe,[Fe,Fe],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[Fe,[Fe],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Fe,[Fe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Fe,[Fe],(i,[e])=>Math.log(e.evaluate(i))],log2:[Fe,[Fe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Fe,[Fe],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Fe,[Fe],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Fe,[Fe],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Fe,[Fe],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Fe,[Fe],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Fe,[Fe],(i,[e])=>Math.atan(e.evaluate(i))],min:[Fe,Mo(Fe),(i,e)=>Math.min(...e.map(n=>n.evaluate(i)))],max:[Fe,Mo(Fe),(i,e)=>Math.max(...e.map(n=>n.evaluate(i)))],abs:[Fe,[Fe],(i,[e])=>Math.abs(e.evaluate(i))],round:[Fe,[Fe],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[Fe,[Fe],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Fe,[Fe],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[gt,[mt,yt],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[gt,[yt],(i,[e])=>i.id()===e.value],"filter-type-==":[gt,[mt],(i,[e])=>i.geometryType()===e.value],"filter-<":[gt,[mt,yt],(i,[e,n])=>{const s=i.properties()[e.value],h=n.value;return typeof s==typeof h&&s<h}],"filter-id-<":[gt,[yt],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n<s}],"filter->":[gt,[mt,yt],(i,[e,n])=>{const s=i.properties()[e.value],h=n.value;return typeof s==typeof h&&s>h}],"filter-id->":[gt,[yt],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n>s}],"filter-<=":[gt,[mt,yt],(i,[e,n])=>{const s=i.properties()[e.value],h=n.value;return typeof s==typeof h&&s<=h}],"filter-id-<=":[gt,[yt],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n<=s}],"filter->=":[gt,[mt,yt],(i,[e,n])=>{const s=i.properties()[e.value],h=n.value;return typeof s==typeof h&&s>=h}],"filter-id->=":[gt,[yt],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n>=s}],"filter-has":[gt,[yt],(i,[e])=>e.value in i.properties()],"filter-has-id":[gt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[gt,[D(mt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[gt,[D(yt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[gt,[mt,D(yt)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[gt,[mt,D(yt)],(i,[e,n])=>function(s,h,g,y){for(;g<=y;){const v=g+y>>1;if(h[v]===s)return!0;h[v]>s?y=v-1:g=v+1}return!1}(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:gt,overloads:[[[gt,gt],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[Mo(gt),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:gt,overloads:[[[gt,gt],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[Mo(gt),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[gt,[gt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[gt,[mt],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[mt,[mt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[mt,[mt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[mt,Mo(yt),(i,e)=>e.map(n=>Ja(n.evaluate(i))).join("")],"resolved-locale":[mt,[Mn],(i,[e])=>e.evaluate(i).resolvedLocale()]});class os{constructor(e,n){var s;this.expression=e,this._warningHistory={},this._evaluator=new ia,this._defaultValue=n?(s=n).type==="color"&&ca(s.default)?new Ft(0,0,0,0):s.type==="color"?Ft.parse(s.default)||null:s.type==="padding"?Ni.parse(s.default)||null:s.type==="variableAnchorOffsetCollection"?oi.parse(s.default)||null:s.default===void 0?null:s.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,s,h,g,y){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=s,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(e,n,s,h,g,y){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=s||null,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new _r(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function Qt(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in sa}function Yt(i,e){const n=new Ut(sa,es,[],e?function(h){const g={color:br,string:mt,number:Fe,enum:mt,boolean:gt,formatted:Ji,padding:H,resolvedImage:E,variableAnchorOffsetCollection:M};return h.type==="array"?D(g[h.value]||yt,h.length):g[h.type]}(e):void 0),s=n.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?kh(new os(s,e)):la(n.errors)}class ha{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!rs(n.expression)}evaluateWithoutErrorHandling(e,n,s,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,h,g,y)}evaluate(e,n,s,h,g,y){return this._styleExpression.evaluate(e,n,s,h,g,y)}}class Ks{constructor(e,n,s,h){this.kind=e,this.zoomStops=s,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!rs(n.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,n,s,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,h,g,y)}evaluate(e,n,s,h,g,y){return this._styleExpression.evaluate(e,n,s,h,g,y)}interpolationFactor(e,n,s){return this.interpolationType?pi.interpolationFactor(this.interpolationType,e,n,s):0}}function Mh(i,e){const n=Yt(i,e);if(n.result==="error")return n;const s=n.value.expression,h=ts(s);if(!h&&!ua(e))return la([new Qr("","data expressions not supported")]);const g=Zs(s,["zoom"]);if(!g&&!Eh(e))return la([new Qr("","zoom expressions not supported")]);const y=Js(s);return y||g?y instanceof Qr?la([y]):y instanceof pi&&!fu(e)?la([new Qr("",'"interpolate" expressions cannot be used with this property')]):kh(y?new Ks(h?"camera":"composite",n.value,y.labels,y instanceof pi?y.interpolation:void 0):new ha(h?"constant":"source",n.value)):la([new Qr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Xs{constructor(e,n){this._parameters=e,this._specification=n,ii(this,Ch(this._parameters,this._specification))}static deserialize(e){return new Xs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Js(i){let e=null;if(i instanceof Gs)e=Js(i.result);else if(i instanceof Bt){for(const n of i.args)if(e=Js(n),e)break}else(i instanceof na||i instanceof pi)&&i.input instanceof en&&i.input.name==="zoom"&&(e=i);return e instanceof Qr||i.eachChild(n=>{const s=Js(n);s instanceof Qr?e=s:!e&&s?e=new Qr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new Qr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function mu(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!mu(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const zh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Qs(i){if(i==null)return{filter:()=>!0,needGeometry:!1};mu(i)||(i=da(i));const e=Yt(i,zh);if(e.result==="error")throw new Error(e.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,s,h)=>e.value.evaluate(n,s,{},h),needGeometry:gu(i)}}function Ah(i,e){return i<e?-1:i>e?1:0}function gu(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(gu(i[e]))return!0;return!1}function da(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?yu(i[1],i[2],"=="):e==="!="?el(yu(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?yu(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(da))):e==="all"?["all"].concat(i.slice(1).map(da)):e==="none"?["all"].concat(i.slice(1).map(da).map(el)):e==="in"?Dh(i[1],i.slice(2)):e==="!in"?el(Dh(i[1],i.slice(2))):e==="has"?Lh(i[1]):e==="!has"?el(Lh(i[1])):e!=="within"||i;var n}function yu(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function Dh(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Ah)]]:["filter-in-small",i,["literal",e]]}}function Lh(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function el(i){return["!",i]}function _u(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let h="[";for(const g of i)h+=`${_u(g)},`;return`${h}]`}const n=Object.keys(i).sort();let s="{";for(let h=0;h<n.length;h++)s+=`${JSON.stringify(n[h])}:${_u(i[n[h]])},`;return`${s}}`}function Qp(i){let e="";for(const n of Hn)e+=`/${_u(i[n])}`;return e}function Rh(i){const e=i.value;return e?[new Re(i.key,e,"constants have been deprecated as of v8")]:[]}function vr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function po(i){if(Array.isArray(i))return i.map(po);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=po(i[n]);return e}return vr(i)}function Ui(i){const e=i.key,n=i.value,s=i.valueSpec||{},h=i.objectElementValidators||{},g=i.style,y=i.styleSpec,v=i.validateSpec;let T=[];const k=Nt(n);if(k!=="object")return[new Re(e,n,`object expected, ${k} found`)];for(const P in n){const z=P.split(".")[0],R=s[z]||s["*"];let B;if(h[z])B=h[z];else if(s[z])B=v;else if(h["*"])B=h["*"];else{if(!s["*"]){T.push(new Re(e,n[P],`unknown property "${P}"`));continue}B=v}T=T.concat(B({key:(e&&`${e}.`)+P,value:n[P],valueSpec:R,style:g,styleSpec:y,object:n,objectKey:P,validateSpec:v},n))}for(const P in s)h[P]||s[P].required&&s[P].default===void 0&&n[P]===void 0&&T.push(new Re(e,n,`missing required property "${P}"`));return T}function pa(i){const e=i.value,n=i.valueSpec,s=i.style,h=i.styleSpec,g=i.key,y=i.arrayElementValidator||i.validateSpec;if(Nt(e)!=="array")return[new Re(g,e,`array expected, ${Nt(e)} found`)];if(n.length&&e.length!==n.length)return[new Re(g,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Re(g,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let v={type:n.value,values:n.values};h.$version<7&&(v.function=n.function),Nt(n.value)==="object"&&(v=n.value);let T=[];for(let k=0;k<e.length;k++)T=T.concat(y({array:e,arrayIndex:k,value:e[k],valueSpec:v,validateSpec:i.validateSpec,style:s,styleSpec:h,key:`${g}[${k}]`}));return T}function vu(i){const e=i.key,n=i.value,s=i.valueSpec;let h=Nt(n);return h==="number"&&n!=n&&(h="NaN"),h!=="number"?[new Re(e,n,`number expected, ${h} found`)]:"minimum"in s&&n<s.minimum?[new Re(e,n,`${n} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&n>s.maximum?[new Re(e,n,`${n} is greater than the maximum value ${s.maximum}`)]:[]}function xu(i){const e=i.valueSpec,n=vr(i.value.type);let s,h,g,y={};const v=n!=="categorical"&&i.value.property===void 0,T=!v,k=Nt(i.value.stops)==="array"&&Nt(i.value.stops[0])==="array"&&Nt(i.value.stops[0][0])==="object",P=Ui({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(B){if(n==="identity")return[new Re(B.key,B.value,'identity function may not have a "stops" property')];let j=[];const $=B.value;return j=j.concat(pa({key:B.key,value:$,valueSpec:B.valueSpec,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:z})),Nt($)==="array"&&$.length===0&&j.push(new Re(B.key,$,"array must have at least one stop")),j},default:function(B){return B.validateSpec({key:B.key,value:B.value,valueSpec:e,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec})}}});return n==="identity"&&v&&P.push(new Re(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||P.push(new Re(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!fu(i.valueSpec)&&P.push(new Re(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(T&&!ua(i.valueSpec)?P.push(new Re(i.key,i.value,"property functions not supported")):v&&!Eh(i.valueSpec)&&P.push(new Re(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!k||i.value.property!==void 0||P.push(new Re(i.key,i.value,'"property" property is required')),P;function z(B){let j=[];const $=B.value,K=B.key;if(Nt($)!=="array")return[new Re(K,$,`array expected, ${Nt($)} found`)];if($.length!==2)return[new Re(K,$,`array length 2 expected, length ${$.length} found`)];if(k){if(Nt($[0])!=="object")return[new Re(K,$,`object expected, ${Nt($[0])} found`)];if($[0].zoom===void 0)return[new Re(K,$,"object stop key must have zoom")];if($[0].value===void 0)return[new Re(K,$,"object stop key must have value")];if(g&&g>vr($[0].zoom))return[new Re(K,$[0].zoom,"stop zoom values must appear in ascending order")];vr($[0].zoom)!==g&&(g=vr($[0].zoom),h=void 0,y={}),j=j.concat(Ui({key:`${K}[0]`,value:$[0],valueSpec:{zoom:{}},validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:vu,value:R}}))}else j=j.concat(R({key:`${K}[0]`,value:$[0],valueSpec:{},validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec},$));return Qt(po($[1]))?j.concat([new Re(`${K}[1]`,$[1],"expressions are not allowed in function stops.")]):j.concat(B.validateSpec({key:`${K}[1]`,value:$[1],valueSpec:e,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec}))}function R(B,j){const $=Nt(B.value),K=vr(B.value),ie=B.value!==null?B.value:j;if(s){if($!==s)return[new Re(B.key,ie,`${$} stop domain type must match previous stop domain type ${s}`)]}else s=$;if($!=="number"&&$!=="string"&&$!=="boolean")return[new Re(B.key,ie,"stop domain value must be a number, string, or boolean")];if($!=="number"&&n!=="categorical"){let de=`number expected, ${$} found`;return ua(e)&&n===void 0&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Re(B.key,ie,de)]}return n!=="categorical"||$!=="number"||isFinite(K)&&Math.floor(K)===K?n!=="categorical"&&$==="number"&&h!==void 0&&K<h?[new Re(B.key,ie,"stop domain values must appear in ascending order")]:(h=K,n==="categorical"&&K in y?[new Re(B.key,ie,"stop domain values must be unique")]:(y[K]=!0,[])):[new Re(B.key,ie,`integer expected, found ${K}`)]}}function fa(i){const e=(i.expressionContext==="property"?Mh:Yt)(po(i.value),i.valueSpec);if(e.result==="error")return e.value.map(s=>new Re(`${i.key}${s.key}`,i.value,s.message));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new Re(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!rs(n))return[new Re(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!rs(n))return[new Re(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Zs(n,["zoom","feature-state"]))return[new Re(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ts(n))return[new Re(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function zo(i){const e=i.key,n=i.value,s=i.valueSpec,h=[];return Array.isArray(s.values)?s.values.indexOf(vr(n))===-1&&h.push(new Re(e,n,`expected one of [${s.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(s.values).indexOf(vr(n))===-1&&h.push(new Re(e,n,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(n)} found`)),h}function ma(i){return mu(po(i.value))?fa(ii({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):as(i)}function as(i){const e=i.value,n=i.key;if(Nt(e)!=="array")return[new Re(n,e,`array expected, ${Nt(e)} found`)];const s=i.styleSpec;let h,g=[];if(e.length<1)return[new Re(n,e,"filter array must have at least 1 element")];switch(g=g.concat(zo({key:`${n}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),vr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&vr(e[1])==="$type"&&g.push(new Re(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&g.push(new Re(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=Nt(e[1]),h!=="string"&&g.push(new Re(`${n}[1]`,e[1],`string expected, ${h} found`)));for(let y=2;y<e.length;y++)h=Nt(e[y]),vr(e[1])==="$type"?g=g.concat(zo({key:`${n}[${y}]`,value:e[y],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&g.push(new Re(`${n}[${y}]`,e[y],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)g=g.concat(as({key:`${n}[${y}]`,value:e[y],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":h=Nt(e[1]),e.length!==2?g.push(new Re(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="string"&&g.push(new Re(`${n}[1]`,e[1],`string expected, ${h} found`));break;case"within":h=Nt(e[1]),e.length!==2?g.push(new Re(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="object"&&g.push(new Re(`${n}[1]`,e[1],`object expected, ${h} found`))}return g}function wu(i,e){const n=i.key,s=i.validateSpec,h=i.style,g=i.styleSpec,y=i.value,v=i.objectKey,T=g[`${e}_${i.layerType}`];if(!T)return[];const k=v.match(/^(.*)-transition$/);if(e==="paint"&&k&&T[k[1]]&&T[k[1]].transition)return s({key:n,value:y,valueSpec:g.transition,style:h,styleSpec:g});const P=i.valueSpec||T[v];if(!P)return[new Re(n,y,`unknown property "${v}"`)];let z;if(Nt(y)==="string"&&ua(P)&&!P.tokens&&(z=/^{([^}]+)}$/.exec(y)))return[new Re(n,y,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const R=[];return i.layerType==="symbol"&&(v==="text-field"&&h&&!h.glyphs&&R.push(new Re(n,y,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&ca(po(y))&&vr(y.type)==="identity"&&R.push(new Re(n,y,'"text-font" does not support identity functions'))),R.concat(s({key:i.key,value:y,valueSpec:P,style:h,styleSpec:g,expressionContext:"property",propertyType:e,propertyKey:v}))}function tl(i){return wu(i,"paint")}function bu(i){return wu(i,"layout")}function Su(i){let e=[];const n=i.value,s=i.key,h=i.style,g=i.styleSpec;n.type||n.ref||e.push(new Re(s,n,'either "type" or "ref" is required'));let y=vr(n.type);const v=vr(n.ref);if(n.id){const T=vr(n.id);for(let k=0;k<i.arrayIndex;k++){const P=h.layers[k];vr(P.id)===T&&e.push(new Re(s,n.id,`duplicate layer id "${n.id}", previously used at line ${P.id.__line__}`))}}if("ref"in n){let T;["type","source","source-layer","filter","layout"].forEach(k=>{k in n&&e.push(new Re(s,n[k],`"${k}" is prohibited for ref layers`))}),h.layers.forEach(k=>{vr(k.id)===v&&(T=k)}),T?T.ref?e.push(new Re(s,n.ref,"ref cannot reference another ref layer")):y=vr(T.type):e.push(new Re(s,n.ref,`ref layer "${v}" not found`))}else if(y!=="background")if(n.source){const T=h.sources&&h.sources[n.source],k=T&&vr(T.type);T?k==="vector"&&y==="raster"?e.push(new Re(s,n.source,`layer "${n.id}" requires a raster source`)):k!=="raster-dem"&&y==="hillshade"?e.push(new Re(s,n.source,`layer "${n.id}" requires a raster-dem source`)):k==="raster"&&y!=="raster"?e.push(new Re(s,n.source,`layer "${n.id}" requires a vector source`)):k!=="vector"||n["source-layer"]?k==="raster-dem"&&y!=="hillshade"?e.push(new Re(s,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!n.paint||!n.paint["line-gradient"]||k==="geojson"&&T.lineMetrics||e.push(new Re(s,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Re(s,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Re(s,n.source,`source "${n.source}" not found`))}else e.push(new Re(s,n,'missing required property "source"'));return e=e.concat(Ui({key:s,value:n,valueSpec:g.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${s}.type`,value:n.type,valueSpec:g.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:ma,layout:T=>Ui({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":k=>bu(ii({layerType:y},k))}}),paint:T=>Ui({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":k=>tl(ii({layerType:y},k))}})}})),e}function Dn(i){const e=i.value,n=i.key,s=Nt(e);return s!=="string"?[new Re(n,e,`string expected, ${s} found`)]:[]}const Fh={promoteId:function({key:i,value:e}){if(Nt(e)==="string")return Dn({key:i,value:e});{const n=[];for(const s in e)n.push(...Dn({key:`${i}.${s}`,value:e[s]}));return n}}};function Bh(i){const e=i.value,n=i.key,s=i.styleSpec,h=i.style,g=i.validateSpec;if(!e.type)return[new Re(n,e,'"type" is required')];const y=vr(e.type);let v;switch(y){case"vector":case"raster":return v=Ui({key:n,value:e,valueSpec:s[`source_${y.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:Fh,validateSpec:g}),v;case"raster-dem":return v=function(T){var k;const P=(k=T.sourceName)!==null&&k!==void 0?k:"",z=T.value,R=T.styleSpec,B=R.source_raster_dem,j=T.style;let $=[];const K=Nt(z);if(z===void 0)return $;if(K!=="object")return $.push(new Re("source_raster_dem",z,`object expected, ${K} found`)),$;const ie=vr(z.encoding)==="custom",de=["redFactor","greenFactor","blueFactor","baseShift"],ae=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const ce in z)!ie&&de.includes(ce)?$.push(new Re(ce,z[ce],`In "${P}": "${ce}" is only valid when "encoding" is set to "custom". ${ae} encoding found`)):B[ce]?$=$.concat(T.validateSpec({key:ce,value:z[ce],valueSpec:B[ce],validateSpec:T.validateSpec,style:j,styleSpec:R})):$.push(new Re(ce,z[ce],`unknown property "${ce}"`));return $}({sourceName:n,value:e,style:i.style,styleSpec:s,validateSpec:g}),v;case"geojson":if(v=Ui({key:n,value:e,valueSpec:s.source_geojson,style:h,styleSpec:s,validateSpec:g,objectElementValidators:Fh}),e.cluster)for(const T in e.clusterProperties){const[k,P]=e.clusterProperties[T],z=typeof k=="string"?[k,["accumulated"],["get",T]]:k;v.push(...fa({key:`${n}.${T}.map`,value:P,validateSpec:g,expressionContext:"cluster-map"})),v.push(...fa({key:`${n}.${T}.reduce`,value:z,validateSpec:g,expressionContext:"cluster-reduce"}))}return v;case"video":return Ui({key:n,value:e,valueSpec:s.source_video,style:h,validateSpec:g,styleSpec:s});case"image":return Ui({key:n,value:e,valueSpec:s.source_image,style:h,validateSpec:g,styleSpec:s});case"canvas":return[new Re(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return zo({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,validateSpec:g,styleSpec:s})}}function Oh(i){const e=i.value,n=i.styleSpec,s=n.light,h=i.style;let g=[];const y=Nt(e);if(e===void 0)return g;if(y!=="object")return g=g.concat([new Re("light",e,`object expected, ${y} found`)]),g;for(const v in e){const T=v.match(/^(.*)-transition$/);g=g.concat(T&&s[T[1]]&&s[T[1]].transition?i.validateSpec({key:v,value:e[v],valueSpec:n.transition,validateSpec:i.validateSpec,style:h,styleSpec:n}):s[v]?i.validateSpec({key:v,value:e[v],valueSpec:s[v],validateSpec:i.validateSpec,style:h,styleSpec:n}):[new Re(v,e[v],`unknown property "${v}"`)])}return g}function Nh(i){const e=i.value,n=i.styleSpec,s=n.sky,h=i.style,g=Nt(e);if(e===void 0)return[];if(g!=="object")return[new Re("sky",e,`object expected, ${g} found`)];let y=[];for(const v in e)y=y.concat(s[v]?Kr({key:v,value:e[v],valueSpec:s[v],style:h,styleSpec:n}):[new Re(v,e[v],`unknown property "${v}"`)]);return y}function jh(i){const e=i.value,n=i.styleSpec,s=n.terrain,h=i.style;let g=[];const y=Nt(e);if(e===void 0)return g;if(y!=="object")return g=g.concat([new Re("terrain",e,`object expected, ${y} found`)]),g;for(const v in e)g=g.concat(s[v]?i.validateSpec({key:v,value:e[v],valueSpec:s[v],validateSpec:i.validateSpec,style:h,styleSpec:n}):[new Re(v,e[v],`unknown property "${v}"`)]);return g}function ss(i){let e=[];const n=i.value,s=i.key;if(Array.isArray(n)){const h=[],g=[];for(const y in n)n[y].id&&h.includes(n[y].id)&&e.push(new Re(s,n,`all the sprites' ids must be unique, but ${n[y].id} is duplicated`)),h.push(n[y].id),n[y].url&&g.includes(n[y].url)&&e.push(new Re(s,n,`all the sprites' URLs must be unique, but ${n[y].url} is duplicated`)),g.push(n[y].url),e=e.concat(Ui({key:`${s}[${y}]`,value:n[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return Dn({key:s,value:n})}const ls={"*":()=>[],array:pa,boolean:function(i){const e=i.value,n=i.key,s=Nt(e);return s!=="boolean"?[new Re(n,e,`boolean expected, ${s} found`)]:[]},number:vu,color:function(i){const e=i.key,n=i.value,s=Nt(n);return s!=="string"?[new Re(e,n,`color expected, ${s} found`)]:Ft.parse(String(n))?[]:[new Re(e,n,`color expected, "${n}" found`)]},constants:Rh,enum:zo,filter:ma,function:xu,layer:Su,object:Ui,source:Bh,light:Oh,sky:Nh,terrain:jh,string:Dn,formatted:function(i){return Dn(i).length===0?[]:fa(i)},resolvedImage:function(i){return Dn(i).length===0?[]:fa(i)},padding:function(i){const e=i.key,n=i.value;if(Nt(n)==="array"){if(n.length<1||n.length>4)return[new Re(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const s={type:"number"};let h=[];for(let g=0;g<n.length;g++)h=h.concat(i.validateSpec({key:`${e}[${g}]`,value:n[g],validateSpec:i.validateSpec,valueSpec:s}));return h}return vu({key:e,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,n=i.value,s=Nt(n),h=i.styleSpec;if(s!=="array"||n.length<1||n.length%2!=0)return[new Re(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let y=0;y<n.length;y+=2)g=g.concat(zo({key:`${e}[${y}]`,value:n[y],valueSpec:h.layout_symbol["text-anchor"]})),g=g.concat(pa({key:`${e}[${y+1}]`,value:n[y+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:h}));return g},sprite:ss};function Kr(i){const e=i.value,n=i.valueSpec,s=i.styleSpec;return i.validateSpec=Kr,n.expression&&ca(vr(e))?xu(i):n.expression&&Qt(po(e))?fa(i):n.type&&ls[n.type]?ls[n.type](i):Ui(ii({},i,{valueSpec:n.type?s[n.type]:n}))}function ga(i){const e=i.value,n=i.key,s=Dn(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new Re(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new Re(n,e,'"glyphs" url must include a "{range}" token'))),s}function tn(i,e=Ie){let n=[];return n=n.concat(Kr({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:Kr,objectElementValidators:{glyphs:ga,"*":()=>[]}})),i.constants&&(n=n.concat(Rh({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:Kr}))),Uh(n)}function Ln(i){return function(e){return i({...e,validateSpec:Kr})}}function Uh(i){return[].concat(i).sort((e,n)=>e.line-n.line)}function Ti(i){return function(...e){return Uh(i.apply(this,e))}}tn.source=Ti(Ln(Bh)),tn.sprite=Ti(Ln(ss)),tn.glyphs=Ti(Ln(ga)),tn.light=Ti(Ln(Oh)),tn.sky=Ti(Ln(Nh)),tn.terrain=Ti(Ln(jh)),tn.layer=Ti(Ln(Su)),tn.filter=Ti(Ln(ma)),tn.paintProperty=Ti(Ln(tl)),tn.layoutProperty=Ti(Ln(bu));const ya=tn,Tu=ya.light,ef=ya.paintProperty,Iu=ya.layoutProperty;function Vh(i,e){let n=!1;if(e&&e.length)for(const s of e)i.fire(new Xt(new Error(s.message))),n=!0;return n}class Yn{constructor(e,n,s){const h=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const y=new Int32Array(this.arrayBuffer);e=y[0],this.d=(n=y[1])+2*(s=y[2]);for(let T=0;T<this.d*this.d;T++){const k=y[3+T],P=y[3+T+1];h.push(k===P?null:y.subarray(k,P))}const v=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],v),this.bboxes=y.subarray(v),this.insert=this._insertReadonly}else{this.d=n+2*s;for(let y=0;y<this.d*this.d;y++)h.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=s,this.scale=n/e,this.uid=0;const g=s/n*e;this.min=-g,this.max=e+g}insert(e,n,s,h,g){this._forEachCell(n,s,h,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,s,h,g,y){this.cells[g].push(y)}query(e,n,s,h,g){const y=this.min,v=this.max;if(e<=y&&n<=y&&v<=s&&v<=h&&!g)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(e,n,s,h,this._queryCell,T,{},g),T}}_queryCell(e,n,s,h,g,y,v,T){const k=this.cells[g];if(k!==null){const P=this.keys,z=this.bboxes;for(let R=0;R<k.length;R++){const B=k[R];if(v[B]===void 0){const j=4*B;(T?T(z[j+0],z[j+1],z[j+2],z[j+3]):e<=z[j+2]&&n<=z[j+3]&&s>=z[j+0]&&h>=z[j+1])?(v[B]=!0,y.push(P[B])):v[B]=!1}}}}_forEachCell(e,n,s,h,g,y,v,T){const k=this._convertToCellCoord(e),P=this._convertToCellCoord(n),z=this._convertToCellCoord(s),R=this._convertToCellCoord(h);for(let B=k;B<=z;B++)for(let j=P;j<=R;j++){const $=this.d*j+B;if((!T||T(this._convertFromCellCoord(B),this._convertFromCellCoord(j),this._convertFromCellCoord(B+1),this._convertFromCellCoord(j+1)))&&g.call(this,e,n,s,h,$,y,v,T))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let s=0;for(let y=0;y<this.cells.length;y++)s+=this.cells[y].length;const h=new Int32Array(n+s+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let g=n;for(let y=0;y<e.length;y++){const v=e[y];h[3+y]=g,h.set(v,g),g+=v.length}return h[3+e.length]=g,h.set(this.keys,g),g+=this.keys.length,h[3+e.length+1]=g,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer}static serialize(e,n){const s=e.toArrayBuffer();return n&&n.push(s),{buffer:s}}static deserialize(e){return new Yn(e.buffer)}}const fo={};function Ke(i,e,n={}){if(fo[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),fo[i]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}Ke("Object",Object),Ke("TransferableGridIndex",Yn),Ke("Color",Ft),Ke("Error",Error),Ke("AJAXError",Fi),Ke("ResolvedImage",Qi),Ke("StylePropertyFunction",Xs),Ke("StyleExpression",os,{omit:["_evaluator"]}),Ke("ZoomDependentExpression",Ks),Ke("ZoomConstantExpression",ha),Ke("CompoundExpression",en,{omit:["_evaluate"]});for(const i in sa)sa[i]._classRegistryKey||Ke(`Expression_${i}`,sa[i]);function ku(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Ao(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error)return i;if(ku(i)||We(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const n=i;return e&&e.push(n.buffer),n}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const n=[];for(const s of i)n.push(Ao(s,e));return n}if(typeof i=="object"){const n=i.constructor,s=n._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${n.name}`);if(!fo[s])throw new Error(`${s} is not registered.`);const h=n.serialize?n.serialize(i,e):{};if(n.serialize){if(e&&h===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in i){if(!i.hasOwnProperty(g)||fo[s].omit.indexOf(g)>=0)continue;const y=i[g];h[g]=fo[s].shallow.indexOf(g)>=0?y:Ao(y,e)}i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(h.$name=s),h}throw new Error("can't serialize object of type "+typeof i)}function _a(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||ku(i)||We(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(_a);if(typeof i=="object"){const e=i.$name||"Object";if(!fo[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=fo[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const s=Object.create(n.prototype);for(const h of Object.keys(i)){if(h==="$name")continue;const g=i[h];s[h]=fo[e].shallow.indexOf(h)>=0?g:_a(g)}return s}throw new Error("can't deserialize object of type "+typeof i)}class Eu{constructor(){this.first=!0}update(e,n){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const He={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function us(i){for(const e of i)if(il(e.charCodeAt(0)))return!0;return!1}function rl(i){for(const e of i)if(!$h(e.charCodeAt(0)))return!1;return!0}function $h(i){return!(He.Arabic(i)||He["Arabic Supplement"](i)||He["Arabic Extended-A"](i)||He["Arabic Presentation Forms-A"](i)||He["Arabic Presentation Forms-B"](i))}function il(i){return!(i!==746&&i!==747&&(i<4352||!(He["Bopomofo Extended"](i)||He.Bopomofo(i)||He["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||He["CJK Compatibility Ideographs"](i)||He["CJK Compatibility"](i)||He["CJK Radicals Supplement"](i)||He["CJK Strokes"](i)||!(!He["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||He["CJK Unified Ideographs Extension A"](i)||He["CJK Unified Ideographs"](i)||He["Enclosed CJK Letters and Months"](i)||He["Hangul Compatibility Jamo"](i)||He["Hangul Jamo Extended-A"](i)||He["Hangul Jamo Extended-B"](i)||He["Hangul Jamo"](i)||He["Hangul Syllables"](i)||He.Hiragana(i)||He["Ideographic Description Characters"](i)||He.Kanbun(i)||He["Kangxi Radicals"](i)||He["Katakana Phonetic Extensions"](i)||He.Katakana(i)&&i!==12540||!(!He["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!He["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||He["Unified Canadian Aboriginal Syllabics"](i)||He["Unified Canadian Aboriginal Syllabics Extended"](i)||He["Vertical Forms"](i)||He["Yijing Hexagram Symbols"](i)||He["Yi Syllables"](i)||He["Yi Radicals"](i))))}function Cu(i){return!(il(i)||function(e){return!!(He["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||He["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||He["Letterlike Symbols"](e)||He["Number Forms"](e)||He["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||He["Control Pictures"](e)&&e!==9251||He["Optical Character Recognition"](e)||He["Enclosed Alphanumerics"](e)||He["Geometric Shapes"](e)||He["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||He["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||He["CJK Symbols and Punctuation"](e)||He.Katakana(e)||He["Private Use Area"](e)||He["CJK Compatibility Forms"](e)||He["Small Form Variants"](e)||He["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Pu(i){return i>=1424&&i<=2303||He["Arabic Presentation Forms-A"](i)||He["Arabic Presentation Forms-B"](i)}function Mu(i,e){return!(!e&&Pu(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||He.Khmer(i))}function Zh(i){for(const e of i)if(Pu(e.charCodeAt(0)))return!0;return!1}const Do=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class rr{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Eu,this.transition={})}isSupportedScript(e){return function(n,s){for(const h of n)if(!Mu(h.charCodeAt(0),s))return!1;return!0}(e,Do.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*n}}}class nl{constructor(e,n){this.property=e,this.value=n,this.expression=function(s,h){if(ca(s))return new Xs(s,h);if(Qt(s)){const g=Mh(s,h);if(g.result==="error")throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=s;return h.type==="color"&&typeof s=="string"?g=Ft.parse(s):h.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(s)&&(g=oi.parse(s)):g=Ni.parse(s),{kind:"constant",evaluate:()=>g}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,s){return this.property.possiblyEvaluate(this,e,n,s)}}class ol{constructor(e){this.property=e,this.value=new nl(e,void 0)}transitioned(e,n){return new Au(this.property,this.value,n,Me({},e.transition,this.transition),e.now)}untransitioned(){return new Au(this.property,this.value,null,{},0)}}class zu{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return vt(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ol(this._values[e].property)),this._values[e].value=new nl(this._values[e].property,n===null?void 0:vt(n))}getTransition(e){return vt(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ol(this._values[e].property)),this._values[e].transition=vt(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);s!==void 0&&(e[n]=s);const h=this.getTransition(n);h!==void 0&&(e[`${n}-transition`]=h)}return e}transitioned(e,n){const s=new qh(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].transitioned(e,n._values[h]);return s}untransitioned(){const e=new qh(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Au{constructor(e,n,s,h,g){this.property=e,this.value=n,this.begin=g+h.delay||0,this.end=this.begin+h.duration||0,e.specification.transition&&(h.delay||h.duration)&&(this.prior=s)}possiblyEvaluate(e,n,s){const h=e.now||0,g=this.value.possiblyEvaluate(e,n,s),y=this.prior;if(y){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return y.possiblyEvaluate(e,n,s);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,n,s),g,function(T){if(T<=0)return 0;if(T>=1)return 1;const k=T*T,P=k*T;return 4*(T<.5?P:3*(T-k)+P-.75)}(v))}}return g}}class qh{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,s){const h=new cs(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(e,n,s);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class tf{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return vt(this._values[e].value)}setValue(e,n){this._values[e]=new nl(this._values[e].property,n===null?void 0:vt(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);s!==void 0&&(e[n]=s)}return e}possiblyEvaluate(e,n,s){const h=new cs(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(e,n,s);return h}}class dn{constructor(e,n,s){this.property=e,this.value=n,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,s,h){return this.property.evaluate(this.value,this.parameters,e,n,s,h)}}class cs{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class it{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,s){const h=ji[this.specification.type];return h?h(e,n,s):e}}class at{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,s,h){return new dn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},s,h)}:e.expression,n)}interpolate(e,n,s){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new dn(this,{kind:"constant",value:void 0},e.parameters);const h=ji[this.specification.type];if(h){const g=h(e.value.value,n.value.value,s);return new dn(this,{kind:"constant",value:g},e.parameters)}return e}evaluate(e,n,s,h,g,y){return e.kind==="constant"?e.value:e.evaluate(n,s,h,g,y)}}class Lo extends at{possiblyEvaluate(e,n,s,h){if(e.value===void 0)return new dn(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const g=e.expression.evaluate(n,null,{},s,h),y=e.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,v=this._calculate(y,y,y,n);return new dn(this,{kind:"constant",value:v},n)}if(e.expression.kind==="camera"){const g=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new dn(this,{kind:"constant",value:g},n)}return new dn(this,e.expression,n)}evaluate(e,n,s,h,g,y){if(e.kind==="source"){const v=e.evaluate(n,s,h,g,y);return this._calculate(v,v,v,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},s,h),e.evaluate({zoom:Math.floor(n.zoom)},s,h),e.evaluate({zoom:Math.floor(n.zoom)+1},s,h),n):e.value}_calculate(e,n,s,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:s,to:n}}interpolate(e){return e}}class Du{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,h){if(e.value!==void 0){if(e.expression.kind==="constant"){const g=e.expression.evaluate(n,null,{},s,h);return this._calculate(g,g,g,n)}return this._calculate(e.expression.evaluate(new rr(Math.floor(n.zoom-1),n)),e.expression.evaluate(new rr(Math.floor(n.zoom),n)),e.expression.evaluate(new rr(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,s,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:s,to:n}}interpolate(e){return e}}class hs{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,h){return!!e.expression.evaluate(n,null,{},s,h)}interpolate(){return!1}}class Ii{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const s=e[n];s.specification.overridable&&this.overridableProperties.push(n);const h=this.defaultPropertyValues[n]=new nl(s,void 0),g=this.defaultTransitionablePropertyValues[n]=new ol(s);this.defaultTransitioningPropertyValues[n]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=h.possiblyEvaluate({})}}}Ke("DataDrivenProperty",at),Ke("DataConstantProperty",it),Ke("CrossFadedDataDrivenProperty",Lo),Ke("CrossFadedProperty",Du),Ke("ColorRampProperty",hs);const Gh="-transition";class pn extends Gn{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new tf(n.layout)),n.paint)){this._transitionablePaint=new zu(n.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new cs(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,s={}){n!=null&&this._validate(Iu,`layers.${this.id}.layout.${e}`,e,n,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return e.endsWith(Gh)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,s={}){if(n!=null&&this._validate(ef,`layers.${this.id}.paint.${e}`,e,n,s))return!1;if(e.endsWith(Gh))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const h=this._transitionablePaint._values[e],g=h.property.specification["property-type"]==="cross-faded-data-driven",y=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value;return T.isDataDriven()||y||g||this._handleOverridablePaintPropertyUpdate(e,v,T)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ct(e,(n,s)=>!(n===void 0||s==="layout"&&!Object.keys(n).length||s==="paint"&&!Object.keys(n).length))}_validate(e,n,s,h,g={}){return(!g||g.validate!==!1)&&Vh(this,e.call(ya,{key:n,layerType:this.type,objectKey:s,value:h,styleSpec:Ie,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof dn&&ua(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const Hh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class va{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class fr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Tr(i,e=1){let n=0,s=0;return{members:i.map(h=>{const g=Hh[h.type].BYTES_PER_ELEMENT,y=n=Wh(n,Math.max(e,g)),v=h.components||1;return s=Math.max(s,g),n+=g*v,{name:h.name,type:h.type,components:v,offset:y}}),size:Wh(n,Math.max(s,e)),alignment:e}}function Wh(i,e){return Math.ceil(i/e)*e}class ds extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const h=2*e;return this.int16[h+0]=n,this.int16[h+1]=s,e}}ds.prototype.bytesPerElement=4,Ke("StructArrayLayout2i4",ds);class al extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){const g=3*e;return this.int16[g+0]=n,this.int16[g+1]=s,this.int16[g+2]=h,e}}al.prototype.bytesPerElement=6,Ke("StructArrayLayout3i6",al);class mo extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,h)}emplace(e,n,s,h,g){const y=4*e;return this.int16[y+0]=n,this.int16[y+1]=s,this.int16[y+2]=h,this.int16[y+3]=g,e}}mo.prototype.bytesPerElement=8,Ke("StructArrayLayout4i8",mo);class Lu extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,s,h,g,y)}emplace(e,n,s,h,g,y,v){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=s,this.int16[T+2]=h,this.int16[T+3]=g,this.int16[T+4]=y,this.int16[T+5]=v,e}}Lu.prototype.bytesPerElement=12,Ke("StructArrayLayout2i4i12",Lu);class Ru extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,s,h,g,y)}emplace(e,n,s,h,g,y,v){const T=4*e,k=8*e;return this.int16[T+0]=n,this.int16[T+1]=s,this.uint8[k+4]=h,this.uint8[k+5]=g,this.uint8[k+6]=y,this.uint8[k+7]=v,e}}Ru.prototype.bytesPerElement=8,Ke("StructArrayLayout2i4ub8",Ru);class ps extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const h=2*e;return this.float32[h+0]=n,this.float32[h+1]=s,e}}ps.prototype.bytesPerElement=8,Ke("StructArrayLayout2f8",ps);class Fu extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,y,v,T,k,P){const z=this.length;return this.resize(z+1),this.emplace(z,e,n,s,h,g,y,v,T,k,P)}emplace(e,n,s,h,g,y,v,T,k,P,z){const R=10*e;return this.uint16[R+0]=n,this.uint16[R+1]=s,this.uint16[R+2]=h,this.uint16[R+3]=g,this.uint16[R+4]=y,this.uint16[R+5]=v,this.uint16[R+6]=T,this.uint16[R+7]=k,this.uint16[R+8]=P,this.uint16[R+9]=z,e}}Fu.prototype.bytesPerElement=20,Ke("StructArrayLayout10ui20",Fu);class sl extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,y,v,T,k,P,z,R){const B=this.length;return this.resize(B+1),this.emplace(B,e,n,s,h,g,y,v,T,k,P,z,R)}emplace(e,n,s,h,g,y,v,T,k,P,z,R,B){const j=12*e;return this.int16[j+0]=n,this.int16[j+1]=s,this.int16[j+2]=h,this.int16[j+3]=g,this.uint16[j+4]=y,this.uint16[j+5]=v,this.uint16[j+6]=T,this.uint16[j+7]=k,this.int16[j+8]=P,this.int16[j+9]=z,this.int16[j+10]=R,this.int16[j+11]=B,e}}sl.prototype.bytesPerElement=24,Ke("StructArrayLayout4i4ui4i24",sl);class Bu extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){const g=3*e;return this.float32[g+0]=n,this.float32[g+1]=s,this.float32[g+2]=h,e}}Bu.prototype.bytesPerElement=12,Ke("StructArrayLayout3f12",Bu);class Ou extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Ou.prototype.bytesPerElement=4,Ke("StructArrayLayout1ul4",Ou);class Kn extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,y,v,T,k){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,s,h,g,y,v,T,k)}emplace(e,n,s,h,g,y,v,T,k,P){const z=10*e,R=5*e;return this.int16[z+0]=n,this.int16[z+1]=s,this.int16[z+2]=h,this.int16[z+3]=g,this.int16[z+4]=y,this.int16[z+5]=v,this.uint32[R+3]=T,this.uint16[z+8]=k,this.uint16[z+9]=P,e}}Kn.prototype.bytesPerElement=20,Ke("StructArrayLayout6i1ul2ui20",Kn);class ll extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,s,h,g,y)}emplace(e,n,s,h,g,y,v){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=s,this.int16[T+2]=h,this.int16[T+3]=g,this.int16[T+4]=y,this.int16[T+5]=v,e}}ll.prototype.bytesPerElement=12,Ke("StructArrayLayout2i2i2i12",ll);class fs extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,h,g)}emplace(e,n,s,h,g,y){const v=4*e,T=8*e;return this.float32[v+0]=n,this.float32[v+1]=s,this.float32[v+2]=h,this.int16[T+6]=g,this.int16[T+7]=y,e}}fs.prototype.bytesPerElement=16,Ke("StructArrayLayout2f1f2i16",fs);class ul extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,h)}emplace(e,n,s,h,g){const y=12*e,v=3*e;return this.uint8[y+0]=n,this.uint8[y+1]=s,this.float32[v+1]=h,this.float32[v+2]=g,e}}ul.prototype.bytesPerElement=12,Ke("StructArrayLayout2ub2f12",ul);class xa extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){const g=3*e;return this.uint16[g+0]=n,this.uint16[g+1]=s,this.uint16[g+2]=h,e}}xa.prototype.bytesPerElement=6,Ke("StructArrayLayout3ui6",xa);class Nu extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,y,v,T,k,P,z,R,B,j,$,K,ie){const de=this.length;return this.resize(de+1),this.emplace(de,e,n,s,h,g,y,v,T,k,P,z,R,B,j,$,K,ie)}emplace(e,n,s,h,g,y,v,T,k,P,z,R,B,j,$,K,ie,de){const ae=24*e,ce=12*e,ke=48*e;return this.int16[ae+0]=n,this.int16[ae+1]=s,this.uint16[ae+2]=h,this.uint16[ae+3]=g,this.uint32[ce+2]=y,this.uint32[ce+3]=v,this.uint32[ce+4]=T,this.uint16[ae+10]=k,this.uint16[ae+11]=P,this.uint16[ae+12]=z,this.float32[ce+7]=R,this.float32[ce+8]=B,this.uint8[ke+36]=j,this.uint8[ke+37]=$,this.uint8[ke+38]=K,this.uint32[ce+10]=ie,this.int16[ae+22]=de,e}}Nu.prototype.bytesPerElement=48,Ke("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Nu);class wa extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,y,v,T,k,P,z,R,B,j,$,K,ie,de,ae,ce,ke,Ce,Ge,et,qe,$e,Be,Xe){const Ve=this.length;return this.resize(Ve+1),this.emplace(Ve,e,n,s,h,g,y,v,T,k,P,z,R,B,j,$,K,ie,de,ae,ce,ke,Ce,Ge,et,qe,$e,Be,Xe)}emplace(e,n,s,h,g,y,v,T,k,P,z,R,B,j,$,K,ie,de,ae,ce,ke,Ce,Ge,et,qe,$e,Be,Xe,Ve){const De=32*e,ot=16*e;return this.int16[De+0]=n,this.int16[De+1]=s,this.int16[De+2]=h,this.int16[De+3]=g,this.int16[De+4]=y,this.int16[De+5]=v,this.int16[De+6]=T,this.int16[De+7]=k,this.uint16[De+8]=P,this.uint16[De+9]=z,this.uint16[De+10]=R,this.uint16[De+11]=B,this.uint16[De+12]=j,this.uint16[De+13]=$,this.uint16[De+14]=K,this.uint16[De+15]=ie,this.uint16[De+16]=de,this.uint16[De+17]=ae,this.uint16[De+18]=ce,this.uint16[De+19]=ke,this.uint16[De+20]=Ce,this.uint16[De+21]=Ge,this.uint16[De+22]=et,this.uint32[ot+12]=qe,this.float32[ot+13]=$e,this.float32[ot+14]=Be,this.uint16[De+30]=Xe,this.uint16[De+31]=Ve,e}}wa.prototype.bytesPerElement=64,Ke("StructArrayLayout8i15ui1ul2f2ui64",wa);class go extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}go.prototype.bytesPerElement=4,Ke("StructArrayLayout1f4",go);class ju extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){const g=3*e;return this.uint16[6*e+0]=n,this.float32[g+1]=s,this.float32[g+2]=h,e}}ju.prototype.bytesPerElement=12,Ke("StructArrayLayout1ui2f12",ju);class cl extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){const g=4*e;return this.uint32[2*e+0]=n,this.uint16[g+2]=s,this.uint16[g+3]=h,e}}cl.prototype.bytesPerElement=8,Ke("StructArrayLayout1ul2ui8",cl);class Ro extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const h=2*e;return this.uint16[h+0]=n,this.uint16[h+1]=s,e}}Ro.prototype.bytesPerElement=4,Ke("StructArrayLayout2ui4",Ro);class Uu extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Uu.prototype.bytesPerElement=2,Ke("StructArrayLayout1ui2",Uu);class Vu extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,h)}emplace(e,n,s,h,g){const y=4*e;return this.float32[y+0]=n,this.float32[y+1]=s,this.float32[y+2]=h,this.float32[y+3]=g,e}}Vu.prototype.bytesPerElement=16,Ke("StructArrayLayout4f16",Vu);class $u extends va{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new q(this.anchorPointX,this.anchorPointY)}}$u.prototype.size=20;class Yh extends Kn{get(e){return new $u(this,e)}}Ke("CollisionBoxArray",Yh);class p extends va{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}p.prototype.size=48;class t extends Nu{get(e){return new p(this,e)}}Ke("PlacedSymbolArray",t);class a extends va{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}a.prototype.size=64;class u extends wa{get(e){return new a(this,e)}}Ke("SymbolInstanceArray",u);class c extends go{getoffsetX(e){return this.float32[1*e+0]}}Ke("GlyphOffsetArray",c);class m extends al{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ke("SymbolLineVertexArray",m);class w extends va{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}w.prototype.size=12;class b extends ju{get(e){return new w(this,e)}}Ke("TextAnchorOffsetArray",b);class I extends va{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}I.prototype.size=8;class C extends cl{get(e){return new I(this,e)}}Ke("FeatureIndexArray",C);class A extends ds{}class L extends ds{}class N extends ds{}class Y extends Lu{}class G extends Ru{}class J extends ps{}class V extends Fu{}class le extends sl{}class me extends Bu{}class ee extends Ou{}class he extends ll{}class ge extends ul{}class ye extends xa{}class Se extends Ro{}const Ae=Tr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Pe}=Ae;class ze{constructor(e=[]){this.segments=e}prepareSegment(e,n,s,h){let g=this.segments[this.segments.length-1];return e>ze.MAX_VERTEX_ARRAY_LENGTH&&Dt(`Max vertices per segment is ${ze.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!g||g.vertexLength+e>ze.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:n.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,s,h){return new ze([{vertexOffset:e,primitiveOffset:n,vertexLength:s,primitiveLength:h,vaos:{},sortKey:0}])}}function Ye(i,e){return 256*(i=Ne(Math.floor(i),0,255))+Ne(Math.floor(e),0,255)}ze.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ke("SegmentVector",ze);const _t=Tr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ue={exports:{}},ut={exports:{}};ut.exports=function(i,e){var n,s,h,g,y,v,T,k;for(s=i.length-(n=3&i.length),h=e,y=3432918353,v=461845907,k=0;k<s;)T=255&i.charCodeAt(k)|(255&i.charCodeAt(++k))<<8|(255&i.charCodeAt(++k))<<16|(255&i.charCodeAt(++k))<<24,++k,h=27492+(65535&(g=5*(65535&(h=(h^=T=(65535&(T=(T=(65535&T)*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*v+(((T>>>16)*v&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(T=0,n){case 3:T^=(255&i.charCodeAt(k+2))<<16;case 2:T^=(255&i.charCodeAt(k+1))<<8;case 1:h^=T=(65535&(T=(T=(65535&(T^=255&i.charCodeAt(k)))*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*v+(((T>>>16)*v&65535)<<16)&4294967295}return h^=i.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var wt=ut.exports,zt={exports:{}};zt.exports=function(i,e){for(var n,s=i.length,h=e^s,g=0;s>=4;)n=1540483477*(65535&(n=255&i.charCodeAt(g)|(255&i.charCodeAt(++g))<<8|(255&i.charCodeAt(++g))<<16|(255&i.charCodeAt(++g))<<24))+((1540483477*(n>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),s-=4,++g;switch(s){case 3:h^=(255&i.charCodeAt(g+2))<<16;case 2:h^=(255&i.charCodeAt(g+1))<<8;case 1:h=1540483477*(65535&(h^=255&i.charCodeAt(g)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var ft=wt,St=zt.exports;Ue.exports=ft,Ue.exports.murmur3=ft,Ue.exports.murmur2=St;var Tt=F(Ue.exports);class cr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,s,h){this.ids.push(Kt(e)),this.positions.push(n,s,h)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Kt(e);let s=0,h=this.ids.length-1;for(;s<h;){const y=s+h>>1;this.ids[y]>=n?h=y:s=y+1}const g=[];for(;this.ids[s]===n;)g.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return g}static serialize(e,n){const s=new Float64Array(e.ids),h=new Uint32Array(e.positions);return ki(s,h,0,s.length-1),n&&n.push(s.buffer,h.buffer),{ids:s,positions:h}}static deserialize(e){const n=new cr;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function Kt(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Tt(String(i))}function ki(i,e,n,s){for(;n<s;){const h=i[n+s>>1];let g=n-1,y=s+1;for(;;){do g++;while(i[g]<h);do y--;while(i[y]>h);if(g>=y)break;Ar(i,g,y),Ar(e,3*g,3*y),Ar(e,3*g+1,3*y+1),Ar(e,3*g+2,3*y+2)}y-n<s-y?(ki(i,e,n,y),n=y+1):(ki(i,e,y+1,s),s=y)}}function Ar(i,e,n){const s=i[e];i[e]=i[n],i[n]=s}Ke("FeaturePositionMap",cr);class er{constructor(e,n){this.gl=e.gl,this.location=n}}class ai extends er{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class fn extends er{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Rn extends er{constructor(e,n){super(e,n),this.current=Ft.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Fo=new Float32Array(16);function Bo(i){return[Ye(255*i.r,255*i.g),Ye(255*i.b,255*i.a)]}class Fn{constructor(e,n,s){this.value=e,this.uniformNames=n.map(h=>`u_${h}`),this.type=s}setUniform(e,n,s){e.set(s.constantOr(this.value))}getBinding(e,n,s){return this.type==="color"?new Rn(e,n):new ai(e,n)}}class mn{constructor(e,n){this.uniformNames=n.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setUniform(e,n,s,h){const g=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&e.set(g)}getBinding(e,n,s){return s.substr(0,9)==="u_pattern"?new fn(e,n):new ai(e,n)}}class mr{constructor(e,n,s,h){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=n.map(g=>({name:`a_${g}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,n,s,h,g){const y=this.paintVertexArray.length,v=this.expression.evaluate(new rr(0),n,{},h,[],g);this.paintVertexArray.resize(e),this._setPaintValue(y,e,v)}updatePaintArray(e,n,s,h){const g=this.expression.evaluate({zoom:0},s,h);this._setPaintValue(e,n,g)}_setPaintValue(e,n,s){if(this.type==="color"){const h=Bo(s);for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ir{constructor(e,n,s,h,g,y){this.expression=e,this.uniformNames=n.map(v=>`u_${v}_t`),this.type=s,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=n.map(v=>({name:`a_${v}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,n,s,h,g){const y=this.expression.evaluate(new rr(this.zoom),n,{},h,[],g),v=this.expression.evaluate(new rr(this.zoom+1),n,{},h,[],g),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,y,v)}updatePaintArray(e,n,s,h){const g=this.expression.evaluate({zoom:this.zoom},s,h),y=this.expression.evaluate({zoom:this.zoom+1},s,h);this._setPaintValue(e,n,g,y)}_setPaintValue(e,n,s,h){if(this.type==="color"){const g=Bo(s),y=Bo(h);for(let v=e;v<n;v++)this.paintVertexArray.emplace(v,g[0],g[1],y[0],y[1])}else{for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,s,h);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const s=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,h=Ne(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(h)}getBinding(e,n,s){return new ai(e,n)}}class xr{constructor(e,n,s,h,g,y){this.expression=e,this.type=n,this.useIntegerZoom=s,this.zoom=h,this.layerId=y,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(e,n,s){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(h,e,n.patterns&&n.patterns[this.layerId],s)}updatePaintArray(e,n,s,h,g){this._setPaintValues(e,n,s.patterns&&s.patterns[this.layerId],g)}_setPaintValues(e,n,s,h){if(!h||!s)return;const{min:g,mid:y,max:v}=s,T=h[g],k=h[y],P=h[v];if(T&&k&&P)for(let z=e;z<n;z++)this.zoomInPaintVertexArray.emplace(z,k.tl[0],k.tl[1],k.br[0],k.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],k.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(z,k.tl[0],k.tl[1],k.br[0],k.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],k.pixelRatio,P.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,_t.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,_t.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ba{constructor(e,n,s){this.binders={},this._buffers=[];const h=[];for(const g in e.paint._values){if(!s(g))continue;const y=e.paint.get(g);if(!(y instanceof dn&&ua(y.property.specification)))continue;const v=Xr(g,e.type),T=y.value,k=y.property.specification.type,P=y.property.useIntegerZoom,z=y.property.specification["property-type"],R=z==="cross-faded"||z==="cross-faded-data-driven";if(T.kind==="constant")this.binders[g]=R?new mn(T.value,v):new Fn(T.value,v,k),h.push(`/u_${g}`);else if(T.kind==="source"||R){const B=Vi(g,k,"source");this.binders[g]=R?new xr(T,k,P,n,B,e.id):new mr(T,v,k,B),h.push(`/a_${g}`)}else{const B=Vi(g,k,"composite");this.binders[g]=new ir(T,v,k,P,n,B),h.push(`/z_${g}`)}}this.cacheKey=h.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof mr||n instanceof ir?n.maxValue:0}populatePaintArrays(e,n,s,h,g){for(const y in this.binders){const v=this.binders[y];(v instanceof mr||v instanceof ir||v instanceof xr)&&v.populatePaintArray(e,n,s,h,g)}}setConstantPatternPositions(e,n){for(const s in this.binders){const h=this.binders[s];h instanceof mn&&h.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,s,h,g){let y=!1;for(const v in e){const T=n.getPositions(v);for(const k of T){const P=s.feature(k.index);for(const z in this.binders){const R=this.binders[z];if((R instanceof mr||R instanceof ir||R instanceof xr)&&R.expression.isStateDependent===!0){const B=h.paint.get(z);R.expression=B.value,R.updatePaintArray(k.start,k.end,P,e[v],g),y=!0}}}}return y}defines(){const e=[];for(const n in this.binders){const s=this.binders[n];(s instanceof Fn||s instanceof mn)&&e.push(...s.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof mr||s instanceof ir)for(let h=0;h<s.paintVertexAttributes.length;h++)e.push(s.paintVertexAttributes[h].name);else if(s instanceof xr)for(let h=0;h<_t.members.length;h++)e.push(_t.members[h].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof Fn||s instanceof mn||s instanceof ir)for(const h of s.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const s=[];for(const h in this.binders){const g=this.binders[h];if(g instanceof Fn||g instanceof mn||g instanceof ir){for(const y of g.uniformNames)if(n[y]){const v=g.getBinding(e,n[y],y);s.push({name:y,property:h,binding:v})}}}return s}setUniforms(e,n,s,h){for(const{name:g,property:y,binding:v}of n)this.binders[y].setUniform(v,h,s.get(y),g)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const s=this.binders[n];if(e&&s instanceof xr){const h=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(s instanceof mr||s instanceof ir)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const n in this.binders){const s=this.binders[n];(s instanceof mr||s instanceof ir||s instanceof xr)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof mr||n instanceof ir||n instanceof xr)&&n.destroy()}}}class ar{constructor(e,n,s=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new ba(h,n,s);this.needsUpload=!1,this._featureMap=new cr,this._bufferOffset=0}populatePaintArrays(e,n,s,h,g,y){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(e,n,h,g,y);n.id!==void 0&&this._featureMap.add(n.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,s,h){for(const g of s)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,n,g,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Xr(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Vi(i,e,n){const s={color:{source:ps,composite:Vu},number:{source:go,composite:ps}},h=function(g){return{"line-pattern":{source:V,composite:V},"fill-pattern":{source:V,composite:V},"fill-extrusion-pattern":{source:V,composite:V}}[g]}(i);return h&&h[n]||s[e][n]}Ke("ConstantBinder",Fn),Ke("CrossFadedConstantBinder",mn),Ke("SourceExpressionBinder",mr),Ke("CrossFadedCompositeBinder",xr),Ke("CompositeExpressionBinder",ir),Ke("ProgramConfiguration",ba,{omit:["_buffers"]}),Ke("ProgramConfigurationSet",ar);const Mt=8192,Zu=Math.pow(2,14)-1,Kh=-Zu-1;function Oo(i){const e=Mt/i.extent,n=i.loadGeometry();for(let s=0;s<n.length;s++){const h=n[s];for(let g=0;g<h.length;g++){const y=h[g],v=Math.round(y.x*e),T=Math.round(y.y*e);y.x=Ne(v,Kh,Zu),y.y=Ne(T,Kh,Zu),(v<y.x||v>y.x+1||T<y.y||T>y.y+1)&&Dt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function No(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Oo(i):[]}}function hl(i,e,n,s,h){i.emplaceBack(2*e+(s+1)/2,2*n+(h+1)/2)}class qu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new L,this.indexArray=new ye,this.segments=new ze,this.programConfigurations=new ar(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s){const h=this.layers[0],g=[];let y=null,v=!1;h.type==="circle"&&(y=h.layout.get("circle-sort-key"),v=!y.isConstant());for(const{feature:T,id:k,index:P,sourceLayerIndex:z}of e){const R=this.layers[0]._featureFilter.needGeometry,B=No(T,R);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),B,s))continue;const j=v?y.evaluate(B,{},s):void 0,$={id:k,properties:T.properties,type:T.type,sourceLayerIndex:z,index:P,geometry:R?B.geometry:Oo(T),patterns:{},sortKey:j};g.push($)}v&&g.sort((T,k)=>T.sortKey-k.sortKey);for(const T of g){const{geometry:k,index:P,sourceLayerIndex:z}=T,R=e[P].feature;this.addFeature(T,k,P,s),n.featureIndex.insert(R,k,P,z,this.index)}}update(e,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Pe),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,s,h){for(const g of n)for(const y of g){const v=y.x,T=y.y;if(v<0||v>=Mt||T<0||T>=Mt)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=k.vertexLength;hl(this.layoutVertexArray,v,T,-1,-1),hl(this.layoutVertexArray,v,T,1,-1),hl(this.layoutVertexArray,v,T,1,1),hl(this.layoutVertexArray,v,T,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},h)}}function jo(i,e){for(let n=0;n<i.length;n++)if(dl(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(dl(i,e[n]))return!0;return!!ms(i,e)}function Xh(i,e,n){return!!dl(i,e)||!!gs(e,i,n)}function Gu(i,e){if(i.length===1)return xy(e,i[0]);for(let n=0;n<e.length;n++){const s=e[n];for(let h=0;h<s.length;h++)if(dl(i,s[h]))return!0}for(let n=0;n<i.length;n++)if(xy(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(ms(i,e[n]))return!0;return!1}function Jh(i,e,n){if(i.length>1){if(ms(i,e))return!0;for(let s=0;s<e.length;s++)if(gs(e[s],i,n))return!0}for(let s=0;s<i.length;s++)if(gs(i[s],e,n))return!0;return!1}function ms(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const s=i[n],h=i[n+1];for(let g=0;g<e.length-1;g++)if(Qh(s,h,e[g],e[g+1]))return!0}return!1}function Qh(i,e,n,s){return lr(i,n,s)!==lr(e,n,s)&&lr(i,e,n)!==lr(i,e,s)}function gs(i,e,n){const s=n*n;if(e.length===1)return i.distSqr(e[0])<s;for(let h=1;h<e.length;h++)if(vy(i,e[h-1],e[h])<s)return!0;return!1}function vy(i,e,n){const s=e.distSqr(n);if(s===0)return i.distSqr(e);const h=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/s;return i.distSqr(h<0?e:h>1?n:n.sub(e)._mult(h)._add(e))}function xy(i,e){let n,s,h,g=!1;for(let y=0;y<i.length;y++){n=i[y];for(let v=0,T=n.length-1;v<n.length;T=v++)s=n[v],h=n[T],s.y>e.y!=h.y>e.y&&e.x<(h.x-s.x)*(e.y-s.y)/(h.y-s.y)+s.x&&(g=!g)}return g}function dl(i,e){let n=!1;for(let s=0,h=i.length-1;s<i.length;h=s++){const g=i[s],y=i[h];g.y>e.y!=y.y>e.y&&e.x<(y.x-g.x)*(e.y-g.y)/(y.y-g.y)+g.x&&(n=!n)}return n}function iw(i,e,n){const s=n[0],h=n[2];if(i.x<s.x&&e.x<s.x||i.x>h.x&&e.x>h.x||i.y<s.y&&e.y<s.y||i.y>h.y&&e.y>h.y)return!1;const g=lr(i,e,n[0]);return g!==lr(i,e,n[1])||g!==lr(i,e,n[2])||g!==lr(i,e,n[3])}function Hu(i,e,n){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:n.programConfigurations.get(e.id).getMaxValue(i)}function ed(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function td(i,e,n,s,h){if(!e[0]&&!e[1])return i;const g=q.convert(e)._mult(h);n==="viewport"&&g._rotate(-s);const y=[];for(let v=0;v<i.length;v++)y.push(i[v].sub(g));return y}let wy,by;Ke("CircleBucket",qu,{omit:["layers"]});var nw={get paint(){return by=by||new Ii({"circle-radius":new at(Ie.paint_circle["circle-radius"]),"circle-color":new at(Ie.paint_circle["circle-color"]),"circle-blur":new at(Ie.paint_circle["circle-blur"]),"circle-opacity":new at(Ie.paint_circle["circle-opacity"]),"circle-translate":new it(Ie.paint_circle["circle-translate"]),"circle-translate-anchor":new it(Ie.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new it(Ie.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new it(Ie.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new at(Ie.paint_circle["circle-stroke-width"]),"circle-stroke-color":new at(Ie.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new at(Ie.paint_circle["circle-stroke-opacity"])})},get layout(){return wy=wy||new Ii({"circle-sort-key":new at(Ie.layout_circle["circle-sort-key"])})}},Ei=1e-6,pl=typeof Float32Array<"u"?Float32Array:Array;function rf(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Sy(i,e,n){var s=e[0],h=e[1],g=e[2],y=e[3],v=e[4],T=e[5],k=e[6],P=e[7],z=e[8],R=e[9],B=e[10],j=e[11],$=e[12],K=e[13],ie=e[14],de=e[15],ae=n[0],ce=n[1],ke=n[2],Ce=n[3];return i[0]=ae*s+ce*v+ke*z+Ce*$,i[1]=ae*h+ce*T+ke*R+Ce*K,i[2]=ae*g+ce*k+ke*B+Ce*ie,i[3]=ae*y+ce*P+ke*j+Ce*de,i[4]=(ae=n[4])*s+(ce=n[5])*v+(ke=n[6])*z+(Ce=n[7])*$,i[5]=ae*h+ce*T+ke*R+Ce*K,i[6]=ae*g+ce*k+ke*B+Ce*ie,i[7]=ae*y+ce*P+ke*j+Ce*de,i[8]=(ae=n[8])*s+(ce=n[9])*v+(ke=n[10])*z+(Ce=n[11])*$,i[9]=ae*h+ce*T+ke*R+Ce*K,i[10]=ae*g+ce*k+ke*B+Ce*ie,i[11]=ae*y+ce*P+ke*j+Ce*de,i[12]=(ae=n[12])*s+(ce=n[13])*v+(ke=n[14])*z+(Ce=n[15])*$,i[13]=ae*h+ce*T+ke*R+Ce*K,i[14]=ae*g+ce*k+ke*B+Ce*ie,i[15]=ae*y+ce*P+ke*j+Ce*de,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Wu,ow=Sy;function rd(i,e,n){var s=e[0],h=e[1],g=e[2],y=e[3];return i[0]=n[0]*s+n[4]*h+n[8]*g+n[12]*y,i[1]=n[1]*s+n[5]*h+n[9]*g+n[13]*y,i[2]=n[2]*s+n[6]*h+n[10]*g+n[14]*y,i[3]=n[3]*s+n[7]*h+n[11]*g+n[15]*y,i}Wu=new pl(4),pl!=Float32Array&&(Wu[0]=0,Wu[1]=0,Wu[2]=0,Wu[3]=0);class aw extends pn{constructor(e){super(e,nw)}createBucket(e){return new qu(e)}queryRadius(e){const n=e;return Hu("circle-radius",this,n)+Hu("circle-stroke-width",this,n)+ed(this.paint.get("circle-translate"))}queryIntersectsFeature(e,n,s,h,g,y,v,T){const k=td(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,v),P=this.paint.get("circle-radius").evaluate(n,s)+this.paint.get("circle-stroke-width").evaluate(n,s),z=this.paint.get("circle-pitch-alignment")==="map",R=z?k:function(j,$){return j.map(K=>Ty(K,$))}(k,T),B=z?P*v:P;for(const j of h)for(const $ of j){const K=z?$:Ty($,T);let ie=B;const de=rd([],[$.x,$.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ie*=de[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ie*=y.cameraToCenterDistance/de[3]),Xh(R,K,ie))return!0}return!1}}function Ty(i,e){const n=rd([],[i.x,i.y,0,1],e);return new q(n[0]/n[3],n[1]/n[3])}class Iy extends qu{}let ky;Ke("HeatmapBucket",Iy,{omit:["layers"]});var sw={get paint(){return ky=ky||new Ii({"heatmap-radius":new at(Ie.paint_heatmap["heatmap-radius"]),"heatmap-weight":new at(Ie.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new it(Ie.paint_heatmap["heatmap-intensity"]),"heatmap-color":new hs(Ie.paint_heatmap["heatmap-color"]),"heatmap-opacity":new it(Ie.paint_heatmap["heatmap-opacity"])})}};function nf(i,{width:e,height:n},s,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*n*s)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${e*n*s}`)}else h=new Uint8Array(e*n*s);return i.width=e,i.height=n,i.data=h,i}function Ey(i,{width:e,height:n},s){if(e===i.width&&n===i.height)return;const h=nf({},{width:e,height:n},s);of(i,h,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,n)},s),i.width=e,i.height=n,i.data=h.data}function of(i,e,n,s,h,g){if(h.width===0||h.height===0)return e;if(h.width>i.width||h.height>i.height||n.x>i.width-h.width||n.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||s.x>e.width-h.width||s.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const y=i.data,v=e.data;if(y===v)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<h.height;T++){const k=((n.y+T)*i.width+n.x)*g,P=((s.y+T)*e.width+s.x)*g;for(let z=0;z<h.width*g;z++)v[P+z]=y[k+z]}return e}class Yu{constructor(e,n){nf(this,e,1,n)}resize(e){Ey(this,e,1)}clone(){return new Yu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,h,g){of(e,n,s,h,g,1)}}class gn{constructor(e,n){nf(this,e,4,n)}resize(e){Ey(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new gn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,h,g){of(e,n,s,h,g,4)}}function Cy(i){const e={},n=i.resolution||256,s=i.clips?i.clips.length:1,h=i.image||new gn({width:n,height:s});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const g=(y,v,T)=>{e[i.evaluationKey]=T;const k=i.expression.evaluate(e);h.data[y+v+0]=Math.floor(255*k.r/k.a),h.data[y+v+1]=Math.floor(255*k.g/k.a),h.data[y+v+2]=Math.floor(255*k.b/k.a),h.data[y+v+3]=Math.floor(255*k.a)};if(i.clips)for(let y=0,v=0;y<s;++y,v+=4*n)for(let T=0,k=0;T<n;T++,k+=4){const P=T/(n-1),{start:z,end:R}=i.clips[y];g(v,k,z*(1-P)+R*P)}else for(let y=0,v=0;y<n;y++,v+=4)g(0,v,y/(n-1));return h}Ke("AlphaImage",Yu),Ke("RGBAImage",gn);class lw extends pn{createBucket(e){return new Iy(e)}constructor(e){super(e,sw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Cy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Py;var uw={get paint(){return Py=Py||new Ii({"hillshade-illumination-direction":new it(Ie.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new it(Ie.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new it(Ie.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new it(Ie.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new it(Ie.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new it(Ie.paint_hillshade["hillshade-accent-color"])})}};class cw extends pn{constructor(e){super(e,uw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const hw=Tr([{name:"a_pos",components:2,type:"Int16"}],4),{members:dw}=hw;var af={exports:{}};function id(i,e,n){n=n||2;var s,h,g,y,v,T,k,P=e&&e.length,z=P?e[0]*n:i.length,R=My(i,0,z,n,!0),B=[];if(!R||R.next===R.prev)return B;if(P&&(R=function($,K,ie,de){var ae,ce,ke,Ce=[];for(ae=0,ce=K.length;ae<ce;ae++)(ke=My($,K[ae]*de,ae<ce-1?K[ae+1]*de:$.length,de,!1))===ke.next&&(ke.steiner=!0),Ce.push(xw(ke));for(Ce.sort(yw),ae=0;ae<Ce.length;ae++)ie=_w(Ce[ae],ie);return ie}(i,e,R,n)),i.length>80*n){s=g=i[0],h=y=i[1];for(var j=n;j<z;j+=n)(v=i[j])<s&&(s=v),(T=i[j+1])<h&&(h=T),v>g&&(g=v),T>y&&(y=T);k=(k=Math.max(g-s,y-h))!==0?32767/k:0}return Ku(R,B,n,s,h,k,0),B}function My(i,e,n,s,h){var g,y;if(h===uf(i,e,n,s)>0)for(g=e;g<n;g+=s)y=Dy(g,i[g],i[g+1],y);else for(g=n-s;g>=e;g-=s)y=Dy(g,i[g],i[g+1],y);return y&&nd(y,y.next)&&(Ju(y),y=y.next),y}function ys(i,e){if(!i)return i;e||(e=i);var n,s=i;do if(n=!1,s.steiner||!nd(s,s.next)&&Ir(s.prev,s,s.next)!==0)s=s.next;else{if(Ju(s),(s=e=s.prev)===s.next)break;n=!0}while(n||s!==e);return e}function Ku(i,e,n,s,h,g,y){if(i){!y&&g&&function(P,z,R,B){var j=P;do j.z===0&&(j.z=sf(j.x,j.y,z,R,B)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next;while(j!==P);j.prevZ.nextZ=null,j.prevZ=null,function($){var K,ie,de,ae,ce,ke,Ce,Ge,et=1;do{for(ie=$,$=null,ce=null,ke=0;ie;){for(ke++,de=ie,Ce=0,K=0;K<et&&(Ce++,de=de.nextZ);K++);for(Ge=et;Ce>0||Ge>0&&de;)Ce!==0&&(Ge===0||!de||ie.z<=de.z)?(ae=ie,ie=ie.nextZ,Ce--):(ae=de,de=de.nextZ,Ge--),ce?ce.nextZ=ae:$=ae,ae.prevZ=ce,ce=ae;ie=de}ce.nextZ=null,et*=2}while(ke>1)}(j)}(i,s,h,g);for(var v,T,k=i;i.prev!==i.next;)if(v=i.prev,T=i.next,g?fw(i,s,h,g):pw(i))e.push(v.i/n|0),e.push(i.i/n|0),e.push(T.i/n|0),Ju(i),i=T.next,k=T.next;else if((i=T)===k){y?y===1?Ku(i=mw(ys(i),e,n),e,n,s,h,g,2):y===2&&gw(i,e,n,s,h,g):Ku(ys(i),e,n,s,h,g,1);break}}}function pw(i){var e=i.prev,n=i,s=i.next;if(Ir(e,n,s)>=0)return!1;for(var h=e.x,g=n.x,y=s.x,v=e.y,T=n.y,k=s.y,P=h<g?h<y?h:y:g<y?g:y,z=v<T?v<k?v:k:T<k?T:k,R=h>g?h>y?h:y:g>y?g:y,B=v>T?v>k?v:k:T>k?T:k,j=s.next;j!==e;){if(j.x>=P&&j.x<=R&&j.y>=z&&j.y<=B&&fl(h,v,g,T,y,k,j.x,j.y)&&Ir(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function fw(i,e,n,s){var h=i.prev,g=i,y=i.next;if(Ir(h,g,y)>=0)return!1;for(var v=h.x,T=g.x,k=y.x,P=h.y,z=g.y,R=y.y,B=v<T?v<k?v:k:T<k?T:k,j=P<z?P<R?P:R:z<R?z:R,$=v>T?v>k?v:k:T>k?T:k,K=P>z?P>R?P:R:z>R?z:R,ie=sf(B,j,e,n,s),de=sf($,K,e,n,s),ae=i.prevZ,ce=i.nextZ;ae&&ae.z>=ie&&ce&&ce.z<=de;){if(ae.x>=B&&ae.x<=$&&ae.y>=j&&ae.y<=K&&ae!==h&&ae!==y&&fl(v,P,T,z,k,R,ae.x,ae.y)&&Ir(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,ce.x>=B&&ce.x<=$&&ce.y>=j&&ce.y<=K&&ce!==h&&ce!==y&&fl(v,P,T,z,k,R,ce.x,ce.y)&&Ir(ce.prev,ce,ce.next)>=0))return!1;ce=ce.nextZ}for(;ae&&ae.z>=ie;){if(ae.x>=B&&ae.x<=$&&ae.y>=j&&ae.y<=K&&ae!==h&&ae!==y&&fl(v,P,T,z,k,R,ae.x,ae.y)&&Ir(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;ce&&ce.z<=de;){if(ce.x>=B&&ce.x<=$&&ce.y>=j&&ce.y<=K&&ce!==h&&ce!==y&&fl(v,P,T,z,k,R,ce.x,ce.y)&&Ir(ce.prev,ce,ce.next)>=0)return!1;ce=ce.nextZ}return!0}function mw(i,e,n){var s=i;do{var h=s.prev,g=s.next.next;!nd(h,g)&&zy(h,s,s.next,g)&&Xu(h,g)&&Xu(g,h)&&(e.push(h.i/n|0),e.push(s.i/n|0),e.push(g.i/n|0),Ju(s),Ju(s.next),s=i=g),s=s.next}while(s!==i);return ys(s)}function gw(i,e,n,s,h,g){var y=i;do{for(var v=y.next.next;v!==y.prev;){if(y.i!==v.i&&ww(y,v)){var T=Ay(y,v);return y=ys(y,y.next),T=ys(T,T.next),Ku(y,e,n,s,h,g,0),void Ku(T,e,n,s,h,g,0)}v=v.next}y=y.next}while(y!==i)}function yw(i,e){return i.x-e.x}function _w(i,e){var n=function(h,g){var y,v=g,T=h.x,k=h.y,P=-1/0;do{if(k<=v.y&&k>=v.next.y&&v.next.y!==v.y){var z=v.x+(k-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(z<=T&&z>P&&(P=z,y=v.x<v.next.x?v:v.next,z===T))return y}v=v.next}while(v!==g);if(!y)return null;var R,B=y,j=y.x,$=y.y,K=1/0;v=y;do T>=v.x&&v.x>=j&&T!==v.x&&fl(k<$?T:P,k,j,$,k<$?P:T,k,v.x,v.y)&&(R=Math.abs(k-v.y)/(T-v.x),Xu(v,h)&&(R<K||R===K&&(v.x>y.x||v.x===y.x&&vw(y,v)))&&(y=v,K=R)),v=v.next;while(v!==B);return y}(i,e);if(!n)return e;var s=Ay(n,i);return ys(s,s.next),ys(n,n.next)}function vw(i,e){return Ir(i.prev,i,e.prev)<0&&Ir(e.next,i,i.next)<0}function sf(i,e,n,s,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*h|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function xw(i){var e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function fl(i,e,n,s,h,g,y,v){return(h-y)*(e-v)>=(i-y)*(g-v)&&(i-y)*(s-v)>=(n-y)*(e-v)&&(n-y)*(g-v)>=(h-y)*(s-v)}function ww(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(n,s){var h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==s.i&&h.next.i!==s.i&&zy(h,h.next,n,s))return!0;h=h.next}while(h!==n);return!1}(i,e)&&(Xu(i,e)&&Xu(e,i)&&function(n,s){var h=n,g=!1,y=(n.x+s.x)/2,v=(n.y+s.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&y<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next;while(h!==n);return g}(i,e)&&(Ir(i.prev,i,e.prev)||Ir(i,e.prev,e))||nd(i,e)&&Ir(i.prev,i,i.next)>0&&Ir(e.prev,e,e.next)>0)}function Ir(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function nd(i,e){return i.x===e.x&&i.y===e.y}function zy(i,e,n,s){var h=ad(Ir(i,e,n)),g=ad(Ir(i,e,s)),y=ad(Ir(n,s,i)),v=ad(Ir(n,s,e));return h!==g&&y!==v||!(h!==0||!od(i,n,e))||!(g!==0||!od(i,s,e))||!(y!==0||!od(n,i,s))||!(v!==0||!od(n,e,s))}function od(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function ad(i){return i>0?1:i<0?-1:0}function Xu(i,e){return Ir(i.prev,i,i.next)<0?Ir(i,e,i.next)>=0&&Ir(i,i.prev,e)>=0:Ir(i,e,i.prev)<0||Ir(i,i.next,e)<0}function Ay(i,e){var n=new lf(i.i,i.x,i.y),s=new lf(e.i,e.x,e.y),h=i.next,g=e.prev;return i.next=e,e.prev=i,n.next=h,h.prev=n,s.next=n,n.prev=s,g.next=s,s.prev=g,s}function Dy(i,e,n,s){var h=new lf(i,e,n);return s?(h.next=s.next,h.prev=s,s.next.prev=h,s.next=h):(h.prev=h,h.next=h),h}function Ju(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function lf(i,e,n){this.i=i,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function uf(i,e,n,s){for(var h=0,g=e,y=n-s;g<n;g+=s)h+=(i[y]-i[g])*(i[g+1]+i[y+1]),y=g;return h}af.exports=id,af.exports.default=id,id.deviation=function(i,e,n,s){var h=e&&e.length,g=Math.abs(uf(i,0,h?e[0]*n:i.length,n));if(h)for(var y=0,v=e.length;y<v;y++)g-=Math.abs(uf(i,e[y]*n,y<v-1?e[y+1]*n:i.length,n));var T=0;for(y=0;y<s.length;y+=3){var k=s[y]*n,P=s[y+1]*n,z=s[y+2]*n;T+=Math.abs((i[k]-i[z])*(i[P+1]-i[k+1])-(i[k]-i[P])*(i[z+1]-i[k+1]))}return g===0&&T===0?0:Math.abs((T-g)/g)},id.flatten=function(i){for(var e=i[0][0].length,n={vertices:[],holes:[],dimensions:e},s=0,h=0;h<i.length;h++){for(var g=0;g<i[h].length;g++)for(var y=0;y<e;y++)n.vertices.push(i[h][g][y]);h>0&&n.holes.push(s+=i[h-1].length)}return n};var Ly=F(af.exports);function bw(i,e,n,s,h){Ry(i,e,n||0,s||i.length-1,h||Sw)}function Ry(i,e,n,s,h){for(;s>n;){if(s-n>600){var g=s-n+1,y=e-n+1,v=Math.log(g),T=.5*Math.exp(2*v/3),k=.5*Math.sqrt(v*T*(g-T)/g)*(y-g/2<0?-1:1);Ry(i,e,Math.max(n,Math.floor(e-y*T/g+k)),Math.min(s,Math.floor(e+(g-y)*T/g+k)),h)}var P=i[e],z=n,R=s;for(Qu(i,n,e),h(i[s],P)>0&&Qu(i,n,s);z<R;){for(Qu(i,z,R),z++,R--;h(i[z],P)<0;)z++;for(;h(i[R],P)>0;)R--}h(i[n],P)===0?Qu(i,n,R):Qu(i,++R,s),R<=e&&(n=R+1),e<=R&&(s=R-1)}}function Qu(i,e,n){var s=i[e];i[e]=i[n],i[n]=s}function Sw(i,e){return i<e?-1:i>e?1:0}function cf(i,e){const n=i.length;if(n<=1)return[i];const s=[];let h,g;for(let y=0;y<n;y++){const v=wi(i[y]);v!==0&&(i[y].area=Math.abs(v),g===void 0&&(g=v<0),g===v<0?(h&&s.push(h),h=[i[y]]):h.push(i[y]))}if(h&&s.push(h),e>1)for(let y=0;y<s.length;y++)s[y].length<=e||(bw(s[y],e,1,s[y].length-1,Tw),s[y]=s[y].slice(0,e));return s}function Tw(i,e){return e.area-i.area}function hf(i,e,n){const s=n.patternDependencies;let h=!1;for(const g of e){const y=g.paint.get(`${i}-pattern`);y.isConstant()||(h=!0);const v=y.constantOr(null);v&&(h=!0,s[v.to]=!0,s[v.from]=!0)}return h}function df(i,e,n,s,h){const g=h.patternDependencies;for(const y of e){const v=y.paint.get(`${i}-pattern`).value;if(v.kind!=="constant"){let T=v.evaluate({zoom:s-1},n,{},h.availableImages),k=v.evaluate({zoom:s},n,{},h.availableImages),P=v.evaluate({zoom:s+1},n,{},h.availableImages);T=T&&T.name?T.name:T,k=k&&k.name?k.name:k,P=P&&P.name?P.name:P,g[T]=!0,g[k]=!0,g[P]=!0,n.patterns[y.id]={min:T,mid:k,max:P}}}return n}class pf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new N,this.indexArray=new ye,this.indexArray2=new Se,this.programConfigurations=new ar(e.layers,e.zoom),this.segments=new ze,this.segments2=new ze,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s){this.hasPattern=hf("fill",this.layers,n);const h=this.layers[0].layout.get("fill-sort-key"),g=!h.isConstant(),y=[];for(const{feature:v,id:T,index:k,sourceLayerIndex:P}of e){const z=this.layers[0]._featureFilter.needGeometry,R=No(v,z);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),R,s))continue;const B=g?h.evaluate(R,{},s,n.availableImages):void 0,j={id:T,properties:v.properties,type:v.type,sourceLayerIndex:P,index:k,geometry:z?R.geometry:Oo(v),patterns:{},sortKey:B};y.push(j)}g&&y.sort((v,T)=>v.sortKey-T.sortKey);for(const v of y){const{geometry:T,index:k,sourceLayerIndex:P}=v;if(this.hasPattern){const z=df("fill",this.layers,v,this.zoom,n);this.patternFeatures.push(z)}else this.addFeature(v,T,k,s,{});n.featureIndex.insert(e[k].feature,T,k,P,this.index)}}update(e,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s)}addFeatures(e,n,s){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dw),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,s,h,g){for(const y of cf(n,500)){let v=0;for(const B of y)v+=B.length;const T=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),k=T.vertexLength,P=[],z=[];for(const B of y){if(B.length===0)continue;B!==y[0]&&z.push(P.length/2);const j=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),$=j.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack($+B.length-1,$),P.push(B[0].x),P.push(B[0].y);for(let K=1;K<B.length;K++)this.layoutVertexArray.emplaceBack(B[K].x,B[K].y),this.indexArray2.emplaceBack($+K-1,$+K),P.push(B[K].x),P.push(B[K].y);j.vertexLength+=B.length,j.primitiveLength+=B.length}const R=Ly(P,z);for(let B=0;B<R.length;B+=3)this.indexArray.emplaceBack(k+R[B],k+R[B+1],k+R[B+2]);T.vertexLength+=v,T.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,g,h)}}let Fy,By;Ke("FillBucket",pf,{omit:["layers","patternFeatures"]});var Iw={get paint(){return By=By||new Ii({"fill-antialias":new it(Ie.paint_fill["fill-antialias"]),"fill-opacity":new at(Ie.paint_fill["fill-opacity"]),"fill-color":new at(Ie.paint_fill["fill-color"]),"fill-outline-color":new at(Ie.paint_fill["fill-outline-color"]),"fill-translate":new it(Ie.paint_fill["fill-translate"]),"fill-translate-anchor":new it(Ie.paint_fill["fill-translate-anchor"]),"fill-pattern":new Lo(Ie.paint_fill["fill-pattern"])})},get layout(){return Fy=Fy||new Ii({"fill-sort-key":new at(Ie.layout_fill["fill-sort-key"])})}};class kw extends pn{constructor(e){super(e,Iw)}recalculate(e,n){super.recalculate(e,n);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new pf(e)}queryRadius(){return ed(this.paint.get("fill-translate"))}queryIntersectsFeature(e,n,s,h,g,y,v){return Gu(td(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,v),h)}isTileClipped(){return!0}}const Ew=Tr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Cw=Tr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Pw}=Ew;var Sa={},Mw=Z,Oy=ml;function ml(i,e,n,s,h){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=h,i.readFields(zw,this,e)}function zw(i,e,n){i==1?e.id=n.readVarint():i==2?function(s,h){for(var g=s.readVarint()+s.pos;s.pos<g;){var y=h._keys[s.readVarint()],v=h._values[s.readVarint()];h.properties[y]=v}}(n,e):i==3?e.type=n.readVarint():i==4&&(e._geometry=n.pos)}function Aw(i){for(var e,n,s=0,h=0,g=i.length,y=g-1;h<g;y=h++)s+=((n=i[y]).x-(e=i[h]).x)*(e.y+n.y);return s}ml.types=["Unknown","Point","LineString","Polygon"],ml.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,n=i.readVarint()+i.pos,s=1,h=0,g=0,y=0,v=[];i.pos<n;){if(h<=0){var T=i.readVarint();s=7&T,h=T>>3}if(h--,s===1||s===2)g+=i.readSVarint(),y+=i.readSVarint(),s===1&&(e&&v.push(e),e=[]),e.push(new Mw(g,y));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&v.push(e),v},ml.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,n=1,s=0,h=0,g=0,y=1/0,v=-1/0,T=1/0,k=-1/0;i.pos<e;){if(s<=0){var P=i.readVarint();n=7&P,s=P>>3}if(s--,n===1||n===2)(h+=i.readSVarint())<y&&(y=h),h>v&&(v=h),(g+=i.readSVarint())<T&&(T=g),g>k&&(k=g);else if(n!==7)throw new Error("unknown command "+n)}return[y,T,v,k]},ml.prototype.toGeoJSON=function(i,e,n){var s,h,g=this.extent*Math.pow(2,n),y=this.extent*i,v=this.extent*e,T=this.loadGeometry(),k=ml.types[this.type];function P(B){for(var j=0;j<B.length;j++){var $=B[j];B[j]=[360*($.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+v)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(s=0;s<T.length;s++)z[s]=T[s][0];P(T=z);break;case 2:for(s=0;s<T.length;s++)P(T[s]);break;case 3:for(T=function(B){var j=B.length;if(j<=1)return[B];for(var $,K,ie=[],de=0;de<j;de++){var ae=Aw(B[de]);ae!==0&&(K===void 0&&(K=ae<0),K===ae<0?($&&ie.push($),$=[B[de]]):$.push(B[de]))}return $&&ie.push($),ie}(T),s=0;s<T.length;s++)for(h=0;h<T[s].length;h++)P(T[s][h])}T.length===1?T=T[0]:k="Multi"+k;var R={type:"Feature",geometry:{type:k,coordinates:T},properties:this.properties};return"id"in this&&(R.id=this.id),R};var Dw=Oy,Ny=jy;function jy(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Lw,this,e),this.length=this._features.length}function Lw(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push(function(s){for(var h=null,g=s.readVarint()+s.pos;s.pos<g;){var y=s.readVarint()>>3;h=y===1?s.readString():y===2?s.readFloat():y===3?s.readDouble():y===4?s.readVarint64():y===5?s.readVarint():y===6?s.readSVarint():y===7?s.readBoolean():null}return h}(n))}jy.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Dw(this._pbf,e,this.extent,this._keys,this._values)};var Rw=Ny;function Fw(i,e,n){if(i===3){var s=new Rw(n,n.readVarint()+n.pos);s.length&&(e[s.name]=s)}}Sa.VectorTile=function(i,e){this.layers=i.readFields(Fw,{},e)},Sa.VectorTileFeature=Oy,Sa.VectorTileLayer=Ny;const Bw=Sa.VectorTileFeature.types,ff=Math.pow(2,13);function ec(i,e,n,s,h,g,y,v){i.emplaceBack(e,n,2*Math.floor(s*ff)+y,h*ff*2,g*ff*2,Math.round(v))}class mf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Y,this.centroidVertexArray=new A,this.indexArray=new ye,this.programConfigurations=new ar(e.layers,e.zoom),this.segments=new ze,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s){this.features=[],this.hasPattern=hf("fill-extrusion",this.layers,n);for(const{feature:h,id:g,index:y,sourceLayerIndex:v}of e){const T=this.layers[0]._featureFilter.needGeometry,k=No(h,T);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),k,s))continue;const P={id:g,sourceLayerIndex:v,index:y,geometry:T?k.geometry:Oo(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(df("fill-extrusion",this.layers,P,this.zoom,n)):this.addFeature(P,P.geometry,y,s,{}),n.featureIndex.insert(h,P.geometry,y,v,this.index,!0)}}addFeatures(e,n,s){for(const h of this.features){const{geometry:g}=h;this.addFeature(h,g,h.index,n,s)}}update(e,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Pw),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Cw.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,s,h,g){const y={x:0,y:0,vertexCount:0};for(const v of cf(n,500)){let T=0;for(const j of v)T+=j.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const j of v){if(j.length===0||Nw(j))continue;let $=0;for(let K=0;K<j.length;K++){const ie=j[K];if(K>=1){const de=j[K-1];if(!Ow(ie,de)){k.vertexLength+4>ze.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ae=ie.sub(de)._perp()._unit(),ce=de.dist(ie);$+ce>32768&&($=0),ec(this.layoutVertexArray,ie.x,ie.y,ae.x,ae.y,0,0,$),ec(this.layoutVertexArray,ie.x,ie.y,ae.x,ae.y,0,1,$),y.x+=2*ie.x,y.y+=2*ie.y,y.vertexCount+=2,$+=ce,ec(this.layoutVertexArray,de.x,de.y,ae.x,ae.y,0,0,$),ec(this.layoutVertexArray,de.x,de.y,ae.x,ae.y,0,1,$),y.x+=2*de.x,y.y+=2*de.y,y.vertexCount+=2;const ke=k.vertexLength;this.indexArray.emplaceBack(ke,ke+2,ke+1),this.indexArray.emplaceBack(ke+1,ke+2,ke+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+T>ze.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray)),Bw[e.type]!=="Polygon")continue;const P=[],z=[],R=k.vertexLength;for(const j of v)if(j.length!==0){j!==v[0]&&z.push(P.length/2);for(let $=0;$<j.length;$++){const K=j[$];ec(this.layoutVertexArray,K.x,K.y,0,0,1,1,0),y.x+=K.x,y.y+=K.y,y.vertexCount+=1,P.push(K.x),P.push(K.y)}}const B=Ly(P,z);for(let j=0;j<B.length;j+=3)this.indexArray.emplaceBack(R+B[j],R+B[j+2],R+B[j+1]);k.primitiveLength+=B.length/3,k.vertexLength+=T}for(let v=0;v<y.vertexCount;v++)this.centroidVertexArray.emplaceBack(Math.floor(y.x/y.vertexCount),Math.floor(y.y/y.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,g,h)}}function Ow(i,e){return i.x===e.x&&(i.x<0||i.x>Mt)||i.y===e.y&&(i.y<0||i.y>Mt)}function Nw(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Mt)||i.every(e=>e.y<0)||i.every(e=>e.y>Mt)}let Uy;Ke("FillExtrusionBucket",mf,{omit:["layers","features"]});var jw={get paint(){return Uy=Uy||new Ii({"fill-extrusion-opacity":new it(Ie["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new at(Ie["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new it(Ie["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new it(Ie["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Lo(Ie["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new at(Ie["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new at(Ie["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new it(Ie["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Uw extends pn{constructor(e){super(e,jw)}createBucket(e){return new mf(e)}queryRadius(){return ed(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,n,s,h,g,y,v,T){const k=td(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,v),P=this.paint.get("fill-extrusion-height").evaluate(n,s),z=this.paint.get("fill-extrusion-base").evaluate(n,s),R=function(j,$,K,ie){const de=[];for(const ae of j){const ce=[ae.x,ae.y,0,1];rd(ce,ce,$),de.push(new q(ce[0]/ce[3],ce[1]/ce[3]))}return de}(k,T),B=function(j,$,K,ie){const de=[],ae=[],ce=ie[8]*$,ke=ie[9]*$,Ce=ie[10]*$,Ge=ie[11]*$,et=ie[8]*K,qe=ie[9]*K,$e=ie[10]*K,Be=ie[11]*K;for(const Xe of j){const Ve=[],De=[];for(const ot of Xe){const rt=ot.x,Et=ot.y,nr=ie[0]*rt+ie[4]*Et+ie[12],sr=ie[1]*rt+ie[5]*Et+ie[13],Nr=ie[2]*rt+ie[6]*Et+ie[14],rn=ie[3]*rt+ie[7]*Et+ie[15],Ci=Nr+Ce,Dr=rn+Ge,ei=nr+et,li=sr+qe,Pi=Nr+$e,Mi=rn+Be,jr=new q((nr+ce)/Dr,(sr+ke)/Dr);jr.z=Ci/Dr,Ve.push(jr);const Ur=new q(ei/Mi,li/Mi);Ur.z=Pi/Mi,De.push(Ur)}de.push(Ve),ae.push(De)}return[de,ae]}(h,z,P,T);return function(j,$,K){let ie=1/0;Gu(K,$)&&(ie=Vy(K,$[0]));for(let de=0;de<$.length;de++){const ae=$[de],ce=j[de];for(let ke=0;ke<ae.length-1;ke++){const Ce=ae[ke],Ge=[Ce,ae[ke+1],ce[ke+1],ce[ke],Ce];jo(K,Ge)&&(ie=Math.min(ie,Vy(K,Ge)))}}return ie!==1/0&&ie}(B[0],B[1],R)}}function tc(i,e){return i.x*e.x+i.y*e.y}function Vy(i,e){if(i.length===1){let n=0;const s=e[n++];let h;for(;!h||s.equals(h);)if(h=e[n++],!h)return 1/0;for(;n<e.length;n++){const g=e[n],y=i[0],v=h.sub(s),T=g.sub(s),k=y.sub(s),P=tc(v,v),z=tc(v,T),R=tc(T,T),B=tc(k,v),j=tc(k,T),$=P*R-z*z,K=(R*B-z*j)/$,ie=(P*j-z*B)/$,de=s.z*(1-K-ie)+h.z*K+g.z*ie;if(isFinite(de))return de}return 1/0}{let n=1/0;for(const s of e)n=Math.min(n,s.z);return n}}const Vw=Tr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:$w}=Vw,Zw=Tr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:qw}=Zw,Gw=Sa.VectorTileFeature.types,Hw=Math.cos(Math.PI/180*37.5),$y=Math.pow(2,14)/.5;class gf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new G,this.layoutVertexArray2=new J,this.indexArray=new ye,this.programConfigurations=new ar(e.layers,e.zoom),this.segments=new ze,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s){this.hasPattern=hf("line",this.layers,n);const h=this.layers[0].layout.get("line-sort-key"),g=!h.isConstant(),y=[];for(const{feature:v,id:T,index:k,sourceLayerIndex:P}of e){const z=this.layers[0]._featureFilter.needGeometry,R=No(v,z);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),R,s))continue;const B=g?h.evaluate(R,{},s):void 0,j={id:T,properties:v.properties,type:v.type,sourceLayerIndex:P,index:k,geometry:z?R.geometry:Oo(v),patterns:{},sortKey:B};y.push(j)}g&&y.sort((v,T)=>v.sortKey-T.sortKey);for(const v of y){const{geometry:T,index:k,sourceLayerIndex:P}=v;if(this.hasPattern){const z=df("line",this.layers,v,this.zoom,n);this.patternFeatures.push(z)}else this.addFeature(v,T,k,s,{});n.featureIndex.insert(e[k].feature,T,k,P,this.index)}}update(e,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s)}addFeatures(e,n,s){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,qw)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$w),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,s,h,g){const y=this.layers[0].layout,v=y.get("line-join").evaluate(e,{}),T=y.get("line-cap"),k=y.get("line-miter-limit"),P=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const z of n)this.addLine(z,e,v,T,k,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,g,h)}addLine(e,n,s,h,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ie=0;ie<e.length-1;ie++)this.totalDistance+=e[ie].dist(e[ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=Gw[n.type]==="Polygon";let T=e.length;for(;T>=2&&e[T-1].equals(e[T-2]);)T--;let k=0;for(;k<T-1&&e[k].equals(e[k+1]);)k++;if(T<(v?3:2))return;s==="bevel"&&(g=1.05);const P=this.overscaling<=16?15*Mt/(512*this.overscaling):0,z=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let R,B,j,$,K;this.e1=this.e2=-1,v&&(R=e[T-2],K=e[k].sub(R)._unit()._perp());for(let ie=k;ie<T;ie++){if(j=ie===T-1?v?e[k+1]:void 0:e[ie+1],j&&e[ie].equals(j))continue;K&&($=K),R&&(B=R),R=e[ie],K=j?j.sub(R)._unit()._perp():$,$=$||K;let de=$.add(K);de.x===0&&de.y===0||de._unit();const ae=$.x*K.x+$.y*K.y,ce=de.x*K.x+de.y*K.y,ke=ce!==0?1/ce:1/0,Ce=2*Math.sqrt(2-2*ce),Ge=ce<Hw&&B&&j,et=$.x*K.y-$.y*K.x>0;if(Ge&&ie>k){const Be=R.dist(B);if(Be>2*P){const Xe=R.sub(R.sub(B)._mult(P/Be)._round());this.updateDistance(B,Xe),this.addCurrentVertex(Xe,$,0,0,z),B=Xe}}const qe=B&&j;let $e=qe?s:v?"butt":h;if(qe&&$e==="round"&&(ke<y?$e="miter":ke<=2&&($e="fakeround")),$e==="miter"&&ke>g&&($e="bevel"),$e==="bevel"&&(ke>2&&($e="flipbevel"),ke<g&&($e="miter")),B&&this.updateDistance(B,R),$e==="miter")de._mult(ke),this.addCurrentVertex(R,de,0,0,z);else if($e==="flipbevel"){if(ke>100)de=K.mult(-1);else{const Be=ke*$.add(K).mag()/$.sub(K).mag();de._perp()._mult(Be*(et?-1:1))}this.addCurrentVertex(R,de,0,0,z),this.addCurrentVertex(R,de.mult(-1),0,0,z)}else if($e==="bevel"||$e==="fakeround"){const Be=-Math.sqrt(ke*ke-1),Xe=et?Be:0,Ve=et?0:Be;if(B&&this.addCurrentVertex(R,$,Xe,Ve,z),$e==="fakeround"){const De=Math.round(180*Ce/Math.PI/20);for(let ot=1;ot<De;ot++){let rt=ot/De;if(rt!==.5){const nr=rt-.5;rt+=rt*nr*(rt-1)*((1.0904+ae*(ae*(3.55645-1.43519*ae)-3.2452))*nr*nr+(.848013+ae*(.215638*ae-1.06021)))}const Et=K.sub($)._mult(rt)._add($)._unit()._mult(et?-1:1);this.addHalfVertex(R,Et.x,Et.y,!1,et,0,z)}}j&&this.addCurrentVertex(R,K,-Xe,-Ve,z)}else if($e==="butt")this.addCurrentVertex(R,de,0,0,z);else if($e==="square"){const Be=B?1:-1;this.addCurrentVertex(R,de,Be,Be,z)}else $e==="round"&&(B&&(this.addCurrentVertex(R,$,0,0,z),this.addCurrentVertex(R,$,1,1,z,!0)),j&&(this.addCurrentVertex(R,K,-1,-1,z,!0),this.addCurrentVertex(R,K,0,0,z)));if(Ge&&ie<T-1){const Be=R.dist(j);if(Be>2*P){const Xe=R.add(j.sub(R)._mult(P/Be)._round());this.updateDistance(R,Xe),this.addCurrentVertex(Xe,K,0,0,z),R=Xe}}}}addCurrentVertex(e,n,s,h,g,y=!1){const v=n.y*h-n.x,T=-n.y-n.x*h;this.addHalfVertex(e,n.x+n.y*s,n.y-n.x*s,y,!1,s,g),this.addHalfVertex(e,v,T,y,!0,-h,g),this.distance>$y/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,s,h,g,y))}addHalfVertex({x:e,y:n},s,h,g,y,v,T){const k=.5*(this.lineClips?this.scaledDistance*($y-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(g?1:0),(n<<1)+(y?1:0),Math.round(63*s)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const P=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),T.primitiveLength++),y?this.e2=P:this.e1=P}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}let Zy,qy;Ke("LineBucket",gf,{omit:["layers","patternFeatures"]});var Gy={get paint(){return qy=qy||new Ii({"line-opacity":new at(Ie.paint_line["line-opacity"]),"line-color":new at(Ie.paint_line["line-color"]),"line-translate":new it(Ie.paint_line["line-translate"]),"line-translate-anchor":new it(Ie.paint_line["line-translate-anchor"]),"line-width":new at(Ie.paint_line["line-width"]),"line-gap-width":new at(Ie.paint_line["line-gap-width"]),"line-offset":new at(Ie.paint_line["line-offset"]),"line-blur":new at(Ie.paint_line["line-blur"]),"line-dasharray":new Du(Ie.paint_line["line-dasharray"]),"line-pattern":new Lo(Ie.paint_line["line-pattern"]),"line-gradient":new hs(Ie.paint_line["line-gradient"])})},get layout(){return Zy=Zy||new Ii({"line-cap":new it(Ie.layout_line["line-cap"]),"line-join":new at(Ie.layout_line["line-join"]),"line-miter-limit":new it(Ie.layout_line["line-miter-limit"]),"line-round-limit":new it(Ie.layout_line["line-round-limit"]),"line-sort-key":new at(Ie.layout_line["line-sort-key"])})}};class Ww extends at{possiblyEvaluate(e,n){return n=new rr(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,s,h){return n=Me({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,s,h)}}let sd;class Yw extends pn{constructor(e){super(e,Gy),this.gradientVersion=0,sd||(sd=new Ww(Gy.paint.properties["line-width"].specification),sd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(s){return s._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof na,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=sd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new gf(e)}queryRadius(e){const n=e,s=Hy(Hu("line-width",this,n),Hu("line-gap-width",this,n)),h=Hu("line-offset",this,n);return s/2+Math.abs(h)+ed(this.paint.get("line-translate"))}queryIntersectsFeature(e,n,s,h,g,y,v){const T=td(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,v),k=v/2*Hy(this.paint.get("line-width").evaluate(n,s),this.paint.get("line-gap-width").evaluate(n,s)),P=this.paint.get("line-offset").evaluate(n,s);return P&&(h=function(z,R){const B=[];for(let j=0;j<z.length;j++){const $=z[j],K=[];for(let ie=0;ie<$.length;ie++){const de=$[ie-1],ae=$[ie],ce=$[ie+1],ke=ie===0?new q(0,0):ae.sub(de)._unit()._perp(),Ce=ie===$.length-1?new q(0,0):ce.sub(ae)._unit()._perp(),Ge=ke._add(Ce)._unit(),et=Ge.x*Ce.x+Ge.y*Ce.y;et!==0&&Ge._mult(1/et),K.push(Ge._mult(R)._add(ae))}B.push(K)}return B}(h,P*v)),function(z,R,B){for(let j=0;j<R.length;j++){const $=R[j];if(z.length>=3){for(let K=0;K<$.length;K++)if(dl(z,$[K]))return!0}if(Jh(z,$,B))return!0}return!1}(T,h,k)}isTileClipped(){return!0}}function Hy(i,e){return e>0?e+2*i:i}const Kw=Tr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Xw=Tr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Tr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jw=Tr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Tr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Wy=Tr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Qw=Tr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function eb(i,e,n){return i.sections.forEach(s=>{s.text=function(h,g,y){const v=g.layout.get("text-transform").evaluate(y,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),Do.applyArabicShaping&&(h=Do.applyArabicShaping(h)),h}(s.text,e,n)}),i}Tr([{name:"triangle",components:3,type:"Uint16"}]),Tr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Tr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Tr([{type:"Float32",name:"offsetX"}]),Tr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Tr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const rc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Or=24,Yy=Ht,Ky=function(i,e,n,s,h){var g,y,v=8*h-s-1,T=(1<<v)-1,k=T>>1,P=-7,z=n?h-1:0,R=n?-1:1,B=i[e+z];for(z+=R,g=B&(1<<-P)-1,B>>=-P,P+=v;P>0;g=256*g+i[e+z],z+=R,P-=8);for(y=g&(1<<-P)-1,g>>=-P,P+=s;P>0;y=256*y+i[e+z],z+=R,P-=8);if(g===0)g=1-k;else{if(g===T)return y?NaN:1/0*(B?-1:1);y+=Math.pow(2,s),g-=k}return(B?-1:1)*y*Math.pow(2,g-s)},Xy=function(i,e,n,s,h,g){var y,v,T,k=8*g-h-1,P=(1<<k)-1,z=P>>1,R=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=s?0:g-1,j=s?1:-1,$=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,y=P):(y=Math.floor(Math.log(e)/Math.LN2),e*(T=Math.pow(2,-y))<1&&(y--,T*=2),(e+=y+z>=1?R/T:R*Math.pow(2,1-z))*T>=2&&(y++,T/=2),y+z>=P?(v=0,y=P):y+z>=1?(v=(e*T-1)*Math.pow(2,h),y+=z):(v=e*Math.pow(2,z-1)*Math.pow(2,h),y=0));h>=8;i[n+B]=255&v,B+=j,v/=256,h-=8);for(y=y<<h|v,k+=h;k>0;i[n+B]=255&y,B+=j,y/=256,k-=8);i[n+B-j]|=128*$};function Ht(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ht.Varint=0,Ht.Fixed64=1,Ht.Bytes=2,Ht.Fixed32=5;var yf=4294967296,Jy=1/yf,Qy=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Uo(i){return i.type===Ht.Bytes?i.readVarint()+i.pos:i.pos+1}function gl(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function e_(i,e,n){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(s);for(var h=n.pos-1;h>=i;h--)n.buf[h+s]=n.buf[h]}function tb(i,e){for(var n=0;n<i.length;n++)e.writeVarint(i[n])}function rb(i,e){for(var n=0;n<i.length;n++)e.writeSVarint(i[n])}function ib(i,e){for(var n=0;n<i.length;n++)e.writeFloat(i[n])}function nb(i,e){for(var n=0;n<i.length;n++)e.writeDouble(i[n])}function ob(i,e){for(var n=0;n<i.length;n++)e.writeBoolean(i[n])}function ab(i,e){for(var n=0;n<i.length;n++)e.writeFixed32(i[n])}function sb(i,e){for(var n=0;n<i.length;n++)e.writeSFixed32(i[n])}function lb(i,e){for(var n=0;n<i.length;n++)e.writeFixed64(i[n])}function ub(i,e){for(var n=0;n<i.length;n++)e.writeSFixed64(i[n])}function ld(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function yl(i,e,n){i[n]=e,i[n+1]=e>>>8,i[n+2]=e>>>16,i[n+3]=e>>>24}function t_(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}Ht.prototype={destroy:function(){this.buf=null},readFields:function(i,e,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),h=s>>3,g=this.pos;this.type=7&s,i(h,e,this),this.pos===g&&this.skip(s)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=ld(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=t_(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=ld(this.buf,this.pos)+ld(this.buf,this.pos+4)*yf;return this.pos+=8,i},readSFixed64:function(){var i=ld(this.buf,this.pos)+t_(this.buf,this.pos+4)*yf;return this.pos+=8,i},readFloat:function(){var i=Ky(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Ky(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,n,s=this.buf;return e=127&(n=s[this.pos++]),n<128?e:(e|=(127&(n=s[this.pos++]))<<7,n<128?e:(e|=(127&(n=s[this.pos++]))<<14,n<128?e:(e|=(127&(n=s[this.pos++]))<<21,n<128?e:function(h,g,y){var v,T,k=y.buf;if(v=(112&(T=k[y.pos++]))>>4,T<128||(v|=(127&(T=k[y.pos++]))<<3,T<128)||(v|=(127&(T=k[y.pos++]))<<10,T<128)||(v|=(127&(T=k[y.pos++]))<<17,T<128)||(v|=(127&(T=k[y.pos++]))<<24,T<128)||(v|=(1&(T=k[y.pos++]))<<31,T<128))return gl(h,v,g);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Qy?function(n,s,h){return Qy.decode(n.subarray(s,h))}(this.buf,e,i):function(n,s,h){for(var g="",y=s;y<h;){var v,T,k,P=n[y],z=null,R=P>239?4:P>223?3:P>191?2:1;if(y+R>h)break;R===1?P<128&&(z=P):R===2?(192&(v=n[y+1]))==128&&(z=(31&P)<<6|63&v)<=127&&(z=null):R===3?(T=n[y+2],(192&(v=n[y+1]))==128&&(192&T)==128&&((z=(15&P)<<12|(63&v)<<6|63&T)<=2047||z>=55296&&z<=57343)&&(z=null)):R===4&&(T=n[y+2],k=n[y+3],(192&(v=n[y+1]))==128&&(192&T)==128&&(192&k)==128&&((z=(15&P)<<18|(63&v)<<12|(63&T)<<6|63&k)<=65535||z>=1114112)&&(z=null)),z===null?(z=65533,R=1):z>65535&&(z-=65536,g+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),g+=String.fromCharCode(z),y+=R}return g}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Ht.Bytes)return i.push(this.readVarint(e));var n=Uo(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Ht.Bytes)return i.push(this.readSVarint());var e=Uo(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ht.Bytes)return i.push(this.readBoolean());var e=Uo(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ht.Bytes)return i.push(this.readFloat());var e=Uo(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ht.Bytes)return i.push(this.readDouble());var e=Uo(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ht.Bytes)return i.push(this.readFixed32());var e=Uo(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ht.Bytes)return i.push(this.readSFixed32());var e=Uo(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ht.Bytes)return i.push(this.readFixed64());var e=Uo(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ht.Bytes)return i.push(this.readSFixed64());var e=Uo(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Ht.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ht.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ht.Fixed32)this.pos+=4;else{if(e!==Ht.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),yl(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),yl(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),yl(this.buf,-1&i,this.pos),yl(this.buf,Math.floor(i*Jy),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),yl(this.buf,-1&i,this.pos),yl(this.buf,Math.floor(i*Jy),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,n){var s,h;if(e>=0?(s=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(g,y,v){v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,v.buf[v.pos]=127&(g>>>=7)}(s,0,n),function(g,y){var v=(7&g)<<4;y.buf[y.pos++]|=v|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(h,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(s,h,g){for(var y,v,T=0;T<h.length;T++){if((y=h.charCodeAt(T))>55295&&y<57344){if(!v){y>56319||T+1===h.length?(s[g++]=239,s[g++]=191,s[g++]=189):v=y;continue}if(y<56320){s[g++]=239,s[g++]=191,s[g++]=189,v=y;continue}y=v-55296<<10|y-56320|65536,v=null}else v&&(s[g++]=239,s[g++]=191,s[g++]=189,v=null);y<128?s[g++]=y:(y<2048?s[g++]=y>>6|192:(y<65536?s[g++]=y>>12|224:(s[g++]=y>>18|240,s[g++]=y>>12&63|128),s[g++]=y>>6&63|128),s[g++]=63&y|128)}return g}(this.buf,i,this.pos);var n=this.pos-e;n>=128&&e_(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),Xy(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Xy(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,e){this.pos++;var n=this.pos;i(e,this);var s=this.pos-n;s>=128&&e_(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,e,n){this.writeTag(i,Ht.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,tb,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,rb,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,ob,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,ib,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,nb,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,ab,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,sb,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,lb,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,ub,e)},writeBytesField:function(i,e){this.writeTag(i,Ht.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Ht.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Ht.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Ht.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Ht.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Ht.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Ht.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Ht.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Ht.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Ht.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var _f=F(Yy);const vf=3;function cb(i,e,n){i===1&&n.readMessage(hb,e)}function hb(i,e,n){if(i===3){const{id:s,bitmap:h,width:g,height:y,left:v,top:T,advance:k}=n.readMessage(db,{});e.push({id:s,bitmap:new Yu({width:g+2*vf,height:y+2*vf},h),metrics:{width:g,height:y,left:v,top:T,advance:k}})}}function db(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}const r_=vf;function i_(i){let e=0,n=0;for(const y of i)e+=y.w*y.h,n=Math.max(n,y.w);i.sort((y,v)=>v.h-y.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let h=0,g=0;for(const y of i)for(let v=s.length-1;v>=0;v--){const T=s[v];if(!(y.w>T.w||y.h>T.h)){if(y.x=T.x,y.y=T.y,g=Math.max(g,y.y+y.h),h=Math.max(h,y.x+y.w),y.w===T.w&&y.h===T.h){const k=s.pop();v<s.length&&(s[v]=k)}else y.h===T.h?(T.x+=y.w,T.w-=y.w):y.w===T.w?(T.y+=y.h,T.h-=y.h):(s.push({x:T.x+y.w,y:T.y,w:T.w-y.w,h:y.h}),T.y+=y.h,T.h-=y.h);break}}return{w:h,h:g,fill:e/(h*g)||0}}const $i=1;class xf{constructor(e,{pixelRatio:n,version:s,stretchX:h,stretchY:g,content:y}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=h,this.stretchY=g,this.content=y,this.version=s}get tl(){return[this.paddedRect.x+$i,this.paddedRect.y+$i]}get br(){return[this.paddedRect.x+this.paddedRect.w-$i,this.paddedRect.y+this.paddedRect.h-$i]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*$i)/this.pixelRatio,(this.paddedRect.h-2*$i)/this.pixelRatio]}}class n_{constructor(e,n){const s={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(e,s,g),this.addImages(n,h,g);const{w:y,h:v}=i_(g),T=new gn({width:y||1,height:v||1});for(const k in e){const P=e[k],z=s[k].paddedRect;gn.copy(P.data,T,{x:0,y:0},{x:z.x+$i,y:z.y+$i},P.data)}for(const k in n){const P=n[k],z=h[k].paddedRect,R=z.x+$i,B=z.y+$i,j=P.data.width,$=P.data.height;gn.copy(P.data,T,{x:0,y:0},{x:R,y:B},P.data),gn.copy(P.data,T,{x:0,y:$-1},{x:R,y:B-1},{width:j,height:1}),gn.copy(P.data,T,{x:0,y:0},{x:R,y:B+$},{width:j,height:1}),gn.copy(P.data,T,{x:j-1,y:0},{x:R-1,y:B},{width:1,height:$}),gn.copy(P.data,T,{x:0,y:0},{x:R+j,y:B},{width:1,height:$})}this.image=T,this.iconPositions=s,this.patternPositions=h}addImages(e,n,s){for(const h in e){const g=e[h],y={x:0,y:0,w:g.data.width+2*$i,h:g.data.height+2*$i};s.push(y),n[h]=new xf(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),n),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),n)}patchUpdatedImage(e,n,s){if(!e||!n||e.version===n.version)return;e.version=n.version;const[h,g]=e.tl;s.update(n.data,void 0,{x:h,y:g})}}var Ta;Ke("ImagePosition",xf),Ke("ImageAtlas",n_),x.ah=void 0,(Ta=x.ah||(x.ah={}))[Ta.none=0]="none",Ta[Ta.horizontal=1]="horizontal",Ta[Ta.vertical=2]="vertical",Ta[Ta.horizontalOnly=3]="horizontalOnly";const ic=-17;class nc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const s=new nc;return s.scale=e||1,s.fontStack=n,s}static forImage(e){const n=new nc;return n.imageName=e,n}}class _l{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const s=new _l;for(let h=0;h<e.sections.length;h++){const g=e.sections[h];g.image?s.addImageSection(g):s.addTextSection(g,n)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let n="";for(let s=0;s<e.length;s++){const h=e.charCodeAt(s+1)||null,g=e.charCodeAt(s-1)||null;n+=h&&Cu(h)&&!rc[e[s+1]]||g&&Cu(g)&&!rc[e[s-1]]||!rc[e[s]]?e[s]:rc[e[s]]}return n}(this.text)}trim(){let e=0;for(let s=0;s<this.text.length&&cd[this.text.charCodeAt(s)];s++)e++;let n=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&cd[this.text.charCodeAt(s)];s--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const s=new _l;return s.text=this.text.substring(e,n),s.sectionIndex=this.sectionIndex.slice(e,n),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(nc.forText(e.scale,e.fontStack||n));const s=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(s)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void Dt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(nc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Dt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ud(i,e,n,s,h,g,y,v,T,k,P,z,R,B,j,$){const K=_l.fromFeature(i,h);let ie;z===x.ah.vertical&&K.verticalizePunctuation();const{processBidirectionalText:de,processStyledBidirectionalText:ae}=Do;if(de&&K.sections.length===1){ie=[];const Ce=de(K.toString(),wf(K,k,g,e,s,B,j));for(const Ge of Ce){const et=new _l;et.text=Ge,et.sections=K.sections;for(let qe=0;qe<Ge.length;qe++)et.sectionIndex.push(0);ie.push(et)}}else if(ae){ie=[];const Ce=ae(K.text,K.sectionIndex,wf(K,k,g,e,s,B,j));for(const Ge of Ce){const et=new _l;et.text=Ge[0],et.sectionIndex=Ge[1],et.sections=K.sections,ie.push(et)}}else ie=function(Ce,Ge){const et=[],qe=Ce.text;let $e=0;for(const Be of Ge)et.push(Ce.substring($e,Be)),$e=Be;return $e<qe.length&&et.push(Ce.substring($e,qe.length)),et}(K,wf(K,k,g,e,s,B,j));const ce=[],ke={positionedLines:ce,text:K.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:z,iconsInText:!1,verticalizable:!1};return function(Ce,Ge,et,qe,$e,Be,Xe,Ve,De,ot,rt,Et){let nr=0,sr=ic,Nr=0,rn=0;const Ci=Ve==="right"?1:Ve==="left"?0:.5;let Dr=0;for(const jr of $e){jr.trim();const Ur=jr.getMaxScale(),fi=(Ur-1)*Or,zi={positionedGlyphs:[],lineOffset:0};Ce.positionedLines[Dr]=zi;const mi=zi.positionedGlyphs;let Zi=0;if(!jr.length()){sr+=Be,++Dr;continue}for(let Vr=0;Vr<jr.length();Vr++){const At=jr.getSection(Vr),gi=jr.getSectionIndex(Vr),ui=jr.getCharCode(Vr);let $r=0,Bn=null,Xn=null,Jn=null,Vo=Or;const On=!(De===x.ah.horizontal||!rt&&!il(ui)||rt&&(cd[ui]||(ei=ui,He.Arabic(ei)||He["Arabic Supplement"](ei)||He["Arabic Extended-A"](ei)||He["Arabic Presentation Forms-A"](ei)||He["Arabic Presentation Forms-B"](ei))));if(At.imageName){const _n=qe[At.imageName];if(!_n)continue;Jn=At.imageName,Ce.iconsInText=Ce.iconsInText||!0,Xn=_n.paddedRect;const Gi=_n.displaySize;At.scale=At.scale*Or/Et,Bn={width:Gi[0],height:Gi[1],left:$i,top:-r_,advance:On?Gi[1]:Gi[0]},$r=fi+(Or-Gi[1]*At.scale),Vo=Bn.advance;const $o=On?Gi[0]*At.scale-Or*Ur:Gi[1]*At.scale-Or*Ur;$o>0&&$o>Zi&&(Zi=$o)}else{const _n=et[At.fontStack],Gi=_n&&_n[ui];if(Gi&&Gi.rect)Xn=Gi.rect,Bn=Gi.metrics;else{const $o=Ge[At.fontStack],uc=$o&&$o[ui];if(!uc)continue;Bn=uc.metrics}$r=(Ur-At.scale)*Or}On?(Ce.verticalizable=!0,mi.push({glyph:ui,imageName:Jn,x:nr,y:sr+$r,vertical:On,scale:At.scale,fontStack:At.fontStack,sectionIndex:gi,metrics:Bn,rect:Xn}),nr+=Vo*At.scale+ot):(mi.push({glyph:ui,imageName:Jn,x:nr,y:sr+$r,vertical:On,scale:At.scale,fontStack:At.fontStack,sectionIndex:gi,metrics:Bn,rect:Xn}),nr+=Bn.advance*At.scale+ot)}mi.length!==0&&(Nr=Math.max(nr-ot,Nr),mb(mi,0,mi.length-1,Ci,Zi)),nr=0;const qi=Be*Ur+Zi;zi.lineOffset=Math.max(Zi,fi),sr+=qi,rn=Math.max(qi,rn),++Dr}var ei;const li=sr-ic,{horizontalAlign:Pi,verticalAlign:Mi}=bf(Xe);(function(jr,Ur,fi,zi,mi,Zi,qi,Vr,At){const gi=(Ur-fi)*mi;let ui=0;ui=Zi!==qi?-Vr*zi-ic:(-zi*At+.5)*qi;for(const $r of jr)for(const Bn of $r.positionedGlyphs)Bn.x+=gi,Bn.y+=ui})(Ce.positionedLines,Ci,Pi,Mi,Nr,rn,Be,li,$e.length),Ce.top+=-Mi*li,Ce.bottom=Ce.top+li,Ce.left+=-Pi*Nr,Ce.right=Ce.left+Nr}(ke,e,n,s,ie,y,v,T,z,k,R,$),!function(Ce){for(const Ge of Ce)if(Ge.positionedGlyphs.length!==0)return!1;return!0}(ce)&&ke}const cd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},pb={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function o_(i,e,n,s,h,g){if(e.imageName){const y=s[e.imageName];return y?y.displaySize[0]*e.scale*Or/g+h:0}{const y=n[e.fontStack],v=y&&y[i];return v?v.metrics.advance*e.scale+h:0}}function a_(i,e,n,s){const h=Math.pow(i-e,2);return s?i<e?h/2:2*h:h+Math.abs(n)*n}function fb(i,e,n){let s=0;return i===10&&(s-=1e4),n&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function s_(i,e,n,s,h,g){let y=null,v=a_(e,n,h,g);for(const T of s){const k=a_(e-T.x,n,h,g)+T.badness;k<=v&&(y=T,v=k)}return{index:i,x:e,priorBreak:y,badness:v}}function l_(i){return i?l_(i.priorBreak).concat(i.index):[]}function wf(i,e,n,s,h,g,y){if(g!=="point")return[];if(!i)return[];const v=[],T=function(R,B,j,$,K,ie){let de=0;for(let ae=0;ae<R.length();ae++){const ce=R.getSection(ae);de+=o_(R.getCharCode(ae),ce,$,K,B,ie)}return de/Math.max(1,Math.ceil(de/j))}(i,e,n,s,h,y),k=i.text.indexOf("")>=0;let P=0;for(let R=0;R<i.length();R++){const B=i.getSection(R),j=i.getCharCode(R);if(cd[j]||(P+=o_(j,B,s,h,e,y)),R<i.length()-1){const $=!((z=j)<11904||!(He["Bopomofo Extended"](z)||He.Bopomofo(z)||He["CJK Compatibility Forms"](z)||He["CJK Compatibility Ideographs"](z)||He["CJK Compatibility"](z)||He["CJK Radicals Supplement"](z)||He["CJK Strokes"](z)||He["CJK Symbols and Punctuation"](z)||He["CJK Unified Ideographs Extension A"](z)||He["CJK Unified Ideographs"](z)||He["Enclosed CJK Letters and Months"](z)||He["Halfwidth and Fullwidth Forms"](z)||He.Hiragana(z)||He["Ideographic Description Characters"](z)||He["Kangxi Radicals"](z)||He["Katakana Phonetic Extensions"](z)||He.Katakana(z)||He["Vertical Forms"](z)||He["Yi Radicals"](z)||He["Yi Syllables"](z)));(pb[j]||$||B.imageName)&&v.push(s_(R+1,P,T,v,fb(j,i.getCharCode(R+1),$&&k),!1))}}var z;return l_(s_(i.length(),P,T,v,0,!0))}function bf(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function mb(i,e,n,s,h){if(!s&&!h)return;const g=i[n],y=(i[n].x+g.metrics.advance*g.scale)*s;for(let v=e;v<=n;v++)i[v].x-=y,i[v].y+=h}function gb(i,e,n){const{horizontalAlign:s,verticalAlign:h}=bf(n),g=e[0]-i.displaySize[0]*s,y=e[1]-i.displaySize[1]*h;return{image:i,top:y,bottom:y+i.displaySize[1],left:g,right:g+i.displaySize[0]}}function u_(i,e,n,s,h,g){const y=i.image;let v;if(y.content){const K=y.content,ie=y.pixelRatio||1;v=[K[0]/ie,K[1]/ie,y.displaySize[0]-K[2]/ie,y.displaySize[1]-K[3]/ie]}const T=e.left*g,k=e.right*g;let P,z,R,B;n==="width"||n==="both"?(B=h[0]+T-s[3],z=h[0]+k+s[1]):(B=h[0]+(T+k-y.displaySize[0])/2,z=B+y.displaySize[0]);const j=e.top*g,$=e.bottom*g;return n==="height"||n==="both"?(P=h[1]+j-s[0],R=h[1]+$+s[2]):(P=h[1]+(j+$-y.displaySize[1])/2,R=P+y.displaySize[1]),{image:y,top:P,right:z,bottom:R,left:B,collisionPadding:v}}const oc=255,yo=128,Ia=oc*yo;function c_(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new rr(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:h}=n;let g=0;for(;g<s.length&&s[g]<=i;)g++;g=Math.max(0,g-1);let y=g;for(;y<s.length&&s[y]<i+1;)y++;y=Math.min(s.length-1,y);const v=s[g],T=s[y];return n.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:T,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:T,minSize:n.evaluate(new rr(v)),maxSize:n.evaluate(new rr(T)),interpolationType:h}}}function Sf(i,e,n){let s="never";const h=i.get(e);return h?s=h:i.get(n)&&(s="always"),s}const yb=Sa.VectorTileFeature.types,_b=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hd(i,e,n,s,h,g,y,v,T,k,P,z,R){const B=v?Math.min(Ia,Math.round(v[0])):0,j=v?Math.min(Ia,Math.round(v[1])):0;i.emplaceBack(e,n,Math.round(32*s),Math.round(32*h),g,y,(B<<1)+(T?1:0),j,16*k,16*P,256*z,256*R)}function Tf(i,e,n){i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n)}function vb(i){for(const e of i.sections)if(Zh(e.text))return!0;return!1}class If{constructor(e){this.layoutVertexArray=new le,this.indexArray=new ye,this.programConfigurations=e,this.segments=new ze,this.dynamicLayoutVertexArray=new me,this.opacityVertexArray=new ee,this.hasVisibleVertices=!1,this.placedSymbolArray=new t}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,s,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Kw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Xw.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,_b,!0),this.opacityVertexBuffer.itemSize=1),(s||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ke("SymbolBuffers",If);class kf{constructor(e,n,s){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new s,this.segments=new ze,this.collisionVertexArray=new ge}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Jw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ke("CollisionBuffers",kf);class vl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=rf([]),this.placementViewportMatrix=rf([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=c_(this.zoom,n["text-size"]),this.iconSizeData=c_(this.zoom,n["icon-size"]);const s=this.layers[0].layout,h=s.get("symbol-sort-key"),g=s.get("symbol-z-order");this.canOverlap=Sf(s,"text-overlap","text-allow-overlap")!=="never"||Sf(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(y=>x.ah[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID}createArrays(){this.text=new If(new ar(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new If(new ar(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new c,this.lineVertexArray=new m,this.symbolInstances=new u,this.textAnchorOffsets=new b}calculateGlyphDependencies(e,n,s,h,g){for(let y=0;y<e.length;y++)if(n[e.charCodeAt(y)]=!0,(s||h)&&g){const v=rc[e.charAt(y)];v&&(n[v.charCodeAt(0)]=!0)}}populate(e,n,s){const h=this.layers[0],g=h.layout,y=g.get("text-font"),v=g.get("text-field"),T=g.get("icon-image"),k=(v.value.kind!=="constant"||v.value.value instanceof Oi&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),P=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,z=g.get("symbol-sort-key");if(this.features=[],!k&&!P)return;const R=n.iconDependencies,B=n.glyphDependencies,j=n.availableImages,$=new rr(this.zoom);for(const{feature:K,id:ie,index:de,sourceLayerIndex:ae}of e){const ce=h._featureFilter.needGeometry,ke=No(K,ce);if(!h._featureFilter.filter($,ke,s))continue;let Ce,Ge;if(ce||(ke.geometry=Oo(K)),k){const qe=h.getValueAndResolveTokens("text-field",ke,s,j),$e=Oi.factory(qe),Be=this.hasRTLText=this.hasRTLText||vb($e);(!Be||Do.getRTLTextPluginStatus()==="unavailable"||Be&&Do.isParsed())&&(Ce=eb($e,h,ke))}if(P){const qe=h.getValueAndResolveTokens("icon-image",ke,s,j);Ge=qe instanceof Qi?qe:Qi.fromString(qe)}if(!Ce&&!Ge)continue;const et=this.sortFeaturesByKey?z.evaluate(ke,{},s):void 0;if(this.features.push({id:ie,text:Ce,icon:Ge,index:de,sourceLayerIndex:ae,geometry:ke.geometry,properties:K.properties,type:yb[K.type],sortKey:et}),Ge&&(R[Ge.name]=!0),Ce){const qe=y.evaluate(ke,{},s).join(","),$e=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(x.ah.vertical)>=0;for(const Be of Ce.sections)if(Be.image)R[Be.image.name]=!0;else{const Xe=us(Ce.toString()),Ve=Be.fontStack||qe,De=B[Ve]=B[Ve]||{};this.calculateGlyphDependencies(Be.text,De,$e,this.allowVerticalPlacement,Xe)}}}g.get("symbol-placement")==="line"&&(this.features=function(K){const ie={},de={},ae=[];let ce=0;function ke(qe){ae.push(K[qe]),ce++}function Ce(qe,$e,Be){const Xe=de[qe];return delete de[qe],de[$e]=Xe,ae[Xe].geometry[0].pop(),ae[Xe].geometry[0]=ae[Xe].geometry[0].concat(Be[0]),Xe}function Ge(qe,$e,Be){const Xe=ie[$e];return delete ie[$e],ie[qe]=Xe,ae[Xe].geometry[0].shift(),ae[Xe].geometry[0]=Be[0].concat(ae[Xe].geometry[0]),Xe}function et(qe,$e,Be){const Xe=Be?$e[0][$e[0].length-1]:$e[0][0];return`${qe}:${Xe.x}:${Xe.y}`}for(let qe=0;qe<K.length;qe++){const $e=K[qe],Be=$e.geometry,Xe=$e.text?$e.text.toString():null;if(!Xe){ke(qe);continue}const Ve=et(Xe,Be),De=et(Xe,Be,!0);if(Ve in de&&De in ie&&de[Ve]!==ie[De]){const ot=Ge(Ve,De,Be),rt=Ce(Ve,De,ae[ot].geometry);delete ie[Ve],delete de[De],de[et(Xe,ae[rt].geometry,!0)]=rt,ae[ot].geometry=null}else Ve in de?Ce(Ve,De,Be):De in ie?Ge(Ve,De,Be):(ke(qe),ie[Ve]=ce-1,de[De]=ce-1)}return ae.filter(qe=>qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((K,ie)=>K.sortKey-ie.sortKey)}update(e,n,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,s),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const s=this.lineVertexArray.length;if(e.segment!==void 0){let h=e.dist(n[e.segment+1]),g=e.dist(n[e.segment]);const y={};for(let v=e.segment+1;v<n.length;v++)y[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:h},v<n.length-1&&(h+=n[v+1].dist(n[v]));for(let v=e.segment||0;v>=0;v--)y[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:g},v>0&&(g+=n[v-1].dist(n[v]));for(let v=0;v<n.length;v++){const T=y[v];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,n,s,h,g,y,v,T,k,P,z,R){const B=e.indexArray,j=e.layoutVertexArray,$=e.segments.prepareSegment(4*n.length,j,B,this.canOverlap?y.sortKey:void 0),K=this.glyphOffsetArray.length,ie=$.vertexLength,de=this.allowVerticalPlacement&&v===x.ah.vertical?Math.PI/2:0,ae=y.text&&y.text.sections;for(let ce=0;ce<n.length;ce++){const{tl:ke,tr:Ce,bl:Ge,br:et,tex:qe,pixelOffsetTL:$e,pixelOffsetBR:Be,minFontScaleX:Xe,minFontScaleY:Ve,glyphOffset:De,isSDF:ot,sectionIndex:rt}=n[ce],Et=$.vertexLength,nr=De[1];hd(j,T.x,T.y,ke.x,nr+ke.y,qe.x,qe.y,s,ot,$e.x,$e.y,Xe,Ve),hd(j,T.x,T.y,Ce.x,nr+Ce.y,qe.x+qe.w,qe.y,s,ot,Be.x,$e.y,Xe,Ve),hd(j,T.x,T.y,Ge.x,nr+Ge.y,qe.x,qe.y+qe.h,s,ot,$e.x,Be.y,Xe,Ve),hd(j,T.x,T.y,et.x,nr+et.y,qe.x+qe.w,qe.y+qe.h,s,ot,Be.x,Be.y,Xe,Ve),Tf(e.dynamicLayoutVertexArray,T,de),B.emplaceBack(Et,Et+1,Et+2),B.emplaceBack(Et+1,Et+2,Et+3),$.vertexLength+=4,$.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(De[0]),ce!==n.length-1&&rt===n[ce+1].sectionIndex||e.programConfigurations.populatePaintArrays(j.length,y,y.index,{},R,ae&&ae[rt])}e.placedSymbolArray.emplaceBack(T.x,T.y,K,this.glyphOffsetArray.length-K,ie,k,P,T.segment,s?s[0]:0,s?s[1]:0,h[0],h[1],v,0,!1,0,z)}_addCollisionDebugVertex(e,n,s,h,g,y){return n.emplaceBack(0,0),e.emplaceBack(s.x,s.y,h,g,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(e,n,s,h,g,y,v){const T=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),k=T.vertexLength,P=g.layoutVertexArray,z=g.collisionVertexArray,R=v.anchorX,B=v.anchorY;this._addCollisionDebugVertex(P,z,y,R,B,new q(e,n)),this._addCollisionDebugVertex(P,z,y,R,B,new q(s,n)),this._addCollisionDebugVertex(P,z,y,R,B,new q(s,h)),this._addCollisionDebugVertex(P,z,y,R,B,new q(e,h)),T.vertexLength+=4;const j=g.indexArray;j.emplaceBack(k,k+1),j.emplaceBack(k+1,k+2),j.emplaceBack(k+2,k+3),j.emplaceBack(k+3,k),T.primitiveLength+=4}addDebugCollisionBoxes(e,n,s,h){for(let g=e;g<n;g++){const y=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,h?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new kf(he,Wy.members,Se),this.iconCollisionBox=new kf(he,Wy.members,Se);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,s,h,g,y,v,T,k){const P={};for(let z=n;z<s;z++){const R=e.get(z);P.textBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},P.textFeatureIndex=R.featureIndex;break}for(let z=h;z<g;z++){const R=e.get(z);P.verticalTextBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},P.verticalTextFeatureIndex=R.featureIndex;break}for(let z=y;z<v;z++){const R=e.get(z);P.iconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},P.iconFeatureIndex=R.featureIndex;break}for(let z=T;z<k;z++){const R=e.get(z);P.verticalIconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},P.verticalIconFeatureIndex=R.featureIndex;break}return P}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const s=e.placedSymbolArray.get(n),h=s.vertexStartIndex+4*s.numGlyphs;for(let g=s.vertexStartIndex;g<h;g+=4)e.indexArray.emplaceBack(g,g+1,g+2),e.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),s=Math.cos(e),h=[],g=[],y=[];for(let v=0;v<this.symbolInstances.length;++v){y.push(v);const T=this.symbolInstances.get(v);h.push(0|Math.round(n*T.anchorX+s*T.anchorY)),g.push(T.featureIndex)}return y.sort((v,T)=>h[v]-h[T]||g[T]-g[v]),y}addToSortKeyRanges(e,n){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===n?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const s=this.symbolInstances.get(n);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((h,g,y)=>{h>=0&&y.indexOf(h)===g&&this.addIndicesForPlacedSymbol(this.text,h)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let h_,d_;Ke("SymbolBucket",vl,{omit:["layers","collisionBoxArray","features","compareText"]}),vl.MAX_GLYPHS=65535,vl.addDynamicAttributes=Tf;var Ef={get paint(){return d_=d_||new Ii({"icon-opacity":new at(Ie.paint_symbol["icon-opacity"]),"icon-color":new at(Ie.paint_symbol["icon-color"]),"icon-halo-color":new at(Ie.paint_symbol["icon-halo-color"]),"icon-halo-width":new at(Ie.paint_symbol["icon-halo-width"]),"icon-halo-blur":new at(Ie.paint_symbol["icon-halo-blur"]),"icon-translate":new it(Ie.paint_symbol["icon-translate"]),"icon-translate-anchor":new it(Ie.paint_symbol["icon-translate-anchor"]),"text-opacity":new at(Ie.paint_symbol["text-opacity"]),"text-color":new at(Ie.paint_symbol["text-color"],{runtimeType:br,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new at(Ie.paint_symbol["text-halo-color"]),"text-halo-width":new at(Ie.paint_symbol["text-halo-width"]),"text-halo-blur":new at(Ie.paint_symbol["text-halo-blur"]),"text-translate":new it(Ie.paint_symbol["text-translate"]),"text-translate-anchor":new it(Ie.paint_symbol["text-translate-anchor"])})},get layout(){return h_=h_||new Ii({"symbol-placement":new it(Ie.layout_symbol["symbol-placement"]),"symbol-spacing":new it(Ie.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new it(Ie.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new at(Ie.layout_symbol["symbol-sort-key"]),"symbol-z-order":new it(Ie.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new it(Ie.layout_symbol["icon-allow-overlap"]),"icon-overlap":new it(Ie.layout_symbol["icon-overlap"]),"icon-ignore-placement":new it(Ie.layout_symbol["icon-ignore-placement"]),"icon-optional":new it(Ie.layout_symbol["icon-optional"]),"icon-rotation-alignment":new it(Ie.layout_symbol["icon-rotation-alignment"]),"icon-size":new at(Ie.layout_symbol["icon-size"]),"icon-text-fit":new it(Ie.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new it(Ie.layout_symbol["icon-text-fit-padding"]),"icon-image":new at(Ie.layout_symbol["icon-image"]),"icon-rotate":new at(Ie.layout_symbol["icon-rotate"]),"icon-padding":new at(Ie.layout_symbol["icon-padding"]),"icon-keep-upright":new it(Ie.layout_symbol["icon-keep-upright"]),"icon-offset":new at(Ie.layout_symbol["icon-offset"]),"icon-anchor":new at(Ie.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new it(Ie.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new it(Ie.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new it(Ie.layout_symbol["text-rotation-alignment"]),"text-field":new at(Ie.layout_symbol["text-field"]),"text-font":new at(Ie.layout_symbol["text-font"]),"text-size":new at(Ie.layout_symbol["text-size"]),"text-max-width":new at(Ie.layout_symbol["text-max-width"]),"text-line-height":new it(Ie.layout_symbol["text-line-height"]),"text-letter-spacing":new at(Ie.layout_symbol["text-letter-spacing"]),"text-justify":new at(Ie.layout_symbol["text-justify"]),"text-radial-offset":new at(Ie.layout_symbol["text-radial-offset"]),"text-variable-anchor":new it(Ie.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new at(Ie.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new at(Ie.layout_symbol["text-anchor"]),"text-max-angle":new it(Ie.layout_symbol["text-max-angle"]),"text-writing-mode":new it(Ie.layout_symbol["text-writing-mode"]),"text-rotate":new at(Ie.layout_symbol["text-rotate"]),"text-padding":new it(Ie.layout_symbol["text-padding"]),"text-keep-upright":new it(Ie.layout_symbol["text-keep-upright"]),"text-transform":new at(Ie.layout_symbol["text-transform"]),"text-offset":new at(Ie.layout_symbol["text-offset"]),"text-allow-overlap":new it(Ie.layout_symbol["text-allow-overlap"]),"text-overlap":new it(Ie.layout_symbol["text-overlap"]),"text-ignore-placement":new it(Ie.layout_symbol["text-ignore-placement"]),"text-optional":new it(Ie.layout_symbol["text-optional"])})}};class p_{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Wn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ke("FormatSectionOverride",p_,{omit:["defaultValue"]});class dd extends pn{constructor(e){super(e,Ef)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const h=[];for(const g of s)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,s,h){const g=this.layout.get(e).evaluate(n,{},s,h),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||Qt(y.value)||!g?g:function(v,T){return T.replace(/{([^{}]+)}/g,(k,P)=>v&&P in v?String(v[P]):"")}(n.properties,g)}createBucket(e){return new vl(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Ef.paint.overridableProperties){if(!dd.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),s=new p_(n),h=new os(s,n.property.specification);let g=null;g=n.value.kind==="constant"||n.value.kind==="source"?new ha("source",h):new Ks("composite",h,n.value.zoomStops),this.paint._values[e]=new dn(n.property,g,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven())&&dd.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const s=e.get("text-field"),h=Ef.paint.properties[n];let g=!1;const y=v=>{for(const T of v)if(h.overrides&&h.overrides.hasOverride(T))return void(g=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Oi)y(s.value.value.sections);else if(s.value.kind==="source"){const v=k=>{g||(k instanceof ko&&zr(k.value)===Ji?y(k.value.sections):k instanceof Ys?y(k.sections):k.eachChild(v))},T=s.value;T._styleExpression&&v(T._styleExpression.expression)}return g}}let f_;var xb={get paint(){return f_=f_||new Ii({"background-color":new it(Ie.paint_background["background-color"]),"background-pattern":new Du(Ie.paint_background["background-pattern"]),"background-opacity":new it(Ie.paint_background["background-opacity"])})}};class wb extends pn{constructor(e){super(e,xb)}}let m_;var bb={get paint(){return m_=m_||new Ii({"raster-opacity":new it(Ie.paint_raster["raster-opacity"]),"raster-hue-rotate":new it(Ie.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new it(Ie.paint_raster["raster-brightness-min"]),"raster-brightness-max":new it(Ie.paint_raster["raster-brightness-max"]),"raster-saturation":new it(Ie.paint_raster["raster-saturation"]),"raster-contrast":new it(Ie.paint_raster["raster-contrast"]),"raster-resampling":new it(Ie.paint_raster["raster-resampling"]),"raster-fade-duration":new it(Ie.paint_raster["raster-fade-duration"])})}};class Sb extends pn{constructor(e){super(e,bb)}}class Tb extends pn{constructor(e){super(e,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Ib{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Cf=63710088e-1;class ka{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ka(pe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,s=this.lat*n,h=e.lat*n,g=Math.sin(s)*Math.sin(h)+Math.cos(s)*Math.cos(h)*Math.cos((e.lng-this.lng)*n);return Cf*Math.acos(Math.min(g,1))}static convert(e){if(e instanceof ka)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ka(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ka(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const g_=2*Math.PI*Cf;function y_(i){return g_*Math.cos(i*Math.PI/180)}function __(i){return(180+i)/360}function v_(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function x_(i,e){return i/y_(e)}function Pf(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class pd{constructor(e,n,s=0){this.x=+e,this.y=+n,this.z=+s}static fromLngLat(e,n=0){const s=ka.convert(e);return new pd(__(s.lng),v_(s.lat),x_(n,s.lat))}toLngLat(){return new ka(360*this.x-180,Pf(this.y))}toAltitude(){return this.z*y_(Pf(this.y))}meterInMercatorCoordinateUnits(){return 1/g_*(e=Pf(this.y),1/Math.cos(e*Math.PI/180));var e}}function w_(i,e,n){var s=2*Math.PI*6378137/256/Math.pow(2,n);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class Mf{constructor(e,n,s){if(e<0||e>25||s<0||s>=Math.pow(2,e)||n<0||n>=Math.pow(2,e))throw new Error(`x=${n}, y=${s}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=s,this.key=ac(0,e,e,n,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,s){const h=(y=this.y,v=this.z,T=w_(256*(g=this.x),256*(y=Math.pow(2,v)-y-1),v),k=w_(256*(g+1),256*(y+1),v),T[0]+","+T[1]+","+k[0]+","+k[1]);var g,y,v,T,k;const P=function(z,R,B){let j,$="";for(let K=z;K>0;K--)j=1<<K-1,$+=(R&j?1:0)+(B&j?2:0);return $}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,P).replace(/{bbox-epsg-3857}/g,h)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new q((e.x*n-this.x)*Mt,(e.y*n-this.y)*Mt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class b_{constructor(e,n){this.wrap=e,this.canonical=n,this.key=ac(e,n.z,n.z,n.x,n.y)}}class yn{constructor(e,n,s,h,g){if(e<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${s}`);this.overscaledZ=e,this.wrap=n,this.canonical=new Mf(s,+h,+g),this.key=ac(n,e,s,h,g)}clone(){return new yn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new yn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new yn(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?ac(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):ac(this.wrap*+n,e,e,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new yn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,s=2*this.canonical.x,h=2*this.canonical.y;return[new yn(n,this.wrap,n,s,h),new yn(n,this.wrap,n,s+1,h),new yn(n,this.wrap,n,s,h+1),new yn(n,this.wrap,n,s+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new yn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new yn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new b_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new pd(e.x-this.wrap,e.y))}}function ac(i,e,n,s,h){(i*=2)<0&&(i=-1*i-1);const g=1<<n;return(g*g*i+g*h+s).toString(36)+n.toString(36)+e.toString(36)}Ke("CanonicalTileID",Mf),Ke("OverscaledTileID",yn,{omit:["posMatrix"]});class S_{constructor(e,n,s,h=1,g=1,y=1,v=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void Dt(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const T=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=g,this.blueFactor=y,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<T;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(T,k)]=this.data[this._idx(T-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,T)]=this.data[this._idx(k,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<T;k++)for(let P=0;P<T;P++){const z=this.get(k,P);z>this.max&&(this.max=z),z<this.min&&(this.min=z)}}get(e,n){const s=new Uint8Array(this.data.buffer),h=4*this._idx(e,n);return this.unpack(s[h],s[h+1],s[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}unpack(e,n,s){return e*this.redFactor+n*this.greenFactor+s*this.blueFactor-this.baseShift}getPixels(){return new gn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,g=n*this.dim+this.dim,y=s*this.dim,v=s*this.dim+this.dim;switch(n){case-1:h=g-1;break;case 1:g=h+1}switch(s){case-1:y=v-1;break;case 1:v=y+1}const T=-n*this.dim,k=-s*this.dim;for(let P=y;P<v;P++)for(let z=h;z<g;z++)this.data[this._idx(z,P)]=e.data[this._idx(z+T,P+k)]}}Ke("DEMData",S_);class T_{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const s=e[n];this._stringToNumber[s]=n,this._numberToString[n]=s}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class I_{constructor(e,n,s,h,g){this.type="Feature",this._vectorTileFeature=e,e._z=n,e._x=s,e._y=h,this.properties=e.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(e[n]=this[n]);return e}}class k_{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Yn(Mt,16,0),this.grid3D=new Yn(Mt,16,0),this.featureIndexArray=new C,this.promoteId=n}insert(e,n,s,h,g,y){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,h,g);const T=y?this.grid3D:this.grid;for(let k=0;k<n.length;k++){const P=n[k],z=[1/0,1/0,-1/0,-1/0];for(let R=0;R<P.length;R++){const B=P[R];z[0]=Math.min(z[0],B.x),z[1]=Math.min(z[1],B.y),z[2]=Math.max(z[2],B.x),z[3]=Math.max(z[3],B.y)}z[0]<Mt&&z[1]<Mt&&z[2]>=0&&z[3]>=0&&T.insert(v,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Sa.VectorTile(new _f(this.rawTileData)).layers,this.sourceLayerCoder=new T_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,n,s,h){this.loadVTLayers();const g=e.params||{},y=Mt/e.tileSize/e.scale,v=Qs(g.filter),T=e.queryGeometry,k=e.queryPadding*y,P=C_(T),z=this.grid.query(P.minX-k,P.minY-k,P.maxX+k,P.maxY+k),R=C_(e.cameraQueryGeometry),B=this.grid3D.query(R.minX-k,R.minY-k,R.maxX+k,R.maxY+k,(K,ie,de,ae)=>function(ce,ke,Ce,Ge,et){for(const $e of ce)if(ke<=$e.x&&Ce<=$e.y&&Ge>=$e.x&&et>=$e.y)return!0;const qe=[new q(ke,Ce),new q(ke,et),new q(Ge,et),new q(Ge,Ce)];if(ce.length>2){for(const $e of qe)if(dl(ce,$e))return!0}for(let $e=0;$e<ce.length-1;$e++)if(iw(ce[$e],ce[$e+1],qe))return!0;return!1}(e.cameraQueryGeometry,K-k,ie-k,de+k,ae+k));for(const K of B)z.push(K);z.sort(kb);const j={};let $;for(let K=0;K<z.length;K++){const ie=z[K];if(ie===$)continue;$=ie;const de=this.featureIndexArray.get(ie);let ae=null;this.loadMatchingFeature(j,de.bucketIndex,de.sourceLayerIndex,de.featureIndex,v,g.layers,g.availableImages,n,s,h,(ce,ke,Ce)=>(ae||(ae=Oo(ce)),ke.queryIntersectsFeature(T,ce,Ce,ae,this.z,e.transform,y,e.pixelPosMatrix)))}return j}loadMatchingFeature(e,n,s,h,g,y,v,T,k,P,z){const R=this.bucketLayerIDs[n];if(y&&!function(K,ie){for(let de=0;de<K.length;de++)if(ie.indexOf(K[de])>=0)return!0;return!1}(y,R))return;const B=this.sourceLayerCoder.decode(s),j=this.vtLayers[B].feature(h);if(g.needGeometry){const K=No(j,!0);if(!g.filter(new rr(this.tileID.overscaledZ),K,this.tileID.canonical))return}else if(!g.filter(new rr(this.tileID.overscaledZ),j))return;const $=this.getId(j,B);for(let K=0;K<R.length;K++){const ie=R[K];if(y&&y.indexOf(ie)<0)continue;const de=T[ie];if(!de)continue;let ae={};$&&P&&(ae=P.getState(de.sourceLayer||"_geojsonTileLayer",$));const ce=Me({},k[ie]);ce.paint=E_(ce.paint,de.paint,j,ae,v),ce.layout=E_(ce.layout,de.layout,j,ae,v);const ke=!z||z(j,de,ae);if(!ke)continue;const Ce=new I_(j,this.z,this.x,this.y,$);Ce.layer=ce;let Ge=e[ie];Ge===void 0&&(Ge=e[ie]=[]),Ge.push({featureIndex:h,feature:Ce,intersectionZ:ke})}}lookupSymbolFeatures(e,n,s,h,g,y,v,T){const k={};this.loadVTLayers();const P=Qs(g);for(const z of e)this.loadMatchingFeature(k,s,h,z,P,y,v,T,n);return k}hasLayer(e){for(const n of this.bucketLayerIDs)for(const s of n)if(e===s)return!0;return!1}getId(e,n){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof s=="boolean"&&(s=Number(s))),s}}function E_(i,e,n,s,h){return tt(i,(g,y)=>{const v=e instanceof cs?e.get(y):null;return v&&v.evaluate?v.evaluate(n,s,h):v})}function C_(i){let e=1/0,n=1/0,s=-1/0,h=-1/0;for(const g of i)e=Math.min(e,g.x),n=Math.min(n,g.y),s=Math.max(s,g.x),h=Math.max(h,g.y);return{minX:e,minY:n,maxX:s,maxY:h}}function kb(i,e){return e-i}function P_(i,e,n,s,h){const g=[];for(let y=0;y<i.length;y++){const v=i[y];let T;for(let k=0;k<v.length-1;k++){let P=v[k],z=v[k+1];P.x<e&&z.x<e||(P.x<e?P=new q(e,P.y+(e-P.x)/(z.x-P.x)*(z.y-P.y))._round():z.x<e&&(z=new q(e,P.y+(e-P.x)/(z.x-P.x)*(z.y-P.y))._round()),P.y<n&&z.y<n||(P.y<n?P=new q(P.x+(n-P.y)/(z.y-P.y)*(z.x-P.x),n)._round():z.y<n&&(z=new q(P.x+(n-P.y)/(z.y-P.y)*(z.x-P.x),n)._round()),P.x>=s&&z.x>=s||(P.x>=s?P=new q(s,P.y+(s-P.x)/(z.x-P.x)*(z.y-P.y))._round():z.x>=s&&(z=new q(s,P.y+(s-P.x)/(z.x-P.x)*(z.y-P.y))._round()),P.y>=h&&z.y>=h||(P.y>=h?P=new q(P.x+(h-P.y)/(z.y-P.y)*(z.x-P.x),h)._round():z.y>=h&&(z=new q(P.x+(h-P.y)/(z.y-P.y)*(z.x-P.x),h)._round()),T&&P.equals(T[T.length-1])||(T=[P],g.push(T)),T.push(z)))))}}return g}Ke("FeatureIndex",k_,{omit:["rawTileData","sourceLayerCoder"]});class Ea extends q{constructor(e,n,s,h){super(e,n),this.angle=s,h!==void 0&&(this.segment=h)}clone(){return new Ea(this.x,this.y,this.angle,this.segment)}}function M_(i,e,n,s,h){if(e.segment===void 0||n===0)return!0;let g=e,y=e.segment+1,v=0;for(;v>-n/2;){if(y--,y<0)return!1;v-=i[y].dist(g),g=i[y]}v+=i[y].dist(i[y+1]),y++;const T=[];let k=0;for(;v<n/2;){const P=i[y],z=i[y+1];if(!z)return!1;let R=i[y-1].angleTo(P)-P.angleTo(z);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:v,angleDelta:R}),k+=R;v-T[0].distance>s;)k-=T.shift().angleDelta;if(k>h)return!1;y++,v+=P.dist(z)}return!0}function z_(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function A_(i,e,n){return i?.6*e*n:0}function D_(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Eb(i,e,n,s,h,g){const y=A_(n,h,g),v=D_(n,s)*g;let T=0;const k=z_(i)/2;for(let P=0;P<i.length-1;P++){const z=i[P],R=i[P+1],B=z.dist(R);if(T+B>k){const j=(k-T)/B,$=ji.number(z.x,R.x,j),K=ji.number(z.y,R.y,j),ie=new Ea($,K,R.angleTo(z),P);return ie._round(),!y||M_(i,ie,v,y,e)?ie:void 0}T+=B}}function Cb(i,e,n,s,h,g,y,v,T){const k=A_(s,g,y),P=D_(s,h),z=P*y,R=i[0].x===0||i[0].x===T||i[0].y===0||i[0].y===T;return e-z<e/4&&(e=z+e/4),L_(i,R?e/2*v%e:(P/2+2*g)*y*v%e,e,k,n,z,R,!1,T)}function L_(i,e,n,s,h,g,y,v,T){const k=g/2,P=z_(i);let z=0,R=e-n,B=[];for(let j=0;j<i.length-1;j++){const $=i[j],K=i[j+1],ie=$.dist(K),de=K.angleTo($);for(;R+n<z+ie;){R+=n;const ae=(R-z)/ie,ce=ji.number($.x,K.x,ae),ke=ji.number($.y,K.y,ae);if(ce>=0&&ce<T&&ke>=0&&ke<T&&R-k>=0&&R+k<=P){const Ce=new Ea(ce,ke,de,j);Ce._round(),s&&!M_(i,Ce,g,s,h)||B.push(Ce)}}z+=ie}return v||B.length||y||(B=L_(i,z/2,n,s,h,g,y,!0,T)),B}Ke("Anchor",Ea);const xl=$i;function R_(i,e,n,s){const h=[],g=i.image,y=g.pixelRatio,v=g.paddedRect.w-2*xl,T=g.paddedRect.h-2*xl,k=i.right-i.left,P=i.bottom-i.top,z=g.stretchX||[[0,v]],R=g.stretchY||[[0,T]],B=(Be,Xe)=>Be+Xe[1]-Xe[0],j=z.reduce(B,0),$=R.reduce(B,0),K=v-j,ie=T-$;let de=0,ae=j,ce=0,ke=$,Ce=0,Ge=K,et=0,qe=ie;if(g.content&&s){const Be=g.content;de=fd(z,0,Be[0]),ce=fd(R,0,Be[1]),ae=fd(z,Be[0],Be[2]),ke=fd(R,Be[1],Be[3]),Ce=Be[0]-de,et=Be[1]-ce,Ge=Be[2]-Be[0]-ae,qe=Be[3]-Be[1]-ke}const $e=(Be,Xe,Ve,De)=>{const ot=md(Be.stretch-de,ae,k,i.left),rt=gd(Be.fixed-Ce,Ge,Be.stretch,j),Et=md(Xe.stretch-ce,ke,P,i.top),nr=gd(Xe.fixed-et,qe,Xe.stretch,$),sr=md(Ve.stretch-de,ae,k,i.left),Nr=gd(Ve.fixed-Ce,Ge,Ve.stretch,j),rn=md(De.stretch-ce,ke,P,i.top),Ci=gd(De.fixed-et,qe,De.stretch,$),Dr=new q(ot,Et),ei=new q(sr,Et),li=new q(sr,rn),Pi=new q(ot,rn),Mi=new q(rt/y,nr/y),jr=new q(Nr/y,Ci/y),Ur=e*Math.PI/180;if(Ur){const mi=Math.sin(Ur),Zi=Math.cos(Ur),qi=[Zi,-mi,mi,Zi];Dr._matMult(qi),ei._matMult(qi),Pi._matMult(qi),li._matMult(qi)}const fi=Be.stretch+Be.fixed,zi=Xe.stretch+Xe.fixed;return{tl:Dr,tr:ei,bl:Pi,br:li,tex:{x:g.paddedRect.x+xl+fi,y:g.paddedRect.y+xl+zi,w:Ve.stretch+Ve.fixed-fi,h:De.stretch+De.fixed-zi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mi,pixelOffsetBR:jr,minFontScaleX:Ge/y/k,minFontScaleY:qe/y/P,isSDF:n}};if(s&&(g.stretchX||g.stretchY)){const Be=F_(z,K,j),Xe=F_(R,ie,$);for(let Ve=0;Ve<Be.length-1;Ve++){const De=Be[Ve],ot=Be[Ve+1];for(let rt=0;rt<Xe.length-1;rt++)h.push($e(De,Xe[rt],ot,Xe[rt+1]))}}else h.push($e({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:T+1}));return h}function fd(i,e,n){let s=0;for(const h of i)s+=Math.max(e,Math.min(n,h[1]))-Math.max(e,Math.min(n,h[0]));return s}function F_(i,e,n){const s=[{fixed:-xl,stretch:0}];for(const[h,g]of i){const y=s[s.length-1];s.push({fixed:h-y.stretch,stretch:y.stretch}),s.push({fixed:h-y.stretch,stretch:y.stretch+(g-h)})}return s.push({fixed:e+xl,stretch:n}),s}function md(i,e,n,s){return i/e*n+s}function gd(i,e,n,s){return i-e*n/s}class yd{constructor(e,n,s,h,g,y,v,T,k,P){if(this.boxStartIndex=e.length,k){let z=y.top,R=y.bottom;const B=y.collisionPadding;B&&(z-=B[1],R+=B[3]);let j=R-z;j>0&&(j=Math.max(10,j),this.circleDiameter=j)}else{let z=y.top*v-T[0],R=y.bottom*v+T[2],B=y.left*v-T[3],j=y.right*v+T[1];const $=y.collisionPadding;if($&&(B-=$[0]*v,z-=$[1]*v,j+=$[2]*v,R+=$[3]*v),P){const K=new q(B,z),ie=new q(j,z),de=new q(B,R),ae=new q(j,R),ce=P*Math.PI/180;K._rotate(ce),ie._rotate(ce),de._rotate(ce),ae._rotate(ce),B=Math.min(K.x,ie.x,de.x,ae.x),j=Math.max(K.x,ie.x,de.x,ae.x),z=Math.min(K.y,ie.y,de.y,ae.y),R=Math.max(K.y,ie.y,de.y,ae.y)}e.emplaceBack(n.x,n.y,B,z,j,R,s,h,g)}this.boxEndIndex=e.length}}class Pb{constructor(e=[],n=Mb){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:s}=this,h=n[e];for(;e>0;){const g=e-1>>1,y=n[g];if(s(h,y)>=0)break;n[e]=y,e=g}n[e]=h}_down(e){const{data:n,compare:s}=this,h=this.length>>1,g=n[e];for(;e<h;){let y=1+(e<<1),v=n[y];const T=y+1;if(T<this.length&&s(n[T],v)<0&&(y=T,v=n[T]),s(v,g)>=0)break;n[e]=v,e=y}n[e]=g}}function Mb(i,e){return i<e?-1:i>e?1:0}function zb(i,e=1,n=!1){let s=1/0,h=1/0,g=-1/0,y=-1/0;const v=i[0];for(let B=0;B<v.length;B++){const j=v[B];(!B||j.x<s)&&(s=j.x),(!B||j.y<h)&&(h=j.y),(!B||j.x>g)&&(g=j.x),(!B||j.y>y)&&(y=j.y)}const T=Math.min(g-s,y-h);let k=T/2;const P=new Pb([],Ab);if(T===0)return new q(s,h);for(let B=s;B<g;B+=T)for(let j=h;j<y;j+=T)P.push(new wl(B+k,j+k,k,i));let z=function(B){let j=0,$=0,K=0;const ie=B[0];for(let de=0,ae=ie.length,ce=ae-1;de<ae;ce=de++){const ke=ie[de],Ce=ie[ce],Ge=ke.x*Ce.y-Ce.x*ke.y;$+=(ke.x+Ce.x)*Ge,K+=(ke.y+Ce.y)*Ge,j+=3*Ge}return new wl($/j,K/j,0,B)}(i),R=P.length;for(;P.length;){const B=P.pop();(B.d>z.d||!z.d)&&(z=B,n&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,R)),B.max-z.d<=e||(k=B.h/2,P.push(new wl(B.p.x-k,B.p.y-k,k,i)),P.push(new wl(B.p.x+k,B.p.y-k,k,i)),P.push(new wl(B.p.x-k,B.p.y+k,k,i)),P.push(new wl(B.p.x+k,B.p.y+k,k,i)),R+=4)}return n&&(console.log(`num probes: ${R}`),console.log(`best distance: ${z.d}`)),z.p}function Ab(i,e){return e.max-i.max}function wl(i,e,n,s){this.p=new q(i,e),this.h=n,this.d=function(h,g){let y=!1,v=1/0;for(let T=0;T<g.length;T++){const k=g[T];for(let P=0,z=k.length,R=z-1;P<z;R=P++){const B=k[P],j=k[R];B.y>h.y!=j.y>h.y&&h.x<(j.x-B.x)*(h.y-B.y)/(j.y-B.y)+B.x&&(y=!y),v=Math.min(v,vy(h,B,j))}}return(y?1:-1)*Math.sqrt(v)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}var si;x.ap=void 0,(si=x.ap||(x.ap={}))[si.center=1]="center",si[si.left=2]="left",si[si.right=3]="right",si[si.top=4]="top",si[si.bottom=5]="bottom",si[si["top-left"]=6]="top-left",si[si["top-right"]=7]="top-right",si[si["bottom-left"]=8]="bottom-left",si[si["bottom-right"]=9]="bottom-right";const Ca=7,zf=Number.POSITIVE_INFINITY;function B_(i,e){return e[1]!==zf?function(n,s,h){let g=0,y=0;switch(s=Math.abs(s),h=Math.abs(h),n){case"top-right":case"top-left":case"top":y=h-Ca;break;case"bottom-right":case"bottom-left":case"bottom":y=-h+Ca}switch(n){case"top-right":case"bottom-right":case"right":g=-s;break;case"top-left":case"bottom-left":case"left":g=s}return[g,y]}(i,e[0],e[1]):function(n,s){let h=0,g=0;s<0&&(s=0);const y=s/Math.SQRT2;switch(n){case"top-right":case"top-left":g=y-Ca;break;case"bottom-right":case"bottom-left":g=-y+Ca;break;case"bottom":g=-s+Ca;break;case"top":g=s-Ca}switch(n){case"top-right":case"bottom-right":h=-y;break;case"top-left":case"bottom-left":h=y;break;case"left":h=s;break;case"right":h=-s}return[h,g]}(i,e[0])}function O_(i,e,n){var s;const h=i.layout,g=(s=h.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(e,{},n);if(g){const v=g.values,T=[];for(let k=0;k<v.length;k+=2){const P=T[k]=v[k],z=v[k+1].map(R=>R*Or);P.startsWith("top")?z[1]-=Ca:P.startsWith("bottom")&&(z[1]+=Ca),T[k+1]=z}return new oi(T)}const y=h.get("text-variable-anchor");if(y){let v;v=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(e,{},n)*Or,zf]:h.get("text-offset").evaluate(e,{},n).map(k=>k*Or);const T=[];for(const k of y)T.push(k,B_(k,v));return new oi(T)}return null}function Af(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Db(i,e,n,s,h,g,y,v,T,k,P){let z=g.textMaxSize.evaluate(e,{});z===void 0&&(z=y);const R=i.layers[0].layout,B=R.get("icon-offset").evaluate(e,{},P),j=j_(n.horizontal),$=y/24,K=i.tilePixelRatio*$,ie=i.tilePixelRatio*z/24,de=i.tilePixelRatio*v,ae=i.tilePixelRatio*R.get("symbol-spacing"),ce=R.get("text-padding")*i.tilePixelRatio,ke=function(De,ot,rt,Et=1){const nr=De.get("icon-padding").evaluate(ot,{},rt),sr=nr&&nr.values;return[sr[0]*Et,sr[1]*Et,sr[2]*Et,sr[3]*Et]}(R,e,P,i.tilePixelRatio),Ce=R.get("text-max-angle")/180*Math.PI,Ge=R.get("text-rotation-alignment")!=="viewport"&&R.get("symbol-placement")!=="point",et=R.get("icon-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",qe=R.get("symbol-placement"),$e=ae/2,Be=R.get("icon-text-fit");let Xe;s&&Be!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(Xe=u_(s,n.vertical,Be,R.get("icon-text-fit-padding"),B,$)),j&&(s=u_(s,j,Be,R.get("icon-text-fit-padding"),B,$)));const Ve=(De,ot)=>{ot.x<0||ot.x>=Mt||ot.y<0||ot.y>=Mt||function(rt,Et,nr,sr,Nr,rn,Ci,Dr,ei,li,Pi,Mi,jr,Ur,fi,zi,mi,Zi,qi,Vr,At,gi,ui,$r,Bn){const Xn=rt.addToLineVertexArray(Et,nr);let Jn,Vo,On,_n,Gi=0,$o=0,uc=0,Z_=0,jf=-1,Uf=-1;const Zo={};let q_=Tt("");if(rt.allowVerticalPlacement&&sr.vertical){const yi=Dr.layout.get("text-rotate").evaluate(At,{},$r)+90;On=new yd(ei,Et,li,Pi,Mi,sr.vertical,jr,Ur,fi,yi),Ci&&(_n=new yd(ei,Et,li,Pi,Mi,Ci,mi,Zi,fi,yi))}if(Nr){const yi=Dr.layout.get("icon-rotate").evaluate(At,{}),vn=Dr.layout.get("icon-text-fit")!=="none",_s=R_(Nr,yi,ui,vn),eo=Ci?R_(Ci,yi,ui,vn):void 0;Vo=new yd(ei,Et,li,Pi,Mi,Nr,mi,Zi,!1,yi),Gi=4*_s.length;const vs=rt.iconSizeData;let _o=null;vs.kind==="source"?(_o=[yo*Dr.layout.get("icon-size").evaluate(At,{})],_o[0]>Ia&&Dt(`${rt.layerIds[0]}: Value for "icon-size" is >= ${oc}. Reduce your "icon-size".`)):vs.kind==="composite"&&(_o=[yo*gi.compositeIconSizes[0].evaluate(At,{},$r),yo*gi.compositeIconSizes[1].evaluate(At,{},$r)],(_o[0]>Ia||_o[1]>Ia)&&Dt(`${rt.layerIds[0]}: Value for "icon-size" is >= ${oc}. Reduce your "icon-size".`)),rt.addSymbols(rt.icon,_s,_o,Vr,qi,At,x.ah.none,Et,Xn.lineStartIndex,Xn.lineLength,-1,$r),jf=rt.icon.placedSymbolArray.length-1,eo&&($o=4*eo.length,rt.addSymbols(rt.icon,eo,_o,Vr,qi,At,x.ah.vertical,Et,Xn.lineStartIndex,Xn.lineLength,-1,$r),Uf=rt.icon.placedSymbolArray.length-1)}const G_=Object.keys(sr.horizontal);for(const yi of G_){const vn=sr.horizontal[yi];if(!Jn){q_=Tt(vn.text);const eo=Dr.layout.get("text-rotate").evaluate(At,{},$r);Jn=new yd(ei,Et,li,Pi,Mi,vn,jr,Ur,fi,eo)}const _s=vn.positionedLines.length===1;if(uc+=N_(rt,Et,vn,rn,Dr,fi,At,zi,Xn,sr.vertical?x.ah.horizontal:x.ah.horizontalOnly,_s?G_:[yi],Zo,jf,gi,$r),_s)break}sr.vertical&&(Z_+=N_(rt,Et,sr.vertical,rn,Dr,fi,At,zi,Xn,x.ah.vertical,["vertical"],Zo,Uf,gi,$r));const Fb=Jn?Jn.boxStartIndex:rt.collisionBoxArray.length,Bb=Jn?Jn.boxEndIndex:rt.collisionBoxArray.length,Ob=On?On.boxStartIndex:rt.collisionBoxArray.length,Nb=On?On.boxEndIndex:rt.collisionBoxArray.length,jb=Vo?Vo.boxStartIndex:rt.collisionBoxArray.length,Ub=Vo?Vo.boxEndIndex:rt.collisionBoxArray.length,Vb=_n?_n.boxStartIndex:rt.collisionBoxArray.length,$b=_n?_n.boxEndIndex:rt.collisionBoxArray.length;let Qn=-1;const vd=(yi,vn)=>yi&&yi.circleDiameter?Math.max(yi.circleDiameter,vn):vn;Qn=vd(Jn,Qn),Qn=vd(On,Qn),Qn=vd(Vo,Qn),Qn=vd(_n,Qn);const H_=Qn>-1?1:0;H_&&(Qn*=Bn/Or),rt.glyphOffsetArray.length>=vl.MAX_GLYPHS&&Dt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),At.sortKey!==void 0&&rt.addToSortKeyRanges(rt.symbolInstances.length,At.sortKey);const Zb=O_(Dr,At,$r),[qb,Gb]=function(yi,vn){const _s=yi.length,eo=vn==null?void 0:vn.values;if((eo==null?void 0:eo.length)>0)for(let vs=0;vs<eo.length;vs+=2){const _o=eo[vs+1];yi.emplaceBack(x.ap[eo[vs]],_o[0],_o[1])}return[_s,yi.length]}(rt.textAnchorOffsets,Zb);rt.symbolInstances.emplaceBack(Et.x,Et.y,Zo.right>=0?Zo.right:-1,Zo.center>=0?Zo.center:-1,Zo.left>=0?Zo.left:-1,Zo.vertical||-1,jf,Uf,q_,Fb,Bb,Ob,Nb,jb,Ub,Vb,$b,li,uc,Z_,Gi,$o,H_,0,jr,Qn,qb,Gb)}(i,ot,De,n,s,h,Xe,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,K,[ce,ce,ce,ce],Ge,T,de,ke,et,B,e,g,k,P,y)};if(qe==="line")for(const De of P_(e.geometry,0,0,Mt,Mt)){const ot=Cb(De,ae,Ce,n.vertical||j,s,24,ie,i.overscaling,Mt);for(const rt of ot)j&&Lb(i,j.text,$e,rt)||Ve(De,rt)}else if(qe==="line-center"){for(const De of e.geometry)if(De.length>1){const ot=Eb(De,Ce,n.vertical||j,s,24,ie);ot&&Ve(De,ot)}}else if(e.type==="Polygon")for(const De of cf(e.geometry,0)){const ot=zb(De,16);Ve(De[0],new Ea(ot.x,ot.y,0))}else if(e.type==="LineString")for(const De of e.geometry)Ve(De,new Ea(De[0].x,De[0].y,0));else if(e.type==="Point")for(const De of e.geometry)for(const ot of De)Ve([ot],new Ea(ot.x,ot.y,0))}function N_(i,e,n,s,h,g,y,v,T,k,P,z,R,B,j){const $=function(de,ae,ce,ke,Ce,Ge,et,qe){const $e=ke.layout.get("text-rotate").evaluate(Ge,{})*Math.PI/180,Be=[];for(const Xe of ae.positionedLines)for(const Ve of Xe.positionedGlyphs){if(!Ve.rect)continue;const De=Ve.rect||{};let ot=r_+1,rt=!0,Et=1,nr=0;const sr=(Ce||qe)&&Ve.vertical,Nr=Ve.metrics.advance*Ve.scale/2;if(qe&&ae.verticalizable&&(nr=Xe.lineOffset/2-(Ve.imageName?-(Or-Ve.metrics.width*Ve.scale)/2:(Ve.scale-1)*Or)),Ve.imageName){const Vr=et[Ve.imageName];rt=Vr.sdf,Et=Vr.pixelRatio,ot=$i/Et}const rn=Ce?[Ve.x+Nr,Ve.y]:[0,0];let Ci=Ce?[0,0]:[Ve.x+Nr+ce[0],Ve.y+ce[1]-nr],Dr=[0,0];sr&&(Dr=Ci,Ci=[0,0]);const ei=Ve.metrics.isDoubleResolution?2:1,li=(Ve.metrics.left-ot)*Ve.scale-Nr+Ci[0],Pi=(-Ve.metrics.top-ot)*Ve.scale+Ci[1],Mi=li+De.w/ei*Ve.scale/Et,jr=Pi+De.h/ei*Ve.scale/Et,Ur=new q(li,Pi),fi=new q(Mi,Pi),zi=new q(li,jr),mi=new q(Mi,jr);if(sr){const Vr=new q(-Nr,Nr-ic),At=-Math.PI/2,gi=Or/2-Nr,ui=new q(5-ic-gi,-(Ve.imageName?gi:0)),$r=new q(...Dr);Ur._rotateAround(At,Vr)._add(ui)._add($r),fi._rotateAround(At,Vr)._add(ui)._add($r),zi._rotateAround(At,Vr)._add(ui)._add($r),mi._rotateAround(At,Vr)._add(ui)._add($r)}if($e){const Vr=Math.sin($e),At=Math.cos($e),gi=[At,-Vr,Vr,At];Ur._matMult(gi),fi._matMult(gi),zi._matMult(gi),mi._matMult(gi)}const Zi=new q(0,0),qi=new q(0,0);Be.push({tl:Ur,tr:fi,bl:zi,br:mi,tex:De,writingMode:ae.writingMode,glyphOffset:rn,sectionIndex:Ve.sectionIndex,isSDF:rt,pixelOffsetTL:Zi,pixelOffsetBR:qi,minFontScaleX:0,minFontScaleY:0})}return Be}(0,n,v,h,g,y,s,i.allowVerticalPlacement),K=i.textSizeData;let ie=null;K.kind==="source"?(ie=[yo*h.layout.get("text-size").evaluate(y,{})],ie[0]>Ia&&Dt(`${i.layerIds[0]}: Value for "text-size" is >= ${oc}. Reduce your "text-size".`)):K.kind==="composite"&&(ie=[yo*B.compositeTextSizes[0].evaluate(y,{},j),yo*B.compositeTextSizes[1].evaluate(y,{},j)],(ie[0]>Ia||ie[1]>Ia)&&Dt(`${i.layerIds[0]}: Value for "text-size" is >= ${oc}. Reduce your "text-size".`)),i.addSymbols(i.text,$,ie,v,g,y,k,e,T.lineStartIndex,T.lineLength,R,j);for(const de of P)z[de]=i.text.placedSymbolArray.length-1;return 4*$.length}function j_(i){for(const e in i)return i[e];return null}function Lb(i,e,n,s){const h=i.compareText;if(e in h){const g=h[e];for(let y=g.length-1;y>=0;y--)if(s.dist(g[y])<n)return!0}else h[e]=[];return h[e].push(s),!1}const U_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Df{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,s]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=s>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const g=U_[15&s];if(!g)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new Df(v,y,g,e)}constructor(e,n=64,s=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const g=U_.indexOf(this.ArrayType),y=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-v%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${s}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+y+v+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=n,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Lf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,s,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:y,nodeSize:v}=this,T=[0,g.length-1,0],k=[];for(;T.length;){const P=T.pop()||0,z=T.pop()||0,R=T.pop()||0;if(z-R<=v){for(let K=R;K<=z;K++){const ie=y[2*K],de=y[2*K+1];ie>=e&&ie<=s&&de>=n&&de<=h&&k.push(g[K])}continue}const B=R+z>>1,j=y[2*B],$=y[2*B+1];j>=e&&j<=s&&$>=n&&$<=h&&k.push(g[B]),(P===0?e<=j:n<=$)&&(T.push(R),T.push(B-1),T.push(1-P)),(P===0?s>=j:h>=$)&&(T.push(B+1),T.push(z),T.push(1-P))}return k}within(e,n,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:y}=this,v=[0,h.length-1,0],T=[],k=s*s;for(;v.length;){const P=v.pop()||0,z=v.pop()||0,R=v.pop()||0;if(z-R<=y){for(let K=R;K<=z;K++)$_(g[2*K],g[2*K+1],e,n)<=k&&T.push(h[K]);continue}const B=R+z>>1,j=g[2*B],$=g[2*B+1];$_(j,$,e,n)<=k&&T.push(h[B]),(P===0?e-s<=j:n-s<=$)&&(v.push(R),v.push(B-1),v.push(1-P)),(P===0?e+s>=j:n+s>=$)&&(v.push(B+1),v.push(z),v.push(1-P))}return T}}function Lf(i,e,n,s,h,g){if(h-s<=n)return;const y=s+h>>1;V_(i,e,y,s,h,g),Lf(i,e,n,s,y-1,1-g),Lf(i,e,n,y+1,h,1-g)}function V_(i,e,n,s,h,g){for(;h>s;){if(h-s>600){const k=h-s+1,P=n-s+1,z=Math.log(k),R=.5*Math.exp(2*z/3),B=.5*Math.sqrt(z*R*(k-R)/k)*(P-k/2<0?-1:1);V_(i,e,n,Math.max(s,Math.floor(n-P*R/k+B)),Math.min(h,Math.floor(n+(k-P)*R/k+B)),g)}const y=e[2*n+g];let v=s,T=h;for(sc(i,e,s,n),e[2*h+g]>y&&sc(i,e,s,h);v<T;){for(sc(i,e,v,T),v++,T--;e[2*v+g]<y;)v++;for(;e[2*T+g]>y;)T--}e[2*s+g]===y?sc(i,e,s,T):(T++,sc(i,e,T,h)),T<=n&&(s=T+1),n<=T&&(h=T-1)}}function sc(i,e,n,s){Rf(i,n,s),Rf(e,2*n,2*s),Rf(e,2*n+1,2*s+1)}function Rf(i,e,n){const s=i[e];i[e]=i[n],i[n]=s}function $_(i,e,n,s){const h=i-n,g=e-s;return h*h+g*g}var Ff;x.bd=void 0,(Ff=x.bd||(x.bd={})).create="create",Ff.load="load",Ff.fullLoad="fullLoad";let _d=null,lc=[];const Bf=1e3/60,Of="loadTime",Nf="fullLoadTime",Rb={mark(i){performance.mark(i)},frame(i){const e=i;_d!=null&&lc.push(e-_d),_d=e},clearMetrics(){_d=null,lc=[],performance.clearMeasures(Of),performance.clearMeasures(Nf);for(const i in x.bd)performance.clearMarks(x.bd[i])},getPerformanceMetrics(){performance.measure(Of,x.bd.create,x.bd.load),performance.measure(Nf,x.bd.create,x.bd.fullLoad);const i=performance.getEntriesByName(Of)[0].duration,e=performance.getEntriesByName(Nf)[0].duration,n=lc.length,s=1/(lc.reduce((g,y)=>g+y,0)/n/1e3),h=lc.filter(g=>g>Bf).reduce((g,y)=>g+(y-Bf)/Bf,0);return{loadTime:i,fullLoadTime:e,fps:s,percentDroppedFrames:h/(n+h)*100,totalFrames:n}}};x.$=ze,x.A=pl,x.B=function(i){if(Vt==null){const e=i.navigator?i.navigator.userAgent:null;Vt=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Vt},x.C=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Ib(()=>this.process()),this.subscription=function(n,s,h,g){return n.addEventListener(s,h,!1),{unsubscribe:()=>{n.removeEventListener(s,h,!1)}}}(this.target,"message",n=>this.receive(n)),this.globalScope=Gr(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}sendAsync(i,e){return new Promise((n,s)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[h]={resolve:n,reject:s},e&&e.signal.addEventListener("abort",()=>{delete this.resolveRejects[h];const v={id:h,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(v)},{once:!0});const g=[],y=Object.assign(Object.assign({},i),{id:h,sourceMapId:this.mapId,origin:location.origin,data:Ao(i.data,g)});this.target.postMessage(y,{transfer:g})})}receive(i){const e=i.data,n=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[n];const s=this.abortControllers[n];return delete this.abortControllers[n],void(s&&s.abort())}if(Gr(self)||e.mustQueue)return this.tasks[n]=e,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return d(this,void 0,void 0,function*(){if(e.type==="<response>"){const h=this.resolveRejects[i];return delete this.resolveRejects[i],h?void(e.error?h.reject(_a(e.error)):h.resolve(_a(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=_a(e.data),s=new AbortController;this.abortControllers[i]=s;try{const h=yield this.messageHandlers[e.type](e.sourceMapId,n,s);this.completeTask(i,null,h)}catch(h){this.completeTask(i,h)}})}completeTask(i,e,n){const s=[];delete this.abortControllers[i];const h={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Ao(e):null,data:Ao(n,s)};this.target.postMessage(h,{transfer:s})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},x.D=it,x.E=Gn,x.F=function(){var i=new pl(16);return pl!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},x.G=Pr,x.H=function(i,e,n){var s,h,g,y,v,T,k,P,z,R,B,j,$=n[0],K=n[1],ie=n[2];return e===i?(i[12]=e[0]*$+e[4]*K+e[8]*ie+e[12],i[13]=e[1]*$+e[5]*K+e[9]*ie+e[13],i[14]=e[2]*$+e[6]*K+e[10]*ie+e[14],i[15]=e[3]*$+e[7]*K+e[11]*ie+e[15]):(h=e[1],g=e[2],y=e[3],v=e[4],T=e[5],k=e[6],P=e[7],z=e[8],R=e[9],B=e[10],j=e[11],i[0]=s=e[0],i[1]=h,i[2]=g,i[3]=y,i[4]=v,i[5]=T,i[6]=k,i[7]=P,i[8]=z,i[9]=R,i[10]=B,i[11]=j,i[12]=s*$+v*K+z*ie+e[12],i[13]=h*$+T*K+R*ie+e[13],i[14]=g*$+k*K+B*ie+e[14],i[15]=y*$+P*K+j*ie+e[15]),i},x.I=xf,x.J=function(i,e,n){var s=n[0],h=n[1],g=n[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*h,i[5]=e[5]*h,i[6]=e[6]*h,i[7]=e[7]*h,i[8]=e[8]*g,i[9]=e[9]*g,i[10]=e[10]*g,i[11]=e[11]*g,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},x.K=Sy,x.L=function(i,e){const n={};for(let s=0;s<e.length;s++){const h=e[s];h in i&&(n[h]=i[h])}return n},x.M=ka,x.N=__,x.O=v_,x.P=q,x.Q=yn,x.R=gn,x.S=ne,x.T=zu,x.U=te,x.V=ht,x.W=Mt,x.X=Tr,x.Y=pd,x.Z=class extends mo{},x._=d,x.a=Br,x.a$=function(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i},x.a0=Mf,x.a1=Re,x.a2=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(n=>{e.onloadstart=()=>{n(e)};for(const s of i){const h=window.document.createElement("source");Wr(s)||(e.crossOrigin="Anonymous"),h.src=s,e.appendChild(h)}})},x.a3=function(){return Ze++},x.a4=Yh,x.a5=vl,x.a6=Qs,x.a7=No,x.a8=rr,x.a9=I_,x.aA=vt,x.aB=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let n=[];try{if(!Pt(i.version,e.version))return[{command:"setStyle",args:[e]}];Pt(i.center,e.center)||n.push({command:"setCenter",args:[e.center]}),Pt(i.zoom,e.zoom)||n.push({command:"setZoom",args:[e.zoom]}),Pt(i.bearing,e.bearing)||n.push({command:"setBearing",args:[e.bearing]}),Pt(i.pitch,e.pitch)||n.push({command:"setPitch",args:[e.pitch]}),Pt(i.sprite,e.sprite)||n.push({command:"setSprite",args:[e.sprite]}),Pt(i.glyphs,e.glyphs)||n.push({command:"setGlyphs",args:[e.glyphs]}),Pt(i.transition,e.transition)||n.push({command:"setTransition",args:[e.transition]}),Pt(i.light,e.light)||n.push({command:"setLight",args:[e.light]}),Pt(i.terrain,e.terrain)||n.push({command:"setTerrain",args:[e.terrain]}),Pt(i.sky,e.sky)||n.push({command:"setSky",args:[e.sky]});const s={},h=[];(function(y,v,T,k){let P;for(P in v=v||{},y=y||{})Object.prototype.hasOwnProperty.call(y,P)&&(Object.prototype.hasOwnProperty.call(v,P)||Cn(P,T,k));for(P in v)Object.prototype.hasOwnProperty.call(v,P)&&(Object.prototype.hasOwnProperty.call(y,P)?Pt(y[P],v[P])||(y[P].type==="geojson"&&v[P].type==="geojson"&&Xi(y,v,P)?dr(T,{command:"setGeoJSONSourceData",args:[P,v[P].data]}):di(P,v,T,k)):Bi(P,v,T))})(i.sources,e.sources,h,s);const g=[];i.layers&&i.layers.forEach(y=>{"source"in y&&s[y.source]?n.push({command:"removeLayer",args:[y.id]}):g.push(y)}),n=n.concat(h),function(y,v,T){v=v||[];const k=(y=y||[]).map(cn),P=v.map(cn),z=y.reduce(Io,{}),R=v.reduce(Io,{}),B=k.slice(),j=Object.create(null);let $,K,ie,de,ae;for(let ce=0,ke=0;ce<k.length;ce++)$=k[ce],Object.prototype.hasOwnProperty.call(R,$)?ke++:(dr(T,{command:"removeLayer",args:[$]}),B.splice(B.indexOf($,ke),1));for(let ce=0,ke=0;ce<P.length;ce++)$=P[P.length-1-ce],B[B.length-1-ce]!==$&&(Object.prototype.hasOwnProperty.call(z,$)?(dr(T,{command:"removeLayer",args:[$]}),B.splice(B.lastIndexOf($,B.length-ke),1)):ke++,de=B[B.length-ce],dr(T,{command:"addLayer",args:[R[$],de]}),B.splice(B.length-ce,0,$),j[$]=!0);for(let ce=0;ce<P.length;ce++)if($=P[ce],K=z[$],ie=R[$],!j[$]&&!Pt(K,ie))if(Pt(K.source,ie.source)&&Pt(K["source-layer"],ie["source-layer"])&&Pt(K.type,ie.type)){for(ae in Pn(K.layout,ie.layout,T,$,null,"setLayoutProperty"),Pn(K.paint,ie.paint,T,$,null,"setPaintProperty"),Pt(K.filter,ie.filter)||dr(T,{command:"setFilter",args:[$,ie.filter]}),Pt(K.minzoom,ie.minzoom)&&Pt(K.maxzoom,ie.maxzoom)||dr(T,{command:"setLayerZoomRange",args:[$,ie.minzoom,ie.maxzoom]}),K)Object.prototype.hasOwnProperty.call(K,ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&(ae.indexOf("paint.")===0?Pn(K[ae],ie[ae],T,$,ae.slice(6),"setPaintProperty"):Pt(K[ae],ie[ae])||dr(T,{command:"setLayerProperty",args:[$,ae,ie[ae]]}));for(ae in ie)Object.prototype.hasOwnProperty.call(ie,ae)&&!Object.prototype.hasOwnProperty.call(K,ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&(ae.indexOf("paint.")===0?Pn(K[ae],ie[ae],T,$,ae.slice(6),"setPaintProperty"):Pt(K[ae],ie[ae])||dr(T,{command:"setLayerProperty",args:[$,ae,ie[ae]]}))}else dr(T,{command:"removeLayer",args:[$]}),de=B[B.lastIndexOf($)+1],dr(T,{command:"addLayer",args:[ie,de]})}(g,e.layers,n)}catch(s){console.warn("Unable to compute style diff:",s),n=[{command:"setStyle",args:[e]}]}return n},x.aC=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},x.aD=function i(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(!i(e[s],n[s]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const s in e)if(!i(e[s],n[s]))return!1;return!0}return e===n},x.aE=tt,x.aF=ct,x.aG=class extends er{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},x.aH=ai,x.aI=class extends er{constructor(i,e){super(i,e),this.current=Fo}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},x.aJ=fn,x.aK=class extends er{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},x.aL=class extends er{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},x.aM=Rn,x.aN=function(i,e,n,s,h,g,y){var v=1/(e-n),T=1/(s-h),k=1/(g-y);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*T,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*k,i[11]=0,i[12]=(e+n)*v,i[13]=(h+s)*T,i[14]=(y+g)*k,i[15]=1,i},x.aO=Ft,x.aP=ow,x.aQ=class extends fs{},x.aR=Qw,x.aS=class extends xa{},x.aT=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},x.aU=Cy,x.aV=A,x.aW=class extends Uu{},x.aX=ye,x.aY=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},x.aZ=function(i,e){var n=i[0],s=i[1],h=i[2],g=i[3],y=i[4],v=i[5],T=i[6],k=i[7],P=i[8],z=i[9],R=i[10],B=i[11],j=i[12],$=i[13],K=i[14],ie=i[15],de=e[0],ae=e[1],ce=e[2],ke=e[3],Ce=e[4],Ge=e[5],et=e[6],qe=e[7],$e=e[8],Be=e[9],Xe=e[10],Ve=e[11],De=e[12],ot=e[13],rt=e[14],Et=e[15];return Math.abs(n-de)<=Ei*Math.max(1,Math.abs(n),Math.abs(de))&&Math.abs(s-ae)<=Ei*Math.max(1,Math.abs(s),Math.abs(ae))&&Math.abs(h-ce)<=Ei*Math.max(1,Math.abs(h),Math.abs(ce))&&Math.abs(g-ke)<=Ei*Math.max(1,Math.abs(g),Math.abs(ke))&&Math.abs(y-Ce)<=Ei*Math.max(1,Math.abs(y),Math.abs(Ce))&&Math.abs(v-Ge)<=Ei*Math.max(1,Math.abs(v),Math.abs(Ge))&&Math.abs(T-et)<=Ei*Math.max(1,Math.abs(T),Math.abs(et))&&Math.abs(k-qe)<=Ei*Math.max(1,Math.abs(k),Math.abs(qe))&&Math.abs(P-$e)<=Ei*Math.max(1,Math.abs(P),Math.abs($e))&&Math.abs(z-Be)<=Ei*Math.max(1,Math.abs(z),Math.abs(Be))&&Math.abs(R-Xe)<=Ei*Math.max(1,Math.abs(R),Math.abs(Xe))&&Math.abs(B-Ve)<=Ei*Math.max(1,Math.abs(B),Math.abs(Ve))&&Math.abs(j-De)<=Ei*Math.max(1,Math.abs(j),Math.abs(De))&&Math.abs($-ot)<=Ei*Math.max(1,Math.abs($),Math.abs(ot))&&Math.abs(K-rt)<=Ei*Math.max(1,Math.abs(K),Math.abs(rt))&&Math.abs(ie-Et)<=Ei*Math.max(1,Math.abs(ie),Math.abs(Et))},x.a_=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},x.aa=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,s,h,g)=>{const y=h||g;return e[s]=!y||y.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},x.ab=function(i,e){const n=[];for(const s in i)s in e||n.push(s);return n},x.ac=Ne,x.ad=function(i,e,n){var s=Math.sin(n),h=Math.cos(n),g=e[0],y=e[1],v=e[2],T=e[3],k=e[4],P=e[5],z=e[6],R=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=g*h+k*s,i[1]=y*h+P*s,i[2]=v*h+z*s,i[3]=T*h+R*s,i[4]=k*h-g*s,i[5]=P*h-y*s,i[6]=z*h-v*s,i[7]=R*h-T*s,i},x.ae=function(i){var e=new pl(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},x.af=rd,x.ag=function(i,e){let n=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:h,minZoom:g,maxZoom:y}=i,v=h?Ne(pi.interpolationFactor(h,e,g,y),0,1):0;i.kind==="camera"?s=ji.number(i.minSize,i.maxSize,v):n=v}return{uSizeT:n,uSize:s}},x.ai=function(i,{uSize:e,uSizeT:n},{lowerSize:s,upperSize:h}){return i.kind==="source"?s/yo:i.kind==="composite"?ji.number(s/yo,h/yo,n):e},x.aj=Tf,x.ak=function(i,e,n,s){const h=e.y-i.y,g=e.x-i.x,y=s.y-n.y,v=s.x-n.x,T=y*g-v*h;if(T===0)return null;const k=(v*(i.y-n.y)-y*(i.x-n.x))/T;return new q(i.x+k*g,i.y+k*h)},x.al=P_,x.am=jo,x.an=rf,x.ao=Or,x.aq=Sf,x.ar=function(i,e){var n=e[0],s=e[1],h=e[2],g=e[3],y=e[4],v=e[5],T=e[6],k=e[7],P=e[8],z=e[9],R=e[10],B=e[11],j=e[12],$=e[13],K=e[14],ie=e[15],de=n*v-s*y,ae=n*T-h*y,ce=n*k-g*y,ke=s*T-h*v,Ce=s*k-g*v,Ge=h*k-g*T,et=P*$-z*j,qe=P*K-R*j,$e=P*ie-B*j,Be=z*K-R*$,Xe=z*ie-B*$,Ve=R*ie-B*K,De=de*Ve-ae*Xe+ce*Be+ke*$e-Ce*qe+Ge*et;return De?(i[0]=(v*Ve-T*Xe+k*Be)*(De=1/De),i[1]=(h*Xe-s*Ve-g*Be)*De,i[2]=($*Ge-K*Ce+ie*ke)*De,i[3]=(R*Ce-z*Ge-B*ke)*De,i[4]=(T*$e-y*Ve-k*qe)*De,i[5]=(n*Ve-h*$e+g*qe)*De,i[6]=(K*ce-j*Ge-ie*ae)*De,i[7]=(P*Ge-R*ce+B*ae)*De,i[8]=(y*Xe-v*$e+k*et)*De,i[9]=(s*$e-n*Xe-g*et)*De,i[10]=(j*Ce-$*ce+ie*de)*De,i[11]=(z*ce-P*Ce-B*de)*De,i[12]=(v*qe-y*Be-T*et)*De,i[13]=(n*Be-s*qe+h*et)*De,i[14]=($*ae-j*ke-K*de)*De,i[15]=(P*ke-z*ae+R*de)*De,i):null},x.as=Af,x.at=bf,x.au=Df,x.av=function(){const i={},e=Ie.$version;for(const n in Ie.$root){const s=Ie.$root[n];if(s.required){let h=null;h=n==="version"?e:s.type==="array"?[]:{},h!=null&&(i[n]=h)}}return i},x.aw=Eu,x.ax=uo,x.ay=function(i){i=i.slice();const e=Object.create(null);for(let n=0;n<i.length;n++)e[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=To(i[n],e[i[n].ref]));return i},x.az=function(i){if(i.type==="custom")return new Tb(i);switch(i.type){case"background":return new wb(i);case"circle":return new aw(i);case"fill":return new kw(i);case"fill-extrusion":return new Uw(i);case"heatmap":return new lw(i);case"hillshade":return new cw(i);case"line":return new Yw(i);case"raster":return new Sb(i);case"symbol":return new dd(i)}},x.b=We,x.b0=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},x.b1=pe,x.b2=b_,x.b3=x_,x.b4=function(i,e,n,s,h){var g,y=1/Math.tan(e/2);return i[0]=y/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=(h+s)*(g=1/(s-h)),i[14]=2*h*s*g):(i[10]=-1,i[14]=-2*s),i},x.b5=function(i,e,n){var s=Math.sin(n),h=Math.cos(n),g=e[4],y=e[5],v=e[6],T=e[7],k=e[8],P=e[9],z=e[10],R=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=g*h+k*s,i[5]=y*h+P*s,i[6]=v*h+z*s,i[7]=T*h+R*s,i[8]=k*h-g*s,i[9]=P*h-y*s,i[10]=z*h-v*s,i[11]=R*h-T*s,i},x.b6=ue,x.b7=Te,x.b8=function(i){return i*Math.PI/180},x.b9=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},x.bA=Do,x.ba=class extends al{},x.bb=Cf,x.bc=Rb,x.be=Fi,x.bf=function(i,e){Br.REGISTERED_PROTOCOLS[i]=e},x.bg=function(i){delete Br.REGISTERED_PROTOCOLS[i]},x.bh=function(i,e){const n={};for(let h=0;h<i.length;h++){const g=e&&e[i[h].id]||Qp(i[h]);e&&(e[i[h].id]=g);let y=n[g];y||(y=n[g]=[]),y.push(i[h])}const s=[];for(const h in n)s.push(n[h]);return s},x.bi=Ke,x.bj=T_,x.bk=k_,x.bl=n_,x.bm=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Mt/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],n=e.layout,s=e._unevaluatedLayout._values,h={layoutIconSize:s["icon-size"].possiblyEvaluate(new rr(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new rr(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new rr(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:P}=i.bucket.textSizeData;h.compositeTextSizes=[s["text-size"].possiblyEvaluate(new rr(k),i.canonical),s["text-size"].possiblyEvaluate(new rr(P),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:P}=i.bucket.iconSizeData;h.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new rr(k),i.canonical),s["icon-size"].possiblyEvaluate(new rr(P),i.canonical)]}const g=n.get("text-line-height")*Or,y=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",v=n.get("text-keep-upright"),T=n.get("text-size");for(const k of i.bucket.features){const P=n.get("text-font").evaluate(k,{},i.canonical).join(","),z=T.evaluate(k,{},i.canonical),R=h.layoutTextSize.evaluate(k,{},i.canonical),B=h.layoutIconSize.evaluate(k,{},i.canonical),j={horizontal:{},vertical:void 0},$=k.text;let K,ie=[0,0];if($){const ce=$.toString(),ke=n.get("text-letter-spacing").evaluate(k,{},i.canonical)*Or,Ce=rl(ce)?ke:0,Ge=n.get("text-anchor").evaluate(k,{},i.canonical),et=O_(e,k,i.canonical);if(!et){const Ve=n.get("text-radial-offset").evaluate(k,{},i.canonical);ie=Ve?B_(Ge,[Ve*Or,zf]):n.get("text-offset").evaluate(k,{},i.canonical).map(De=>De*Or)}let qe=y?"center":n.get("text-justify").evaluate(k,{},i.canonical);const $e=n.get("symbol-placement"),Be=$e==="point"?n.get("text-max-width").evaluate(k,{},i.canonical)*Or:0,Xe=()=>{i.bucket.allowVerticalPlacement&&us(ce)&&(j.vertical=ud($,i.glyphMap,i.glyphPositions,i.imagePositions,P,Be,g,Ge,"left",Ce,ie,x.ah.vertical,!0,$e,R,z))};if(!y&&et){const Ve=new Set;if(qe==="auto")for(let ot=0;ot<et.values.length;ot+=2)Ve.add(Af(et.values[ot]));else Ve.add(qe);let De=!1;for(const ot of Ve)if(!j.horizontal[ot])if(De)j.horizontal[ot]=j.horizontal[0];else{const rt=ud($,i.glyphMap,i.glyphPositions,i.imagePositions,P,Be,g,"center",ot,Ce,ie,x.ah.horizontal,!1,$e,R,z);rt&&(j.horizontal[ot]=rt,De=rt.positionedLines.length===1)}Xe()}else{qe==="auto"&&(qe=Af(Ge));const Ve=ud($,i.glyphMap,i.glyphPositions,i.imagePositions,P,Be,g,Ge,qe,Ce,ie,x.ah.horizontal,!1,$e,R,z);Ve&&(j.horizontal[qe]=Ve),Xe(),us(ce)&&y&&v&&(j.vertical=ud($,i.glyphMap,i.glyphPositions,i.imagePositions,P,Be,g,Ge,qe,Ce,ie,x.ah.vertical,!1,$e,R,z))}}let de=!1;if(k.icon&&k.icon.name){const ce=i.imageMap[k.icon.name];ce&&(K=gb(i.imagePositions[k.icon.name],n.get("icon-offset").evaluate(k,{},i.canonical),n.get("icon-anchor").evaluate(k,{},i.canonical)),de=!!ce.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=de:i.bucket.sdfIcons!==de&&Dt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ce.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ae=j_(j.horizontal)||j.vertical;i.bucket.iconsInText=!!ae&&ae.iconsInText,(ae||K)&&Db(i.bucket,k,j,K,i.imageMap,h,R,B,ie,de,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},x.bn=gf,x.bo=pf,x.bp=mf,x.bq=Sa,x.br=_f,x.bs=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},x.bt=function(i,e,n,s,h){return d(this,void 0,void 0,function*(){if(te())try{return yield ht(i,e,n,s,h)}catch{}return function(g,y,v,T,k){const P=g.width,z=g.height;xt&&Ct||(xt=new OffscreenCanvas(P,z),Ct=xt.getContext("2d",{willReadFrequently:!0})),xt.width=P,xt.height=z,Ct.drawImage(g,0,0,P,z);const R=Ct.getImageData(y,v,T,k);return Ct.clearRect(0,0,P,z),R.data}(i,e,n,s,h)})},x.bu=S_,x.bv=F,x.bw=Z,x.bx=Yy,x.by=Yt,x.bz=function(i){return i.message===Hr},x.c=Wt,x.d=i=>d(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),x.e=Me,x.f=i=>new Promise((e,n)=>{const s=new Image;s.onload=()=>{e(s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame(()=>{s.src=pt})},s.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(i)],{type:"image/png"});s.src=i.byteLength?URL.createObjectURL(h):pt}),x.g=or,x.h=(i,e)=>kn(Me(i,{type:"json"}),e),x.i=Gr,x.j=Xt,x.k=En,x.l=(i,e)=>kn(Me(i,{type:"arrayBuffer"}),e),x.m=kn,x.n=function(i){return new _f(i).readFields(cb,[])},x.o=Yu,x.p=i_,x.q=Ii,x.r=Tu,x.s=Wr,x.t=Vh,x.u=He,x.v=Ie,x.w=Dt,x.x=ya,x.y=function([i,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(n),y:i*Math.sin(e)*Math.sin(n),z:i*Math.cos(n)}},x.z=ji}),_("worker",["./shared"],function(x){class d{constructor(E){this.keyCache={},E&&this.replace(E)}replace(E){this._layerConfigs={},this._layers={},this.update(E,[])}update(E,M){for(const O of E){this._layerConfigs[O.id]=O;const X=this._layers[O.id]=x.az(O);X._featureFilter=x.a6(X.filter),this.keyCache[O.id]&&delete this.keyCache[O.id]}for(const O of M)delete this.keyCache[O],delete this._layerConfigs[O],delete this._layers[O];this.familiesBySource={};const D=x.bh(Object.values(this._layerConfigs),this.keyCache);for(const O of D){const X=O.map(ve=>this._layers[ve.id]),re=X[0];if(re.visibility==="none")continue;const oe=re.source||"";let W=this.familiesBySource[oe];W||(W=this.familiesBySource[oe]={});const se=re.sourceLayer||"_geojsonTileLayer";let _e=W[se];_e||(_e=W[se]=[]),_e.push(X)}}}class F{constructor(E){const M={},D=[];for(const oe in E){const W=E[oe],se=M[oe]={};for(const _e in W){const ve=W[+_e];if(!ve||ve.bitmap.width===0||ve.bitmap.height===0)continue;const fe={x:0,y:0,w:ve.bitmap.width+2,h:ve.bitmap.height+2};D.push(fe),se[_e]={rect:fe,metrics:ve.metrics}}}const{w:O,h:X}=x.p(D),re=new x.o({width:O||1,height:X||1});for(const oe in E){const W=E[oe];for(const se in W){const _e=W[+se];if(!_e||_e.bitmap.width===0||_e.bitmap.height===0)continue;const ve=M[oe][se].rect;x.o.copy(_e.bitmap,re,{x:0,y:0},{x:ve.x+1,y:ve.y+1},_e.bitmap)}}this.image=re,this.positions=M}}x.bi("GlyphAtlas",F);class Z{constructor(E){this.tileID=new x.Q(E.tileID.overscaledZ,E.tileID.wrap,E.tileID.canonical.z,E.tileID.canonical.x,E.tileID.canonical.y),this.uid=E.uid,this.zoom=E.zoom,this.pixelRatio=E.pixelRatio,this.tileSize=E.tileSize,this.source=E.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=E.showCollisionBoxes,this.collectResourceTiming=!!E.collectResourceTiming,this.returnDependencies=!!E.returnDependencies,this.promoteId=E.promoteId,this.inFlightDependencies=[]}parse(E,M,D,O){return x._(this,void 0,void 0,function*(){this.status="parsing",this.data=E,this.collisionBoxArray=new x.a4;const X=new x.bj(Object.keys(E.layers).sort()),re=new x.bk(this.tileID,this.promoteId);re.bucketLayerIDs=[];const oe={},W={featureIndex:re,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:D},se=M.familiesBySource[this.source];for(const dt in se){const Jt=E.layers[dt];if(!Jt)continue;Jt.version===1&&x.w(`Vector tile source "${this.source}" layer "${dt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ur=X.encode(dt),Yr=[];for(let pr=0;pr<Jt.length;pr++){const Mr=Jt.feature(pr),bt=re.getId(Mr,dt);Yr.push({feature:Mr,id:bt,index:pr,sourceLayerIndex:ur})}for(const pr of se[dt]){const Mr=pr[0];Mr.source!==this.source&&x.w(`layer.source = ${Mr.source} does not equal this.source = ${this.source}`),Mr.minzoom&&this.zoom<Math.floor(Mr.minzoom)||Mr.maxzoom&&this.zoom>=Mr.maxzoom||Mr.visibility!=="none"&&(Q(pr,this.zoom,D),(oe[Mr.id]=Mr.createBucket({index:re.bucketLayerIDs.length,layers:pr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ur,sourceID:this.source})).populate(Yr,W,this.tileID.canonical),re.bucketLayerIDs.push(pr.map(bt=>bt.id)))}}const _e=x.aE(W.glyphDependencies,dt=>Object.keys(dt).map(Number));this.inFlightDependencies.forEach(dt=>dt==null?void 0:dt.abort()),this.inFlightDependencies=[];let ve=Promise.resolve({});if(Object.keys(_e).length){const dt=new AbortController;this.inFlightDependencies.push(dt),ve=O.sendAsync({type:"getGlyphs",data:{stacks:_e,source:this.source,tileID:this.tileID,type:"glyphs"}},dt)}const fe=Object.keys(W.iconDependencies);let Oe=Promise.resolve({});if(fe.length){const dt=new AbortController;this.inFlightDependencies.push(dt),Oe=O.sendAsync({type:"getImages",data:{icons:fe,source:this.source,tileID:this.tileID,type:"icons"}},dt)}const Je=Object.keys(W.patternDependencies);let Qe=Promise.resolve({});if(Je.length){const dt=new AbortController;this.inFlightDependencies.push(dt),Qe=O.sendAsync({type:"getImages",data:{icons:Je,source:this.source,tileID:this.tileID,type:"patterns"}},dt)}const[st,lt,qt]=yield Promise.all([ve,Oe,Qe]),Rt=new F(st),Gt=new x.bl(lt,qt);for(const dt in oe){const Jt=oe[dt];Jt instanceof x.a5?(Q(Jt.layers,this.zoom,D),x.bm({bucket:Jt,glyphMap:st,glyphPositions:Rt.positions,imageMap:lt,imagePositions:Gt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Jt.hasPattern&&(Jt instanceof x.bn||Jt instanceof x.bo||Jt instanceof x.bp)&&(Q(Jt.layers,this.zoom,D),Jt.addFeatures(W,this.tileID.canonical,Gt.patternPositions))}return this.status="done",{buckets:Object.values(oe).filter(dt=>!dt.isEmpty()),featureIndex:re,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Rt.image,imageAtlas:Gt,glyphMap:this.returnDependencies?st:null,iconMap:this.returnDependencies?lt:null,glyphPositions:this.returnDependencies?Rt.positions:null}})}}function Q(H,E,M){const D=new x.a8(E);for(const O of H)O.recalculate(D,M)}class q{constructor(E,M,D){this.actor=E,this.layerIndex=M,this.availableImages=D,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(E,M){return x._(this,void 0,void 0,function*(){const D=yield x.l(E.request,M);try{return{vectorTile:new x.bq.VectorTile(new x.br(D.data)),rawData:D.data,cacheControl:D.cacheControl,expires:D.expires}}catch(O){const X=new Uint8Array(D.data);let re=`Unable to parse the tile at ${E.request.url}, `;throw re+=X[0]===31&&X[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${O.messge}`,new Error(re)}})}loadTile(E){return x._(this,void 0,void 0,function*(){const M=E.uid,D=!!(E&&E.request&&E.request.collectResourceTiming)&&new x.bs(E.request),O=new Z(E);this.loading[M]=O;const X=new AbortController;O.abort=X;try{const re=yield this.loadVectorTile(E,X);if(delete this.loading[M],!re)return null;const oe=re.rawData,W={};re.expires&&(W.expires=re.expires),re.cacheControl&&(W.cacheControl=re.cacheControl);const se={};if(D){const ve=D.finish();ve&&(se.resourceTiming=JSON.parse(JSON.stringify(ve)))}O.vectorTile=re.vectorTile;const _e=O.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[M]=O,this.fetching[M]={rawTileData:oe,cacheControl:W,resourceTiming:se};try{const ve=yield _e;return x.e({rawTileData:oe.slice(0)},ve,W,se)}finally{delete this.fetching[M]}}catch(re){throw delete this.loading[M],O.status="done",this.loaded[M]=O,re}})}reloadTile(E){return x._(this,void 0,void 0,function*(){const M=E.uid;if(!this.loaded||!this.loaded[M])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const D=this.loaded[M];if(D.showCollisionBoxes=E.showCollisionBoxes,D.status==="parsing"){const O=yield D.parse(D.vectorTile,this.layerIndex,this.availableImages,this.actor);let X;if(this.fetching[M]){const{rawTileData:re,cacheControl:oe,resourceTiming:W}=this.fetching[M];delete this.fetching[M],X=x.e({rawTileData:re.slice(0)},O,oe,W)}else X=O;return X}if(D.status==="done"&&D.vectorTile)return D.parse(D.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(E){return x._(this,void 0,void 0,function*(){const M=this.loading,D=E.uid;M&&M[D]&&M[D].abort&&(M[D].abort.abort(),delete M[D])})}removeTile(E){return x._(this,void 0,void 0,function*(){this.loaded&&this.loaded[E.uid]&&delete this.loaded[E.uid]})}}class U{constructor(){this.loaded={}}loadTile(E){return x._(this,void 0,void 0,function*(){const{uid:M,encoding:D,rawImageData:O,redFactor:X,greenFactor:re,blueFactor:oe,baseShift:W}=E,se=O.width+2,_e=O.height+2,ve=x.b(O)?new x.R({width:se,height:_e},yield x.bt(O,-1,-1,se,_e)):O,fe=new x.bu(M,ve,D,X,re,oe,W);return this.loaded=this.loaded||{},this.loaded[M]=fe,fe})}removeTile(E){const M=this.loaded,D=E.uid;M&&M[D]&&delete M[D]}}function we(H,E){if(H.length!==0){be(H[0],E);for(var M=1;M<H.length;M++)be(H[M],!E)}}function be(H,E){for(var M=0,D=0,O=0,X=H.length,re=X-1;O<X;re=O++){var oe=(H[O][0]-H[re][0])*(H[re][1]+H[O][1]),W=M+oe;D+=Math.abs(M)>=Math.abs(oe)?M-W+oe:oe-W+M,M=W}M+D>=0!=!!E&&H.reverse()}var xe=x.bv(function H(E,M){var D,O=E&&E.type;if(O==="FeatureCollection")for(D=0;D<E.features.length;D++)H(E.features[D],M);else if(O==="GeometryCollection")for(D=0;D<E.geometries.length;D++)H(E.geometries[D],M);else if(O==="Feature")H(E.geometry,M);else if(O==="Polygon")we(E.coordinates,M);else if(O==="MultiPolygon")for(D=0;D<E.coordinates.length;D++)we(E.coordinates[D],M);return E});const Ee=x.bq.VectorTileFeature.prototype.toGeoJSON;var ne={exports:{}},te=x.bw,ue=x.bq.VectorTileFeature,Te=Ne;function Ne(H,E){this.options=E||{},this.features=H,this.length=H.length}function pe(H,E){this.id=typeof H.id=="number"?H.id:void 0,this.type=H.type,this.rawGeometry=H.type===1?[H.geometry]:H.geometry,this.properties=H.tags,this.extent=E||4096}Ne.prototype.feature=function(H){return new pe(this.features[H],this.options.extent)},pe.prototype.loadGeometry=function(){var H=this.rawGeometry;this.geometry=[];for(var E=0;E<H.length;E++){for(var M=H[E],D=[],O=0;O<M.length;O++)D.push(new te(M[O][0],M[O][1]));this.geometry.push(D)}return this.geometry},pe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var H=this.geometry,E=1/0,M=-1/0,D=1/0,O=-1/0,X=0;X<H.length;X++)for(var re=H[X],oe=0;oe<re.length;oe++){var W=re[oe];E=Math.min(E,W.x),M=Math.max(M,W.x),D=Math.min(D,W.y),O=Math.max(O,W.y)}return[E,D,M,O]},pe.prototype.toGeoJSON=ue.prototype.toGeoJSON;var Me=x.bx,Ze=Te;function tt(H){var E=new Me;return function(M,D){for(var O in M.layers)D.writeMessage(3,ct,M.layers[O])}(H,E),E.finish()}function ct(H,E){var M;E.writeVarintField(15,H.version||1),E.writeStringField(1,H.name||""),E.writeVarintField(5,H.extent||4096);var D={keys:[],values:[],keycache:{},valuecache:{}};for(M=0;M<H.length;M++)D.feature=H.feature(M),E.writeMessage(2,vt,D);var O=D.keys;for(M=0;M<O.length;M++)E.writeStringField(3,O[M]);var X=D.values;for(M=0;M<X.length;M++)E.writeMessage(4,Gr,X[M])}function vt(H,E){var M=H.feature;M.id!==void 0&&E.writeVarintField(1,M.id),E.writeMessage(2,kt,H),E.writeVarintField(3,M.type),E.writeMessage(4,wi,M)}function kt(H,E){var M=H.feature,D=H.keys,O=H.values,X=H.keycache,re=H.valuecache;for(var oe in M.properties){var W=M.properties[oe],se=X[oe];if(W!==null){se===void 0&&(D.push(oe),X[oe]=se=D.length-1),E.writeVarint(se);var _e=typeof W;_e!=="string"&&_e!=="boolean"&&_e!=="number"&&(W=JSON.stringify(W));var ve=_e+":"+W,fe=re[ve];fe===void 0&&(O.push(W),re[ve]=fe=O.length-1),E.writeVarint(fe)}}}function Dt(H,E){return(E<<3)+(7&H)}function lr(H){return H<<1^H>>31}function wi(H,E){for(var M=H.loadGeometry(),D=H.type,O=0,X=0,re=M.length,oe=0;oe<re;oe++){var W=M[oe],se=1;D===1&&(se=W.length),E.writeVarint(Dt(1,se));for(var _e=D===3?W.length-1:W.length,ve=0;ve<_e;ve++){ve===1&&D!==1&&E.writeVarint(Dt(2,_e-1));var fe=W[ve].x-O,Oe=W[ve].y-X;E.writeVarint(lr(fe)),E.writeVarint(lr(Oe)),O+=fe,X+=Oe}D===3&&E.writeVarint(Dt(7,1))}}function Gr(H,E){var M=typeof H;M==="string"?E.writeStringField(1,H):M==="boolean"?E.writeBooleanField(7,H):M==="number"&&(H%1!=0?E.writeDoubleField(3,H):H<0?E.writeSVarintField(6,H):E.writeVarintField(5,H))}ne.exports=tt,ne.exports.fromVectorTileJs=tt,ne.exports.fromGeojsonVt=function(H,E){E=E||{};var M={};for(var D in H)M[D]=new Ze(H[D].features,E),M[D].name=D,M[D].version=E.version,M[D].extent=E.extent;return tt({layers:M})},ne.exports.GeoJSONWrapper=Ze;var Vt=x.bv(ne.exports);const We={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:H=>H},pt=Math.fround||(ht=new Float32Array(1),H=>(ht[0]=+H,ht[0]));var ht;const xt=3,Ct=5,Hr=6;class Wt{constructor(E){this.options=Object.assign(Object.create(We),E),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(E){const{log:M,minZoom:D,maxZoom:O}=this.options;M&&console.time("total time");const X=`prepare ${E.length} points`;M&&console.time(X),this.points=E;const re=[];for(let W=0;W<E.length;W++){const se=E[W];if(!se.geometry)continue;const[_e,ve]=se.geometry.coordinates,fe=pt(Pr(_e)),Oe=pt(Fi(ve));re.push(fe,Oe,1/0,W,-1,1),this.options.reduce&&re.push(0)}let oe=this.trees[O+1]=this._createTree(re);M&&console.timeEnd(X);for(let W=O;W>=D;W--){const se=+Date.now();oe=this.trees[W]=this._createTree(this._cluster(oe,W)),M&&console.log("z%d: %d clusters in %dms",W,oe.numItems,+Date.now()-se)}return M&&console.timeEnd("total time"),this}getClusters(E,M){let D=((E[0]+180)%360+360)%360-180;const O=Math.max(-90,Math.min(90,E[1]));let X=E[2]===180?180:((E[2]+180)%360+360)%360-180;const re=Math.max(-90,Math.min(90,E[3]));if(E[2]-E[0]>=360)D=-180,X=180;else if(D>X){const ve=this.getClusters([D,O,180,re],M),fe=this.getClusters([-180,O,X,re],M);return ve.concat(fe)}const oe=this.trees[this._limitZoom(M)],W=oe.range(Pr(D),Fi(re),Pr(X),Fi(O)),se=oe.data,_e=[];for(const ve of W){const fe=this.stride*ve;_e.push(se[fe+Ct]>1?Br(se,fe,this.clusterProps):this.points[se[fe+xt]])}return _e}getChildren(E){const M=this._getOriginId(E),D=this._getOriginZoom(E),O="No cluster with the specified id.",X=this.trees[D];if(!X)throw new Error(O);const re=X.data;if(M*this.stride>=re.length)throw new Error(O);const oe=this.options.radius/(this.options.extent*Math.pow(2,D-1)),W=X.within(re[M*this.stride],re[M*this.stride+1],oe),se=[];for(const _e of W){const ve=_e*this.stride;re[ve+4]===E&&se.push(re[ve+Ct]>1?Br(re,ve,this.clusterProps):this.points[re[ve+xt]])}if(se.length===0)throw new Error(O);return se}getLeaves(E,M,D){const O=[];return this._appendLeaves(O,E,M=M||10,D=D||0,0),O}getTile(E,M,D){const O=this.trees[this._limitZoom(E)],X=Math.pow(2,E),{extent:re,radius:oe}=this.options,W=oe/re,se=(D-W)/X,_e=(D+1+W)/X,ve={features:[]};return this._addTileFeatures(O.range((M-W)/X,se,(M+1+W)/X,_e),O.data,M,D,X,ve),M===0&&this._addTileFeatures(O.range(1-W/X,se,1,_e),O.data,X,D,X,ve),M===X-1&&this._addTileFeatures(O.range(0,se,W/X,_e),O.data,-1,D,X,ve),ve.features.length?ve:null}getClusterExpansionZoom(E){let M=this._getOriginZoom(E)-1;for(;M<=this.options.maxZoom;){const D=this.getChildren(E);if(M++,D.length!==1)break;E=D[0].properties.cluster_id}return M}_appendLeaves(E,M,D,O,X){const re=this.getChildren(M);for(const oe of re){const W=oe.properties;if(W&&W.cluster?X+W.point_count<=O?X+=W.point_count:X=this._appendLeaves(E,W.cluster_id,D,O,X):X<O?X++:E.push(oe),E.length===D)break}return X}_createTree(E){const M=new x.au(E.length/this.stride|0,this.options.nodeSize,Float32Array);for(let D=0;D<E.length;D+=this.stride)M.add(E[D],E[D+1]);return M.finish(),M.data=E,M}_addTileFeatures(E,M,D,O,X,re){for(const oe of E){const W=oe*this.stride,se=M[W+Ct]>1;let _e,ve,fe;if(se)_e=or(M,W,this.clusterProps),ve=M[W],fe=M[W+1];else{const Qe=this.points[M[W+xt]];_e=Qe.properties;const[st,lt]=Qe.geometry.coordinates;ve=Pr(st),fe=Fi(lt)}const Oe={type:1,geometry:[[Math.round(this.options.extent*(ve*X-D)),Math.round(this.options.extent*(fe*X-O))]],tags:_e};let Je;Je=se||this.options.generateId?M[W+xt]:this.points[M[W+xt]].id,Je!==void 0&&(Oe.id=Je),re.features.push(Oe)}}_limitZoom(E){return Math.max(this.options.minZoom,Math.min(Math.floor(+E),this.options.maxZoom+1))}_cluster(E,M){const{radius:D,extent:O,reduce:X,minPoints:re}=this.options,oe=D/(O*Math.pow(2,M)),W=E.data,se=[],_e=this.stride;for(let ve=0;ve<W.length;ve+=_e){if(W[ve+2]<=M)continue;W[ve+2]=M;const fe=W[ve],Oe=W[ve+1],Je=E.within(W[ve],W[ve+1],oe),Qe=W[ve+Ct];let st=Qe;for(const lt of Je){const qt=lt*_e;W[qt+2]>M&&(st+=W[qt+Ct])}if(st>Qe&&st>=re){let lt,qt=fe*Qe,Rt=Oe*Qe,Gt=-1;const dt=((ve/_e|0)<<5)+(M+1)+this.points.length;for(const Jt of Je){const ur=Jt*_e;if(W[ur+2]<=M)continue;W[ur+2]=M;const Yr=W[ur+Ct];qt+=W[ur]*Yr,Rt+=W[ur+1]*Yr,W[ur+4]=dt,X&&(lt||(lt=this._map(W,ve,!0),Gt=this.clusterProps.length,this.clusterProps.push(lt)),X(lt,this._map(W,ur)))}W[ve+4]=dt,se.push(qt/st,Rt/st,1/0,dt,-1,st),X&&se.push(Gt)}else{for(let lt=0;lt<_e;lt++)se.push(W[ve+lt]);if(st>1)for(const lt of Je){const qt=lt*_e;if(!(W[qt+2]<=M)){W[qt+2]=M;for(let Rt=0;Rt<_e;Rt++)se.push(W[qt+Rt])}}}}return se}_getOriginId(E){return E-this.points.length>>5}_getOriginZoom(E){return(E-this.points.length)%32}_map(E,M,D){if(E[M+Ct]>1){const re=this.clusterProps[E[M+Hr]];return D?Object.assign({},re):re}const O=this.points[E[M+xt]].properties,X=this.options.map(O);return D&&X===O?Object.assign({},X):X}}function Br(H,E,M){return{type:"Feature",id:H[E+xt],properties:or(H,E,M),geometry:{type:"Point",coordinates:[(D=H[E],360*(D-.5)),uo(H[E+1])]}};var D}function or(H,E,M){const D=H[E+Ct],O=D>=1e4?`${Math.round(D/1e3)}k`:D>=1e3?Math.round(D/100)/10+"k":D,X=H[E+Hr],re=X===-1?{}:Object.assign({},M[X]);return Object.assign(re,{cluster:!0,cluster_id:H[E+xt],point_count:D,point_count_abbreviated:O})}function Pr(H){return H/360+.5}function Fi(H){const E=Math.sin(H*Math.PI/180),M=.5-.25*Math.log((1+E)/(1-E))/Math.PI;return M<0?0:M>1?1:M}function uo(H){const E=(180-360*H)*Math.PI/180;return 360*Math.atan(Math.exp(E))/Math.PI-90}function kn(H,E,M,D){for(var O,X=D,re=M-E>>1,oe=M-E,W=H[E],se=H[E+1],_e=H[M],ve=H[M+1],fe=E+3;fe<M;fe+=3){var Oe=Wr(H[fe],H[fe+1],W,se,_e,ve);if(Oe>X)O=fe,X=Oe;else if(Oe===X){var Je=Math.abs(fe-re);Je<oe&&(O=fe,oe=Je)}}X>D&&(O-E>3&&kn(H,E,O,D),H[O+2]=X,M-O>3&&kn(H,O,M,D))}function Wr(H,E,M,D,O,X){var re=O-M,oe=X-D;if(re!==0||oe!==0){var W=((H-M)*re+(E-D)*oe)/(re*re+oe*oe);W>1?(M=O,D=X):W>0&&(M+=re*W,D+=oe*W)}return(re=H-M)*re+(oe=E-D)*oe}function bi(H,E,M,D){var O={id:H===void 0?null:H,type:E,geometry:M,tags:D,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(X){var re=X.geometry,oe=X.type;if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")un(X,re);else if(oe==="Polygon"||oe==="MultiLineString")for(var W=0;W<re.length;W++)un(X,re[W]);else if(oe==="MultiPolygon")for(W=0;W<re.length;W++)for(var se=0;se<re[W].length;se++)un(X,re[W][se])}(O),O}function un(H,E){for(var M=0;M<E.length;M+=3)H.minX=Math.min(H.minX,E[M]),H.minY=Math.min(H.minY,E[M+1]),H.maxX=Math.max(H.maxX,E[M]),H.maxY=Math.max(H.maxY,E[M+1])}function En(H,E,M,D){if(E.geometry){var O=E.geometry.coordinates,X=E.geometry.type,re=Math.pow(M.tolerance/((1<<M.maxZoom)*M.extent),2),oe=[],W=E.id;if(M.promoteId?W=E.properties[M.promoteId]:M.generateId&&(W=D||0),X==="Point")Xt(O,oe);else if(X==="MultiPoint")for(var se=0;se<O.length;se++)Xt(O[se],oe);else if(X==="LineString")Gn(O,oe,re,!1);else if(X==="MultiLineString"){if(M.lineMetrics){for(se=0;se<O.length;se++)Gn(O[se],oe=[],re,!1),H.push(bi(W,"LineString",oe,E.properties));return}Ie(O,oe,re,!1)}else if(X==="Polygon")Ie(O,oe,re,!0);else{if(X!=="MultiPolygon"){if(X==="GeometryCollection"){for(se=0;se<E.geometry.geometries.length;se++)En(H,{id:W,geometry:E.geometry.geometries[se],properties:E.properties},M,D);return}throw new Error("Input data is not a valid GeoJSON object.")}for(se=0;se<O.length;se++){var _e=[];Ie(O[se],_e,re,!0),oe.push(_e)}}H.push(bi(W,X,oe,E.properties))}}function Xt(H,E){E.push(Hn(H[0])),E.push(To(H[1])),E.push(0)}function Gn(H,E,M,D){for(var O,X,re=0,oe=0;oe<H.length;oe++){var W=Hn(H[oe][0]),se=To(H[oe][1]);E.push(W),E.push(se),E.push(0),oe>0&&(re+=D?(O*se-W*X)/2:Math.sqrt(Math.pow(W-O,2)+Math.pow(se-X,2))),O=W,X=se}var _e=E.length-3;E[2]=1,kn(E,0,_e,M),E[_e+2]=1,E.size=Math.abs(re),E.start=0,E.end=E.size}function Ie(H,E,M,D){for(var O=0;O<H.length;O++){var X=[];Gn(H[O],X,M,D),E.push(X)}}function Hn(H){return H/360+.5}function To(H){var E=Math.sin(H*Math.PI/180),M=.5-.25*Math.log((1+E)/(1-E))/Math.PI;return M<0?0:M>1?1:M}function Pt(H,E,M,D,O,X,re,oe){if(D/=E,X>=(M/=E)&&re<D)return H;if(re<M||X>=D)return null;for(var W=[],se=0;se<H.length;se++){var _e=H[se],ve=_e.geometry,fe=_e.type,Oe=O===0?_e.minX:_e.minY,Je=O===0?_e.maxX:_e.maxY;if(Oe>=M&&Je<D)W.push(_e);else if(!(Je<M||Oe>=D)){var Qe=[];if(fe==="Point"||fe==="MultiPoint")dr(ve,Qe,M,D,O);else if(fe==="LineString")Bi(ve,Qe,M,D,O,!1,oe.lineMetrics);else if(fe==="MultiLineString")di(ve,Qe,M,D,O,!1);else if(fe==="Polygon")di(ve,Qe,M,D,O,!0);else if(fe==="MultiPolygon")for(var st=0;st<ve.length;st++){var lt=[];di(ve[st],lt,M,D,O,!0),lt.length&&Qe.push(lt)}if(Qe.length){if(oe.lineMetrics&&fe==="LineString"){for(st=0;st<Qe.length;st++)W.push(bi(_e.id,fe,Qe[st],_e.tags));continue}fe!=="LineString"&&fe!=="MultiLineString"||(Qe.length===1?(fe="LineString",Qe=Qe[0]):fe="MultiLineString"),fe!=="Point"&&fe!=="MultiPoint"||(fe=Qe.length===3?"Point":"MultiPoint"),W.push(bi(_e.id,fe,Qe,_e.tags))}}}return W.length?W:null}function dr(H,E,M,D,O){for(var X=0;X<H.length;X+=3){var re=H[X+O];re>=M&&re<=D&&(E.push(H[X]),E.push(H[X+1]),E.push(H[X+2]))}}function Bi(H,E,M,D,O,X,re){for(var oe,W,se=Cn(H),_e=O===0?Pn:cn,ve=H.start,fe=0;fe<H.length-3;fe+=3){var Oe=H[fe],Je=H[fe+1],Qe=H[fe+2],st=H[fe+3],lt=H[fe+4],qt=O===0?Oe:Je,Rt=O===0?st:lt,Gt=!1;re&&(oe=Math.sqrt(Math.pow(Oe-st,2)+Math.pow(Je-lt,2))),qt<M?Rt>M&&(W=_e(se,Oe,Je,st,lt,M),re&&(se.start=ve+oe*W)):qt>D?Rt<D&&(W=_e(se,Oe,Je,st,lt,D),re&&(se.start=ve+oe*W)):Xi(se,Oe,Je,Qe),Rt<M&&qt>=M&&(W=_e(se,Oe,Je,st,lt,M),Gt=!0),Rt>D&&qt<=D&&(W=_e(se,Oe,Je,st,lt,D),Gt=!0),!X&&Gt&&(re&&(se.end=ve+oe*W),E.push(se),se=Cn(H)),re&&(ve+=oe)}var dt=H.length-3;Oe=H[dt],Je=H[dt+1],Qe=H[dt+2],(qt=O===0?Oe:Je)>=M&&qt<=D&&Xi(se,Oe,Je,Qe),dt=se.length-3,X&&dt>=3&&(se[dt]!==se[0]||se[dt+1]!==se[1])&&Xi(se,se[0],se[1],se[2]),se.length&&E.push(se)}function Cn(H){var E=[];return E.size=H.size,E.start=H.start,E.end=H.end,E}function di(H,E,M,D,O,X){for(var re=0;re<H.length;re++)Bi(H[re],E,M,D,O,X,!1)}function Xi(H,E,M,D){H.push(E),H.push(M),H.push(D)}function Pn(H,E,M,D,O,X){var re=(X-E)/(D-E);return H.push(X),H.push(M+(O-M)*re),H.push(1),re}function cn(H,E,M,D,O,X){var re=(X-M)/(O-M);return H.push(E+(D-E)*re),H.push(X),H.push(1),re}function Io(H,E){for(var M=[],D=0;D<H.length;D++){var O,X=H[D],re=X.type;if(re==="Point"||re==="MultiPoint"||re==="LineString")O=Re(X.geometry,E);else if(re==="MultiLineString"||re==="Polygon"){O=[];for(var oe=0;oe<X.geometry.length;oe++)O.push(Re(X.geometry[oe],E))}else if(re==="MultiPolygon")for(O=[],oe=0;oe<X.geometry.length;oe++){for(var W=[],se=0;se<X.geometry[oe].length;se++)W.push(Re(X.geometry[oe][se],E));O.push(W)}M.push(bi(X.id,re,O,X.tags))}return M}function Re(H,E){var M=[];M.size=H.size,H.start!==void 0&&(M.start=H.start,M.end=H.end);for(var D=0;D<H.length;D+=3)M.push(H[D]+E,H[D+1],H[D+2]);return M}function ii(H,E){if(H.transformed)return H;var M,D,O,X=1<<H.z,re=H.x,oe=H.y;for(M=0;M<H.features.length;M++){var W=H.features[M],se=W.geometry,_e=W.type;if(W.geometry=[],_e===1)for(D=0;D<se.length;D+=2)W.geometry.push(Qr(se[D],se[D+1],E,X,re,oe));else for(D=0;D<se.length;D++){var ve=[];for(O=0;O<se[D].length;O+=2)ve.push(Qr(se[D][O],se[D][O+1],E,X,re,oe));W.geometry.push(ve)}}return H.transformed=!0,H}function Qr(H,E,M,D,O,X){return[Math.round(M*(H*D-O)),Math.round(M*(E*D-X))]}function co(H,E,M,D,O){for(var X=E===O.maxZoom?0:O.tolerance/((1<<E)*O.extent),re={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:M,y:D,z:E,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},oe=0;oe<H.length;oe++){re.numFeatures++,Wn(re,H[oe],X,O);var W=H[oe].minX,se=H[oe].minY,_e=H[oe].maxX,ve=H[oe].maxY;W<re.minX&&(re.minX=W),se<re.minY&&(re.minY=se),_e>re.maxX&&(re.maxX=_e),ve>re.maxY&&(re.maxY=ve)}return re}function Wn(H,E,M,D){var O=E.geometry,X=E.type,re=[];if(X==="Point"||X==="MultiPoint")for(var oe=0;oe<O.length;oe+=3)re.push(O[oe]),re.push(O[oe+1]),H.numPoints++,H.numSimplified++;else if(X==="LineString")Fe(re,O,H,M,!1,!1);else if(X==="MultiLineString"||X==="Polygon")for(oe=0;oe<O.length;oe++)Fe(re,O[oe],H,M,X==="Polygon",oe===0);else if(X==="MultiPolygon")for(var W=0;W<O.length;W++){var se=O[W];for(oe=0;oe<se.length;oe++)Fe(re,se[oe],H,M,!0,oe===0)}if(re.length){var _e=E.tags||null;if(X==="LineString"&&D.lineMetrics){for(var ve in _e={},E.tags)_e[ve]=E.tags[ve];_e.mapbox_clip_start=O.start/O.size,_e.mapbox_clip_end=O.end/O.size}var fe={geometry:re,type:X==="Polygon"||X==="MultiPolygon"?3:X==="LineString"||X==="MultiLineString"?2:1,tags:_e};E.id!==null&&(fe.id=E.id),H.features.push(fe)}}function Fe(H,E,M,D,O,X){var re=D*D;if(D>0&&E.size<(O?re:D))M.numPoints+=E.length/3;else{for(var oe=[],W=0;W<E.length;W+=3)(D===0||E[W+2]>re)&&(M.numSimplified++,oe.push(E[W]),oe.push(E[W+1])),M.numPoints++;O&&function(se,_e){for(var ve=0,fe=0,Oe=se.length,Je=Oe-2;fe<Oe;Je=fe,fe+=2)ve+=(se[fe]-se[Je])*(se[fe+1]+se[Je+1]);if(ve>0===_e)for(fe=0,Oe=se.length;fe<Oe/2;fe+=2){var Qe=se[fe],st=se[fe+1];se[fe]=se[Oe-2-fe],se[fe+1]=se[Oe-1-fe],se[Oe-2-fe]=Qe,se[Oe-1-fe]=st}}(oe,X),H.push(oe)}}function mt(H,E){var M=(E=this.options=function(O,X){for(var re in X)O[re]=X[re];return O}(Object.create(this.options),E)).debug;if(M&&console.time("preprocess data"),E.maxZoom<0||E.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(E.promoteId&&E.generateId)throw new Error("promoteId and generateId cannot be used together.");var D=function(O,X){var re=[];if(O.type==="FeatureCollection")for(var oe=0;oe<O.features.length;oe++)En(re,O.features[oe],X,oe);else En(re,O.type==="Feature"?O:{geometry:O},X);return re}(H,E);this.tiles={},this.tileCoords=[],M&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",E.indexMaxZoom,E.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),D=function(O,X){var re=X.buffer/X.extent,oe=O,W=Pt(O,1,-1-re,re,0,-1,2,X),se=Pt(O,1,1-re,2+re,0,-1,2,X);return(W||se)&&(oe=Pt(O,1,-re,1+re,0,-1,2,X)||[],W&&(oe=Io(W,1).concat(oe)),se&&(oe=oe.concat(Io(se,-1)))),oe}(D,E),D.length&&this.splitTile(D,0,0,0),M&&(D.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function gt(H,E,M){return 32*((1<<H)*M+E)+H}function br(H,E){return E?H.properties[E]:H.id}function Si(H,E){if(H==null)return!0;if(H.type==="Feature")return br(H,E)!=null;if(H.type==="FeatureCollection"){const M=new Set;for(const D of H.features){const O=br(D,E);if(O==null||M.has(O))return!1;M.add(O)}return!0}return!1}function yt(H,E){const M=new Map;if(H!=null)if(H.type==="Feature")M.set(br(H,E),H);else for(const D of H.features)M.set(br(D,E),D);return M}mt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},mt.prototype.splitTile=function(H,E,M,D,O,X,re){for(var oe=[H,E,M,D],W=this.options,se=W.debug;oe.length;){D=oe.pop(),M=oe.pop(),E=oe.pop(),H=oe.pop();var _e=1<<E,ve=gt(E,M,D),fe=this.tiles[ve];if(!fe&&(se>1&&console.time("creation"),fe=this.tiles[ve]=co(H,E,M,D,W),this.tileCoords.push({z:E,x:M,y:D}),se)){se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",E,M,D,fe.numFeatures,fe.numPoints,fe.numSimplified),console.timeEnd("creation"));var Oe="z"+E;this.stats[Oe]=(this.stats[Oe]||0)+1,this.total++}if(fe.source=H,O){if(E===W.maxZoom||E===O)continue;var Je=1<<O-E;if(M!==Math.floor(X/Je)||D!==Math.floor(re/Je))continue}else if(E===W.indexMaxZoom||fe.numPoints<=W.indexMaxPoints)continue;if(fe.source=null,H.length!==0){se>1&&console.time("clipping");var Qe,st,lt,qt,Rt,Gt,dt=.5*W.buffer/W.extent,Jt=.5-dt,ur=.5+dt,Yr=1+dt;Qe=st=lt=qt=null,Rt=Pt(H,_e,M-dt,M+ur,0,fe.minX,fe.maxX,W),Gt=Pt(H,_e,M+Jt,M+Yr,0,fe.minX,fe.maxX,W),H=null,Rt&&(Qe=Pt(Rt,_e,D-dt,D+ur,1,fe.minY,fe.maxY,W),st=Pt(Rt,_e,D+Jt,D+Yr,1,fe.minY,fe.maxY,W),Rt=null),Gt&&(lt=Pt(Gt,_e,D-dt,D+ur,1,fe.minY,fe.maxY,W),qt=Pt(Gt,_e,D+Jt,D+Yr,1,fe.minY,fe.maxY,W),Gt=null),se>1&&console.timeEnd("clipping"),oe.push(Qe||[],E+1,2*M,2*D),oe.push(st||[],E+1,2*M,2*D+1),oe.push(lt||[],E+1,2*M+1,2*D),oe.push(qt||[],E+1,2*M+1,2*D+1)}}},mt.prototype.getTile=function(H,E,M){var D=this.options,O=D.extent,X=D.debug;if(H<0||H>24)return null;var re=1<<H,oe=gt(H,E=(E%re+re)%re,M);if(this.tiles[oe])return ii(this.tiles[oe],O);X>1&&console.log("drilling down to z%d-%d-%d",H,E,M);for(var W,se=H,_e=E,ve=M;!W&&se>0;)se--,_e=Math.floor(_e/2),ve=Math.floor(ve/2),W=this.tiles[gt(se,_e,ve)];return W&&W.source?(X>1&&console.log("found parent tile z%d-%d-%d",se,_e,ve),X>1&&console.time("drilling down"),this.splitTile(W.source,se,_e,ve,H,E,M),X>1&&console.timeEnd("drilling down"),this.tiles[oe]?ii(this.tiles[oe],O):null):null};class Mn extends q{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(E,M){return x._(this,void 0,void 0,function*(){const D=E.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const O=this._geoJSONIndex.getTile(D.z,D.x,D.y);if(!O)return null;const X=new class{constructor(oe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=x.W,this.length=oe.length,this._features=oe}feature(oe){return new class{constructor(W){this._feature=W,this.extent=x.W,this.type=W.type,this.properties=W.tags,"id"in W&&!isNaN(W.id)&&(this.id=parseInt(W.id,10))}loadGeometry(){if(this._feature.type===1){const W=[];for(const se of this._feature.geometry)W.push([new x.P(se[0],se[1])]);return W}{const W=[];for(const se of this._feature.geometry){const _e=[];for(const ve of se)_e.push(new x.P(ve[0],ve[1]));W.push(_e)}return W}}toGeoJSON(W,se,_e){return Ee.call(this,W,se,_e)}}(this._features[oe])}}(O.features);let re=Vt(X);return re.byteOffset===0&&re.byteLength===re.buffer.byteLength||(re=new Uint8Array(re)),{vectorTile:X,rawData:re.buffer}})}loadData(E){return x._(this,void 0,void 0,function*(){var M;(M=this._pendingRequest)===null||M===void 0||M.abort();const D=!!(E&&E.request&&E.request.collectResourceTiming)&&new x.bs(E.request);this._pendingRequest=new AbortController;try{let O=yield this.loadGeoJSON(E,this._pendingRequest);if(delete this._pendingRequest,typeof O!="object")throw new Error(`Input data given to '${E.source}' is not a valid GeoJSON object.`);if(xe(O,!0),E.filter){const re=x.by(E.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(re.result==="error")throw new Error(re.value.map(W=>`${W.key}: ${W.message}`).join(", "));O={type:"FeatureCollection",features:O.features.filter(W=>re.value.evaluate({zoom:0},W))}}this._geoJSONIndex=E.cluster?new Wt(function({superclusterOptions:re,clusterProperties:oe}){if(!oe||!re)return re;const W={},se={},_e={accumulated:null,zoom:0},ve={properties:null},fe=Object.keys(oe);for(const Oe of fe){const[Je,Qe]=oe[Oe],st=x.by(Qe),lt=x.by(typeof Je=="string"?[Je,["accumulated"],["get",Oe]]:Je);W[Oe]=st.value,se[Oe]=lt.value}return re.map=Oe=>{ve.properties=Oe;const Je={};for(const Qe of fe)Je[Qe]=W[Qe].evaluate(_e,ve);return Je},re.reduce=(Oe,Je)=>{ve.properties=Je;for(const Qe of fe)_e.accumulated=Oe[Qe],Oe[Qe]=se[Qe].evaluate(_e,ve)},re}(E)).load(O.features):function(re,oe){return new mt(re,oe)}(O,E.geojsonVtOptions),this.loaded={};const X={};if(D){const re=D.finish();re&&(X.resourceTiming={},X.resourceTiming[E.source]=JSON.parse(JSON.stringify(re)))}return X}catch(O){if(delete this._pendingRequest,x.bz(O))return{abandoned:!0};throw O}})}reloadTile(E){const M=this.loaded;return M&&M[E.uid]?super.reloadTile(E):this.loadTile(E)}loadGeoJSON(E,M){return x._(this,void 0,void 0,function*(){const{promoteId:D}=E;if(E.request){const O=yield x.h(E.request,M);return this._dataUpdateable=Si(O.data,D)?yt(O.data,D):void 0,O.data}if(typeof E.data=="string")try{const O=JSON.parse(E.data);return this._dataUpdateable=Si(O,D)?yt(O,D):void 0,O}catch{throw new Error(`Input data given to '${E.source}' is not a valid GeoJSON object.`)}if(!E.dataDiff)throw new Error(`Input data given to '${E.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${E.source}`);return function(O,X,re){var oe,W,se,_e;if(X.removeAll&&O.clear(),X.remove)for(const ve of X.remove)O.delete(ve);if(X.add)for(const ve of X.add){const fe=br(ve,re);fe!=null&&O.set(fe,ve)}if(X.update)for(const ve of X.update){let fe=O.get(ve.id);if(fe==null)continue;const Oe=!ve.removeAllProperties&&(((oe=ve.removeProperties)===null||oe===void 0?void 0:oe.length)>0||((W=ve.addOrUpdateProperties)===null||W===void 0?void 0:W.length)>0);if((ve.newGeometry||ve.removeAllProperties||Oe)&&(fe=Object.assign({},fe),O.set(ve.id,fe),Oe&&(fe.properties=Object.assign({},fe.properties))),ve.newGeometry&&(fe.geometry=ve.newGeometry),ve.removeAllProperties)fe.properties={};else if(((se=ve.removeProperties)===null||se===void 0?void 0:se.length)>0)for(const Je of ve.removeProperties)Object.prototype.hasOwnProperty.call(fe.properties,Je)&&delete fe.properties[Je];if(((_e=ve.addOrUpdateProperties)===null||_e===void 0?void 0:_e.length)>0)for(const{key:Je,value:Qe}of ve.addOrUpdateProperties)fe.properties[Je]=Qe}}(this._dataUpdateable,E.dataDiff,D),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(E){return x._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(E){return this._geoJSONIndex.getClusterExpansionZoom(E.clusterId)}getClusterChildren(E){return this._geoJSONIndex.getChildren(E.clusterId)}getClusterLeaves(E){return this._geoJSONIndex.getLeaves(E.clusterId,E.limit,E.offset)}}class Ji{constructor(E){this.self=E,this.actor=new x.C(E),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(M,D)=>{if(this.externalWorkerSourceTypes[M])throw new Error(`Worker source with name "${M}" already registered.`);this.externalWorkerSourceTypes[M]=D},this.self.addProtocol=x.bf,this.self.removeProtocol=x.bg,this.self.registerRTLTextPlugin=M=>{if(x.bA.isParsed())throw new Error("RTL text plugin already registered.");x.bA.setMethods(M)},this.actor.registerMessageHandler("loadDEMTile",(M,D)=>this._getDEMWorkerSource(M,D.source).loadTile(D)),this.actor.registerMessageHandler("removeDEMTile",(M,D)=>x._(this,void 0,void 0,function*(){this._getDEMWorkerSource(M,D.source).removeTile(D)})),this.actor.registerMessageHandler("getClusterExpansionZoom",(M,D)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(M,D.type,D.source).getClusterExpansionZoom(D)})),this.actor.registerMessageHandler("getClusterChildren",(M,D)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(M,D.type,D.source).getClusterChildren(D)})),this.actor.registerMessageHandler("getClusterLeaves",(M,D)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(M,D.type,D.source).getClusterLeaves(D)})),this.actor.registerMessageHandler("loadData",(M,D)=>this._getWorkerSource(M,D.type,D.source).loadData(D)),this.actor.registerMessageHandler("loadTile",(M,D)=>this._getWorkerSource(M,D.type,D.source).loadTile(D)),this.actor.registerMessageHandler("reloadTile",(M,D)=>this._getWorkerSource(M,D.type,D.source).reloadTile(D)),this.actor.registerMessageHandler("abortTile",(M,D)=>this._getWorkerSource(M,D.type,D.source).abortTile(D)),this.actor.registerMessageHandler("removeTile",(M,D)=>this._getWorkerSource(M,D.type,D.source).removeTile(D)),this.actor.registerMessageHandler("removeSource",(M,D)=>x._(this,void 0,void 0,function*(){if(!this.workerSources[M]||!this.workerSources[M][D.type]||!this.workerSources[M][D.type][D.source])return;const O=this.workerSources[M][D.type][D.source];delete this.workerSources[M][D.type][D.source],O.removeSource!==void 0&&O.removeSource(D)})),this.actor.registerMessageHandler("removeMap",M=>x._(this,void 0,void 0,function*(){delete this.layerIndexes[M],delete this.availableImages[M],delete this.workerSources[M],delete this.demWorkerSources[M]})),this.actor.registerMessageHandler("setReferrer",(M,D)=>x._(this,void 0,void 0,function*(){this.referrer=D})),this.actor.registerMessageHandler("syncRTLPluginState",(M,D)=>this._syncRTLPluginState(M,D)),this.actor.registerMessageHandler("importScript",(M,D)=>x._(this,void 0,void 0,function*(){this.self.importScripts(D)})),this.actor.registerMessageHandler("setImages",(M,D)=>this._setImages(M,D)),this.actor.registerMessageHandler("updateLayers",(M,D)=>x._(this,void 0,void 0,function*(){this._getLayerIndex(M).update(D.layers,D.removedIds)})),this.actor.registerMessageHandler("setLayers",(M,D)=>x._(this,void 0,void 0,function*(){this._getLayerIndex(M).replace(D)}))}_setImages(E,M){return x._(this,void 0,void 0,function*(){this.availableImages[E]=M;for(const D in this.workerSources[E]){const O=this.workerSources[E][D];for(const X in O)O[X].availableImages=M}})}_syncRTLPluginState(E,M){return x._(this,void 0,void 0,function*(){if(x.bA.isParsed())return x.bA.getState();if(M.pluginStatus!=="loading")return x.bA.setState(M),M;const D=M.pluginURL;if(this.self.importScripts(D),x.bA.isParsed()){const O={pluginStatus:"loaded",pluginURL:D};return x.bA.setState(O),O}throw x.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${D}`)})}_getAvailableImages(E){let M=this.availableImages[E];return M||(M=[]),M}_getLayerIndex(E){let M=this.layerIndexes[E];return M||(M=this.layerIndexes[E]=new d),M}_getWorkerSource(E,M,D){if(this.workerSources[E]||(this.workerSources[E]={}),this.workerSources[E][M]||(this.workerSources[E][M]={}),!this.workerSources[E][M][D]){const O={sendAsync:(X,re)=>(X.targetMapId=E,this.actor.sendAsync(X,re))};switch(M){case"vector":this.workerSources[E][M][D]=new q(O,this._getLayerIndex(E),this._getAvailableImages(E));break;case"geojson":this.workerSources[E][M][D]=new Mn(O,this._getLayerIndex(E),this._getAvailableImages(E));break;default:this.workerSources[E][M][D]=new this.externalWorkerSourceTypes[M](O,this._getLayerIndex(E),this._getAvailableImages(E))}}return this.workerSources[E][M][D]}_getDEMWorkerSource(E,M){return this.demWorkerSources[E]||(this.demWorkerSources[E]={}),this.demWorkerSources[E][M]||(this.demWorkerSources[E][M]=new U),this.demWorkerSources[E][M]}}return x.i(self)&&(self.worker=new Ji(self)),Ji}),_("index",["exports","./shared"],function(x,d){var F="4.1.2";let Z,Q;const q={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:p=>new Promise((t,a)=>{const u=requestAnimationFrame(t);p.signal.addEventListener("abort",()=>{cancelAnimationFrame(u),a(d.c())})}),getImageData(p,t=0){return this.getImageCanvasContext(p).getImageData(-t,-t,p.width+2*t,p.height+2*t)},getImageCanvasContext(p){const t=window.document.createElement("canvas"),a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return t.width=p.width,t.height=p.height,a.drawImage(p,0,0,p.width,p.height),a},resolveURL:p=>(Z||(Z=document.createElement("a")),Z.href=p,Z.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Q==null&&(Q=matchMedia("(prefers-reduced-motion: reduce)")),Q.matches)}};class U{static testProp(t){if(!U.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in U.docStyle)return t[a];return t[0]}static create(t,a,u){const c=window.document.createElement(t);return a!==void 0&&(c.className=a),u&&u.appendChild(c),c}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){U.docStyle&&U.selectProp&&(U.userSelect=U.docStyle[U.selectProp],U.docStyle[U.selectProp]="none")}static enableDrag(){U.docStyle&&U.selectProp&&(U.docStyle[U.selectProp]=U.userSelect)}static setTransform(t,a){t.style[U.transformProp]=a}static addEventListener(t,a,u,c={}){t.addEventListener(a,u,"passive"in c?c:c.capture)}static removeEventListener(t,a,u,c={}){t.removeEventListener(a,u,"passive"in c?c:c.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",U.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",U.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",U.suppressClickInternal,!0)},0)}static getScale(t){const a=t.getBoundingClientRect();return{x:a.width/t.offsetWidth||1,y:a.height/t.offsetHeight||1,boundingClientRect:a}}static getPoint(t,a,u){const c=a.boundingClientRect;return new d.P((u.clientX-c.left)/a.x-t.clientLeft,(u.clientY-c.top)/a.y-t.clientTop)}static mousePos(t,a){const u=U.getScale(t);return U.getPoint(t,u,a)}static touchPos(t,a){const u=[],c=U.getScale(t);for(let m=0;m<a.length;m++)u.push(U.getPoint(t,c,a[m]));return u}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}U.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,U.selectProp=U.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),U.transformProp=U.testProp(["transform","WebkitTransform"]);const we={supported:!1,testSupport:function(p){!Ee&&xe&&(ne?te(p):be=p)}};let be,xe,Ee=!1,ne=!1;function te(p){const t=p.createTexture();p.bindTexture(p.TEXTURE_2D,t);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,xe),p.isContextLost())return;we.supported=!0}catch{}p.deleteTexture(t),Ee=!0}var ue,Te;typeof document<"u"&&(xe=document.createElement("img"),xe.onload=function(){be&&te(be),be=null,ne=!0},xe.onerror=function(){Ee=!0,be=null},xe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(p){let t,a,u,c;p.resetRequestQueue=()=>{t=[],a=0,u=0,c={}},p.addThrottleControl=I=>{const C=u++;return c[C]=I,C},p.removeThrottleControl=I=>{delete c[I],w()},p.getImage=(I,C,A=!0)=>new Promise((L,N)=>{we.supported&&(I.headers||(I.headers={}),I.headers.accept="image/webp,*/*"),d.e(I,{type:"image"}),t.push({abortController:C,requestParameters:I,supportImageRefresh:A,state:"queued",onError:Y=>{N(Y)},onSuccess:Y=>{L(Y)}}),w()});const m=I=>d._(this,void 0,void 0,function*(){I.state="running";const{requestParameters:C,supportImageRefresh:A,onError:L,onSuccess:N,abortController:Y}=I,G=A===!1&&!d.i(self)&&!d.g(C.url)&&(!C.headers||Object.keys(C.headers).reduce((le,me)=>le&&me==="accept",!0));a++;const J=G?b(C,Y):d.m(C,Y);try{const le=yield J;delete I.abortController,I.state="completed",le.data instanceof HTMLImageElement||d.b(le.data)?N(le):le.data&&N({data:yield(V=le.data,typeof createImageBitmap=="function"?d.d(V):d.f(V)),cacheControl:le.cacheControl,expires:le.expires})}catch(le){delete I.abortController,L(le)}finally{a--,w()}var V}),w=()=>{const I=(()=>{for(const C of Object.keys(c))if(c[C]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=a;C<I&&t.length>0;C++){const A=t.shift();A.abortController.signal.aborted?C--:m(A)}},b=(I,C)=>new Promise((A,L)=>{const N=new Image,Y=I.url,G=I.credentials;G&&G==="include"?N.crossOrigin="use-credentials":(G&&G==="same-origin"||!d.s(Y))&&(N.crossOrigin="anonymous"),C.signal.addEventListener("abort",()=>{N.src="",L(d.c())}),N.fetchPriority="high",N.onload=()=>{N.onerror=N.onload=null,A({data:N})},N.onerror=()=>{N.onerror=N.onload=null,C.signal.aborted||L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},N.src=Y})}(ue||(ue={})),ue.resetRequestQueue(),function(p){p.Glyphs="Glyphs",p.Image="Image",p.Source="Source",p.SpriteImage="SpriteImage",p.SpriteJSON="SpriteJSON",p.Style="Style",p.Tile="Tile",p.Unknown="Unknown"}(Te||(Te={}));class Ne{constructor(t){this._transformRequestFn=t}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}normalizeSpriteURL(t,a,u){const c=function(m){const w=m.match(pe);if(!w)throw new Error(`Unable to parse URL "${m}"`);return{protocol:w[1],authority:w[2],path:w[3]||"/",params:w[4]?w[4].split("&"):[]}}(t);return c.path+=`${a}${u}`,function(m){const w=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${w}`}(c)}setTransformRequest(t){this._transformRequestFn=t}}const pe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Me(p){var t=new d.A(3);return t[0]=p[0],t[1]=p[1],t[2]=p[2],t}var Ze,tt=function(p,t,a){return p[0]=t[0]-a[0],p[1]=t[1]-a[1],p[2]=t[2]-a[2],p};Ze=new d.A(3),d.A!=Float32Array&&(Ze[0]=0,Ze[1]=0,Ze[2]=0);var ct=function(p){var t=p[0],a=p[1];return t*t+a*a};function vt(p){const t=[];if(typeof p=="string")t.push({id:"default",url:p});else if(p&&p.length>0){const a=[];for(const{id:u,url:c}of p){const m=`${u}${c}`;a.indexOf(m)===-1&&(a.push(m),t.push({id:u,url:c}))}}return t}(function(){var p=new d.A(2);d.A!=Float32Array&&(p[0]=0,p[1]=0)})();class kt{constructor(t,a,u,c){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(a,c)}update(t,a,u){const{width:c,height:m}=t,w=!(this.size&&this.size[0]===c&&this.size[1]===m||u),{context:b}=this,{gl:I}=b;if(this.useMipmap=!!(a&&a.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!a||a.premultiply!==!1)),w)this.size=[c,m],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||d.b(t)?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,t):I.texImage2D(I.TEXTURE_2D,0,this.format,c,m,0,this.format,I.UNSIGNED_BYTE,t.data);else{const{x:C,y:A}=u||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||d.b(t)?I.texSubImage2D(I.TEXTURE_2D,0,C,A,I.RGBA,I.UNSIGNED_BYTE,t):I.texSubImage2D(I.TEXTURE_2D,0,C,A,c,m,I.RGBA,I.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)}bind(t,a,u){const{context:c}=this,{gl:m}=c;m.bindTexture(m.TEXTURE_2D,this.texture),u!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=m.LINEAR),t!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,t),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,u||t),this.filter=t),a!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function Dt(p){const{userImage:t}=p;return!!(t&&t.render&&t.render())&&(p.data.replace(new Uint8Array(t.data.buffer)),!0)}class lr extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,promiseResolve:u}of this.requestors)u(this._getImagesForIds(a));this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const u=a.spriteData;a.data=new d.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let u=!0;const c=a.data||a.spriteData;return this._validateStretch(a.stretchX,c&&c.width)||(this.fire(new d.j(new Error(`Image "${t}" has invalid "stretchX" value`))),u=!1),this._validateStretch(a.stretchY,c&&c.height)||(this.fire(new d.j(new Error(`Image "${t}" has invalid "stretchY" value`))),u=!1),this._validateContent(a.content,a)||(this.fire(new d.j(new Error(`Image "${t}" has invalid "content" value`))),u=!1),u}_validateStretch(t,a){if(!t)return!0;let u=0;for(const c of t){if(c[0]<u||c[1]<c[0]||a<c[1])return!1;u=c[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const u=a.spriteData,c=u&&u.width||a.data.width,m=u&&u.height||a.data.height;return!(t[0]<0||c<t[0]||t[1]<0||m<t[1]||t[2]<0||c<t[2]||t[3]<0||m<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,u=!0){const c=this.getImage(t);if(u&&(c.data.width!==a.data.width||c.data.height!==a.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=c.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((a,u)=>{let c=!0;if(!this.isLoaded())for(const m of t)this.images[m]||(c=!1);this.isLoaded()||c?a(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:a})})}_getImagesForIds(t){const a={};for(const u of t){let c=this.getImage(u);c||(this.fire(new d.k("styleimagemissing",{id:u})),c=this.getImage(u)),c?a[u]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:d.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],u=this.getImage(t);if(!u)return null;if(a&&a.position.version===u.version)return a.position;if(a)a.position.version=u.version;else{const c={w:u.data.width+2,h:u.data.height+2,x:0,y:0},m=new d.I(c,u);this.patterns[t]={bin:c,position:m}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new kt(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const m in this.patterns)t.push(this.patterns[m].bin);const{w:a,h:u}=d.p(t),c=this.atlasImage;c.resize({width:a||1,height:u||1});for(const m in this.patterns){const{bin:w}=this.patterns[m],b=w.x+1,I=w.y+1,C=this.getImage(m).data,A=C.width,L=C.height;d.R.copy(C,c,{x:0,y:0},{x:b,y:I},{width:A,height:L}),d.R.copy(C,c,{x:0,y:L-1},{x:b,y:I-1},{width:A,height:1}),d.R.copy(C,c,{x:0,y:0},{x:b,y:I+L},{width:A,height:1}),d.R.copy(C,c,{x:A-1,y:0},{x:b-1,y:I},{width:1,height:L}),d.R.copy(C,c,{x:0,y:0},{x:b+A,y:I},{width:1,height:L})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const u=this.getImage(a);u||d.w(`Image with ID: "${a}" was not found`),Dt(u)&&this.updateImage(a,u)}}}const wi=1e20;function Gr(p,t,a,u,c,m,w,b,I){for(let C=t;C<t+u;C++)Vt(p,a*m+C,m,c,w,b,I);for(let C=a;C<a+c;C++)Vt(p,C*m+t,1,u,w,b,I)}function Vt(p,t,a,u,c,m,w){m[0]=0,w[0]=-wi,w[1]=wi,c[0]=p[t];for(let b=1,I=0,C=0;b<u;b++){c[b]=p[t+b*a];const A=b*b;do{const L=m[I];C=(c[b]-c[L]+A-L*L)/(b-L)/2}while(C<=w[I]&&--I>-1);I++,m[I]=b,w[I]=C,w[I+1]=wi}for(let b=0,I=0;b<u;b++){for(;w[I+1]<b;)I++;const C=m[I],A=b-C;p[t+b*a]=c[C]+A*A}}class We{constructor(t,a){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return d._(this,void 0,void 0,function*(){const a=[];for(const m in t)for(const w of t[m])a.push(this._getAndCacheGlyphsPromise(m,w));const u=yield Promise.all(a),c={};for(const{stack:m,id:w,glyph:b}of u)c[m]||(c[m]={}),c[m][w]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return c})}_getAndCacheGlyphsPromise(t,a){return d._(this,void 0,void 0,function*(){let u=this.entries[t];u||(u=this.entries[t]={glyphs:{},requests:{},ranges:{}});let c=u.glyphs[a];if(c!==void 0)return{stack:t,id:a,glyph:c};if(c=this._tinySDF(u,t,a),c)return u.glyphs[a]=c,{stack:t,id:a,glyph:c};const m=Math.floor(a/256);if(256*m>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[m])return{stack:t,id:a,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[m]){const b=We.loadGlyphRange(t,m,this.url,this.requestManager);u.requests[m]=b}const w=yield u.requests[m];for(const b in w)this._doesCharSupportLocalGlyph(+b)||(u.glyphs[+b]=w[+b]);return u.ranges[m]=!0,{stack:t,id:a,glyph:w[a]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(d.u["CJK Unified Ideographs"](t)||d.u["Hangul Syllables"](t)||d.u.Hiragana(t)||d.u.Katakana(t))}_tinySDF(t,a,u){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(u))return;let m=t.tinySDF;if(!m){let b="400";/bold/i.test(a)?b="900":/medium/i.test(a)?b="500":/light/i.test(a)&&(b="200"),m=t.tinySDF=new We.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:b})}const w=m.draw(String.fromCharCode(u));return{id:u,bitmap:new d.o({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}}We.loadGlyphRange=function(p,t,a,u){return d._(this,void 0,void 0,function*(){const c=256*t,m=c+255,w=u.transformRequest(a.replace("{fontstack}",p).replace("{range}",`${c}-${m}`),Te.Glyphs),b=yield d.l(w,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${t}, ${c}-${m}`);const I={};for(const C of d.n(b.data))I[C.id]=C;return I})},We.TinySDF=class{constructor({fontSize:p=24,buffer:t=3,radius:a=8,cutoff:u=.25,fontFamily:c="sans-serif",fontWeight:m="normal",fontStyle:w="normal"}={}){this.buffer=t,this.cutoff=u,this.radius=a;const b=this.size=p+4*t,I=this._createCanvas(b),C=this.ctx=I.getContext("2d",{willReadFrequently:!0});C.font=`${w} ${m} ${p}px ${c}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(p){const t=document.createElement("canvas");return t.width=t.height=p,t}draw(p){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:c,actualBoundingBoxRight:m}=this.ctx.measureText(p),w=Math.ceil(a),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-c))),I=Math.min(this.size-this.buffer,w+Math.ceil(u)),C=b+2*this.buffer,A=I+2*this.buffer,L=Math.max(C*A,0),N=new Uint8ClampedArray(L),Y={data:N,width:C,height:A,glyphWidth:b,glyphHeight:I,glyphTop:w,glyphLeft:0,glyphAdvance:t};if(b===0||I===0)return Y;const{ctx:G,buffer:J,gridInner:V,gridOuter:le}=this;G.clearRect(J,J,b,I),G.fillText(p,J,J+w);const me=G.getImageData(J,J,b,I);le.fill(wi,0,L),V.fill(0,0,L);for(let ee=0;ee<I;ee++)for(let he=0;he<b;he++){const ge=me.data[4*(ee*b+he)+3]/255;if(ge===0)continue;const ye=(ee+J)*C+he+J;if(ge===1)le[ye]=0,V[ye]=wi;else{const Se=.5-ge;le[ye]=Se>0?Se*Se:0,V[ye]=Se<0?Se*Se:0}}Gr(le,0,0,C,A,C,this.f,this.v,this.z),Gr(V,J,J,b,I,C,this.f,this.v,this.z);for(let ee=0;ee<L;ee++){const he=Math.sqrt(le[ee])-Math.sqrt(V[ee]);N[ee]=Math.round(255-255*(he/this.radius+this.cutoff))}return Y}};class pt{constructor(){this.specification=d.v.light.position}possiblyEvaluate(t,a){return d.y(t.expression.evaluate(a))}interpolate(t,a,u){return{x:d.z.number(t.x,a.x,u),y:d.z.number(t.y,a.y,u),z:d.z.number(t.z,a.z,u)}}}let ht;class xt extends d.E{constructor(t){super(),ht=ht||new d.q({anchor:new d.D(d.v.light.anchor),position:new pt,color:new d.D(d.v.light.color),intensity:new d.D(d.v.light.intensity)}),this._transitionable=new d.T(ht),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(d.r,t,a))for(const u in t){const c=t[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),c):this._transitionable.setValue(u,c)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,u){return(!u||u.validate!==!1)&&d.t(this,t.call(d.x,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:d.v}))}}class Ct{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const u=t.join(",")+String(a);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(t,a)),this.dashEntry[u]}getDashRanges(t,a,u){const c=[];let m=t.length%2==1?-t[t.length-1]*u:0,w=t[0]*u,b=!0;c.push({left:m,right:w,isDash:b,zeroLength:t[0]===0});let I=t[0];for(let C=1;C<t.length;C++){b=!b;const A=t[C];m=I*u,I+=A,w=I*u,c.push({left:m,right:w,isDash:b,zeroLength:A===0})}return c}addRoundDash(t,a,u){const c=a/2;for(let m=-u;m<=u;m++){const w=this.width*(this.nextRow+u+m);let b=0,I=t[b];for(let C=0;C<this.width;C++){C/I.right>1&&(I=t[++b]);const A=Math.abs(C-I.left),L=Math.abs(C-I.right),N=Math.min(A,L);let Y;const G=m/u*(c+1);if(I.isDash){const J=c-Math.abs(G);Y=Math.sqrt(N*N+J*J)}else Y=c-Math.sqrt(N*N+G*G);this.data[w+C]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(t){for(let b=t.length-1;b>=0;--b){const I=t[b],C=t[b+1];I.zeroLength?t.splice(b,1):C&&C.isDash===I.isDash&&(C.left=I.left,t.splice(b,1))}const a=t[0],u=t[t.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const c=this.width*this.nextRow;let m=0,w=t[m];for(let b=0;b<this.width;b++){b/w.right>1&&(w=t[++m]);const I=Math.abs(b-w.left),C=Math.abs(b-w.right),A=Math.min(I,C);this.data[c+b]=Math.max(0,Math.min(255,(w.isDash?A:-A)+128))}}addDash(t,a){const u=a?7:0,c=2*u+1;if(this.nextRow+c>this.height)return d.w("LineAtlas out of space"),null;let m=0;for(let b=0;b<t.length;b++)m+=t[b];if(m!==0){const b=this.width/m,I=this.getDashRanges(t,this.width,b);a?this.addRoundDash(I,b,u):this.addRegularDash(I)}const w={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:m};return this.nextRow+=c,this.dirty=!0,w}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const Hr="maplibre_preloaded_worker_pool";class Wt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Wt.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Hr]}numActive(){return Object.keys(this.active).length}}const Br=Math.floor(q.hardwareConcurrency/2);let or,Pr;function Fi(){return or||(or=new Wt),or}Wt.workerCount=d.B(globalThis)?Math.max(Math.min(Br,3),1):1;class uo{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const u=this.workerPool.acquire(a);for(let c=0;c<u.length;c++){const m=new d.C(u[c],a);m.name=`Worker ${c}`,this.actors.push(m)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a){const u=[];for(const c of this.actors)u.push(c.sendAsync({type:t,data:a}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(a=>{a.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,a){for(const u of this.actors)u.registerMessageHandler(t,a)}}function kn(){return Pr||(Pr=new uo(Fi(),d.G),Pr.registerMessageHandler("getResource",(p,t,a)=>d.m(t,a))),Pr}function Wr(p,t){const a=d.F();return d.H(a,a,[1,1,0]),d.J(a,a,[.5*p.width,.5*p.height,1]),d.K(a,a,p.calculatePosMatrix(t.toUnwrapped()))}function bi(p,t,a,u,c,m){const w=function(L,N,Y){if(L)for(const G of L){const J=N[G];if(J&&J.source===Y&&J.type==="fill-extrusion")return!0}else for(const G in N){const J=N[G];if(J.source===Y&&J.type==="fill-extrusion")return!0}return!1}(c&&c.layers,t,p.id),b=m.maxPitchScaleFactor(),I=p.tilesIn(u,b,w);I.sort(un);const C=[];for(const L of I)C.push({wrappedTileID:L.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(t,a,p._state,L.queryGeometry,L.cameraQueryGeometry,L.scale,c,m,b,Wr(p.transform,L.tileID))});const A=function(L){const N={},Y={};for(const G of L){const J=G.queryResults,V=G.wrappedTileID,le=Y[V]=Y[V]||{};for(const me in J){const ee=J[me],he=le[me]=le[me]||{},ge=N[me]=N[me]||[];for(const ye of ee)he[ye.featureIndex]||(he[ye.featureIndex]=!0,ge.push(ye))}}return N}(C);for(const L in A)A[L].forEach(N=>{const Y=N.feature,G=p.getFeatureState(Y.layer["source-layer"],Y.id);Y.source=Y.layer.source,Y.layer["source-layer"]&&(Y.sourceLayer=Y.layer["source-layer"]),Y.state=G});return A}function un(p,t){const a=p.tileID,u=t.tileID;return a.overscaledZ-u.overscaledZ||a.canonical.y-u.canonical.y||a.wrap-u.wrap||a.canonical.x-u.canonical.x}function En(p,t,a){return d._(this,void 0,void 0,function*(){let u=p;if(p.url?u=(yield d.h(t.transformRequest(p.url,Te.Source),a)).data:yield q.frameAsync(a),!u)return null;const c=d.L(d.e(u,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(c.vectorLayerIds=u.vector_layers.map(m=>m.id)),c})}class Xt{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof d.M?new d.M(t.lng,t.lat):d.M.convert(t),this}setSouthWest(t){return this._sw=t instanceof d.M?new d.M(t.lng,t.lat):d.M.convert(t),this}extend(t){const a=this._sw,u=this._ne;let c,m;if(t instanceof d.M)c=t,m=t;else{if(!(t instanceof Xt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Xt.convert(t)):this.extend(d.M.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(d.M.convert(t)):this;if(c=t._sw,m=t._ne,!c||!m)return this}return a||u?(a.lng=Math.min(c.lng,a.lng),a.lat=Math.min(c.lat,a.lat),u.lng=Math.max(m.lng,u.lng),u.lat=Math.max(m.lat,u.lat)):(this._sw=new d.M(c.lng,c.lat),this._ne=new d.M(m.lng,m.lat)),this}getCenter(){return new d.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.M(this.getWest(),this.getNorth())}getSouthEast(){return new d.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:u}=d.M.convert(t);let c=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&c}static convert(t){return t instanceof Xt?t:t&&new Xt(t)}static fromLngLat(t,a=0){const u=360*a/40075017,c=u/Math.cos(Math.PI/180*t.lat);return new Xt(new d.M(t.lng-c,t.lat-u),new d.M(t.lng+c,t.lat+u))}}class Gn{constructor(t,a,u){this.bounds=Xt.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),u=Math.floor(d.N(this.bounds.getWest())*a),c=Math.floor(d.O(this.bounds.getNorth())*a),m=Math.ceil(d.N(this.bounds.getEast())*a),w=Math.ceil(d.O(this.bounds.getSouth())*a);return t.x>=u&&t.x<m&&t.y>=c&&t.y<w}}class Ie extends d.E{constructor(t,a,u,c){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.L(a,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield En(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(d.e(this,t),t.bounds&&(this.tileBounds=new Gn(t.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new d.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(t){return d._(this,void 0,void 0,function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(a,Te.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};u.request.collectResourceTiming=this._collectResourceTiming;let c="reloadTile";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((m,w)=>{t.reloadPromise={resolve:m,reject:w}})}else t.actor=this.dispatcher.getActor(),c="loadTile";t.abortController=new AbortController;try{const m=yield t.actor.sendAsync({type:c,data:u},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,m)}catch(m){if(delete t.abortController,t.aborted)return;if(m&&m.status!==404)throw m;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,a){if(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),t.reloadPromise){const u=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(u.resolve).catch(u.reject)}}abortTile(t){return d._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"abortTile",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return d._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"removeTile",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Hn extends d.E{constructor(t,a,u,c){super(),this.id=t,this.dispatcher=u,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},a),d.e(this,d.L(a,["url","scheme","tileSize"]))}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield En(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(d.e(this,t),t.bounds&&(this.tileBounds=new Gn(t.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new d.j(t))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return d.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return d._(this,void 0,void 0,function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const u=yield ue.getImage(this.map._requestManager.transformRequest(a,Te.Tile),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&t.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const c=this.map.painter.context,m=c.gl,w=u.data;t.texture=this.map.painter.getTileTexture(w.width),t.texture?t.texture.update(w,{useMipmap:!0}):(t.texture=new kt(c,w,m.RGBA,{useMipmap:!0}),t.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST),c.extTextureFilterAnisotropic&&m.texParameterf(m.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax)),t.state="loaded"}}catch(u){if(delete t.abortController,t.aborted)t.state="unloaded";else if(u)throw t.state="errored",u}})}abortTile(t){return d._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return d._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class To extends Hn{constructor(t,a,u,c){super(t,a,u,c),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t){return d._(this,void 0,void 0,function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(a,Te.Tile);t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const c=yield ue.getImage(u,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(c&&c.data){const m=c.data;this.map._refreshExpiredTiles&&c.cacheControl&&c.expires&&t.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const w=d.b(m)&&d.S()?m:yield this.readImageNow(m),b={type:this.type,uid:t.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const I=yield t.actor.sendAsync({type:"loadDEMTile",data:b});t.dem=I,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(c){if(delete t.abortController,t.aborted)t.state="unloaded";else if(c)throw t.state="errored",c}})}readImageNow(t){return d._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&d.U()){const a=t.width+2,u=t.height+2;try{return new d.R({width:a,height:u},yield d.V(t,-1,-1,a,u))}catch{}}return q.getImageData(t,1)})}_getNeighboringTiles(t){const a=t.canonical,u=Math.pow(2,a.z),c=(a.x-1+u)%u,m=a.x===0?t.wrap-1:t.wrap,w=(a.x+1+u)%u,b=a.x+1===u?t.wrap+1:t.wrap,I={};return I[new d.Q(t.overscaledZ,m,a.z,c,a.y).key]={backfilled:!1},I[new d.Q(t.overscaledZ,b,a.z,w,a.y).key]={backfilled:!1},a.y>0&&(I[new d.Q(t.overscaledZ,m,a.z,c,a.y-1).key]={backfilled:!1},I[new d.Q(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},I[new d.Q(t.overscaledZ,b,a.z,w,a.y-1).key]={backfilled:!1}),a.y+1<u&&(I[new d.Q(t.overscaledZ,m,a.z,c,a.y+1).key]={backfilled:!1},I[new d.Q(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},I[new d.Q(t.overscaledZ,b,a.z,w,a.y+1).key]={backfilled:!1}),I}unloadTile(t){return d._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"removeDEMTile",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class Pt extends d.E{constructor(t,a,u,c){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(c),this._data=a.data,this._options=d.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const m=d.W/this.tileSize;this.workerOptions=d.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*m,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*m,extent:d.W,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:d.W,radius:(a.clusterRadius||50)*m,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return d._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"getClusterExpansionZoom",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"getClusterChildren",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,a,u){return this.actor.sendAsync({type:"getClusterLeaves",data:{type:this.type,source:this.id,clusterId:t,limit:a,offset:u}})}_updateWorkerData(t){return d._(this,void 0,void 0,function*(){const a=d.e({type:this.type},this.workerOptions);t?a.dataDiff=t:typeof this._data=="string"?(a.request=this.map._requestManager.transformRequest(q.resolveURL(this._data),Te.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new d.k("dataloading",{dataType:"source"}));try{const u=yield this.actor.sendAsync({type:"loadData",data:a});if(this._pendingLoads--,this._removed||u.abandoned)return void this.fire(new d.k("dataabort",{dataType:"source"}));let c=null;u.resourceTiming&&u.resourceTiming[this.id]&&(c=u.resourceTiming[this.id].slice(0));const m={dataType:"source"};this._collectResourceTiming&&c&&c.length>0&&d.e(m,{resourceTiming:c}),this.fire(new d.k("data",Object.assign(Object.assign({},m),{sourceDataType:"metadata"}))),this.fire(new d.k("data",Object.assign(Object.assign({},m),{sourceDataType:"content"})))}catch(u){if(this._pendingLoads--,this._removed)return void this.fire(new d.k("dataabort",{dataType:"source"}));this.fire(new d.j(u))}})}loaded(){return this._pendingLoads===0}loadTile(t){return d._(this,void 0,void 0,function*(){const a=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const u={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const c=yield this.actor.sendAsync({type:a,data:u},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(c,this.map.painter,a==="reloadTile")})}abortTile(t){return d._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return d._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"removeTile",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"removeSource",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var dr=d.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Bi extends d.E{constructor(t,a,u,c){super(),this.id=t,this.dispatcher=u,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=a}load(t){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield ue.getImage(this.map._requestManager.transformRequest(this.url,Te.Image),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,t&&(this.coordinates=t),this._finishLoading())}catch(a){this._request=null,this.fire(new d.j(a))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(d.Y.fromLngLat);this.tileID=function(c){let m=1/0,w=1/0,b=-1/0,I=-1/0;for(const N of c)m=Math.min(m,N.x),w=Math.min(w,N.y),b=Math.max(b,N.x),I=Math.max(I,N.y);const C=Math.max(b-m,I-w),A=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),L=Math.pow(2,A);return new d.a0(A,Math.floor((m+b)/2*L),Math.floor((w+I)/2*L))}(a),this.minzoom=this.maxzoom=this.tileID.z;const u=a.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new d.Z,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,d.W,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,d.W),this._boundsArray.emplaceBack(u[2].x,u[2].y,d.W,d.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,dr.members)),this.boundsSegments||(this.boundsSegments=d.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new kt(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let u=!1;for(const c in this.tiles){const m=this.tiles[c];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return d._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Cn extends Bi{constructor(t,a,u,c){super(t,a,u,c),this.roundZoom=!0,this.type="video",this.options=a}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const a of t.urls)this.urls.push(this.map._requestManager.transformRequest(a,Te.Source).url);try{const a=yield d.a2(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new d.j(a))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new d.j(new d.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,a=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,dr.members)),this.boundsSegments||(this.boundsSegments=d.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new kt(t,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let u=!1;for(const c in this.tiles){const m=this.tiles[c];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class di extends Bi{constructor(t,a,u,c){super(t,a,u,c),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(w=>typeof w!="number"))||this.fire(new d.j(new d.a1(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.j(new d.a1(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new d.j(new d.a1(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new d.j(new d.a1(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.j(new d.a1(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return d._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,u=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,dr.members)),this.boundsSegments||(this.boundsSegments=d.$.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new kt(a,this.canvas,u.RGBA,{premultiply:!0});let c=!1;for(const m in this.tiles){const w=this.tiles[m];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,c=!0)}c&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Xi={},Pn=p=>{switch(p){case"geojson":return Pt;case"image":return Bi;case"raster":return Hn;case"raster-dem":return To;case"vector":return Ie;case"video":return Cn;case"canvas":return di}return Xi[p]},cn="RTLPluginLoaded";class Io extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=kn()}_syncState(t){return this.status=t,this.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t,pluginURL:this.url}).catch(a=>{throw this.status="error",a})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return d._(this,arguments,void 0,function*(a,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=q.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return d._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.k(cn))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Re=null;function ii(){return Re||(Re=new Io),Re}class Qr{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=d.a3(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const a=t+this.timeAdded;a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(c,m){const w={};if(!m)return w;for(const b of c){const I=b.layerIds.map(C=>m.getLayer(C)).filter(Boolean);if(I.length!==0){b.layers=I,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(C=>I.filter(A=>A.id===C)[0]));for(const C of I)w[C.id]=b}}return w}(t.buckets,a.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const m=this.buckets[c];if(m instanceof d.a5){if(this.hasSymbolBuckets=!0,!u)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const m=this.buckets[c];if(m instanceof d.a5&&m.hasRTLText){this.hasRTLText=!0,ii().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const m=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(c).queryRadius(m))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new d.a4}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const u in this.buckets){const c=this.buckets[u];c.uploadPending()&&c.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new kt(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new kt(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,u,c,m,w,b,I,C,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:m,scale:w,tileSize:this.tileSize,pixelPosMatrix:A,transform:I,params:b,queryPadding:this.queryPadding*C},t,a,u):{}}querySourceFeatures(t,a){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const c=u.loadVTLayers(),m=a&&a.sourceLayer?a.sourceLayer:"",w=c._geojsonTileLayer||c[m];if(!w)return;const b=d.a6(a&&a.filter),{z:I,x:C,y:A}=this.tileID.canonical,L={z:I,x:C,y:A};for(let N=0;N<w.length;N++){const Y=w.feature(N);if(b.needGeometry){const V=d.a7(Y,!0);if(!b.filter(new d.a8(this.tileID.overscaledZ),V,this.tileID.canonical))continue}else if(!b.filter(new d.a8(this.tileID.overscaledZ),Y))continue;const G=u.getId(Y,m),J=new d.a9(Y,I,C,A,G);J.tile=L,t.push(J)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const u=d.aa(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let c=!1;if(this.expirationTime>u)c=!1;else if(a)if(this.expirationTime<a)c=!0;else{const m=this.expirationTime-a;m?this.expirationTime=u+Math.max(m,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!a.style.hasLayer(c))continue;const m=this.buckets[c],w=m.layers[0].sourceLayer||"_geojsonTileLayer",b=u[w],I=t[w];if(!b||!I||Object.keys(I).length===0)continue;m.update(I,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});const C=a&&a.style&&a.style.getLayer(c);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=q.now()+t}setDependencies(t,a){const u={};for(const c of a)u[c]=!0;this.dependencies[t]=u}hasDependency(t,a){for(const u of t){const c=this.dependencies[u];if(c){for(const m of a)if(c[m])return!0}}return!1}}class co{constructor(t,a){this.max=t,this.onRemove=a,this.reset()}reset(){for(const t in this.data)for(const a of this.data[t])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(t,a,u){const c=t.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const m={value:a,timeout:void 0};if(u!==void 0&&(m.timeout=setTimeout(()=>{this.remove(t,m)},u)),this.data[c].push(m),this.order.push(c),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const a=this.data[t].shift();return a.timeout&&clearTimeout(a.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),a.value}getByKey(t){const a=this.data[t];return a?a[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,a){if(!this.has(t))return this;const u=t.wrapped().key,c=a===void 0?0:this.data[u].indexOf(a),m=this.data[u][c];return this.data[u].splice(c,1),m.timeout&&clearTimeout(m.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(m.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(t){const a=[];for(const u in this.data)for(const c of this.data[u])t(c.value)||a.push(c);for(const u of a)this.remove(u.value.tileID,u)}}class Wn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,u){const c=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][c]=this.stateChanges[t][c]||{},d.e(this.stateChanges[t][c],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const m in this.state[t])m!==c&&(this.deletedStates[t][m]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][c]===null){this.deletedStates[t][c]={};for(const m in this.state[t][c])u[m]||(this.deletedStates[t][c][m]=null)}else for(const m in u)this.deletedStates[t]&&this.deletedStates[t][c]&&this.deletedStates[t][c][m]===null&&delete this.deletedStates[t][c][m]}removeFeatureState(t,a,u){if(this.deletedStates[t]===null)return;const c=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&a!==void 0)this.deletedStates[t][c]!==null&&(this.deletedStates[t][c]=this.deletedStates[t][c]||{},this.deletedStates[t][c][u]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][c])for(u in this.deletedStates[t][c]={},this.stateChanges[t][c])this.deletedStates[t][c][u]=null;else this.deletedStates[t][c]=null;else this.deletedStates[t]=null}getState(t,a){const u=String(a),c=d.e({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const m=this.deletedStates[t][a];if(m===null)return{};for(const w in m)delete c[w]}return c}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const u={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const m={};for(const w in this.stateChanges[c])this.state[c][w]||(this.state[c][w]={}),d.e(this.state[c][w],this.stateChanges[c][w]),m[w]=this.state[c][w];u[c]=m}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const m={};if(this.deletedStates[c]===null)for(const w in this.state[c])m[w]={},this.state[c][w]={};else for(const w in this.deletedStates[c]){if(this.deletedStates[c][w]===null)this.state[c][w]={};else for(const b of Object.keys(this.deletedStates[c][w]))delete this.state[c][w][b];m[w]=this.state[c][w]}u[c]=u[c]||{},d.e(u[c],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const c in t)t[c].setFeatureState(u,a)}}class Fe extends d.E{constructor(t,a,u){super(),this.id=t,this.dispatcher=u,this.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,m,w,b)=>{const I=new(Pn(m.type))(c,m,w,b);if(I.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${I.id}`);return I})(t,a,u,this),this._tiles={},this._cache=new co(0,c=>this._unloadTile(c)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Wn,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const a=this._tiles[t];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a,u){return d._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,a,u)}catch(c){t.state="errored",c.status!==404?this._source.fire(new d.j(c,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new d.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const u=this._tiles[a];u.upload(t),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(mt).map(t=>t.key)}getRenderableIds(t){const a=[];for(const u in this._tiles)this._isIdRenderable(u,t)&&a.push(this._tiles[u]);return t?a.sort((u,c)=>{const m=u.tileID,w=c.tileID,b=new d.P(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),I=new d.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-w.overscaledZ||I.y-b.y||I.x-b.x}).map(u=>u.tileID.key):a.map(u=>u.tileID).sort(mt).map(u=>u.key)}hasRenderableParent(t){const a=this.findLoadedParent(t,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(t,a){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(a||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,a){return d._(this,void 0,void 0,function*(){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=a),yield this._loadTile(u,t,a))})}_tileLoaded(t,a,u){t.timeAdded=q.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new d.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const a=this.getRenderableIds();for(let c=0;c<a.length;c++){const m=a[c];if(t.neighboringTiles&&t.neighboringTiles[m]){const w=this.getTileByID(m);u(t,w),u(w,t)}}function u(c,m){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let w=m.tileID.canonical.x-c.tileID.canonical.x;const b=m.tileID.canonical.y-c.tileID.canonical.y,I=Math.pow(2,c.tileID.canonical.z),C=m.tileID.key;w===0&&b===0||Math.abs(b)>1||(Math.abs(w)>1&&(Math.abs(w+I)===1?w+=I:Math.abs(w-I)===1&&(w-=I)),m.dem&&c.dem&&(c.dem.backfillBorder(m.dem,w,b),c.neighboringTiles&&c.neighboringTiles[C]&&(c.neighboringTiles[C].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,a,u,c){for(const m in this._tiles){let w=this._tiles[m];if(c[m]||!w.hasData()||w.tileID.overscaledZ<=a||w.tileID.overscaledZ>u)continue;let b=w.tileID;for(;w&&w.tileID.overscaledZ>a+1;){const C=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[C.key],w&&w.hasData()&&(b=C)}let I=b;for(;I.overscaledZ>a;)if(I=I.scaledTo(I.overscaledZ-1),t[I.key]){c[b.key]=b;break}}}findLoadedParent(t,a){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=a?u:null}for(let u=t.overscaledZ-1;u>=a;u--){const c=t.scaledTo(u),m=this._getLoadedTile(c);if(m)return m}}_getLoadedTile(t){const a=this._tiles[t.key];return a&&a.hasData()?a:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,u=Math.ceil(t.height/this._source.tileSize)+1,c=Math.floor(a*u*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(m)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,a){const u={};for(const c in this._tiles){const m=this._tiles[c];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+a),u[m.tileID.key]=m}this._tiles=u;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}update(t,a){if(this.transform=t,this.terrain=a,!this._sourceLoaded||this._paused)return;let u;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new d.Q(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(u=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a}),this._source.hasTile&&(u=u.filter(A=>this._source.hasTile(A)))):u=[];const c=t.coveringZoomLevel(this._source),m=Math.max(c-Fe.maxOverzooming,this._source.minzoom),w=Math.max(c+Fe.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const A={};for(const L of u)if(L.canonical.z>this._source.minzoom){const N=L.scaledTo(L.canonical.z-1);A[N.key]=N;const Y=L.scaledTo(Math.max(this._source.minzoom,Math.min(L.canonical.z,5)));A[Y.key]=Y}u=u.concat(Object.values(A))}const b=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,b&&this.fire(new d.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const I=this._updateRetainedTiles(u,c);if(gt(this._source.type)){const A={},L={},N=Object.keys(I),Y=q.now();for(const G of N){const J=I[G],V=this._tiles[G];if(!V||V.fadeEndTime!==0&&V.fadeEndTime<=Y)continue;const le=this.findLoadedParent(J,m);le&&(this._addTile(le.tileID),A[le.tileID.key]=le.tileID),L[G]=J}this._retainLoadedChildren(L,c,w,I);for(const G in A)I[G]||(this._coveredTiles[G]=!0,I[G]=A[G]);if(a){const G={},J={};for(const V of u)this._tiles[V.key].hasData()?G[V.key]=V:J[V.key]=V;for(const V in J){const le=J[V].children(this._source.maxzoom);this._tiles[le[0].key]&&this._tiles[le[1].key]&&this._tiles[le[2].key]&&this._tiles[le[3].key]&&(G[le[0].key]=I[le[0].key]=le[0],G[le[1].key]=I[le[1].key]=le[1],G[le[2].key]=I[le[2].key]=le[2],G[le[3].key]=I[le[3].key]=le[3],delete J[V])}for(const V in J){const le=this.findLoadedParent(J[V],this._source.minzoom);if(le){G[le.tileID.key]=I[le.tileID.key]=le.tileID;for(const me in G)G[me].isChildOf(le.tileID)&&delete G[me]}}for(const V in this._tiles)G[V]||(this._coveredTiles[V]=!0)}}for(const A in I)this._tiles[A].clearFadeHold();const C=d.ab(this._tiles,I);for(const A of C){const L=this._tiles[A];L.hasSymbolBuckets&&!L.holdingForFade()?L.setHoldDuration(this.map._fadeDuration):L.hasSymbolBuckets&&!L.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){const u={},c={},m=Math.max(a-Fe.maxOverzooming,this._source.minzoom),w=Math.max(a+Fe.maxUnderzooming,this._source.minzoom),b={};for(const I of t){const C=this._addTile(I);u[I.key]=I,C.hasData()||a<this._source.maxzoom&&(b[I.key]=I)}this._retainLoadedChildren(b,a,w,u);for(const I of t){let C=this._tiles[I.key];if(C.hasData())continue;if(a+1>this._source.maxzoom){const L=I.children(this._source.maxzoom)[0],N=this.getTile(L);if(N&&N.hasData()){u[L.key]=L;continue}}else{const L=I.children(this._source.maxzoom);if(u[L[0].key]&&u[L[1].key]&&u[L[2].key]&&u[L[3].key])continue}let A=C.wasRequested();for(let L=I.overscaledZ-1;L>=m;--L){const N=I.scaledTo(L);if(c[N.key])break;if(c[N.key]=!0,C=this.getTile(N),!C&&A&&(C=this._addTile(N)),C){const Y=C.hasData();if((A||Y)&&(u[N.key]=N),A=C.wasRequested(),Y)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const a=[];let u,c=this._tiles[t].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){u=this._loadedParentTiles[c.key];break}a.push(c.key);const m=c.scaledTo(c.overscaledZ-1);if(u=this._getLoadedTile(m),u)break;c=m}for(const m of a)this._loadedParentTiles[m]=u}}_addTile(t){let a=this._tiles[t.key];if(a)return a;a=this._cache.getAndRemove(t),a&&(this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,a)));const u=a;return a||(a=new Qr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,t.key,a.state)),a.uses++,this._tiles[t.key]=a,u||this._source.fire(new d.k("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=a.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const a=this._tiles[t];a&&(a.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,a,u){const c=[],m=this.transform;if(!m)return c;const w=u?m.getCameraQueryGeometry(t):t,b=t.map(G=>m.pointCoordinate(G,this.terrain)),I=w.map(G=>m.pointCoordinate(G,this.terrain)),C=this.getIds();let A=1/0,L=1/0,N=-1/0,Y=-1/0;for(const G of I)A=Math.min(A,G.x),L=Math.min(L,G.y),N=Math.max(N,G.x),Y=Math.max(Y,G.y);for(let G=0;G<C.length;G++){const J=this._tiles[C[G]];if(J.holdingForFade())continue;const V=J.tileID,le=Math.pow(2,m.zoom-J.tileID.overscaledZ),me=a*J.queryPadding*d.W/J.tileSize/le,ee=[V.getTilePoint(new d.Y(A,L)),V.getTilePoint(new d.Y(N,Y))];if(ee[0].x-me<d.W&&ee[0].y-me<d.W&&ee[1].x+me>=0&&ee[1].y+me>=0){const he=b.map(ye=>V.getTilePoint(ye)),ge=I.map(ye=>V.getTilePoint(ye));c.push({tile:J,tileID:V,queryGeometry:he,cameraQueryGeometry:ge,scale:le})}}return c}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map(u=>this._tiles[u].tileID);for(const u of a)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(gt(this._source.type)){const t=q.now();for(const a in this._tiles)if(this._tiles[a].fadeEndTime>=t)return!0}return!1}setFeatureState(t,a,u){this._state.updateState(t=t||"_geojsonTileLayer",a,u)}removeFeatureState(t,a,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",a,u)}getFeatureState(t,a){return this._state.getState(t=t||"_geojsonTileLayer",a)}setDependencies(t,a,u){const c=this._tiles[t];c&&c.setDependencies(a,u)}reloadTilesForDependencies(t,a){for(const u in this._tiles)this._tiles[u].hasDependency(t,a)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(t,a))}}function mt(p,t){const a=Math.abs(2*p.wrap)-+(p.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return p.overscaledZ-t.overscaledZ||u-a||t.canonical.y-p.canonical.y||t.canonical.x-p.canonical.x}function gt(p){return p==="raster"||p==="image"||p==="video"}Fe.maxOverzooming=10,Fe.maxUnderzooming=3;class br{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=d.ac(t,0,1);let a=1,u=this._distances[a];const c=t*this.paddedLength+this.padding;for(;u<c&&a<this._distances.length;)u=this._distances[++a];const m=a-1,w=this._distances[m],b=u-w,I=b>0?(c-w)/b:0;return this.points[m].mult(1-I).add(this.points[a].mult(I))}}function Si(p,t){let a=!0;return p==="always"||p!=="never"&&t!=="never"||(a=!1),a}class yt{constructor(t,a,u){const c=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(a/u);for(let w=0;w<this.xCellCount*this.yCellCount;w++)c.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,u,c,m){this._forEachCell(a,u,c,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(c),this.bboxes.push(m)}insertCircle(t,a,u,c){this._forEachCell(a-c,u-c,a+c,u+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(u),this.circles.push(c)}_insertBoxCell(t,a,u,c,m,w){this.boxCells[m].push(w)}_insertCircleCell(t,a,u,c,m,w){this.circleCells[m].push(w)}_query(t,a,u,c,m,w,b){if(u<0||t>this.width||c<0||a>this.height)return[];const I=[];if(t<=0&&a<=0&&this.width<=u&&this.height<=c){if(m)return[{key:null,x1:t,y1:a,x2:u,y2:c}];for(let C=0;C<this.boxKeys.length;C++)I.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const A=this.circles[3*C],L=this.circles[3*C+1],N=this.circles[3*C+2];I.push({key:this.circleKeys[C],x1:A-N,y1:L-N,x2:A+N,y2:L+N})}}else this._forEachCell(t,a,u,c,this._queryCell,I,{hitTest:m,overlapMode:w,seenUids:{box:{},circle:{}}},b);return I}query(t,a,u,c){return this._query(t,a,u,c,!1,null)}hitTest(t,a,u,c,m,w){return this._query(t,a,u,c,!0,m,w).length>0}hitTestCircle(t,a,u,c,m){const w=t-u,b=t+u,I=a-u,C=a+u;if(b<0||w>this.width||C<0||I>this.height)return!1;const A=[];return this._forEachCell(w,I,b,C,this._queryCellCircle,A,{hitTest:!0,overlapMode:c,circle:{x:t,y:a,radius:u},seenUids:{box:{},circle:{}}},m),A.length>0}_queryCell(t,a,u,c,m,w,b,I){const{seenUids:C,hitTest:A,overlapMode:L}=b,N=this.boxCells[m];if(N!==null){const G=this.bboxes;for(const J of N)if(!C.box[J]){C.box[J]=!0;const V=4*J,le=this.boxKeys[J];if(t<=G[V+2]&&a<=G[V+3]&&u>=G[V+0]&&c>=G[V+1]&&(!I||I(le))&&(!A||!Si(L,le.overlapMode))&&(w.push({key:le,x1:G[V],y1:G[V+1],x2:G[V+2],y2:G[V+3]}),A))return!0}}const Y=this.circleCells[m];if(Y!==null){const G=this.circles;for(const J of Y)if(!C.circle[J]){C.circle[J]=!0;const V=3*J,le=this.circleKeys[J];if(this._circleAndRectCollide(G[V],G[V+1],G[V+2],t,a,u,c)&&(!I||I(le))&&(!A||!Si(L,le.overlapMode))){const me=G[V],ee=G[V+1],he=G[V+2];if(w.push({key:le,x1:me-he,y1:ee-he,x2:me+he,y2:ee+he}),A)return!0}}}return!1}_queryCellCircle(t,a,u,c,m,w,b,I){const{circle:C,seenUids:A,overlapMode:L}=b,N=this.boxCells[m];if(N!==null){const G=this.bboxes;for(const J of N)if(!A.box[J]){A.box[J]=!0;const V=4*J,le=this.boxKeys[J];if(this._circleAndRectCollide(C.x,C.y,C.radius,G[V+0],G[V+1],G[V+2],G[V+3])&&(!I||I(le))&&!Si(L,le.overlapMode))return w.push(!0),!0}}const Y=this.circleCells[m];if(Y!==null){const G=this.circles;for(const J of Y)if(!A.circle[J]){A.circle[J]=!0;const V=3*J,le=this.circleKeys[J];if(this._circlesCollide(G[V],G[V+1],G[V+2],C.x,C.y,C.radius)&&(!I||I(le))&&!Si(L,le.overlapMode))return w.push(!0),!0}}}_forEachCell(t,a,u,c,m,w,b,I){const C=this._convertToXCellCoord(t),A=this._convertToYCellCoord(a),L=this._convertToXCellCoord(u),N=this._convertToYCellCoord(c);for(let Y=C;Y<=L;Y++)for(let G=A;G<=N;G++)if(m.call(this,t,a,u,c,this.xCellCount*G+Y,w,b,I))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,u,c,m,w){const b=c-t,I=m-a,C=u+w;return C*C>b*b+I*I}_circleAndRectCollide(t,a,u,c,m,w,b){const I=(w-c)/2,C=Math.abs(t-(c+I));if(C>I+u)return!1;const A=(b-m)/2,L=Math.abs(a-(m+A));if(L>A+u)return!1;if(C<=I||L<=A)return!0;const N=C-I,Y=L-A;return N*N+Y*Y<=u*u}}function Mn(p,t,a,u,c){const m=d.F();return t?(d.J(m,m,[1/c,1/c,1]),a||d.ad(m,m,u.angle)):d.K(m,u.labelPlaneMatrix,p),m}function Ji(p,t,a,u,c){if(t){const m=d.ae(p);return d.J(m,m,[c,c,1]),a||d.ad(m,m,-u.angle),m}return u.glCoordMatrix}function H(p,t,a){let u;a?(u=[p.x,p.y,a(p.x,p.y),1],d.af(u,u,t)):(u=[p.x,p.y,0,1],Je(u,u,t));const c=u[3];return{point:new d.P(u[0]/c,u[1]/c),signedDistanceFromCamera:c}}function E(p,t){return .5+p/t*.5}function M(p,t){const a=p[0]/p[3],u=p[1]/p[3];return a>=-t[0]&&a<=t[0]&&u>=-t[1]&&u<=t[1]}function D(p,t,a,u,c,m,w,b,I,C){const A=u?p.textSizeData:p.iconSizeData,L=d.ag(A,a.transform.zoom),N=[256/a.width*2+1,256/a.height*2+1],Y=u?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;Y.clear();const G=p.lineVertexArray,J=u?p.text.placedSymbolArray:p.icon.placedSymbolArray,V=a.transform.width/a.transform.height;let le=!1;for(let me=0;me<J.length;me++){const ee=J.get(me);if(ee.hidden||ee.writingMode===d.ah.vertical&&!le){Oe(ee.numGlyphs,Y);continue}let he;if(le=!1,C?(he=[ee.anchorX,ee.anchorY,C(ee.anchorX,ee.anchorY),1],d.af(he,he,t)):(he=[ee.anchorX,ee.anchorY,0,1],Je(he,he,t)),!M(he,N)){Oe(ee.numGlyphs,Y);continue}const ge=E(a.transform.cameraToCenterDistance,he[3]),ye=d.ai(A,L,ee),Se=w?ye/ge:ye*ge,Ae=new d.P(ee.anchorX,ee.anchorY),Pe=H(Ae,c,C).point,ze={projections:{},offsets:{}},Ye=re(ee,Se,!1,b,t,c,m,p.glyphOffsetArray,G,Y,Pe,Ae,ze,V,I,C);le=Ye.useVertical,(Ye.notEnoughRoom||le||Ye.needsFlipping&&re(ee,Se,!0,b,t,c,m,p.glyphOffsetArray,G,Y,Pe,Ae,ze,V,I,C).notEnoughRoom)&&Oe(ee.numGlyphs,Y)}u?p.text.dynamicLayoutVertexBuffer.updateData(Y):p.icon.dynamicLayoutVertexBuffer.updateData(Y)}function O(p,t,a,u,c,m,w,b,I,C,A,L,N){const Y=b.glyphStartIndex+b.numGlyphs,G=b.lineStartIndex,J=b.lineStartIndex+b.lineLength,V=t.getoffsetX(b.glyphStartIndex),le=t.getoffsetX(Y-1),me=ve(p*V,a,u,c,m,w,b.segment,G,J,I,C,A,L,N);if(!me)return null;const ee=ve(p*le,a,u,c,m,w,b.segment,G,J,I,C,A,L,N);return ee?{first:me,last:ee}:null}function X(p,t,a,u){return p===d.ah.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*u?{useVertical:!0}:(p===d.ah.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function re(p,t,a,u,c,m,w,b,I,C,A,L,N,Y,G,J){const V=t/24,le=p.lineOffsetX*V,me=p.lineOffsetY*V;let ee;if(p.numGlyphs>1){const he=p.glyphStartIndex+p.numGlyphs,ge=p.lineStartIndex,ye=p.lineStartIndex+p.lineLength,Se=O(V,b,le,me,a,A,L,p,I,m,N,G,J);if(!Se)return{notEnoughRoom:!0};const Ae=H(Se.first.point,w,J).point,Pe=H(Se.last.point,w,J).point;if(u&&!a){const ze=X(p.writingMode,Ae,Pe,Y);if(ze)return ze}ee=[Se.first];for(let ze=p.glyphStartIndex+1;ze<he-1;ze++)ee.push(ve(V*b.getoffsetX(ze),le,me,a,A,L,p.segment,ge,ye,I,m,N,G,J));ee.push(Se.last)}else{if(u&&!a){const ge=H(L,c,J).point,ye=p.lineStartIndex+p.segment+1,Se=new d.P(I.getx(ye),I.gety(ye)),Ae=H(Se,c,J),Pe=Ae.signedDistanceFromCamera>0?Ae.point:oe(L,Se,ge,1,c,J),ze=X(p.writingMode,ge,Pe,Y);if(ze)return ze}const he=ve(V*b.getoffsetX(p.glyphStartIndex),le,me,a,A,L,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,I,m,N,G,J);if(!he)return{notEnoughRoom:!0};ee=[he]}for(const he of ee)d.aj(C,he.point,he.angle);return{}}function oe(p,t,a,u,c,m){const w=H(p.add(p.sub(t)._unit()),c,m).point,b=a.sub(w);return a.add(b._mult(u/b.mag()))}function W(p,t){const{projectionCache:a,lineVertexArray:u,labelPlaneMatrix:c,tileAnchorPoint:m,distanceFromAnchor:w,getElevation:b,previousVertex:I,direction:C,absOffsetX:A}=t;if(a.projections[p])return a.projections[p];const L=new d.P(u.getx(p),u.gety(p)),N=H(L,c,b);if(N.signedDistanceFromCamera>0)return a.projections[p]=N.point,N.point;const Y=p-C;return oe(w===0?m:new d.P(u.getx(Y),u.gety(Y)),L,I,A-w+1,c,b)}function se(p,t,a){return p._unit()._perp()._mult(t*a)}function _e(p,t,a,u,c,m,w,b){const{projectionCache:I,direction:C}=b;if(I.offsets[p])return I.offsets[p];const A=a.add(t);if(p+C<u||p+C>=c)return I.offsets[p]=A,A;const L=W(p+C,b),N=se(L.sub(a),w,C),Y=a.add(N),G=L.add(N);return I.offsets[p]=d.ak(m,A,Y,G)||A,I.offsets[p]}function ve(p,t,a,u,c,m,w,b,I,C,A,L,N,Y){const G=u?p-t:p+t;let J=G>0?1:-1,V=0;u&&(J*=-1,V=Math.PI),J<0&&(V+=Math.PI);let le,me,ee=J>0?b+w:b+w+1,he=c,ge=c,ye=0,Se=0;const Ae=Math.abs(G),Pe=[];let ze;for(;ye+Se<=Ae;){if(ee+=J,ee<b||ee>=I)return null;ye+=Se,ge=he,me=le;const Ue={projectionCache:L,lineVertexArray:C,labelPlaneMatrix:A,tileAnchorPoint:m,distanceFromAnchor:ye,getElevation:Y,previousVertex:ge,direction:J,absOffsetX:Ae};if(he=W(ee,Ue),a===0)Pe.push(ge),ze=he.sub(ge);else{let ut;const wt=he.sub(ge);ut=wt.mag()===0?se(W(ee+J,Ue).sub(he),a,J):se(wt,a,J),me||(me=ge.add(ut)),le=_e(ee,ut,he,b,I,me,a,Ue),Pe.push(me),ze=le.sub(me)}Se=ze.mag()}const Ye=ze._mult((Ae-ye)/Se)._add(me||ge),_t=V+Math.atan2(he.y-ge.y,he.x-ge.x);return Pe.push(Ye),{point:Ye,angle:N?_t:0,path:Pe}}const fe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Oe(p,t){for(let a=0;a<p;a++){const u=t.length;t.resize(u+4),t.float32.set(fe,3*u)}}function Je(p,t,a){const u=t[0],c=t[1];return p[0]=a[0]*u+a[4]*c+a[12],p[1]=a[1]*u+a[5]*c+a[13],p[3]=a[3]*u+a[7]*c+a[15],p}const Qe=100;class st{constructor(t,a=new yt(t.width+200,t.height+200,25),u=new yt(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=u,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Qe,this.screenBottomBoundary=t.height+Qe,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,u,c,m,w){const b=this.projectAndGetPerspectiveRatio(c,t.anchorPointX,t.anchorPointY,w),I=u*b.perspectiveRatio,C=t.x1*I+b.point.x,A=t.y1*I+b.point.y,L=t.x2*I+b.point.x,N=t.y2*I+b.point.y;return!this.isInsideGrid(C,A,L,N)||a!=="always"&&this.grid.hitTest(C,A,L,N,a,m)||b.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[C,A,L,N],offscreen:this.isOffscreen(C,A,L,N)}}placeCollisionCircles(t,a,u,c,m,w,b,I,C,A,L,N,Y,G){const J=[],V=new d.P(a.anchorX,a.anchorY),le=H(V,w,G),me=E(this.transform.cameraToCenterDistance,le.signedDistanceFromCamera),ee=(A?m/me:m*me)/d.ao,he=H(V,b,G).point,ge=O(ee,c,a.lineOffsetX*ee,a.lineOffsetY*ee,!1,he,V,a,u,b,{projections:{},offsets:{}},!1,G);let ye=!1,Se=!1,Ae=!0;if(ge){const Pe=.5*N*me+Y,ze=new d.P(-100,-100),Ye=new d.P(this.screenRightBoundary,this.screenBottomBoundary),_t=new br,Ue=ge.first,ut=ge.last;let wt=[];for(let St=Ue.path.length-1;St>=1;St--)wt.push(Ue.path[St]);for(let St=1;St<ut.path.length;St++)wt.push(ut.path[St]);const zt=2.5*Pe;if(I){const St=wt.map(Tt=>H(Tt,I,G));wt=St.some(Tt=>Tt.signedDistanceFromCamera<=0)?[]:St.map(Tt=>Tt.point)}let ft=[];if(wt.length>0){const St=wt[0].clone(),Tt=wt[0].clone();for(let cr=1;cr<wt.length;cr++)St.x=Math.min(St.x,wt[cr].x),St.y=Math.min(St.y,wt[cr].y),Tt.x=Math.max(Tt.x,wt[cr].x),Tt.y=Math.max(Tt.y,wt[cr].y);ft=St.x>=ze.x&&Tt.x<=Ye.x&&St.y>=ze.y&&Tt.y<=Ye.y?[wt]:Tt.x<ze.x||St.x>Ye.x||Tt.y<ze.y||St.y>Ye.y?[]:d.al([wt],ze.x,ze.y,Ye.x,Ye.y)}for(const St of ft){_t.reset(St,.25*Pe);let Tt=0;Tt=_t.length<=.5*Pe?1:Math.ceil(_t.paddedLength/zt)+1;for(let cr=0;cr<Tt;cr++){const Kt=cr/Math.max(Tt-1,1),ki=_t.lerp(Kt),Ar=ki.x+Qe,er=ki.y+Qe;J.push(Ar,er,Pe,0);const ai=Ar-Pe,fn=er-Pe,Rn=Ar+Pe,Fo=er+Pe;if(Ae=Ae&&this.isOffscreen(ai,fn,Rn,Fo),Se=Se||this.isInsideGrid(ai,fn,Rn,Fo),t!=="always"&&this.grid.hitTestCircle(Ar,er,Pe,t,L)&&(ye=!0,!C))return{circles:[],offscreen:!1,collisionDetected:ye}}}}return{circles:!C&&ye||!Se||me<this.perspectiveRatioCutoff?[]:J,offscreen:Ae,collisionDetected:ye}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let u=1/0,c=1/0,m=-1/0,w=-1/0;for(const A of t){const L=new d.P(A.x+Qe,A.y+Qe);u=Math.min(u,L.x),c=Math.min(c,L.y),m=Math.max(m,L.x),w=Math.max(w,L.y),a.push(L)}const b=this.grid.query(u,c,m,w).concat(this.ignoredGrid.query(u,c,m,w)),I={},C={};for(const A of b){const L=A.key;if(I[L.bucketInstanceId]===void 0&&(I[L.bucketInstanceId]={}),I[L.bucketInstanceId][L.featureIndex])continue;const N=[new d.P(A.x1,A.y1),new d.P(A.x2,A.y1),new d.P(A.x2,A.y2),new d.P(A.x1,A.y2)];d.am(a,N)&&(I[L.bucketInstanceId][L.featureIndex]=!0,C[L.bucketInstanceId]===void 0&&(C[L.bucketInstanceId]=[]),C[L.bucketInstanceId].push(L.featureIndex))}return C}insertCollisionBox(t,a,u,c,m,w){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:m,collisionGroupID:w,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,u,c,m,w){const b=u?this.ignoredGrid:this.grid,I={bucketInstanceId:c,featureIndex:m,collisionGroupID:w,overlapMode:a};for(let C=0;C<t.length;C+=4)b.insertCircle(I,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,a,u,c){let m;return c?(m=[a,u,c(a,u),1],d.af(m,m,t)):(m=[a,u,0,1],Je(m,m,t)),{point:new d.P((m[0]/m[3]+1)/2*this.transform.width+Qe,(-m[1]/m[3]+1)/2*this.transform.height+Qe),perspectiveRatio:.5+this.transform.cameraToCenterDistance/m[3]*.5}}isOffscreen(t,a,u,c){return u<Qe||t>=this.screenRightBoundary||c<Qe||a>this.screenBottomBoundary}isInsideGrid(t,a,u,c){return u>=0&&t<this.gridRightBoundary&&c>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=d.an([]);return d.H(t,t,[-100,-100,0]),t}}function lt(p,t,a){return t*(d.W/(p.tileSize*Math.pow(2,a-p.tileID.overscaledZ)))}class qt{constructor(t,a,u,c){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):c&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Rt{constructor(t,a,u,c,m){this.text=new qt(t?t.text:null,a,u,m),this.icon=new qt(t?t.icon:null,a,c,m)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Gt{constructor(t,a,u){this.text=t,this.icon=a,this.skipFade=u}}class dt{constructor(){this.invProjMatrix=d.F(),this.viewportMatrix=d.F(),this.circles=[]}}class Jt{constructor(t,a,u,c,m){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=u,this.bucketIndex=c,this.tileID=m}}class ur{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:u=>u.collisionGroupID===a}}return this.collisionGroups[t]}}function Yr(p,t,a,u,c){const{horizontalAlign:m,verticalAlign:w}=d.at(p);return new d.P(-(m-.5)*t+u[0]*c,-(w-.5)*a+u[1]*c)}function pr(p,t,a,u,c,m){const{x1:w,x2:b,y1:I,y2:C,anchorPointX:A,anchorPointY:L}=p,N=new d.P(t,a);return u&&N._rotate(c?m:-m),{x1:w+N.x,y1:I+N.y,x2:b+N.x,y2:C+N.y,anchorPointX:A,anchorPointY:L}}class Mr{constructor(t,a,u,c,m){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new st(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new ur(c),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,a,u,c){const m=u.getBucket(a),w=u.latestFeatureIndex;if(!m||!w||a.id!==m.layerIds[0])return;const b=u.collisionBoxArray,I=m.layers[0].layout,C=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),A=u.tileSize/d.W,L=this.transform.calculatePosMatrix(u.tileID.toUnwrapped()),N=I.get("text-pitch-alignment")==="map",Y=I.get("text-rotation-alignment")==="map",G=lt(u,1,this.transform.zoom),J=Mn(L,N,Y,this.transform,G);let V=null;if(N){const me=Ji(L,N,Y,this.transform,G);V=d.K([],this.transform.labelPlaneMatrix,me)}this.retainedQueryData[m.bucketInstanceId]=new Jt(m.bucketInstanceId,w,m.sourceLayerIndex,m.index,u.tileID);const le={bucket:m,layout:I,posMatrix:L,textLabelPlaneMatrix:J,labelToScreenMatrix:V,scale:C,textPixelRatio:A,holdingForFade:u.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:d.ag(m.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(c)for(const me of m.sortKeyRanges){const{sortKey:ee,symbolInstanceStart:he,symbolInstanceEnd:ge}=me;t.push({sortKey:ee,symbolInstanceStart:he,symbolInstanceEnd:ge,parameters:le})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:le})}attemptAnchorPlacement(t,a,u,c,m,w,b,I,C,A,L,N,Y,G,J,V){const le=d.ap[t.textAnchor],me=[t.textOffset0,t.textOffset1],ee=Yr(le,u,c,me,m),he=this.collisionIndex.placeCollisionBox(pr(a,ee.x,ee.y,w,b,this.transform.angle),L,I,C,A.predicate,V);if((!J||this.collisionIndex.placeCollisionBox(pr(J,ee.x,ee.y,w,b,this.transform.angle),L,I,C,A.predicate,V).box.length!==0)&&he.box.length>0){let ge;if(this.prevPlacement&&this.prevPlacement.variableOffsets[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID].text&&(ge=this.prevPlacement.variableOffsets[N.crossTileID].anchor),N.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[N.crossTileID]={textOffset:me,width:u,height:c,anchor:le,textBoxScale:m,prevAnchor:ge},this.markUsedJustification(Y,le,N,G),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,G,N),this.placedOrientations[N.crossTileID]=G),{shift:ee,placedGlyphBoxes:he}}}placeLayerBucketPart(t,a,u){const{bucket:c,layout:m,posMatrix:w,textLabelPlaneMatrix:b,labelToScreenMatrix:I,textPixelRatio:C,holdingForFade:A,collisionBoxArray:L,partiallyEvaluatedTextSize:N,collisionGroup:Y}=t.parameters,G=m.get("text-optional"),J=m.get("icon-optional"),V=d.aq(m,"text-overlap","text-allow-overlap"),le=V==="always",me=d.aq(m,"icon-overlap","icon-allow-overlap"),ee=me==="always",he=m.get("text-rotation-alignment")==="map",ge=m.get("text-pitch-alignment")==="map",ye=m.get("icon-text-fit")!=="none",Se=m.get("symbol-z-order")==="viewport-y",Ae=le&&(ee||!c.hasIconData()||J),Pe=ee&&(le||!c.hasTextData()||G);!c.collisionArrays&&L&&c.deserializeCollisionBoxes(L);const ze=this.retainedQueryData[c.bucketInstanceId].tileID,Ye=this.terrain?(Ue,ut)=>this.terrain.getElevation(ze,Ue,ut):null,_t=(Ue,ut)=>{var wt,zt;if(a[Ue.crossTileID])return;if(A)return void(this.placements[Ue.crossTileID]=new Gt(!1,!1,!1));let ft=!1,St=!1,Tt=!0,cr=null,Kt={box:null,offscreen:null},ki={box:null,offscreen:null},Ar=null,er=null,ai=null,fn=0,Rn=0,Fo=0;ut.textFeatureIndex?fn=ut.textFeatureIndex:Ue.useRuntimeCollisionCircles&&(fn=Ue.featureIndex),ut.verticalTextFeatureIndex&&(Rn=ut.verticalTextFeatureIndex);const Bo=ut.textBox;if(Bo){const mr=ar=>{let Xr=d.ah.horizontal;if(c.allowVerticalPlacement&&!ar&&this.prevPlacement){const Vi=this.prevPlacement.placedOrientations[Ue.crossTileID];Vi&&(this.placedOrientations[Ue.crossTileID]=Vi,Xr=Vi,this.markUsedOrientation(c,Xr,Ue))}return Xr},ir=(ar,Xr)=>{if(c.allowVerticalPlacement&&Ue.numVerticalGlyphVertices>0&&ut.verticalTextBox){for(const Vi of c.writingModes)if(Vi===d.ah.vertical?(Kt=Xr(),ki=Kt):Kt=ar(),Kt&&Kt.box&&Kt.box.length)break}else Kt=ar()},xr=Ue.textAnchorOffsetStartIndex,ba=Ue.textAnchorOffsetEndIndex;if(ba===xr){const ar=(Xr,Vi)=>{const Mt=this.collisionIndex.placeCollisionBox(Xr,V,C,w,Y.predicate,Ye);return Mt&&Mt.box&&Mt.box.length&&(this.markUsedOrientation(c,Vi,Ue),this.placedOrientations[Ue.crossTileID]=Vi),Mt};ir(()=>ar(Bo,d.ah.horizontal),()=>{const Xr=ut.verticalTextBox;return c.allowVerticalPlacement&&Ue.numVerticalGlyphVertices>0&&Xr?ar(Xr,d.ah.vertical):{box:null,offscreen:null}}),mr(Kt&&Kt.box&&Kt.box.length)}else{let ar=d.ap[(zt=(wt=this.prevPlacement)===null||wt===void 0?void 0:wt.variableOffsets[Ue.crossTileID])===null||zt===void 0?void 0:zt.anchor];const Xr=(Mt,Zu,Kh)=>{const Oo=Mt.x2-Mt.x1,No=Mt.y2-Mt.y1,hl=Ue.textBoxScale,qu=ye&&me==="never"?Zu:null;let jo={box:[],offscreen:!1},Xh=V==="never"?1:2,Gu="never";ar&&Xh++;for(let Jh=0;Jh<Xh;Jh++){for(let ms=xr;ms<ba;ms++){const Qh=c.textAnchorOffsets.get(ms);if(ar&&Qh.textAnchor!==ar)continue;const gs=this.attemptAnchorPlacement(Qh,Mt,Oo,No,hl,he,ge,C,w,Y,Gu,Ue,c,Kh,qu,Ye);if(gs&&(jo=gs.placedGlyphBoxes,jo&&jo.box&&jo.box.length))return ft=!0,cr=gs.shift,jo}ar?ar=null:Gu=V}return jo};ir(()=>Xr(Bo,ut.iconBox,d.ah.horizontal),()=>{const Mt=ut.verticalTextBox;return c.allowVerticalPlacement&&!(Kt&&Kt.box&&Kt.box.length)&&Ue.numVerticalGlyphVertices>0&&Mt?Xr(Mt,ut.verticalIconBox,d.ah.vertical):{box:null,offscreen:null}}),Kt&&(ft=Kt.box,Tt=Kt.offscreen);const Vi=mr(Kt&&Kt.box);if(!ft&&this.prevPlacement){const Mt=this.prevPlacement.variableOffsets[Ue.crossTileID];Mt&&(this.variableOffsets[Ue.crossTileID]=Mt,this.markUsedJustification(c,Mt.anchor,Ue,Vi))}}}if(Ar=Kt,ft=Ar&&Ar.box&&Ar.box.length>0,Tt=Ar&&Ar.offscreen,Ue.useRuntimeCollisionCircles){const mr=c.text.placedSymbolArray.get(Ue.centerJustifiedTextSymbolIndex),ir=d.ai(c.textSizeData,N,mr),xr=m.get("text-padding");er=this.collisionIndex.placeCollisionCircles(V,mr,c.lineVertexArray,c.glyphOffsetArray,ir,w,b,I,u,ge,Y.predicate,Ue.collisionCircleDiameter,xr,Ye),er.circles.length&&er.collisionDetected&&!u&&d.w("Collisions detected, but collision boxes are not shown"),ft=le||er.circles.length>0&&!er.collisionDetected,Tt=Tt&&er.offscreen}if(ut.iconFeatureIndex&&(Fo=ut.iconFeatureIndex),ut.iconBox){const mr=ir=>{const xr=ye&&cr?pr(ir,cr.x,cr.y,he,ge,this.transform.angle):ir;return this.collisionIndex.placeCollisionBox(xr,me,C,w,Y.predicate,Ye)};ki&&ki.box&&ki.box.length&&ut.verticalIconBox?(ai=mr(ut.verticalIconBox),St=ai.box.length>0):(ai=mr(ut.iconBox),St=ai.box.length>0),Tt=Tt&&ai.offscreen}const Fn=G||Ue.numHorizontalGlyphVertices===0&&Ue.numVerticalGlyphVertices===0,mn=J||Ue.numIconVertices===0;if(Fn||mn?mn?Fn||(St=St&&ft):ft=St&&ft:St=ft=St&&ft,ft&&Ar&&Ar.box&&this.collisionIndex.insertCollisionBox(Ar.box,V,m.get("text-ignore-placement"),c.bucketInstanceId,ki&&ki.box&&Rn?Rn:fn,Y.ID),St&&ai&&this.collisionIndex.insertCollisionBox(ai.box,me,m.get("icon-ignore-placement"),c.bucketInstanceId,Fo,Y.ID),er&&(ft&&this.collisionIndex.insertCollisionCircles(er.circles,V,m.get("text-ignore-placement"),c.bucketInstanceId,fn,Y.ID),u)){const mr=c.bucketInstanceId;let ir=this.collisionCircleArrays[mr];ir===void 0&&(ir=this.collisionCircleArrays[mr]=new dt);for(let xr=0;xr<er.circles.length;xr+=4)ir.circles.push(er.circles[xr+0]),ir.circles.push(er.circles[xr+1]),ir.circles.push(er.circles[xr+2]),ir.circles.push(er.collisionDetected?1:0)}if(Ue.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ue.crossTileID]=new Gt(ft||Ae,St||Pe,Tt||c.justReloaded),a[Ue.crossTileID]=!0};if(Se){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ue=c.getSortedSymbolIndexes(this.transform.angle);for(let ut=Ue.length-1;ut>=0;--ut){const wt=Ue[ut];_t(c.symbolInstances.get(wt),c.collisionArrays[wt])}}else for(let Ue=t.symbolInstanceStart;Ue<t.symbolInstanceEnd;Ue++)_t(c.symbolInstances.get(Ue),c.collisionArrays[Ue]);if(u&&c.bucketInstanceId in this.collisionCircleArrays){const Ue=this.collisionCircleArrays[c.bucketInstanceId];d.ar(Ue.invProjMatrix,w),Ue.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}markUsedJustification(t,a,u,c){let m;m=c===d.ah.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[d.as(a)];const w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const b of w)b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=m>=0&&b!==m?0:u.crossTileID)}markUsedOrientation(t,a,u){const c=a===d.ah.horizontal||a===d.ah.horizontalOnly?a:0,m=a===d.ah.vertical?a:0,w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const b of w)t.text.placedSymbolArray.get(b).placedOrientation=c;u.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let u=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const c=a?a.symbolFadeChange(t):1,m=a?a.opacities:{},w=a?a.variableOffsets:{},b=a?a.placedOrientations:{};for(const I in this.placements){const C=this.placements[I],A=m[I];A?(this.opacities[I]=new Rt(A,c,C.text,C.icon),u=u||C.text!==A.text.placed||C.icon!==A.icon.placed):(this.opacities[I]=new Rt(null,c,C.text,C.icon,C.skipFade),u=u||C.text||C.icon)}for(const I in m){const C=m[I];if(!this.opacities[I]){const A=new Rt(C,c,!1,!1);A.isHidden()||(this.opacities[I]=A,u=u||C.text.placed||C.icon.placed)}}for(const I in w)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=w[I]);for(const I in b)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=b[I]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const u={};for(const c of a){const m=c.getBucket(t);m&&c.latestFeatureIndex&&t.id===m.layerIds[0]&&this.updateBucketOpacities(m,u,c.collisionBoxArray)}}updateBucketOpacities(t,a,u){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const c=t.layers[0],m=c.layout,w=new Rt(null,0,!1,!1,!0),b=m.get("text-allow-overlap"),I=m.get("icon-allow-overlap"),C=c._unevaluatedLayout.hasValue("text-variable-anchor")||c._unevaluatedLayout.hasValue("text-variable-anchor-offset"),A=m.get("text-rotation-alignment")==="map",L=m.get("text-pitch-alignment")==="map",N=m.get("icon-text-fit")!=="none",Y=new Rt(null,0,b&&(I||!t.hasIconData()||m.get("icon-optional")),I&&(b||!t.hasTextData()||m.get("text-optional")),!0);!t.collisionArrays&&u&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(u);const G=(J,V,le)=>{for(let me=0;me<V/4;me++)J.opacityVertexArray.emplaceBack(le);J.hasVisibleVertices=J.hasVisibleVertices||le!==oi};for(let J=0;J<t.symbolInstances.length;J++){const V=t.symbolInstances.get(J),{numHorizontalGlyphVertices:le,numVerticalGlyphVertices:me,crossTileID:ee}=V;let he=this.opacities[ee];a[ee]?he=w:he||(he=Y,this.opacities[ee]=he),a[ee]=!0;const ge=V.numIconVertices>0,ye=this.placedOrientations[V.crossTileID],Se=ye===d.ah.vertical,Ae=ye===d.ah.horizontal||ye===d.ah.horizontalOnly;if(le>0||me>0){const Pe=ph(he.text);G(t.text,le,Se?oi:Pe),G(t.text,me,Ae?oi:Pe);const ze=he.text.isHidden();[V.rightJustifiedTextSymbolIndex,V.centerJustifiedTextSymbolIndex,V.leftJustifiedTextSymbolIndex].forEach(Ue=>{Ue>=0&&(t.text.placedSymbolArray.get(Ue).hidden=ze||Se?1:0)}),V.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(V.verticalPlacedTextSymbolIndex).hidden=ze||Ae?1:0);const Ye=this.variableOffsets[V.crossTileID];Ye&&this.markUsedJustification(t,Ye.anchor,V,ye);const _t=this.placedOrientations[V.crossTileID];_t&&(this.markUsedJustification(t,"left",V,_t),this.markUsedOrientation(t,_t,V))}if(ge){const Pe=ph(he.icon),ze=!(N&&V.verticalPlacedIconSymbolIndex&&Se);V.placedIconSymbolIndex>=0&&(G(t.icon,V.numIconVertices,ze?Pe:oi),t.icon.placedSymbolArray.get(V.placedIconSymbolIndex).hidden=he.icon.isHidden()),V.verticalPlacedIconSymbolIndex>=0&&(G(t.icon,V.numVerticalIconVertices,ze?oi:Pe),t.icon.placedSymbolArray.get(V.verticalPlacedIconSymbolIndex).hidden=he.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Pe=t.collisionArrays[J];if(Pe){let ze=new d.P(0,0);if(Pe.textBox||Pe.verticalTextBox){let _t=!0;if(C){const Ue=this.variableOffsets[ee];Ue?(ze=Yr(Ue.anchor,Ue.width,Ue.height,Ue.textOffset,Ue.textBoxScale),A&&ze._rotate(L?this.transform.angle:-this.transform.angle)):_t=!1}Pe.textBox&&bt(t.textCollisionBox.collisionVertexArray,he.text.placed,!_t||Se,ze.x,ze.y),Pe.verticalTextBox&&bt(t.textCollisionBox.collisionVertexArray,he.text.placed,!_t||Ae,ze.x,ze.y)}const Ye=!!(!Ae&&Pe.verticalIconBox);Pe.iconBox&&bt(t.iconCollisionBox.collisionVertexArray,he.icon.placed,Ye,N?ze.x:0,N?ze.y:0),Pe.verticalIconBox&&bt(t.iconCollisionBox.collisionVertexArray,he.icon.placed,!Ye,N?ze.x:0,N?ze.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=J.invProjMatrix,t.placementViewportMatrix=J.viewportMatrix,t.collisionCircleArray=J.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const u=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function bt(p,t,a,u,c){p.emplaceBack(t?1:0,a?1:0,u||0,c||0),p.emplaceBack(t?1:0,a?1:0,u||0,c||0),p.emplaceBack(t?1:0,a?1:0,u||0,c||0),p.emplaceBack(t?1:0,a?1:0,u||0,c||0)}const $t=Math.pow(2,25),ni=Math.pow(2,24),Ft=Math.pow(2,17),Xa=Math.pow(2,16),ru=Math.pow(2,9),Oi=Math.pow(2,8),Ni=Math.pow(2,1);function ph(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const t=p.placed?1:0,a=Math.floor(127*p.opacity);return a*$t+t*ni+a*Ft+t*Xa+a*ru+t*Oi+a*Ni+t}const oi=0;class Qi{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,u,c,m){const w=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(w,c,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((b,I)=>b.sortKey-I.sortKey));this._currentPartIndex<w.length;)if(a.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,m())return!0;return!1}}class fh{constructor(t,a,u,c,m,w,b,I){this.placement=new Mr(t,a,w,b,I),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,a,u){const c=q.now(),m=()=>!this._forceFullPlacement&&q.now()-c>2;for(;this._currentPlacementIndex>=0;){const w=a[t[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=b)&&(!w.maxzoom||w.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new Qi(w)),this._inProgressLayer.continuePlacement(u[w.source],this.placement,this._showCollisionBoxes,w,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ho=512/d.W/2;class zr{constructor(t,a,u){this.tileID=t,this.bucketInstanceId=u,this._symbolsByKey={};const c=new Map;for(let m=0;m<a.length;m++){const w=a.get(m),b=w.key,I=c.get(b);I?I.push(w):c.set(b,[w])}for(const[m,w]of c){const b={positions:w.map(I=>({x:Math.floor(I.anchorX*ho),y:Math.floor(I.anchorY*ho)})),crossTileIDs:w.map(I=>I.crossTileID)};if(b.positions.length>128){const I=new d.au(b.positions.length,16,Uint16Array);for(const{x:C,y:A}of b.positions)I.add(C,A);I.finish(),delete b.positions,b.index=I}this._symbolsByKey[m]=b}}getScaledCoordinates(t,a){const{x:u,y:c,z:m}=this.tileID.canonical,{x:w,y:b,z:I}=a.canonical,C=ho/Math.pow(2,I-m),A=(b*d.W+t.anchorY)*C,L=c*d.W*ho;return{x:Math.floor((w*d.W+t.anchorX)*C-u*d.W*ho),y:Math.floor(A-L)}}findMatches(t,a,u){const c=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let m=0;m<t.length;m++){const w=t.get(m);if(w.crossTileID)continue;const b=this._symbolsByKey[w.key];if(!b)continue;const I=this.getScaledCoordinates(w,a);if(b.index){const C=b.index.range(I.x-c,I.y-c,I.x+c,I.y+c).sort();for(const A of C){const L=b.crossTileIDs[A];if(!u[L]){u[L]=!0,w.crossTileID=L;break}}}else if(b.positions)for(let C=0;C<b.positions.length;C++){const A=b.positions[C],L=b.crossTileIDs[C];if(Math.abs(A.x-I.x)<=c&&Math.abs(A.y-I.y)<=c&&!u[L]){u[L]=!0,w.crossTileID=L;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Ja{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ko{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const u in this.indexes){const c=this.indexes[u],m={};for(const w in c){const b=c[w];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+a),m[b.tileID.key]=b}this.indexes[u]=m}this.lng=t}addBucket(t,a,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let m=0;m<a.symbolInstances.length;m++)a.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const c=this.usedCrossTileIDs[t.overscaledZ];for(const m in this.indexes){const w=this.indexes[m];if(Number(m)>t.overscaledZ)for(const b in w){const I=w[b];I.tileID.isChildOf(t)&&I.findMatches(a.symbolInstances,t,c)}else{const b=w[t.scaledTo(Number(m)).key];b&&b.findMatches(a.symbolInstances,t,c)}}for(let m=0;m<a.symbolInstances.length;m++){const w=a.symbolInstances.get(m);w.crossTileID||(w.crossTileID=u.generate(),c[w.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new zr(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const u of a.getCrossTileIDsLists())for(const c of u)delete this.usedCrossTileIDs[t][c]}removeStaleBuckets(t){let a=!1;for(const u in this.indexes){const c=this.indexes[u];for(const m in c)t[c[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,c[m]),delete c[m],a=!0)}return a}}class _r{constructor(){this.layerIndexes={},this.crossTileIDs=new Ja,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,u){let c=this.layerIndexes[t.id];c===void 0&&(c=this.layerIndexes[t.id]=new ko);let m=!1;const w={};c.handleWrapJump(u);for(const b of a){const I=b.getBucket(t);I&&t.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(b.tileID,I,this.crossTileIDs)&&(m=!0),w[I.bucketInstanceId]=!0)}return c.removeStaleBuckets(w)&&(m=!0),m}pruneUnusedLayers(t){const a={};t.forEach(u=>{a[u]=!0});for(const u in this.layerIndexes)a[u]||delete this.layerIndexes[u]}}const Eo=(p,t)=>d.t(p,t&&t.filter(a=>a.identifier!=="source.canvas")),hn=d.av();class Os extends d.E{constructor(t,a={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const c=this.sourceCaches[u].getSource().type;c!=="vector"&&c!=="geojson"||this.sourceCaches[u].reload()}},this.map=t,this.dispatcher=new uo(Fi(),t._getMapId()),this.dispatcher.registerMessageHandler("getGlyphs",(u,c)=>this.getGlyphs(u,c)),this.dispatcher.registerMessageHandler("getImages",(u,c)=>this.getImages(u,c)),this.imageManager=new lr,this.imageManager.setEventedParent(this),this.glyphManager=new We(t._requestManager,a.localIdeographFontFamily),this.lineAtlas=new Ct(256,512),this.crossTileSymbolIndex=new _r,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",d.ax()),ii().on(cn,this._rtlPluginLoaded),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const c=this.sourceCaches[u.sourceId];if(!c)return;const m=c.getSource();if(m&&m.vectorLayerIds)for(const w in this._layers){const b=this._layers[w];b.source===m.id&&this._validateLayer(b)}})}loadURL(t,a={},u){this.fire(new d.k("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const c=this.map._requestManager.transformRequest(t,Te.Style);this._loadStyleRequest=new AbortController,d.h(c,this._loadStyleRequest).then(m=>{this._loadStyleRequest=null,this._load(m.data,a,u)}).catch(m=>{this._loadStyleRequest=null,m&&this.fire(new d.j(m))})}loadJSON(t,a={},u){this.fire(new d.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,q.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(t,a,u)}).catch(()=>{})}loadEmpty(){this.fire(new d.k("dataloading",{dataType:"style"})),this._load(hn,{validate:!1})}_load(t,a,u){var c;const m=a.transformStyle?a.transformStyle(u,t):t;if(!a.validate||!Eo(this,d.x(m))){this._loaded=!0,this.stylesheet=m;for(const w in m.sources)this.addSource(w,m.sources[w],{validate:!1});m.sprite?this._loadSprite(m.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(m.glyphs),this._createLayers(),this.light=new xt(this.stylesheet.light),this.map.setTerrain((c=this.stylesheet.terrain)!==null&&c!==void 0?c:null),this.fire(new d.k("data",{dataType:"style"})),this.fire(new d.k("style.load"))}}_createLayers(){const t=d.ay(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(a=>a.id),this._layers={},this._serializedLayers=null;for(const a of t){const u=d.az(a);u.setEventedParent(this,{layer:{id:a.id}}),this._layers[a.id]=u}}_loadSprite(t,a=!1,u=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(m,w,b,I){return d._(this,void 0,void 0,function*(){const C=vt(m),A=b>1?"@2x":"",L={},N={};for(const{id:Y,url:G}of C){const J=w.transformRequest(w.normalizeSpriteURL(G,A,".json"),Te.SpriteJSON);L[Y]=d.h(J,I);const V=w.transformRequest(w.normalizeSpriteURL(G,A,".png"),Te.SpriteImage);N[Y]=ue.getImage(V,I)}return yield Promise.all([...Object.values(L),...Object.values(N)]),function(Y,G){return d._(this,void 0,void 0,function*(){const J={};for(const V in Y){J[V]={};const le=q.getImageCanvasContext((yield G[V]).data),me=(yield Y[V]).data;for(const ee in me){const{width:he,height:ge,x:ye,y:Se,sdf:Ae,pixelRatio:Pe,stretchX:ze,stretchY:Ye,content:_t}=me[ee];J[V][ee]={data:null,pixelRatio:Pe,sdf:Ae,stretchX:ze,stretchY:Ye,content:_t,spriteData:{width:he,height:ge,x:ye,y:Se,context:le}}}}return J})}(L,N)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(m=>{if(this._spriteRequest=null,m)for(const w in m){this._spritesImagesIds[w]=[];const b=this._spritesImagesIds[w]?this._spritesImagesIds[w].filter(I=>!(I in m)):[];for(const I of b)this.imageManager.removeImage(I),this._changedImages[I]=!0;for(const I in m[w]){const C=w==="default"?I:`${w}:${I}`;this._spritesImagesIds[w].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,m[w][I],!1):this.imageManager.addImage(C,m[w][I]),a&&(this._changedImages[C]=!0)}}}).catch(m=>{this._spriteRequest=null,c=m,this.fire(new d.j(c))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.k("data",{dataType:"style"})),u&&u(c)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}_validateLayer(t){const a=this.sourceCaches[t.source];if(!a)return;const u=t.sourceLayer;if(!u)return;const c=a.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(u)===-1)&&this.fire(new d.j(new Error(`Source layer "${u}" does not exist on source "${c.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const a=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a);const u=[];for(const c of t)a[c]&&u.push(a[c]);return u}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const u of a){const c=this._layers[u];c.type!=="custom"&&(t[u]=c.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(this._changed){const c=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(c.length||m.length)&&this._updateWorkerLayers(c,m);for(const w in this._updatedSources){const b=this._updatedSources[w];if(b==="reload")this._reloadSource(w);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const u={};for(const c in this.sourceCaches){const m=this.sourceCaches[c];u[c]=m.used,m.used=!1}for(const c of this._order){const m=this._layers[c];m.recalculate(t,this._availableImages),!m.isHidden(t.zoom)&&m.source&&(this.sourceCaches[m.source].used=!0)}for(const c in u){const m=this.sourceCaches[c];u[c]!==m.used&&m.fire(new d.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(t),this.z=t.zoom,a&&this.fire(new d.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){var u;this._checkLoaded();const c=this.serialize();if(t=a.transformStyle?a.transformStyle(c,t):t,((u=a.validate)===null||u===void 0||u)&&Eo(this,d.x(t)))return!1;(t=d.aA(t)).layers=d.ay(t.layers);const m=d.aB(c,t),w=this._getOperationsToPerform(m);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const b of w.operations)b();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const a=[],u=[];for(const c of t)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":a.push(()=>this.addLayer.apply(this,c.args));break;case"removeLayer":a.push(()=>this.removeLayer.apply(this,c.args));break;case"setPaintProperty":a.push(()=>this.setPaintProperty.apply(this,c.args));break;case"setLayoutProperty":a.push(()=>this.setLayoutProperty.apply(this,c.args));break;case"setFilter":a.push(()=>this.setFilter.apply(this,c.args));break;case"addSource":a.push(()=>this.addSource.apply(this,c.args));break;case"removeSource":a.push(()=>this.removeSource.apply(this,c.args));break;case"setLayerZoomRange":a.push(()=>this.setLayerZoomRange.apply(this,c.args));break;case"setLight":a.push(()=>this.setLight.apply(this,c.args));break;case"setGeoJSONSourceData":a.push(()=>this.setGeoJSONSourceData.apply(this,c.args));break;case"setGlyphs":a.push(()=>this.setGlyphs.apply(this,c.args));break;case"setSprite":a.push(()=>this.setSprite.apply(this,c.args));break;case"setTerrain":a.push(()=>this.map.setTerrain.apply(this,c.args));break;case"setTransition":a.push(()=>{});break;default:u.push(c.command)}return{operations:a,unimplemented:u}}addImage(t,a){if(this.getImage(t))return this.fire(new d.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new d.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,u={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(d.x.source,`sources.${t}`,a,null,u))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const c=this.sourceCaches[t]=new Fe(t,a,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:t})),c.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===t)return this.fire(new d.j(new Error(`Source "${t}" cannot be removed while layer "${u}" is using it.`)));const a=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],a.fire(new d.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const u=this.sourceCaches[t].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(a),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,a,u={}){this._checkLoaded();const c=t.id;if(this.getLayer(c))return void this.fire(new d.j(new Error(`Layer "${c}" already exists on this map.`)));let m;if(t.type==="custom"){if(Eo(this,d.aC(t)))return;m=d.az(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(c,t.source),t=d.aA(t),t=d.e(t,{source:c})),this._validate(d.x.layer,`layers.${c}`,t,{arrayIndex:-1},u))return;m=d.az(t),this._validateLayer(m),m.setEventedParent(this,{layer:{id:c}})}const w=a?this._order.indexOf(a):this._order.length;if(a&&w===-1)this.fire(new d.j(new Error(`Cannot add layer "${c}" before non-existing layer "${a}".`)));else{if(this._order.splice(w,0,c),this._layerOrderChanged=!0,this._layers[c]=m,this._removedLayers[c]&&m.source&&m.type!=="custom"){const b=this._removedLayers[c];delete this._removedLayers[c],b.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new d.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const u=this._order.indexOf(t);this._order.splice(u,1);const c=a?this._order.indexOf(a):this._order.length;a&&c===-1?this.fire(new d.j(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(c,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new d.j(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,u){this._checkLoaded();const c=this.getLayer(t);c?c.minzoom===a&&c.maxzoom===u||(a!=null&&(c.minzoom=a),u!=null&&(c.maxzoom=u),this._updateLayer(c)):this.fire(new d.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,u={}){this._checkLoaded();const c=this.getLayer(t);if(c){if(!d.aD(c.filter,a))return a==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(d.x.filter,`layers.${c.id}.filter`,a,null,u)||(c.filter=d.aA(a),this._updateLayer(c)))}else this.fire(new d.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return d.aA(this.getLayer(t).filter)}setLayoutProperty(t,a,u,c={}){this._checkLoaded();const m=this.getLayer(t);m?d.aD(m.getLayoutProperty(a),u)||(m.setLayoutProperty(a,u,c),this._updateLayer(m)):this.fire(new d.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const u=this.getLayer(t);if(u)return u.getLayoutProperty(a);this.fire(new d.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,u,c={}){this._checkLoaded();const m=this.getLayer(t);m?d.aD(m.getPaintProperty(a),u)||(m.setPaintProperty(a,u,c)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new d.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const u=t.source,c=t.sourceLayer,m=this.sourceCaches[u];if(m===void 0)return void this.fire(new d.j(new Error(`The source '${u}' does not exist in the map's style.`)));const w=m.getSource().type;w==="geojson"&&c?this.fire(new d.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||c?(t.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),m.setFeatureState(c,t.id,a)):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const u=t.source,c=this.sourceCaches[u];if(c===void 0)return void this.fire(new d.j(new Error(`The source '${u}' does not exist in the map's style.`)));const m=c.getSource().type,w=m==="vector"?t.sourceLayer:void 0;m!=="vector"||w?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new d.j(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(w,t.id,a):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,u=t.sourceLayer,c=this.sourceCaches[a];if(c!==void 0)return c.getSource().type!=="vector"||u?(t.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),c.getFeatureState(u,t.id)):void this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.j(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=d.aE(this.sourceCaches,m=>m.serialize()),a=this._serializeByIds(this._order),u=this.map.getTerrain()||void 0,c=this.stylesheet;return d.aF({version:c.version,name:c.name,metadata:c.metadata,light:c.light,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:t,layers:a,terrain:u},m=>m!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=w=>this._layers[w].type==="fill-extrusion",u={},c=[];for(let w=this._order.length-1;w>=0;w--){const b=this._order[w];if(a(b)){u[b]=w;for(const I of t){const C=I[b];if(C)for(const A of C)c.push(A)}}}c.sort((w,b)=>b.intersectionZ-w.intersectionZ);const m=[];for(let w=this._order.length-1;w>=0;w--){const b=this._order[w];if(a(b))for(let I=c.length-1;I>=0;I--){const C=c[I].feature;if(u[C.layer.id]<w)break;m.push(C),c.pop()}else for(const I of t){const C=I[b];if(C)for(const A of C)m.push(A.feature)}}return m}queryRenderedFeatures(t,a,u){a&&a.filter&&this._validate(d.x.filter,"queryRenderedFeatures.filter",a.filter,null,a);const c={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new d.j(new Error("parameters.layers must be an Array."))),[];for(const b of a.layers){const I=this._layers[b];if(!I)return this.fire(new d.j(new Error(`The layer '${b}' does not exist in the map's style and cannot be queried for features.`))),[];c[I.source]=!0}}const m=[];a.availableImages=this._availableImages;const w=this._serializedAllLayers();for(const b in this.sourceCaches)a.layers&&!c[b]||m.push(bi(this.sourceCaches[b],this._layers,w,t,a,u));return this.placement&&m.push(function(b,I,C,A,L,N,Y){const G={},J=N.queryRenderedSymbols(A),V=[];for(const le of Object.keys(J).map(Number))V.push(Y[le]);V.sort(un);for(const le of V){const me=le.featureIndex.lookupSymbolFeatures(J[le.bucketInstanceId],I,le.bucketIndex,le.sourceLayerIndex,L.filter,L.layers,L.availableImages,b);for(const ee in me){const he=G[ee]=G[ee]||[],ge=me[ee];ge.sort((ye,Se)=>{const Ae=le.featureSortOrder;if(Ae){const Pe=Ae.indexOf(ye.featureIndex);return Ae.indexOf(Se.featureIndex)-Pe}return Se.featureIndex-ye.featureIndex});for(const ye of ge)he.push(ye)}}for(const le in G)G[le].forEach(me=>{const ee=me.feature,he=C[b[le].source].getFeatureState(ee.layer["source-layer"],ee.id);ee.source=ee.layer.source,ee.layer["source-layer"]&&(ee.sourceLayer=ee.layer["source-layer"]),ee.state=he});return G}(this._layers,w,this.sourceCaches,t,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(t,a){a&&a.filter&&this._validate(d.x.filter,"querySourceFeatures.filter",a.filter,null,a);const u=this.sourceCaches[t];return u?function(c,m){const w=c.getRenderableIds().map(C=>c.getTileByID(C)),b=[],I={};for(let C=0;C<w.length;C++){const A=w[C],L=A.tileID.canonical.key;I[L]||(I[L]=!0,A.querySourceFeatures(b,m))}return b}(u,a):[]}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const u=this.light.getLight();let c=!1;for(const w in t)if(!d.aD(t[w],u[w])){c=!0;break}if(!c)return;const m={now:q.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(m)}_validate(t,a,u,c,m={}){return(!m||m.validate!==!1)&&Eo(this,t.call(d.x,d.e({key:a,style:this.serialize(),value:u,styleSpec:d.v},c)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ii().off(cn,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches){const u=this.sourceCaches[a];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("removeMap",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const a in this.sourceCaches)this.sourceCaches[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,a,u,c,m=!1){let w=!1,b=!1;const I={};for(const C of this._order){const A=this._layers[C];if(A.type!=="symbol")continue;if(!I[A.source]){const N=this.sourceCaches[A.source];I[A.source]=N.getRenderableIds(!0).map(Y=>N.getTileByID(Y)).sort((Y,G)=>G.tileID.overscaledZ-Y.tileID.overscaledZ||(Y.tileID.isLessThan(G.tileID)?-1:1))}const L=this.crossTileSymbolIndex.addLayer(A,I[A.source],t.center.lng);w=w||L}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(q.now(),t.zoom))&&(this.pauseablePlacement=new fh(t,this.map.terrain,this._order,m,a,u,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(q.now()),b=!0),w&&this.pauseablePlacement.placement.setStale()),b||w)for(const C of this._order){const A=this._layers[C];A.type==="symbol"&&this.placement.updateLayerOpacities(A,I[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(q.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,a){return d._(this,void 0,void 0,function*(){const u=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const c=this.sourceCaches[a.source];return c&&c.setDependencies(a.tileID.key,a.type,a.icons),u})}getGlyphs(t,a){return d._(this,void 0,void 0,function*(){const u=yield this.glyphManager.getGlyphs(a.stacks),c=this.sourceCaches[a.source];return c&&c.setDependencies(a.tileID.key,a.type,[""]),u})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(d.x.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,a,u={},c){this._checkLoaded();const m=[{id:t,url:a}],w=[...vt(this.stylesheet.sprite),...m];this._validate(d.x.sprite,"sprite",w,null,u)||(this.stylesheet.sprite=w,this._loadSprite(m,!0,c))}removeSprite(t){this._checkLoaded();const a=vt(this.stylesheet.sprite);if(a.find(u=>u.id===t)){if(this._spritesImagesIds[t])for(const u of this._spritesImagesIds[t])this.imageManager.removeImage(u),this._changedImages[u]=!0;a.splice(a.findIndex(u=>u.id===t),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}else this.fire(new d.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return vt(this.stylesheet.sprite)}setSprite(t,a={},u){this._checkLoaded(),t&&this._validate(d.x.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,u):(this._unloadSprite(),u&&u(null)))}}var zn=d.X([{name:"a_pos",type:"Int16",components:2}]),iu="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const ia={prelude:Ut(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ut(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ut(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ut(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ut("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ut(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ut(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ut("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ut("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ut("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ut(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ut(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ut(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ut(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ut(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ut(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ut(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ut(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ut(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ut(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ut(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ut(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ut(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ut(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ut(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ut(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ut("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",iu),terrainDepth:Ut("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",iu),terrainCoords:Ut("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",iu)};function Ut(p,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=t.match(/attribute ([\w]+) ([\w]+)/g),c=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=m?m.concat(c):c,b={};return{fragmentSource:p=p.replace(a,(I,C,A,L,N)=>(b[N]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${N}
varying ${A} ${L} ${N};
#else
uniform ${A} ${L} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${A} ${L} ${N} = u_${N};
#endif
`)),vertexSource:t=t.replace(a,(I,C,A,L,N)=>{const Y=L==="float"?"vec2":"vec4",G=N.match(/color/)?"color":Y;return b[N]?C==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${A} ${Y} a_${N};
varying ${A} ${L} ${N};
#else
uniform ${A} ${L} u_${N};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${A} ${L} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${G}(a_${N}, u_${N}_t);
#else
    ${A} ${L} ${N} = u_${N};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${A} ${Y} a_${N};
#else
uniform ${A} ${L} u_${N};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${A} ${L} ${N} = a_${N};
#else
    ${A} ${L} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${A} ${L} ${N} = unpack_mix_${G}(a_${N}, u_${N}_t);
#else
    ${A} ${L} ${N} = u_${N};
#endif
`}),staticAttributes:u,staticUniforms:w}}class Ns{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,u,c,m,w,b,I,C){this.context=t;let A=this.boundPaintVertexBuffers.length!==c.length;for(let L=0;!A&&L<c.length;L++)this.boundPaintVertexBuffers[L]!==c[L]&&(A=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==u||A||this.boundIndexBuffer!==m||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==I||this.boundDynamicVertexBuffer3!==C?this.freshBind(a,u,c,m,w,b,I,C):(t.bindVertexArray.set(this.vao),b&&b.bind(),m&&m.dynamicDraw&&m.bind(),I&&I.bind(),C&&C.bind())}freshBind(t,a,u,c,m,w,b,I){const C=t.numAttributes,A=this.context,L=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=c,this.boundVertexOffset=m,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=I,a.enableAttributes(L,t);for(const N of u)N.enableAttributes(L,t);w&&w.enableAttributes(L,t),b&&b.enableAttributes(L,t),I&&I.enableAttributes(L,t),a.bind(),a.setVertexAttribPointers(L,t,m);for(const N of u)N.bind(),N.setVertexAttribPointers(L,t,m);w&&(w.bind(),w.setVertexAttribPointers(L,t,m)),c&&c.bind(),b&&(b.bind(),b.setVertexAttribPointers(L,t,m)),I&&(I.bind(),I.setVertexAttribPointers(L,t,m)),A.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function An(p){const t=[];for(let a=0;a<p.length;a++){if(p[a]===null)continue;const u=p[a].split(" ");t.push(u.pop())}return t}class nu{constructor(t,a,u,c,m,w){const b=t.gl;this.program=b.createProgram();const I=An(a.staticAttributes),C=u?u.getBinderAttributes():[],A=I.concat(C),L=ia.prelude.staticUniforms?An(ia.prelude.staticUniforms):[],N=a.staticUniforms?An(a.staticUniforms):[],Y=u?u.getBinderUniforms():[],G=L.concat(N).concat(Y),J=[];for(const ye of G)J.indexOf(ye)<0&&J.push(ye);const V=u?u.defines():[];m&&V.push("#define OVERDRAW_INSPECTOR;"),w&&V.push("#define TERRAIN3D;");const le=V.concat(ia.prelude.fragmentSource,a.fragmentSource).join(`
`),me=V.concat(ia.prelude.vertexSource,a.vertexSource).join(`
`),ee=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(ee,le),b.compileShader(ee),!b.getShaderParameter(ee,b.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${b.getShaderInfoLog(ee)}`);b.attachShader(this.program,ee);const he=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(he,me),b.compileShader(he),!b.getShaderParameter(he,b.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${b.getShaderInfoLog(he)}`);b.attachShader(this.program,he),this.attributes={};const ge={};this.numAttributes=A.length;for(let ye=0;ye<this.numAttributes;ye++)A[ye]&&(b.bindAttribLocation(this.program,ye,A[ye]),this.attributes[A[ye]]=ye);if(b.linkProgram(this.program),!b.getProgramParameter(this.program,b.LINK_STATUS))throw new Error(`Program failed to link: ${b.getProgramInfoLog(this.program)}`);b.deleteShader(he),b.deleteShader(ee);for(let ye=0;ye<J.length;ye++){const Se=J[ye];if(Se&&!ge[Se]){const Ae=b.getUniformLocation(this.program,Se);Ae&&(ge[Se]=Ae)}}this.fixedUniforms=c(t,ge),this.terrainUniforms=((ye,Se)=>({u_depth:new d.aG(ye,Se.u_depth),u_terrain:new d.aG(ye,Se.u_terrain),u_terrain_dim:new d.aH(ye,Se.u_terrain_dim),u_terrain_matrix:new d.aI(ye,Se.u_terrain_matrix),u_terrain_unpack:new d.aJ(ye,Se.u_terrain_unpack),u_terrain_exaggeration:new d.aH(ye,Se.u_terrain_exaggeration)}))(t,ge),this.binderUniforms=u?u.getUniforms(t,ge):[]}draw(t,a,u,c,m,w,b,I,C,A,L,N,Y,G,J,V,le,me){const ee=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(u),t.setStencilMode(c),t.setColorMode(m),t.setCullFace(w),I){t.activeTexture.set(ee.TEXTURE2),ee.bindTexture(ee.TEXTURE_2D,I.depthTexture),t.activeTexture.set(ee.TEXTURE3),ee.bindTexture(ee.TEXTURE_2D,I.texture);for(const ge in this.terrainUniforms)this.terrainUniforms[ge].set(I[ge])}for(const ge in this.fixedUniforms)this.fixedUniforms[ge].set(b[ge]);J&&J.setUniforms(t,this.binderUniforms,Y,{zoom:G});let he=0;switch(a){case ee.LINES:he=2;break;case ee.TRIANGLES:he=3;break;case ee.LINE_STRIP:he=1}for(const ge of N.get()){const ye=ge.vaos||(ge.vaos={});(ye[C]||(ye[C]=new Ns)).bind(t,this,A,J?J.getPaintVertexBuffers():[],L,ge.vertexOffset,V,le,me),ee.drawElements(a,ge.primitiveLength*he,ee.UNSIGNED_SHORT,ge.primitiveOffset*he*2)}}}function Qa(p,t,a){const u=1/lt(a,1,t.transform.tileZoom),c=Math.pow(2,a.tileID.overscaledZ),m=a.tileSize*Math.pow(2,t.transform.tileZoom)/c,w=m*(a.tileID.canonical.x+a.tileID.wrap*c),b=m*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[u,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[w>>16,b>>16],u_pixel_coord_lower:[65535&w,65535&b]}}const mh=(p,t,a,u)=>{const c=t.style.light,m=c.properties.get("position"),w=[m.x,m.y,m.z],b=function(){var C=new d.A(9);return d.A!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[5]=0,C[6]=0,C[7]=0),C[0]=1,C[4]=1,C[8]=1,C}();c.properties.get("anchor")==="viewport"&&function(C,A){var L=Math.sin(A),N=Math.cos(A);C[0]=N,C[1]=L,C[2]=0,C[3]=-L,C[4]=N,C[5]=0,C[6]=0,C[7]=0,C[8]=1}(b,-t.transform.angle),function(C,A,L){var N=A[0],Y=A[1],G=A[2];C[0]=N*L[0]+Y*L[3]+G*L[6],C[1]=N*L[1]+Y*L[4]+G*L[7],C[2]=N*L[2]+Y*L[5]+G*L[8]}(w,w,b);const I=c.properties.get("color");return{u_matrix:p,u_lightpos:w,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+a,u_opacity:u}},Np=(p,t,a,u,c,m,w)=>d.e(mh(p,t,a,u),Qa(m,t,w),{u_height_factor:-Math.pow(2,c.overscaledZ)/w.tileSize/8}),js=p=>({u_matrix:p}),gh=(p,t,a,u)=>d.e(js(p),Qa(a,t,u)),yh=(p,t)=>({u_matrix:p,u_world:t}),jp=(p,t,a,u,c)=>d.e(gh(p,t,a,u),{u_world:c}),_h=(p,t,a,u)=>{const c=p.transform;let m,w;if(u.paint.get("circle-pitch-alignment")==="map"){const b=lt(a,1,c.zoom);m=!0,w=[b,b]}else m=!1,w=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(t.posMatrix,a,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+m,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:w}},Up=(p,t,a)=>{const u=lt(a,1,t.zoom),c=Math.pow(2,t.zoom-a.tileID.overscaledZ),m=a.tileID.overscaleFactor();return{u_matrix:p,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:u,u_extrude_scale:[t.pixelsToGLUnits[0]/(u*c),t.pixelsToGLUnits[1]/(u*c)],u_overscale_factor:m}},Us=(p,t,a=1)=>({u_matrix:p,u_color:t,u_overlay:0,u_overlay_scale:a}),ou=p=>({u_matrix:p}),vh=(p,t,a,u)=>({u_matrix:p,u_extrude_scale:lt(t,1,a),u_intensity:u});function xh(p,t){const a=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new d.Y(0,u/a).toLngLat().lat,new d.Y(0,(u+1)/a).toLngLat().lat]}const Vs=(p,t,a,u)=>{const c=p.transform;return{u_matrix:ts(p,t,a,u),u_ratio:1/lt(t,1,c.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},Co=(p,t,a,u,c)=>d.e(Vs(p,t,a,c),{u_image:0,u_image_height:u}),$s=(p,t,a,u,c)=>{const m=p.transform,w=es(t,m);return{u_matrix:ts(p,t,a,c),u_texsize:t.imageAtlasTexture.size,u_ratio:1/lt(t,1,m.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[w,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},en=(p,t,a,u,c,m)=>{const w=p.lineAtlas,b=es(t,p.transform),I=a.layout.get("line-cap")==="round",C=w.getDash(u.from,I),A=w.getDash(u.to,I),L=C.width*c.fromScale,N=A.width*c.toScale;return d.e(Vs(p,t,a,m),{u_patternscale_a:[b/L,-C.height/2],u_patternscale_b:[b/N,-A.height/2],u_sdfgamma:w.width/(256*Math.min(L,N)*p.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:A.y,u_mix:c.t})};function es(p,t){return 1/lt(p,1,t.tileZoom)}function ts(p,t,a,u){return p.translatePosMatrix(u?u.posMatrix:t.tileID.posMatrix,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const rs=(p,t,a,u,c)=>{return{u_matrix:p,u_tl_parent:t,u_scale_parent:a,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(w=c.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(m=c.paint.get("raster-contrast"),m>0?1/(1-m):1+m),u_spin_weights:Zs(c.paint.get("raster-hue-rotate"))};var m,w};function Zs(p){p*=Math.PI/180;const t=Math.sin(p),a=Math.cos(p);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const is=(p,t,a,u,c,m,w,b,I,C)=>{const A=c.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:A.cameraToCenterDistance,u_pitch:A.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:A.width/A.height,u_fade_change:c.options.fadeDuration?c.symbolFadeChange:1,u_matrix:m,u_label_plane_matrix:w,u_coord_matrix:b,u_is_text:+I,u_pitch_with_map:+u,u_texsize:C,u_texture:0}},na=(p,t,a,u,c,m,w,b,I,C,A)=>{const L=c.transform;return d.e(is(p,t,a,u,c,m,w,b,I,C),{u_gamma_scale:u?Math.cos(L._pitch)*L.cameraToCenterDistance:1,u_device_pixel_ratio:c.pixelRatio,u_is_halo:+A})},Vp=(p,t,a,u,c,m,w,b,I,C)=>d.e(na(p,t,a,u,c,m,w,b,!0,I,!0),{u_texsize_icon:C,u_texture_icon:1}),$p=(p,t,a)=>({u_matrix:p,u_opacity:t,u_color:a}),wh=(p,t,a,u,c,m)=>d.e(function(w,b,I,C){const A=I.imageManager.getPattern(w.from.toString()),L=I.imageManager.getPattern(w.to.toString()),{width:N,height:Y}=I.imageManager.getPixelSize(),G=Math.pow(2,C.tileID.overscaledZ),J=C.tileSize*Math.pow(2,I.transform.tileZoom)/G,V=J*(C.tileID.canonical.x+C.tileID.wrap*G),le=J*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:L.tl,u_pattern_br_b:L.br,u_texsize:[N,Y],u_mix:b.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:L.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/lt(C,1,I.transform.tileZoom),u_pixel_coord_upper:[V>>16,le>>16],u_pixel_coord_lower:[65535&V,65535&le]}}(u,m,a,c),{u_matrix:p,u_opacity:t}),Zp={fillExtrusion:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_lightpos:new d.aK(p,t.u_lightpos),u_lightintensity:new d.aH(p,t.u_lightintensity),u_lightcolor:new d.aK(p,t.u_lightcolor),u_vertical_gradient:new d.aH(p,t.u_vertical_gradient),u_opacity:new d.aH(p,t.u_opacity)}),fillExtrusionPattern:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_lightpos:new d.aK(p,t.u_lightpos),u_lightintensity:new d.aH(p,t.u_lightintensity),u_lightcolor:new d.aK(p,t.u_lightcolor),u_vertical_gradient:new d.aH(p,t.u_vertical_gradient),u_height_factor:new d.aH(p,t.u_height_factor),u_image:new d.aG(p,t.u_image),u_texsize:new d.aL(p,t.u_texsize),u_pixel_coord_upper:new d.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aL(p,t.u_pixel_coord_lower),u_scale:new d.aK(p,t.u_scale),u_fade:new d.aH(p,t.u_fade),u_opacity:new d.aH(p,t.u_opacity)}),fill:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix)}),fillPattern:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_image:new d.aG(p,t.u_image),u_texsize:new d.aL(p,t.u_texsize),u_pixel_coord_upper:new d.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aL(p,t.u_pixel_coord_lower),u_scale:new d.aK(p,t.u_scale),u_fade:new d.aH(p,t.u_fade)}),fillOutline:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_world:new d.aL(p,t.u_world)}),fillOutlinePattern:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_world:new d.aL(p,t.u_world),u_image:new d.aG(p,t.u_image),u_texsize:new d.aL(p,t.u_texsize),u_pixel_coord_upper:new d.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aL(p,t.u_pixel_coord_lower),u_scale:new d.aK(p,t.u_scale),u_fade:new d.aH(p,t.u_fade)}),circle:(p,t)=>({u_camera_to_center_distance:new d.aH(p,t.u_camera_to_center_distance),u_scale_with_map:new d.aG(p,t.u_scale_with_map),u_pitch_with_map:new d.aG(p,t.u_pitch_with_map),u_extrude_scale:new d.aL(p,t.u_extrude_scale),u_device_pixel_ratio:new d.aH(p,t.u_device_pixel_ratio),u_matrix:new d.aI(p,t.u_matrix)}),collisionBox:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_camera_to_center_distance:new d.aH(p,t.u_camera_to_center_distance),u_pixels_to_tile_units:new d.aH(p,t.u_pixels_to_tile_units),u_extrude_scale:new d.aL(p,t.u_extrude_scale),u_overscale_factor:new d.aH(p,t.u_overscale_factor)}),collisionCircle:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_inv_matrix:new d.aI(p,t.u_inv_matrix),u_camera_to_center_distance:new d.aH(p,t.u_camera_to_center_distance),u_viewport_size:new d.aL(p,t.u_viewport_size)}),debug:(p,t)=>({u_color:new d.aM(p,t.u_color),u_matrix:new d.aI(p,t.u_matrix),u_overlay:new d.aG(p,t.u_overlay),u_overlay_scale:new d.aH(p,t.u_overlay_scale)}),clippingMask:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix)}),heatmap:(p,t)=>({u_extrude_scale:new d.aH(p,t.u_extrude_scale),u_intensity:new d.aH(p,t.u_intensity),u_matrix:new d.aI(p,t.u_matrix)}),heatmapTexture:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_world:new d.aL(p,t.u_world),u_image:new d.aG(p,t.u_image),u_color_ramp:new d.aG(p,t.u_color_ramp),u_opacity:new d.aH(p,t.u_opacity)}),hillshade:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_image:new d.aG(p,t.u_image),u_latrange:new d.aL(p,t.u_latrange),u_light:new d.aL(p,t.u_light),u_shadow:new d.aM(p,t.u_shadow),u_highlight:new d.aM(p,t.u_highlight),u_accent:new d.aM(p,t.u_accent)}),hillshadePrepare:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_image:new d.aG(p,t.u_image),u_dimension:new d.aL(p,t.u_dimension),u_zoom:new d.aH(p,t.u_zoom),u_unpack:new d.aJ(p,t.u_unpack)}),line:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_ratio:new d.aH(p,t.u_ratio),u_device_pixel_ratio:new d.aH(p,t.u_device_pixel_ratio),u_units_to_pixels:new d.aL(p,t.u_units_to_pixels)}),lineGradient:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_ratio:new d.aH(p,t.u_ratio),u_device_pixel_ratio:new d.aH(p,t.u_device_pixel_ratio),u_units_to_pixels:new d.aL(p,t.u_units_to_pixels),u_image:new d.aG(p,t.u_image),u_image_height:new d.aH(p,t.u_image_height)}),linePattern:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_texsize:new d.aL(p,t.u_texsize),u_ratio:new d.aH(p,t.u_ratio),u_device_pixel_ratio:new d.aH(p,t.u_device_pixel_ratio),u_image:new d.aG(p,t.u_image),u_units_to_pixels:new d.aL(p,t.u_units_to_pixels),u_scale:new d.aK(p,t.u_scale),u_fade:new d.aH(p,t.u_fade)}),lineSDF:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_ratio:new d.aH(p,t.u_ratio),u_device_pixel_ratio:new d.aH(p,t.u_device_pixel_ratio),u_units_to_pixels:new d.aL(p,t.u_units_to_pixels),u_patternscale_a:new d.aL(p,t.u_patternscale_a),u_patternscale_b:new d.aL(p,t.u_patternscale_b),u_sdfgamma:new d.aH(p,t.u_sdfgamma),u_image:new d.aG(p,t.u_image),u_tex_y_a:new d.aH(p,t.u_tex_y_a),u_tex_y_b:new d.aH(p,t.u_tex_y_b),u_mix:new d.aH(p,t.u_mix)}),raster:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_tl_parent:new d.aL(p,t.u_tl_parent),u_scale_parent:new d.aH(p,t.u_scale_parent),u_buffer_scale:new d.aH(p,t.u_buffer_scale),u_fade_t:new d.aH(p,t.u_fade_t),u_opacity:new d.aH(p,t.u_opacity),u_image0:new d.aG(p,t.u_image0),u_image1:new d.aG(p,t.u_image1),u_brightness_low:new d.aH(p,t.u_brightness_low),u_brightness_high:new d.aH(p,t.u_brightness_high),u_saturation_factor:new d.aH(p,t.u_saturation_factor),u_contrast_factor:new d.aH(p,t.u_contrast_factor),u_spin_weights:new d.aK(p,t.u_spin_weights)}),symbolIcon:(p,t)=>({u_is_size_zoom_constant:new d.aG(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aG(p,t.u_is_size_feature_constant),u_size_t:new d.aH(p,t.u_size_t),u_size:new d.aH(p,t.u_size),u_camera_to_center_distance:new d.aH(p,t.u_camera_to_center_distance),u_pitch:new d.aH(p,t.u_pitch),u_rotate_symbol:new d.aG(p,t.u_rotate_symbol),u_aspect_ratio:new d.aH(p,t.u_aspect_ratio),u_fade_change:new d.aH(p,t.u_fade_change),u_matrix:new d.aI(p,t.u_matrix),u_label_plane_matrix:new d.aI(p,t.u_label_plane_matrix),u_coord_matrix:new d.aI(p,t.u_coord_matrix),u_is_text:new d.aG(p,t.u_is_text),u_pitch_with_map:new d.aG(p,t.u_pitch_with_map),u_texsize:new d.aL(p,t.u_texsize),u_texture:new d.aG(p,t.u_texture)}),symbolSDF:(p,t)=>({u_is_size_zoom_constant:new d.aG(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aG(p,t.u_is_size_feature_constant),u_size_t:new d.aH(p,t.u_size_t),u_size:new d.aH(p,t.u_size),u_camera_to_center_distance:new d.aH(p,t.u_camera_to_center_distance),u_pitch:new d.aH(p,t.u_pitch),u_rotate_symbol:new d.aG(p,t.u_rotate_symbol),u_aspect_ratio:new d.aH(p,t.u_aspect_ratio),u_fade_change:new d.aH(p,t.u_fade_change),u_matrix:new d.aI(p,t.u_matrix),u_label_plane_matrix:new d.aI(p,t.u_label_plane_matrix),u_coord_matrix:new d.aI(p,t.u_coord_matrix),u_is_text:new d.aG(p,t.u_is_text),u_pitch_with_map:new d.aG(p,t.u_pitch_with_map),u_texsize:new d.aL(p,t.u_texsize),u_texture:new d.aG(p,t.u_texture),u_gamma_scale:new d.aH(p,t.u_gamma_scale),u_device_pixel_ratio:new d.aH(p,t.u_device_pixel_ratio),u_is_halo:new d.aG(p,t.u_is_halo)}),symbolTextAndIcon:(p,t)=>({u_is_size_zoom_constant:new d.aG(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aG(p,t.u_is_size_feature_constant),u_size_t:new d.aH(p,t.u_size_t),u_size:new d.aH(p,t.u_size),u_camera_to_center_distance:new d.aH(p,t.u_camera_to_center_distance),u_pitch:new d.aH(p,t.u_pitch),u_rotate_symbol:new d.aG(p,t.u_rotate_symbol),u_aspect_ratio:new d.aH(p,t.u_aspect_ratio),u_fade_change:new d.aH(p,t.u_fade_change),u_matrix:new d.aI(p,t.u_matrix),u_label_plane_matrix:new d.aI(p,t.u_label_plane_matrix),u_coord_matrix:new d.aI(p,t.u_coord_matrix),u_is_text:new d.aG(p,t.u_is_text),u_pitch_with_map:new d.aG(p,t.u_pitch_with_map),u_texsize:new d.aL(p,t.u_texsize),u_texsize_icon:new d.aL(p,t.u_texsize_icon),u_texture:new d.aG(p,t.u_texture),u_texture_icon:new d.aG(p,t.u_texture_icon),u_gamma_scale:new d.aH(p,t.u_gamma_scale),u_device_pixel_ratio:new d.aH(p,t.u_device_pixel_ratio),u_is_halo:new d.aG(p,t.u_is_halo)}),background:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_opacity:new d.aH(p,t.u_opacity),u_color:new d.aM(p,t.u_color)}),backgroundPattern:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_opacity:new d.aH(p,t.u_opacity),u_image:new d.aG(p,t.u_image),u_pattern_tl_a:new d.aL(p,t.u_pattern_tl_a),u_pattern_br_a:new d.aL(p,t.u_pattern_br_a),u_pattern_tl_b:new d.aL(p,t.u_pattern_tl_b),u_pattern_br_b:new d.aL(p,t.u_pattern_br_b),u_texsize:new d.aL(p,t.u_texsize),u_mix:new d.aH(p,t.u_mix),u_pattern_size_a:new d.aL(p,t.u_pattern_size_a),u_pattern_size_b:new d.aL(p,t.u_pattern_size_b),u_scale_a:new d.aH(p,t.u_scale_a),u_scale_b:new d.aH(p,t.u_scale_b),u_pixel_coord_upper:new d.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aL(p,t.u_pixel_coord_lower),u_tile_units_to_pixels:new d.aH(p,t.u_tile_units_to_pixels)}),terrain:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_texture:new d.aG(p,t.u_texture),u_ele_delta:new d.aH(p,t.u_ele_delta)}),terrainDepth:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_ele_delta:new d.aH(p,t.u_ele_delta)}),terrainCoords:(p,t)=>({u_matrix:new d.aI(p,t.u_matrix),u_texture:new d.aG(p,t.u_texture),u_terrain_coords_id:new d.aH(p,t.u_terrain_coords_id),u_ele_delta:new d.aH(p,t.u_ele_delta)})};class Po{constructor(t,a,u){this.context=t;const c=t.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const qs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ji{constructor(t,a,u,c){this.length=a.length,this.attributes=u,this.itemSize=a.bytesPerElement,this.dynamicDraw=c,this.context=t;const m=t.gl;this.buffer=m.createBuffer(),t.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let u=0;u<this.attributes.length;u++){const c=a.attributes[this.attributes[u].name];c!==void 0&&t.enableVertexAttribArray(c)}}setVertexAttribPointers(t,a,u){for(let c=0;c<this.attributes.length;c++){const m=this.attributes[c],w=a.attributes[m.name];w!==void 0&&t.vertexAttribPointer(w,m.components,t[qs[m.type]],!1,this.itemSize,m.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const pi=new WeakMap;function oa(p){var t;if(pi.has(p))return pi.get(p);{const a=(t=p.getParameter(p.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return pi.set(p,a),a}}class Bt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Gs extends Bt{getDefault(){return d.aO.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class au extends Bt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class su extends Bt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Hs extends Bt{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class lu extends Bt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class uu extends Bt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ws extends Bt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class bh extends Bt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Sh extends Bt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class aa extends Bt{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class qp extends Bt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class Gp extends Bt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Hp extends Bt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class Wp extends Bt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Yp extends Bt{getDefault(){return d.aO.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Kp extends Bt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class cu extends Bt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class Ys extends Bt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class hu extends Bt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class du extends Bt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class sa extends Bt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Th extends Bt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ih extends Bt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class pu extends Bt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Mo extends Bt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class kh extends Bt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class la extends Bt{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ua extends Bt{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const u=this.gl;oa(u)?u.bindVertexArray(t):(a=u.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Eh extends Bt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class fu extends Bt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Nt extends Bt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ca extends Bt{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class Xp extends ca{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ch extends ca{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ns extends ca{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Jp{constructor(t,a,u,c,m){this.context=t,this.width=a,this.height=u;const w=t.gl,b=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new Xp(t,b),c)this.depthAttachment=m?new ns(t,b):new Ch(t,b);else if(m)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const u=this.depthAttachment.get();u&&t.deleteRenderbuffer(u)}t.deleteFramebuffer(this.framebuffer)}}class Sr{constructor(t,a,u){this.blendFunction=t,this.blendColor=a,this.mask=u}}Sr.Replace=[1,0],Sr.disabled=new Sr(Sr.Replace,d.aO.transparent,[!1,!1,!1,!1]),Sr.unblended=new Sr(Sr.Replace,d.aO.transparent,[!0,!0,!0,!0]),Sr.alphaBlended=new Sr([1,771],d.aO.transparent,[!0,!0,!0,!0]);class Ph{constructor(t){var a,u;if(this.gl=t,this.clearColor=new Gs(this),this.clearDepth=new au(this),this.clearStencil=new su(this),this.colorMask=new Hs(this),this.depthMask=new lu(this),this.stencilMask=new uu(this),this.stencilFunc=new Ws(this),this.stencilOp=new bh(this),this.stencilTest=new Sh(this),this.depthRange=new aa(this),this.depthTest=new qp(this),this.depthFunc=new Gp(this),this.blend=new Hp(this),this.blendFunc=new Wp(this),this.blendColor=new Yp(this),this.blendEquation=new Kp(this),this.cullFace=new cu(this),this.cullFaceSide=new Ys(this),this.frontFace=new hu(this),this.program=new du(this),this.activeTexture=new sa(this),this.viewport=new Th(this),this.bindFramebuffer=new Ih(this),this.bindRenderbuffer=new pu(this),this.bindTexture=new Mo(this),this.bindVertexBuffer=new kh(this),this.bindElementBuffer=new la(this),this.bindVertexArray=new ua(this),this.pixelStoreUnpack=new Eh(this),this.pixelStoreUnpackPremultiplyAlpha=new fu(this),this.pixelStoreUnpackFlipY=new Nt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),oa(t)){this.HALF_FLOAT=t.HALF_FLOAT;const c=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:c==null?void 0:c.RGBA16F_EXT,this.RGB16F=(u=t.RGB16F)!==null&&u!==void 0?u:c==null?void 0:c.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const c=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=c==null?void 0:c.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new Po(this,t,a)}createVertexBuffer(t,a,u){return new ji(this,t,a,u)}createRenderbuffer(t,a,u){const c=this.gl,m=c.createRenderbuffer();return this.bindRenderbuffer.set(m),c.renderbufferStorage(c.RENDERBUFFER,t,a,u),this.bindRenderbuffer.set(null),m}createFramebuffer(t,a,u,c){return new Jp(this,t,a,u,c)}clear({color:t,depth:a,stencil:u}){const c=this.gl;let m=0;t&&(m|=c.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(m|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),u!==void 0&&(m|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),c.clear(m)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){d.aD(t.blendFunction,Sr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return oa(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return oa(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Lt{constructor(t,a,u){this.func=t,this.mask=a,this.range=u}}Lt.ReadOnly=!1,Lt.ReadWrite=!0,Lt.disabled=new Lt(519,Lt.ReadOnly,[0,1]);const os=7680;class Qt{constructor(t,a,u,c,m,w){this.test=t,this.ref=a,this.mask=u,this.fail=c,this.depthFail=m,this.pass=w}}Qt.disabled=new Qt({func:519,mask:0},0,0,os,os,os);class Yt{constructor(t,a,u){this.enable=t,this.mode=a,this.frontFace=u}}let ha;function Ks(p,t,a,u,c,m,w){const b=p.context,I=b.gl,C=p.useProgram("collisionBox"),A=[];let L=0,N=0;for(let ee=0;ee<u.length;ee++){const he=u[ee],ge=t.getTile(he),ye=ge.getBucket(a);if(!ye)continue;let Se=he.posMatrix;c[0]===0&&c[1]===0||(Se=p.translatePosMatrix(he.posMatrix,ge,c,m));const Ae=w?ye.textCollisionBox:ye.iconCollisionBox,Pe=ye.collisionCircleArray;if(Pe.length>0){const ze=d.F(),Ye=Se;d.aP(ze,ye.placementInvProjMatrix,p.transform.glCoordMatrix),d.aP(ze,ze,ye.placementViewportMatrix),A.push({circleArray:Pe,circleOffset:N,transform:Ye,invTransform:ze,coord:he}),L+=Pe.length/4,N=L}Ae&&C.draw(b,I.LINES,Lt.disabled,Qt.disabled,p.colorModeForRenderPass(),Yt.disabled,Up(Se,p.transform,ge),p.style.map.terrain&&p.style.map.terrain.getTerrainData(he),a.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,null,p.transform.zoom,null,null,Ae.collisionVertexBuffer)}if(!w||!A.length)return;const Y=p.useProgram("collisionCircle"),G=new d.aQ;G.resize(4*L),G._trim();let J=0;for(const ee of A)for(let he=0;he<ee.circleArray.length/4;he++){const ge=4*he,ye=ee.circleArray[ge+0],Se=ee.circleArray[ge+1],Ae=ee.circleArray[ge+2],Pe=ee.circleArray[ge+3];G.emplace(J++,ye,Se,Ae,Pe,0),G.emplace(J++,ye,Se,Ae,Pe,1),G.emplace(J++,ye,Se,Ae,Pe,2),G.emplace(J++,ye,Se,Ae,Pe,3)}(!ha||ha.length<2*L)&&(ha=function(ee){const he=2*ee,ge=new d.aS;ge.resize(he),ge._trim();for(let ye=0;ye<he;ye++){const Se=6*ye;ge.uint16[Se+0]=4*ye+0,ge.uint16[Se+1]=4*ye+1,ge.uint16[Se+2]=4*ye+2,ge.uint16[Se+3]=4*ye+2,ge.uint16[Se+4]=4*ye+3,ge.uint16[Se+5]=4*ye+0}return ge}(L));const V=b.createIndexBuffer(ha,!0),le=b.createVertexBuffer(G,d.aR.members,!0);for(const ee of A){const he={u_matrix:ee.transform,u_inv_matrix:ee.invTransform,u_camera_to_center_distance:(me=p.transform).cameraToCenterDistance,u_viewport_size:[me.width,me.height]};Y.draw(b,I.TRIANGLES,Lt.disabled,Qt.disabled,p.colorModeForRenderPass(),Yt.disabled,he,p.style.map.terrain&&p.style.map.terrain.getTerrainData(ee.coord),a.id,le,V,d.$.simpleSegment(0,2*ee.circleOffset,ee.circleArray.length,ee.circleArray.length/2),null,p.transform.zoom,null,null,null)}var me;le.destroy(),V.destroy()}Yt.disabled=new Yt(!1,1029,2305),Yt.backCCW=new Yt(!0,1029,2305);const Mh=d.an(new Float32Array(16));function Xs(p,t,a,u,c,m){const{horizontalAlign:w,verticalAlign:b}=d.at(p);return new d.P((-(w-.5)*t/c+u[0])*m,(-(b-.5)*a/c+u[1])*m)}function Js(p,t,a,u,c,m,w,b,I,C,A){const L=p.text.placedSymbolArray,N=p.text.dynamicLayoutVertexArray,Y=p.icon.dynamicLayoutVertexArray,G={};N.clear();for(let J=0;J<L.length;J++){const V=L.get(J),le=V.hidden||!V.crossTileID||p.allowVerticalPlacement&&!V.placedOrientation?null:u[V.crossTileID];if(le){const me=new d.P(V.anchorX,V.anchorY),ee=H(me,a?w:m,A),he=E(c.cameraToCenterDistance,ee.signedDistanceFromCamera);let ge=d.ai(p.textSizeData,I,V)*he/d.ao;a&&(ge*=p.tilePixelRatio/b);const{width:ye,height:Se,anchor:Ae,textOffset:Pe,textBoxScale:ze}=le,Ye=Xs(Ae,ye,Se,Pe,ze,ge),_t=a?H(me.add(Ye),m,A).point:ee.point.add(t?Ye.rotate(-c.angle):Ye),Ue=p.allowVerticalPlacement&&V.placedOrientation===d.ah.vertical?Math.PI/2:0;for(let ut=0;ut<V.numGlyphs;ut++)d.aj(N,_t,Ue);C&&V.associatedIconIndex>=0&&(G[V.associatedIconIndex]={shiftedAnchor:_t,angle:Ue})}else Oe(V.numGlyphs,N)}if(C){Y.clear();const J=p.icon.placedSymbolArray;for(let V=0;V<J.length;V++){const le=J.get(V);if(le.hidden)Oe(le.numGlyphs,Y);else{const me=G[V];if(me)for(let ee=0;ee<le.numGlyphs;ee++)d.aj(Y,me.shiftedAnchor,me.angle);else Oe(le.numGlyphs,Y)}}p.icon.dynamicLayoutVertexBuffer.updateData(Y)}p.text.dynamicLayoutVertexBuffer.updateData(N)}function mu(p,t,a){return a.iconsInText&&t?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function zh(p,t,a,u,c,m,w,b,I,C,A,L){const N=p.context,Y=N.gl,G=p.transform,J=b==="map",V=I==="map",le=b!=="viewport"&&a.layout.get("symbol-placement")!=="point",me=J&&!V&&!le,ee=!a.layout.get("symbol-sort-key").isConstant();let he=!1;const ge=p.depthModeForSublayer(0,Lt.ReadOnly),ye=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Se=[];for(const Ae of u){const Pe=t.getTile(Ae),ze=Pe.getBucket(a);if(!ze)continue;const Ye=c?ze.text:ze.icon;if(!Ye||!Ye.segments.get().length||!Ye.hasVisibleVertices)continue;const _t=Ye.programConfigurations.get(a.id),Ue=c||ze.sdfIcons,ut=c?ze.textSizeData:ze.iconSizeData,wt=V||G.pitch!==0,zt=p.useProgram(mu(Ue,c,ze),_t),ft=d.ag(ut,G.zoom),St=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Ae);let Tt,cr,Kt,ki,Ar=[0,0],er=null;if(c)cr=Pe.glyphAtlasTexture,Kt=Y.LINEAR,Tt=Pe.glyphAtlasTexture.size,ze.iconsInText&&(Ar=Pe.imageAtlasTexture.size,er=Pe.imageAtlasTexture,ki=wt||p.options.rotating||p.options.zooming||ut.kind==="composite"||ut.kind==="camera"?Y.LINEAR:Y.NEAREST);else{const ar=a.layout.get("icon-size").constantOr(0)!==1||ze.iconsNeedLinear;cr=Pe.imageAtlasTexture,Kt=Ue||p.options.rotating||p.options.zooming||ar||wt?Y.LINEAR:Y.NEAREST,Tt=Pe.imageAtlasTexture.size}const ai=lt(Pe,1,p.transform.zoom),fn=Mn(Ae.posMatrix,V,J,p.transform,ai),Rn=Ji(Ae.posMatrix,V,J,p.transform,ai),Fo=ye&&ze.hasTextData(),Bo=a.layout.get("icon-text-fit")!=="none"&&Fo&&ze.hasIconData();if(le){const ar=p.style.map.terrain?(Vi,Mt)=>p.style.map.terrain.getElevation(Ae,Vi,Mt):null,Xr=a.layout.get("text-rotation-alignment")==="map";D(ze,Ae.posMatrix,p,c,fn,Rn,V,C,Xr,ar)}const Fn=p.translatePosMatrix(Ae.posMatrix,Pe,m,w),mn=le||c&&ye||Bo?Mh:fn,mr=p.translatePosMatrix(Rn,Pe,m,w,!0),ir=Ue&&a.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let xr;xr=Ue?ze.iconsInText?Vp(ut.kind,ft,me,V,p,Fn,mn,mr,Tt,Ar):na(ut.kind,ft,me,V,p,Fn,mn,mr,c,Tt,!0):is(ut.kind,ft,me,V,p,Fn,mn,mr,c,Tt);const ba={program:zt,buffers:Ye,uniformValues:xr,atlasTexture:cr,atlasTextureIcon:er,atlasInterpolation:Kt,atlasInterpolationIcon:ki,isSDF:Ue,hasHalo:ir};if(ee&&ze.canOverlap){he=!0;const ar=Ye.segments.get();for(const Xr of ar)Se.push({segments:new d.$([Xr]),sortKey:Xr.sortKey,state:ba,terrainData:St})}else Se.push({segments:Ye.segments,sortKey:0,state:ba,terrainData:St})}he&&Se.sort((Ae,Pe)=>Ae.sortKey-Pe.sortKey);for(const Ae of Se){const Pe=Ae.state;if(N.activeTexture.set(Y.TEXTURE0),Pe.atlasTexture.bind(Pe.atlasInterpolation,Y.CLAMP_TO_EDGE),Pe.atlasTextureIcon&&(N.activeTexture.set(Y.TEXTURE1),Pe.atlasTextureIcon&&Pe.atlasTextureIcon.bind(Pe.atlasInterpolationIcon,Y.CLAMP_TO_EDGE)),Pe.isSDF){const ze=Pe.uniformValues;Pe.hasHalo&&(ze.u_is_halo=1,Qs(Pe.buffers,Ae.segments,a,p,Pe.program,ge,A,L,ze,Ae.terrainData)),ze.u_is_halo=0}Qs(Pe.buffers,Ae.segments,a,p,Pe.program,ge,A,L,Pe.uniformValues,Ae.terrainData)}}function Qs(p,t,a,u,c,m,w,b,I,C){const A=u.context;c.draw(A,A.gl.TRIANGLES,m,w,b,Yt.disabled,I,C,a.id,p.layoutVertexBuffer,p.indexBuffer,t,a.paint,u.transform.zoom,p.programConfigurations.get(a.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function Ah(p,t,a,u,c){if(!a||!u||!u.imageAtlas)return;const m=u.imageAtlas.patternPositions;let w=m[a.to.toString()],b=m[a.from.toString()];if(!w&&b&&(w=b),!b&&w&&(b=w),!w||!b){const I=c.getPaintProperty(t);w=m[I],b=m[I]}w&&b&&p.setConstantPatternPositions(w,b)}function gu(p,t,a,u,c,m,w){const b=p.context.gl,I="fill-pattern",C=a.paint.get(I),A=C&&C.constantOr(1),L=a.getCrossfadeParameters();let N,Y,G,J,V;w?(Y=A&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=b.LINES):(Y=A?"fillPattern":"fill",N=b.TRIANGLES);const le=C.constantOr(null);for(const me of u){const ee=t.getTile(me);if(A&&!ee.patternsLoaded())continue;const he=ee.getBucket(a);if(!he)continue;const ge=he.programConfigurations.get(a.id),ye=p.useProgram(Y,ge),Se=p.style.map.terrain&&p.style.map.terrain.getTerrainData(me);A&&(p.context.activeTexture.set(b.TEXTURE0),ee.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),ge.updatePaintBuffers(L)),Ah(ge,I,le,ee,a);const Ae=Se?me:null,Pe=p.translatePosMatrix(Ae?Ae.posMatrix:me.posMatrix,ee,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(w){J=he.indexBuffer2,V=he.segments2;const ze=[b.drawingBufferWidth,b.drawingBufferHeight];G=Y==="fillOutlinePattern"&&A?jp(Pe,p,L,ee,ze):yh(Pe,ze)}else J=he.indexBuffer,V=he.segments,G=A?gh(Pe,p,L,ee):js(Pe);ye.draw(p.context,N,c,p.stencilModeForClipping(me),m,Yt.disabled,G,Se,a.id,he.layoutVertexBuffer,J,V,a.paint,p.transform.zoom,ge)}}function da(p,t,a,u,c,m,w){const b=p.context,I=b.gl,C="fill-extrusion-pattern",A=a.paint.get(C),L=A.constantOr(1),N=a.getCrossfadeParameters(),Y=a.paint.get("fill-extrusion-opacity"),G=A.constantOr(null);for(const J of u){const V=t.getTile(J),le=V.getBucket(a);if(!le)continue;const me=p.style.map.terrain&&p.style.map.terrain.getTerrainData(J),ee=le.programConfigurations.get(a.id),he=p.useProgram(L?"fillExtrusionPattern":"fillExtrusion",ee);L&&(p.context.activeTexture.set(I.TEXTURE0),V.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ee.updatePaintBuffers(N)),Ah(ee,C,G,V,a);const ge=p.translatePosMatrix(J.posMatrix,V,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),ye=a.paint.get("fill-extrusion-vertical-gradient"),Se=L?Np(ge,p,ye,Y,J,N,V):mh(ge,p,ye,Y);he.draw(b,b.gl.TRIANGLES,c,m,w,Yt.backCCW,Se,me,a.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,a.paint,p.transform.zoom,ee,p.style.map.terrain&&le.centroidVertexBuffer)}}function yu(p,t,a,u,c,m,w){const b=p.context,I=b.gl,C=a.fbo;if(!C)return;const A=p.useProgram("hillshade"),L=p.style.map.terrain&&p.style.map.terrain.getTerrainData(t);b.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,C.colorAttachment.get()),A.draw(b,I.TRIANGLES,c,m,w,Yt.disabled,((N,Y,G,J)=>{const V=G.paint.get("hillshade-shadow-color"),le=G.paint.get("hillshade-highlight-color"),me=G.paint.get("hillshade-accent-color");let ee=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);G.paint.get("hillshade-illumination-anchor")==="viewport"&&(ee-=N.transform.angle);const he=!N.options.moving;return{u_matrix:J?J.posMatrix:N.transform.calculatePosMatrix(Y.tileID.toUnwrapped(),he),u_image:0,u_latrange:xh(0,Y.tileID),u_light:[G.paint.get("hillshade-exaggeration"),ee],u_shadow:V,u_highlight:le,u_accent:me}})(p,a,u,L?t:null),L,u.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function Dh(p,t,a,u,c,m){const w=p.context,b=w.gl,I=t.dem;if(I&&I.data){const C=I.dim,A=I.stride,L=I.getPixels();if(w.activeTexture.set(b.TEXTURE1),w.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||p.getTileTexture(A),t.demTexture){const Y=t.demTexture;Y.update(L,{premultiply:!1}),Y.bind(b.NEAREST,b.CLAMP_TO_EDGE)}else t.demTexture=new kt(w,L,b.RGBA,{premultiply:!1}),t.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);w.activeTexture.set(b.TEXTURE0);let N=t.fbo;if(!N){const Y=new kt(w,{width:C,height:C,data:null},b.RGBA);Y.bind(b.LINEAR,b.CLAMP_TO_EDGE),N=t.fbo=w.createFramebuffer(C,C,!0,!1),N.colorAttachment.set(Y.texture)}w.bindFramebuffer.set(N.framebuffer),w.viewport.set([0,0,C,C]),p.useProgram("hillshadePrepare").draw(w,b.TRIANGLES,u,c,m,Yt.disabled,((Y,G)=>{const J=G.stride,V=d.F();return d.aN(V,0,d.W,-d.W,0,0,1),d.H(V,V,[0,-d.W,0]),{u_matrix:V,u_image:1,u_dimension:[J,J],u_zoom:Y.overscaledZ,u_unpack:G.getUnpackVector()}})(t.tileID,I),null,a.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Lh(p,t,a,u,c,m){const w=u.paint.get("raster-fade-duration");if(!m&&w>0){const b=q.now(),I=(b-p.timeAdded)/w,C=t?(b-t.timeAdded)/w:-1,A=a.getSource(),L=c.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),N=!t||Math.abs(t.tileID.overscaledZ-L)>Math.abs(p.tileID.overscaledZ-L),Y=N&&p.refreshedUponExpiration?1:d.ac(N?I:1-C,0,1);return p.refreshedUponExpiration&&I>=1&&(p.refreshedUponExpiration=!1),t?{opacity:1,mix:1-Y}:{opacity:Y,mix:0}}return{opacity:1,mix:0}}const el=new d.aO(1,0,0,1),_u=new d.aO(0,1,0,1),Qp=new d.aO(0,0,1,1),Rh=new d.aO(1,0,1,1),vr=new d.aO(0,1,1,1);function po(p,t,a,u){pa(p,0,t+a/2,p.transform.width,a,u)}function Ui(p,t,a,u){pa(p,t-a/2,0,a,p.transform.height,u)}function pa(p,t,a,u,c,m){const w=p.context,b=w.gl;b.enable(b.SCISSOR_TEST),b.scissor(t*p.pixelRatio,a*p.pixelRatio,u*p.pixelRatio,c*p.pixelRatio),w.clear({color:m}),b.disable(b.SCISSOR_TEST)}function vu(p,t,a){const u=p.context,c=u.gl,m=a.posMatrix,w=p.useProgram("debug"),b=Lt.disabled,I=Qt.disabled,C=p.colorModeForRenderPass(),A="$debug",L=p.style.map.terrain&&p.style.map.terrain.getTerrainData(a);u.activeTexture.set(c.TEXTURE0);const N=t.getTileByID(a.key).latestRawTileData,Y=Math.floor((N&&N.byteLength||0)/1024),G=t.getTile(a).tileSize,J=512/Math.min(G,512)*(a.overscaledZ/p.transform.zoom)*.5;let V=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(V+=` => ${a.overscaledZ}`),function(le,me){le.initDebugOverlayCanvas();const ee=le.debugOverlayCanvas,he=le.context.gl,ge=le.debugOverlayCanvas.getContext("2d");ge.clearRect(0,0,ee.width,ee.height),ge.shadowColor="white",ge.shadowBlur=2,ge.lineWidth=1.5,ge.strokeStyle="white",ge.textBaseline="top",ge.font="bold 36px Open Sans, sans-serif",ge.fillText(me,5,5),ge.strokeText(me,5,5),le.debugOverlayTexture.update(ee),le.debugOverlayTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE)}(p,`${V} ${Y}kB`),w.draw(u,c.TRIANGLES,b,I,Sr.alphaBlended,Yt.disabled,Us(m,d.aO.transparent,J),null,A,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),w.draw(u,c.LINE_STRIP,b,I,C,Yt.disabled,Us(m,d.aO.red),L,A,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function xu(p,t,a){const u=p.context,c=u.gl,m=p.colorModeForRenderPass(),w=new Lt(c.LEQUAL,Lt.ReadWrite,p.depthRangeFor3D),b=p.useProgram("terrain"),I=t.getTerrainMesh();u.bindFramebuffer.set(null),u.viewport.set([0,0,p.width,p.height]);for(const C of a){const A=p.renderToTexture.getTexture(C),L=t.getTerrainData(C.tileID);u.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,A.texture);const N={u_matrix:p.transform.calculatePosMatrix(C.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(p.transform.zoom)};b.draw(u,c.TRIANGLES,w,Qt.disabled,m,Yt.backCCW,N,L,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}}class fa{constructor(t,a){this.context=new Ph(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Fe.maxUnderzooming+Fe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new _r}resize(t,a,u){if(this.width=Math.floor(t*u),this.height=Math.floor(a*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const t=this.context,a=new d.aV;a.emplaceBack(0,0),a.emplaceBack(d.W,0),a.emplaceBack(0,d.W),a.emplaceBack(d.W,d.W),this.tileExtentBuffer=t.createVertexBuffer(a,zn.members),this.tileExtentSegments=d.$.simpleSegment(0,0,4,2);const u=new d.aV;u.emplaceBack(0,0),u.emplaceBack(d.W,0),u.emplaceBack(0,d.W),u.emplaceBack(d.W,d.W),this.debugBuffer=t.createVertexBuffer(u,zn.members),this.debugSegments=d.$.simpleSegment(0,0,4,5);const c=new d.Z;c.emplaceBack(0,0,0,0),c.emplaceBack(d.W,0,d.W,0),c.emplaceBack(0,d.W,0,d.W),c.emplaceBack(d.W,d.W,d.W,d.W),this.rasterBoundsBuffer=t.createVertexBuffer(c,dr.members),this.rasterBoundsSegments=d.$.simpleSegment(0,0,4,2);const m=new d.aV;m.emplaceBack(0,0),m.emplaceBack(1,0),m.emplaceBack(0,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,zn.members),this.viewportSegments=d.$.simpleSegment(0,0,4,2);const w=new d.aW;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(w);const b=new d.aX;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(b);const I=this.context.gl;this.stencilClearMode=new Qt({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=d.F();d.aN(u,0,this.width,this.height,0,0,1),d.J(u,u,[a.drawingBufferWidth,a.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,a.TRIANGLES,Lt.disabled,this.stencilClearMode,Sr.disabled,Yt.disabled,ou(u),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source;const u=this.context,c=u.gl;this.nextStencilID+a.length>256&&this.clearStencil(),u.setColorMode(Sr.disabled),u.setDepthMode(Lt.disabled);const m=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of a){const b=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,I=this.style.map.terrain&&this.style.map.terrain.getTerrainData(w);m.draw(u,c.TRIANGLES,Lt.disabled,new Qt({func:c.ALWAYS,mask:0},b,255,c.KEEP,c.KEEP,c.REPLACE),Sr.disabled,Yt.disabled,ou(w.posMatrix),I,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new Qt({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new Qt({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,u=t.sort((w,b)=>b.overscaledZ-w.overscaledZ),c=u[u.length-1].overscaledZ,m=u[0].overscaledZ-c+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const w={};for(let b=0;b<m;b++)w[b+c]=new Qt({func:a.GEQUAL,mask:255},b+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=m,[w,u]}return[{[c]:Qt.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Sr([t.CONSTANT_COLOR,t.ONE],new d.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Sr.unblended:Sr.alphaBlended}depthModeForSublayer(t,a,u){if(!this.opaquePassEnabledForLayer())return Lt.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Lt(u||this.context.gl.LEQUAL,a,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(q.now()),this.imageManager.beginFrame();const u=this.style._order,c=this.style.sourceCaches,m={},w={},b={};for(const I in c){const C=c[I];C.used&&C.prepare(this.context),m[I]=C.getVisibleCoordinates(),w[I]=m[I].slice().reverse(),b[I]=C.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<u.length;I++)if(this.style._layers[u[I]].is3D()){this.opaquePassCutoff=I;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const I of u){const C=this.style._layers[I];if(!C.hasOffscreenPass()||C.isHidden(this.transform.zoom))continue;const A=w[C.source];(C.type==="custom"||A.length)&&this.renderLayer(this,c[C.source],C,A)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?d.aO.black:d.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[u[this.currentLayer]],C=c[I.source],A=m[I.source];this._renderTileClippingMasks(I,A),this.renderLayer(this,C,I,A)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const I=this.style._layers[u[this.currentLayer]],C=c[I.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(I))continue;const A=(I.type==="symbol"?b:w)[I.source];this._renderTileClippingMasks(I,m[I.source]),this.renderLayer(this,C,I,A)}if(this.options.showTileBoundaries){const I=function(C,A){let L=null;const N=Object.values(C._layers).flatMap(V=>V.source&&!V.isHidden(A)?[C.sourceCaches[V.source]]:[]),Y=N.filter(V=>V.getSource().type==="vector"),G=N.filter(V=>V.getSource().type!=="vector"),J=V=>{(!L||L.getSource().maxzoom<V.getSource().maxzoom)&&(L=V)};return Y.forEach(V=>J(V)),L||G.forEach(V=>J(V)),L}(this.style,this.transform.zoom);I&&function(C,A,L){for(let N=0;N<L.length;N++)vu(C,A,L[N])}(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const C=I.transform.padding;po(I,I.transform.height-(C.top||0),3,el),po(I,C.bottom||0,3,_u),Ui(I,C.left||0,3,Qp),Ui(I,I.transform.width-(C.right||0),3,Rh);const A=I.transform.centerPoint;(function(L,N,Y,G){pa(L,N-1,Y-10,2,20,G),pa(L,N-10,Y-1,20,2,G)})(I,A.x,I.transform.height-A.y,vr)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,u=this.transform.projMatrix;let c=this.terrainFacilitator.dirty;c||(c=t?!d.aY(a,u):!d.aZ(a,u)),c||(c=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),c&&(d.a_(a,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(m,w){const b=m.context,I=b.gl,C=Sr.unblended,A=new Lt(I.LEQUAL,Lt.ReadWrite,[0,1]),L=w.getTerrainMesh(),N=w.sourceCache.getRenderableTiles(),Y=m.useProgram("terrainDepth");b.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),b.clear({color:d.aO.transparent,depth:1});for(const G of N){const J=w.getTerrainData(G.tileID),V={u_matrix:m.transform.calculatePosMatrix(G.tileID.toUnwrapped()),u_ele_delta:w.getMeshFrameDelta(m.transform.zoom)};Y.draw(b,I.TRIANGLES,A,Qt.disabled,C,Yt.backCCW,V,J,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain),function(m,w){const b=m.context,I=b.gl,C=Sr.unblended,A=new Lt(I.LEQUAL,Lt.ReadWrite,[0,1]),L=w.getTerrainMesh(),N=w.getCoordsTexture(),Y=w.sourceCache.getRenderableTiles(),G=m.useProgram("terrainCoords");b.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),b.clear({color:d.aO.transparent,depth:1}),w.coordsIndex=[];for(const J of Y){const V=w.getTerrainData(J.tileID);b.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,N.texture);const le={u_matrix:m.transform.calculatePosMatrix(J.tileID.toUnwrapped()),u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(m.transform.zoom)};G.draw(b,I.TRIANGLES,A,Qt.disabled,C,Yt.backCCW,le,V,"terrain",L.vertexBuffer,L.indexBuffer,L.segments),w.coordsIndex.push(J.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain))}renderLayer(t,a,u,c){if(!u.isHidden(this.transform.zoom)&&(u.type==="background"||u.type==="custom"||(c||[]).length))switch(this.id=u.id,u.type){case"symbol":(function(m,w,b,I,C){if(m.renderPass!=="translucent")return;const A=Qt.disabled,L=m.colorModeForRenderPass();(b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(N,Y,G,J,V,le,me){const ee=Y.transform,he=V==="map",ge=le==="map";for(const ye of N){const Se=J.getTile(ye),Ae=Se.getBucket(G);if(!Ae||!Ae.text||!Ae.text.segments.get().length)continue;const Pe=d.ag(Ae.textSizeData,ee.zoom),ze=lt(Se,1,Y.transform.zoom),Ye=Mn(ye.posMatrix,ge,he,Y.transform,ze),_t=G.layout.get("icon-text-fit")!=="none"&&Ae.hasIconData();if(Pe){const Ue=Math.pow(2,ee.zoom-Se.tileID.overscaledZ);Js(Ae,he,ge,me,ee,Ye,ye.posMatrix,Ue,Pe,_t,Y.style.map.terrain?(ut,wt)=>Y.style.map.terrain.getElevation(ye,ut,wt):null)}}}(I,m,b,w,b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),C),b.paint.get("icon-opacity").constantOr(1)!==0&&zh(m,w,b,I,!1,b.paint.get("icon-translate"),b.paint.get("icon-translate-anchor"),b.layout.get("icon-rotation-alignment"),b.layout.get("icon-pitch-alignment"),b.layout.get("icon-keep-upright"),A,L),b.paint.get("text-opacity").constantOr(1)!==0&&zh(m,w,b,I,!0,b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.layout.get("text-keep-upright"),A,L),w.map.showCollisionBoxes&&(Ks(m,w,b,I,b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),!0),Ks(m,w,b,I,b.paint.get("icon-translate"),b.paint.get("icon-translate-anchor"),!1))})(t,a,u,c,this.style.placement.variableOffsets);break;case"circle":(function(m,w,b,I){if(m.renderPass!=="translucent")return;const C=b.paint.get("circle-opacity"),A=b.paint.get("circle-stroke-width"),L=b.paint.get("circle-stroke-opacity"),N=!b.layout.get("circle-sort-key").isConstant();if(C.constantOr(1)===0&&(A.constantOr(1)===0||L.constantOr(1)===0))return;const Y=m.context,G=Y.gl,J=m.depthModeForSublayer(0,Lt.ReadOnly),V=Qt.disabled,le=m.colorModeForRenderPass(),me=[];for(let ee=0;ee<I.length;ee++){const he=I[ee],ge=w.getTile(he),ye=ge.getBucket(b);if(!ye)continue;const Se=ye.programConfigurations.get(b.id),Ae=m.useProgram("circle",Se),Pe=ye.layoutVertexBuffer,ze=ye.indexBuffer,Ye=m.style.map.terrain&&m.style.map.terrain.getTerrainData(he),_t={programConfiguration:Se,program:Ae,layoutVertexBuffer:Pe,indexBuffer:ze,uniformValues:_h(m,he,ge,b),terrainData:Ye};if(N){const Ue=ye.segments.get();for(const ut of Ue)me.push({segments:new d.$([ut]),sortKey:ut.sortKey,state:_t})}else me.push({segments:ye.segments,sortKey:0,state:_t})}N&&me.sort((ee,he)=>ee.sortKey-he.sortKey);for(const ee of me){const{programConfiguration:he,program:ge,layoutVertexBuffer:ye,indexBuffer:Se,uniformValues:Ae,terrainData:Pe}=ee.state;ge.draw(Y,G.TRIANGLES,J,V,le,Yt.disabled,Ae,Pe,b.id,ye,Se,ee.segments,b.paint,m.transform.zoom,he)}})(t,a,u,c);break;case"heatmap":(function(m,w,b,I){if(b.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const C=m.context,A=C.gl,L=Qt.disabled,N=new Sr([A.ONE,A.ONE],d.aO.transparent,[!0,!0,!0,!0]);(function(Y,G,J){const V=Y.gl;Y.activeTexture.set(V.TEXTURE1),Y.viewport.set([0,0,G.width/4,G.height/4]);let le=J.heatmapFbo;if(le)V.bindTexture(V.TEXTURE_2D,le.colorAttachment.get()),Y.bindFramebuffer.set(le.framebuffer);else{const me=V.createTexture();V.bindTexture(V.TEXTURE_2D,me),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MAG_FILTER,V.LINEAR),le=J.heatmapFbo=Y.createFramebuffer(G.width/4,G.height/4,!1,!1),function(ee,he,ge,ye){var Se,Ae;const Pe=ee.gl,ze=(Se=ee.HALF_FLOAT)!==null&&Se!==void 0?Se:Pe.UNSIGNED_BYTE,Ye=(Ae=ee.RGBA16F)!==null&&Ae!==void 0?Ae:Pe.RGBA;Pe.texImage2D(Pe.TEXTURE_2D,0,Ye,he.width/4,he.height/4,0,Pe.RGBA,ze,null),ye.colorAttachment.set(ge)}(Y,G,me,le)}})(C,m,b),C.clear({color:d.aO.transparent});for(let Y=0;Y<I.length;Y++){const G=I[Y];if(w.hasRenderableParent(G))continue;const J=w.getTile(G),V=J.getBucket(b);if(!V)continue;const le=V.programConfigurations.get(b.id),me=m.useProgram("heatmap",le),{zoom:ee}=m.transform;me.draw(C,A.TRIANGLES,Lt.disabled,L,N,Yt.disabled,vh(G.posMatrix,J,ee,b.paint.get("heatmap-intensity")),null,b.id,V.layoutVertexBuffer,V.indexBuffer,V.segments,b.paint,m.transform.zoom,le)}C.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(C,A){const L=C.context,N=L.gl,Y=A.heatmapFbo;if(!Y)return;L.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,Y.colorAttachment.get()),L.activeTexture.set(N.TEXTURE1);let G=A.colorRampTexture;G||(G=A.colorRampTexture=new kt(L,A.colorRamp,N.RGBA)),G.bind(N.LINEAR,N.CLAMP_TO_EDGE),C.useProgram("heatmapTexture").draw(L,N.TRIANGLES,Lt.disabled,Qt.disabled,C.colorModeForRenderPass(),Yt.disabled,((J,V,le,me)=>{const ee=d.F();d.aN(ee,0,J.width,J.height,0,0,1);const he=J.context.gl;return{u_matrix:ee,u_world:[he.drawingBufferWidth,he.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:V.paint.get("heatmap-opacity")}})(C,A),null,A.id,C.viewportBuffer,C.quadTriangleIndexBuffer,C.viewportSegments,A.paint,C.transform.zoom)}(m,b))})(t,a,u,c);break;case"line":(function(m,w,b,I){if(m.renderPass!=="translucent")return;const C=b.paint.get("line-opacity"),A=b.paint.get("line-width");if(C.constantOr(1)===0||A.constantOr(1)===0)return;const L=m.depthModeForSublayer(0,Lt.ReadOnly),N=m.colorModeForRenderPass(),Y=b.paint.get("line-dasharray"),G=b.paint.get("line-pattern"),J=G.constantOr(1),V=b.paint.get("line-gradient"),le=b.getCrossfadeParameters(),me=J?"linePattern":Y?"lineSDF":V?"lineGradient":"line",ee=m.context,he=ee.gl;let ge=!0;for(const ye of I){const Se=w.getTile(ye);if(J&&!Se.patternsLoaded())continue;const Ae=Se.getBucket(b);if(!Ae)continue;const Pe=Ae.programConfigurations.get(b.id),ze=m.context.program.get(),Ye=m.useProgram(me,Pe),_t=ge||Ye.program!==ze,Ue=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ye),ut=G.constantOr(null);if(ut&&Se.imageAtlas){const ft=Se.imageAtlas,St=ft.patternPositions[ut.to.toString()],Tt=ft.patternPositions[ut.from.toString()];St&&Tt&&Pe.setConstantPatternPositions(St,Tt)}const wt=Ue?ye:null,zt=J?$s(m,Se,b,le,wt):Y?en(m,Se,b,Y,le,wt):V?Co(m,Se,b,Ae.lineClipsArray.length,wt):Vs(m,Se,b,wt);if(J)ee.activeTexture.set(he.TEXTURE0),Se.imageAtlasTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE),Pe.updatePaintBuffers(le);else if(Y&&(_t||m.lineAtlas.dirty))ee.activeTexture.set(he.TEXTURE0),m.lineAtlas.bind(ee);else if(V){const ft=Ae.gradients[b.id];let St=ft.texture;if(b.gradientVersion!==ft.version){let Tt=256;if(b.stepInterpolant){const cr=w.getSource().maxzoom,Kt=ye.canonical.z===cr?Math.ceil(1<<m.transform.maxZoom-ye.canonical.z):1;Tt=d.ac(d.aT(Ae.maxLineLength/d.W*1024*Kt),256,ee.maxTextureSize)}ft.gradient=d.aU({expression:b.gradientExpression(),evaluationKey:"lineProgress",resolution:Tt,image:ft.gradient||void 0,clips:Ae.lineClipsArray}),ft.texture?ft.texture.update(ft.gradient):ft.texture=new kt(ee,ft.gradient,he.RGBA),ft.version=b.gradientVersion,St=ft.texture}ee.activeTexture.set(he.TEXTURE0),St.bind(b.stepInterpolant?he.NEAREST:he.LINEAR,he.CLAMP_TO_EDGE)}Ye.draw(ee,he.TRIANGLES,L,m.stencilModeForClipping(ye),N,Yt.disabled,zt,Ue,b.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,b.paint,m.transform.zoom,Pe,Ae.layoutVertexBuffer2),ge=!1}})(t,a,u,c);break;case"fill":(function(m,w,b,I){const C=b.paint.get("fill-color"),A=b.paint.get("fill-opacity");if(A.constantOr(1)===0)return;const L=m.colorModeForRenderPass(),N=b.paint.get("fill-pattern"),Y=m.opaquePassEnabledForLayer()&&!N.constantOr(1)&&C.constantOr(d.aO.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===Y){const G=m.depthModeForSublayer(1,m.renderPass==="opaque"?Lt.ReadWrite:Lt.ReadOnly);gu(m,w,b,I,G,L,!1)}if(m.renderPass==="translucent"&&b.paint.get("fill-antialias")){const G=m.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,Lt.ReadOnly);gu(m,w,b,I,G,L,!0)}})(t,a,u,c);break;case"fill-extrusion":(function(m,w,b,I){const C=b.paint.get("fill-extrusion-opacity");if(C!==0&&m.renderPass==="translucent"){const A=new Lt(m.context.gl.LEQUAL,Lt.ReadWrite,m.depthRangeFor3D);if(C!==1||b.paint.get("fill-extrusion-pattern").constantOr(1))da(m,w,b,I,A,Qt.disabled,Sr.disabled),da(m,w,b,I,A,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const L=m.colorModeForRenderPass();da(m,w,b,I,A,Qt.disabled,L)}}})(t,a,u,c);break;case"hillshade":(function(m,w,b,I){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const C=m.context,A=m.depthModeForSublayer(0,Lt.ReadOnly),L=m.colorModeForRenderPass(),[N,Y]=m.renderPass==="translucent"?m.stencilConfigForOverlap(I):[{},I];for(const G of Y){const J=w.getTile(G);J.needsHillshadePrepare!==void 0&&J.needsHillshadePrepare&&m.renderPass==="offscreen"?Dh(m,J,b,A,Qt.disabled,L):m.renderPass==="translucent"&&yu(m,G,J,b,A,N[G.overscaledZ],L)}C.viewport.set([0,0,m.width,m.height])})(t,a,u,c);break;case"raster":(function(m,w,b,I){if(m.renderPass!=="translucent"||b.paint.get("raster-opacity")===0||!I.length)return;const C=m.context,A=C.gl,L=w.getSource(),N=m.useProgram("raster"),Y=m.colorModeForRenderPass(),[G,J]=L instanceof Bi?[{},I]:m.stencilConfigForOverlap(I),V=J[J.length-1].overscaledZ,le=!m.options.moving;for(const me of J){const ee=m.depthModeForSublayer(me.overscaledZ-V,b.paint.get("raster-opacity")===1?Lt.ReadWrite:Lt.ReadOnly,A.LESS),he=w.getTile(me);he.registerFadeDuration(b.paint.get("raster-fade-duration"));const ge=w.findLoadedParent(me,0),ye=Lh(he,ge,w,b,m.transform,m.style.map.terrain);let Se,Ae;const Pe=b.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;C.activeTexture.set(A.TEXTURE0),he.texture.bind(Pe,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(A.TEXTURE1),ge?(ge.texture.bind(Pe,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),Se=Math.pow(2,ge.tileID.overscaledZ-he.tileID.overscaledZ),Ae=[he.tileID.canonical.x*Se%1,he.tileID.canonical.y*Se%1]):he.texture.bind(Pe,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST);const ze=m.style.map.terrain&&m.style.map.terrain.getTerrainData(me),Ye=ze?me:null,_t=Ye?Ye.posMatrix:m.transform.calculatePosMatrix(me.toUnwrapped(),le),Ue=rs(_t,Ae||[0,0],Se||1,ye,b);L instanceof Bi?N.draw(C,A.TRIANGLES,ee,Qt.disabled,Y,Yt.disabled,Ue,ze,b.id,L.boundsBuffer,m.quadTriangleIndexBuffer,L.boundsSegments):N.draw(C,A.TRIANGLES,ee,G[me.overscaledZ],Y,Yt.disabled,Ue,ze,b.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}})(t,a,u,c);break;case"background":(function(m,w,b,I){const C=b.paint.get("background-color"),A=b.paint.get("background-opacity");if(A===0)return;const L=m.context,N=L.gl,Y=m.transform,G=Y.tileSize,J=b.paint.get("background-pattern");if(m.isPatternMissing(J))return;const V=!J&&C.a===1&&A===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==V)return;const le=Qt.disabled,me=m.depthModeForSublayer(0,V==="opaque"?Lt.ReadWrite:Lt.ReadOnly),ee=m.colorModeForRenderPass(),he=m.useProgram(J?"backgroundPattern":"background"),ge=I||Y.coveringTiles({tileSize:G,terrain:m.style.map.terrain});J&&(L.activeTexture.set(N.TEXTURE0),m.imageManager.bind(m.context));const ye=b.getCrossfadeParameters();for(const Se of ge){const Ae=I?Se.posMatrix:m.transform.calculatePosMatrix(Se.toUnwrapped()),Pe=J?wh(Ae,A,m,J,{tileID:Se,tileSize:G},ye):$p(Ae,A,C),ze=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Se);he.draw(L,N.TRIANGLES,me,le,ee,Yt.disabled,Pe,ze,b.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}})(t,0,u,c);break;case"custom":(function(m,w,b){const I=m.context,C=b.implementation;if(m.renderPass==="offscreen"){const A=C.prerender;A&&(m.setCustomLayerDefaults(),I.setColorMode(m.colorModeForRenderPass()),A.call(C,I.gl,m.transform.customLayerMatrix()),I.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),I.setColorMode(m.colorModeForRenderPass()),I.setStencilMode(Qt.disabled);const A=C.renderingMode==="3d"?new Lt(m.context.gl.LEQUAL,Lt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Lt.ReadOnly);I.setDepthMode(A),C.render(I.gl,m.transform.customLayerMatrix()),I.setDirty(),m.setBaseState(),I.bindFramebuffer.set(null)}})(t,0,u)}}translatePosMatrix(t,a,u,c,m){if(!u[0]&&!u[1])return t;const w=m?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(w){const C=Math.sin(w),A=Math.cos(w);u=[u[0]*A-u[1]*C,u[0]*C+u[1]*A]}const b=[m?u[0]:lt(a,u[0],this.transform.zoom),m?u[1]:lt(a,u[1],this.transform.zoom),0],I=new Float32Array(16);return d.H(I,t,b),I}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),u=this.imageManager.getPattern(t.to.toString());return!a||!u}useProgram(t,a){this.cache=this.cache||{};const u=t+(a?a.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[u]||(this.cache[u]=new nu(this.context,ia[t],a,Zp[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new kt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}class zo{constructor(t,a){this.points=t,this.planes=a}static fromInvProjectionMatrix(t,a,u){const c=Math.pow(2,u),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const I=1/(b=d.af([],b,t))[3]/a*c;return d.a$(b,b,[I,I,1/b[3],I])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const I=function(N,Y){var G=Y[0],J=Y[1],V=Y[2],le=G*G+J*J+V*V;return le>0&&(le=1/Math.sqrt(le)),N[0]=Y[0]*le,N[1]=Y[1]*le,N[2]=Y[2]*le,N}([],function(N,Y,G){var J=Y[0],V=Y[1],le=Y[2],me=G[0],ee=G[1],he=G[2];return N[0]=V*he-le*ee,N[1]=le*me-J*he,N[2]=J*ee-V*me,N}([],tt([],m[b[0]],m[b[1]]),tt([],m[b[2]],m[b[1]]))),C=-((A=I)[0]*(L=m[b[1]])[0]+A[1]*L[1]+A[2]*L[2]);var A,L;return I.concat(C)});return new zo(m,w)}}class ma{constructor(t,a){this.min=t,this.max=a,this.center=function(u,c,m){return u[0]=.5*c[0],u[1]=.5*c[1],u[2]=.5*c[2],u}([],function(u,c,m){return u[0]=c[0]+m[0],u[1]=c[1]+m[1],u[2]=c[2]+m[2],u}([],this.min,this.max))}quadrant(t){const a=[t%2==0,t<2],u=Me(this.min),c=Me(this.max);for(let m=0;m<a.length;m++)u[m]=a[m]?this.min[m]:this.center[m],c[m]=a[m]?this.center[m]:this.max[m];return c[2]=this.max[2],new ma(u,c)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const a=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let u=!0;for(let c=0;c<t.planes.length;c++){const m=t.planes[c];let w=0;for(let b=0;b<a.length;b++)d.b0(m,a[b])>=0&&w++;if(w===0)return 0;w!==a.length&&(u=!1)}if(u)return 2;for(let c=0;c<3;c++){let m=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let b=0;b<t.points.length;b++){const I=t.points[b][c]-this.min[c];m=Math.min(m,I),w=Math.max(w,I)}if(w<0||m>this.max[c]-this.min[c])return 0}return 1}}class as{constructor(t=0,a=0,u=0,c=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(u)||u<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=u,this.right=c}interpolate(t,a,u){return a.top!=null&&t.top!=null&&(this.top=d.z.number(t.top,a.top,u)),a.bottom!=null&&t.bottom!=null&&(this.bottom=d.z.number(t.bottom,a.bottom,u)),a.left!=null&&t.left!=null&&(this.left=d.z.number(t.left,a.left,u)),a.right!=null&&t.right!=null&&(this.right=d.z.number(t.right,a.right,u)),this}getCenter(t,a){const u=d.ac((this.left+t-this.right)/2,0,t),c=d.ac((this.top+a-this.bottom)/2,0,a);return new d.P(u,c)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new as(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const wu=85.051129;class tl{constructor(t,a,u,c,m){this.tileSize=512,this._renderWorldCopies=m===void 0||!!m,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=u??0,this._maxPitch=c??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new as,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new tl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const a=-d.b1(t,-180,180)*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=function(){var u=new d.A(4);return d.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}(),function(u,c,m){var w=c[0],b=c[1],I=c[2],C=c[3],A=Math.sin(m),L=Math.cos(m);u[0]=w*L+I*A,u[1]=b*L+C*A,u[2]=w*-A+I*L,u[3]=b*-A+C*L}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=d.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this.tileZoom=Math.max(0,Math.floor(a)),this.scale=this.zoomScale(a),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,u){this._unmodified=!1,this._edgeInsets.interpolate(t,a,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new d.b2(0,t)];if(this._renderWorldCopies){const u=this.pointCoordinate(new d.P(0,0)),c=this.pointCoordinate(new d.P(this.width,0)),m=this.pointCoordinate(new d.P(this.width,this.height)),w=this.pointCoordinate(new d.P(0,this.height)),b=Math.floor(Math.min(u.x,c.x,m.x,w.x)),I=Math.floor(Math.max(u.x,c.x,m.x,w.x)),C=1;for(let A=b-C;A<=I+C;A++)A!==0&&a.push(new d.b2(A,t))}return a}coveringTiles(t){var a,u;let c=this.coveringZoomLevel(t);const m=c;if(t.minzoom!==void 0&&c<t.minzoom)return[];t.maxzoom!==void 0&&c>t.maxzoom&&(c=t.maxzoom);const w=this.pointCoordinate(this.getCameraPoint()),b=d.Y.fromLngLat(this.center),I=Math.pow(2,c),C=[I*w.x,I*w.y,0],A=[I*b.x,I*b.y,0],L=zo.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c);let N=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(N=c);const Y=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,G=ee=>({aabb:new ma([ee*I,0,0],[(ee+1)*I,I,0]),zoom:0,x:0,y:0,wrap:ee,fullyVisible:!1}),J=[],V=[],le=c,me=t.reparseOverscaled?m:c;if(this._renderWorldCopies)for(let ee=1;ee<=3;ee++)J.push(G(-ee)),J.push(G(ee));for(J.push(G(0));J.length>0;){const ee=J.pop(),he=ee.x,ge=ee.y;let ye=ee.fullyVisible;if(!ye){const Ye=ee.aabb.intersects(L);if(Ye===0)continue;ye=Ye===2}const Se=t.terrain?C:A,Ae=ee.aabb.distanceX(Se),Pe=ee.aabb.distanceY(Se),ze=Math.max(Math.abs(Ae),Math.abs(Pe));if(ee.zoom===le||ze>Y+(1<<le-ee.zoom)-2&&ee.zoom>=N){const Ye=le-ee.zoom,_t=C[0]-.5-(he<<Ye),Ue=C[1]-.5-(ge<<Ye);V.push({tileID:new d.Q(ee.zoom===le?me:ee.zoom,ee.wrap,ee.zoom,he,ge),distanceSq:ct([A[0]-.5-he,A[1]-.5-ge]),tileDistanceToCamera:Math.sqrt(_t*_t+Ue*Ue)})}else for(let Ye=0;Ye<4;Ye++){const _t=(he<<1)+Ye%2,Ue=(ge<<1)+(Ye>>1),ut=ee.zoom+1;let wt=ee.aabb.quadrant(Ye);if(t.terrain){const zt=new d.Q(ut,ee.wrap,ut,_t,Ue),ft=t.terrain.getMinMaxElevation(zt),St=(a=ft.minElevation)!==null&&a!==void 0?a:this.elevation,Tt=(u=ft.maxElevation)!==null&&u!==void 0?u:this.elevation;wt=new ma([wt.min[0],wt.min[1],St],[wt.max[0],wt.max[1],Tt])}J.push({aabb:wt,zoom:ut,x:_t,y:Ue,wrap:ee.wrap,fullyVisible:ye})}}return V.sort((ee,he)=>ee.distanceSq-he.distanceSq).map(ee=>ee.tileID)}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const a=d.ac(t.lat,-85.051129,wu);return new d.P(d.N(t.lng)*this.worldSize,d.O(a)*this.worldSize)}unproject(t){return new d.Y(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const a=this.elevation,u=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,c=this.pointLocation(this.centerPoint,t),m=t.getElevationForLngLatZoom(c,this.tileZoom);if(!(this.elevation-m))return;const w=u+a-m,b=Math.cos(this._pitch)*this.cameraToCenterDistance/w/d.b3(1,c.lat),I=this.scaleZoom(b/this.tileSize);this._elevation=m,this._center=c,this.zoom=I}setLocationAtPoint(t,a){const u=this.pointCoordinate(a),c=this.pointCoordinate(this.centerPoint),m=this.locationCoordinate(t),w=new d.Y(m.x-(u.x-c.x),m.y-(u.y-c.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,a){return a?this.coordinatePoint(this.locationCoordinate(t),a.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,a){return this.coordinateLocation(this.pointCoordinate(t,a))}locationCoordinate(t){return d.Y.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,a){if(a){const N=a.pointCoordinate(t);if(N!=null)return N}const u=[t.x,t.y,0,1],c=[t.x,t.y,1,1];d.af(u,u,this.pixelMatrixInverse),d.af(c,c,this.pixelMatrixInverse);const m=u[3],w=c[3],b=u[1]/m,I=c[1]/w,C=u[2]/m,A=c[2]/w,L=C===A?0:(0-C)/(A-C);return new d.Y(d.z.number(u[0]/m,c[0]/w,L)/this.worldSize,d.z.number(b,I,L)/this.worldSize)}coordinatePoint(t,a=0,u=this.pixelMatrix){const c=[t.x*this.worldSize,t.y*this.worldSize,a,1];return d.af(c,c,u),new d.P(c[0]/c[3],c[1]/c[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Xt().extend(this.pointLocation(new d.P(0,t))).extend(this.pointLocation(new d.P(this.width,t))).extend(this.pointLocation(new d.P(this.width,this.height))).extend(this.pointLocation(new d.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Xt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,wu])}calculatePosMatrix(t,a=!1){const u=t.key,c=a?this._alignedPosMatrixCache:this._posMatrixCache;if(c[u])return c[u];const m=t.canonical,w=this.worldSize/this.zoomScale(m.z),b=m.x+Math.pow(2,m.z)*t.wrap,I=d.an(new Float64Array(16));return d.H(I,I,[b*w,m.y*w,0]),d.J(I,I,[w/d.W,w/d.W,1]),d.K(I,a?this.alignedProjMatrix:this.projMatrix,I),c[u]=new Float32Array(I),c[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,a){a=d.ac(+a,this.minZoom,this.maxZoom);const u={center:new d.M(t.lng,t.lat),zoom:a};let c=this.lngRange;if(!this._renderWorldCopies&&c===null){const ee=179.9999999999;c=[-ee,ee]}const m=this.tileSize*this.zoomScale(u.zoom);let w=0,b=m,I=0,C=m,A=0,L=0;const{x:N,y:Y}=this.size;if(this.latRange){const ee=this.latRange;w=d.O(ee[1])*m,b=d.O(ee[0])*m,b-w<Y&&(A=Y/(b-w))}c&&(I=d.b1(d.N(c[0])*m,0,m),C=d.b1(d.N(c[1])*m,0,m),C<I&&(C+=m),C-I<N&&(L=N/(C-I)));const{x:G,y:J}=this.project.call({worldSize:m},t);let V,le;const me=Math.max(L||0,A||0);if(me){const ee=new d.P(L?(C+I)/2:G,A?(b+w)/2:J);return u.center=this.unproject.call({worldSize:m},ee).wrap(),u.zoom+=this.scaleZoom(me),u}if(this.latRange){const ee=Y/2;J-ee<w&&(le=w+ee),J+ee>b&&(le=b-ee)}if(c){const ee=(I+C)/2;let he=G;this._renderWorldCopies&&(he=d.b1(G,ee-m/2,ee+m/2));const ge=N/2;he-ge<I&&(V=I+ge),he+ge>C&&(V=C-ge)}if(V!==void 0||le!==void 0){const ee=new d.P(V??G,le??J);u.center=this.unproject.call({worldSize:m},ee).wrap()}return u}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:a,zoom:u}=this.getConstrained(this.center,this.zoom);this.center=a,this.zoom=u,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,a=this.point.x,u=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=d.b3(1,this.center.lat)*this.worldSize;let c=d.an(new Float64Array(16));d.J(c,c,[this.width/2,-this.height/2,1]),d.H(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=d.an(new Float64Array(16)),d.J(c,c,[1,-1,1]),d.H(c,c,[-1,-1,0]),d.J(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c;const m=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),w=Math.min(this.elevation,this.minElevationForCurrentTile),b=m-w*this._pixelPerMeter/Math.cos(this._pitch),I=w<0?b:m,C=Math.PI/2+this._pitch,A=this._fov*(.5+t.y/this.height),L=Math.sin(A)*I/Math.sin(d.ac(Math.PI-C-A,.01,Math.PI-.01)),N=this.getHorizon(),Y=2*Math.atan(N/this.cameraToCenterDistance)*(.5+t.y/(2*N)),G=Math.sin(Y)*I/Math.sin(d.ac(Math.PI-C-Y,.01,Math.PI-.01)),J=Math.min(L,G),V=1.01*(Math.cos(Math.PI/2-this._pitch)*J+I),le=this.height/50;c=new Float64Array(16),d.b4(c,this._fov,this.width/this.height,le,V),c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,d.J(c,c,[1,-1,1]),d.H(c,c,[0,0,-this.cameraToCenterDistance]),d.b5(c,c,this._pitch),d.ad(c,c,this.angle),d.H(c,c,[-a,-u,0]),this.mercatorMatrix=d.J([],c,[this.worldSize,this.worldSize,this.worldSize]),d.J(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=d.K(new Float64Array(16),this.labelPlaneMatrix,c),d.H(c,c,[0,0,-this.elevation]),this.projMatrix=c,this.invProjMatrix=d.ar([],c),this.pixelMatrix3D=d.K(new Float64Array(16),this.labelPlaneMatrix,c);const me=this.width%2/2,ee=this.height%2/2,he=Math.cos(this.angle),ge=Math.sin(this.angle),ye=a-Math.round(a)+he*me+ge*ee,Se=u-Math.round(u)+he*ee+ge*me,Ae=new Float64Array(c);if(d.H(Ae,Ae,[ye>.5?ye-1:ye,Se>.5?Se-1:Se,0]),this.alignedProjMatrix=Ae,c=d.ar(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new d.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return d.af(a,a,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,t))}getCameraQueryGeometry(t){const a=this.getCameraPoint();if(t.length===1)return[t[0],a];{let u=a.x,c=a.y,m=a.x,w=a.y;for(const b of t)u=Math.min(u,b.x),c=Math.min(c,b.y),m=Math.max(m,b.x),w=Math.max(w,b.y);return[new d.P(u,c),new d.P(m,c),new d.P(m,w),new d.P(u,w),new d.P(u,c)]}}lngLatToCameraDepth(t,a){const u=this.locationCoordinate(t),c=[u.x*this.worldSize,u.y*this.worldSize,a,1];return d.af(c,c,this.projMatrix),c[2]/c[3]}}function bu(p,t){let a,u=!1,c=null,m=null;const w=()=>{c=null,u&&(p.apply(m,a),c=setTimeout(w,t),u=!1)};return(...b)=>(u=!0,m=this,a=b,c||w(),c)}class Su{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let u;return a.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(u=c)}),(u&&u[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(a.length>=3&&!a.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:u,pitch:+(a[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,a)}catch{}},this._updateHash=bu(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const a=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,c=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,c),w=Math.round(a.lng*m)/m,b=Math.round(a.lat*m)/m,I=this._map.getBearing(),C=this._map.getPitch();let A="";if(A+=t?`/${w}/${b}/${u}`:`${u}/${b}/${w}`,(I||C)&&(A+="/"+Math.round(10*I)/10),C&&(A+=`/${Math.round(C)}`),this._hashName){const L=this._hashName;let N=!1;const Y=window.location.hash.slice(1).split("&").map(G=>{const J=G.split("=")[0];return J===L?(N=!0,`${J}=${A}`):G}).filter(G=>G);return N||Y.push(`${L}=${A}`),`#${Y.join("&")}`}return`#${A}`}}const Dn={linearity:.3,easing:d.b6(0,0,.3,1)},Fh=d.e({deceleration:2500,maxSpeed:1400},Dn),Bh=d.e({deceleration:20,maxSpeed:1400},Dn),Oh=d.e({deceleration:1e3,maxSpeed:360},Dn),Nh=d.e({deceleration:1e3,maxSpeed:90},Dn);class jh{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=q.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)a.zoom+=m.zoomDelta||0,a.bearing+=m.bearingDelta||0,a.pitch+=m.pitchDelta||0,m.panDelta&&a.pan._add(m.panDelta),m.around&&(a.around=m.around),m.pinchAround&&(a.pinchAround=m.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(a.pan.mag()){const m=ls(a.pan.mag(),u,d.e({},Fh,t||{}));c.offset=a.pan.mult(m.amount/a.pan.mag()),c.center=this._map.transform.center,ss(c,m)}if(a.zoom){const m=ls(a.zoom,u,Bh);c.zoom=this._map.transform.zoom+m.amount,ss(c,m)}if(a.bearing){const m=ls(a.bearing,u,Oh);c.bearing=this._map.transform.bearing+d.ac(m.amount,-179,179),ss(c,m)}if(a.pitch){const m=ls(a.pitch,u,Nh);c.pitch=this._map.transform.pitch+m.amount,ss(c,m)}if(c.zoom||c.bearing){const m=a.pinchAround===void 0?a.around:a.pinchAround;c.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),d.e(c,{noMoveStart:!0})}}function ss(p,t){(!p.duration||p.duration<t.duration)&&(p.duration=t.duration,p.easing=t.easing)}function ls(p,t,a){const{maxSpeed:u,linearity:c,deceleration:m}=a,w=d.ac(p*c/(t/1e3),-u,u),b=Math.abs(w)/(m*c);return{easing:a.easing,duration:1e3*b,amount:w*(b/2)}}class Kr extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,u,c={}){const m=U.mousePos(a.getCanvas(),u),w=a.unproject(m);super(t,d.e({point:m,lngLat:w,originalEvent:u},c)),this._defaultPrevented=!1,this.target=a}}class ga extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,u){const c=t==="touchend"?u.changedTouches:u.touches,m=U.touchPos(a.getCanvasContainer(),c),w=m.map(I=>a.unproject(I)),b=m.reduce((I,C,A,L)=>I.add(C.div(L.length)),new d.P(0,0));super(t,{points:m,point:b,lngLats:w,lngLat:a.unproject(b),originalEvent:u}),this._defaultPrevented=!1}}class tn extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,u){super(t,{originalEvent:u}),this._defaultPrevented=!1}}class Ln{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new tn(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Kr(t.type,this._map,t))}mouseup(t){this._map.fire(new Kr(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Kr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Kr(t.type,this._map,t))}mouseover(t){this._map.fire(new Kr(t.type,this._map,t))}mouseout(t){this._map.fire(new Kr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ga(t.type,this._map,t))}touchmove(t){this._map.fire(new ga(t.type,this._map,t))}touchend(t){this._map.fire(new ga(t.type,this._map,t))}touchcancel(t){this._map.fire(new ga(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Uh{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Kr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Kr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Kr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ti{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(d.P.convert(t),this._map.terrain)}}class ya{constructor(t,a){this._map=t,this._tr=new Ti(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(U.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const u=a;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=u,this._box||(this._box=U.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const m=Math.min(c.x,u.x),w=Math.max(c.x,u.x),b=Math.min(c.y,u.y),I=Math.max(c.y,u.y);U.setTransform(this._box,`translate(${m}px,${b}px)`),this._box.style.width=w-m+"px",this._box.style.height=I-b+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const u=this._startPos,c=a;if(this.reset(),U.suppressClick(),u.x!==c.x||u.y!==c.y)return this._map.fire(new d.k("boxzoomend",{originalEvent:t})),{cameraAnimation:m=>m.fitScreenCoordinates(u,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(U.remove(this._box),this._box=null),U.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new d.k(t,{originalEvent:a}))}}function Tu(p,t){if(p.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${t.length}`);const a={};for(let u=0;u<p.length;u++)a[p[u].identifier]=t[u];return a}class ef{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(c){const m=new d.P(0,0);for(const w of c)m._add(w);return m.div(c.length)}(a),this.touches=Tu(u,a)))}touchmove(t,a,u){if(this.aborted||!this.centroid)return;const c=Tu(u,a);for(const m in this.touches){const w=c[m];(!w||w.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(t,a,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class Iu{constructor(t){this.singleTap=new ef(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,u){this.singleTap.touchstart(t,a,u)}touchmove(t,a,u){this.singleTap.touchmove(t,a,u)}touchend(t,a,u){const c=this.singleTap.touchend(t,a,u);if(c){const m=t.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(c)<30;if(m&&w||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class Vh{constructor(t){this._tr=new Ti(t),this._zoomIn=new Iu({numTouches:1,numTaps:2}),this._zoomOut=new Iu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,u){this._zoomIn.touchstart(t,a,u),this._zoomOut.touchstart(t,a,u)}touchmove(t,a,u){this._zoomIn.touchmove(t,a,u),this._zoomOut.touchmove(t,a,u)}touchend(t,a,u){const c=this._zoomIn.touchend(t,a,u),m=this._zoomOut.touchend(t,a,u),w=this._tr;return c?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(c)},{originalEvent:t})}):m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(m)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yn{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=a.length?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const c=a.length?a[0]:a;return!this._moved&&c.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(u,c))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&U.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const fo={0:1,2:2};class Ke{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=U.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(a,u){const c=fo[u];return a.buttons===void 0||(a.buttons&c)!==c}(t,this._eventButton)}isValidEndEvent(t){return U.mouseButton(t)===this._eventButton}}class ku{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const Ao=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=function(t){t.preventDefault()}},_a=({enable:p,clickTolerance:t,bearingDegreesPerPixelMoved:a=.8})=>{const u=new Ke({checkCorrectEvent:c=>U.mouseButton(c)===0&&c.ctrlKey||U.mouseButton(c)===2});return new Yn({clickTolerance:t,move:(c,m)=>({bearingDelta:(m.x-c.x)*a}),moveStateManager:u,enable:p,assignEvents:Ao})},Eu=({enable:p,clickTolerance:t,pitchDegreesPerPixelMoved:a=-.5})=>{const u=new Ke({checkCorrectEvent:c=>U.mouseButton(c)===0&&c.ctrlKey||U.mouseButton(c)===2});return new Yn({clickTolerance:t,move:(c,m)=>({pitchDelta:(m.y-c.y)*a}),moveStateManager:u,enable:p,assignEvents:Ao})};class He{constructor(t,a){this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(t,a,u){return this._calculateTransform(t,a,u)}touchmove(t,a,u){if(this._active&&!(u.length<this.minTouchs()))return t.preventDefault(),this._calculateTransform(t,a,u)}touchend(t,a,u){this._calculateTransform(t,a,u),this._active&&u.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,u){u.length>0&&(this._active=!0);const c=Tu(u,a),m=new d.P(0,0),w=new d.P(0,0);let b=0;for(const C in c){const A=c[C],L=this._touches[C];L&&(m._add(A),w._add(A.sub(L)),b++,c[C]=A)}if(this._touches=c,b<this.minTouchs()||!w.mag())return;const I=w.div(b);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(b),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class us{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,u){if(!this._firstTwoTouches)return;t.preventDefault();const[c,m]=this._firstTwoTouches,w=rl(u,a,c),b=rl(u,a,m);if(!w||!b)return;const I=this._aroundCenter?null:w.add(b).div(2);return this._move([w,b],I,t)}touchend(t,a,u){if(!this._firstTwoTouches)return;const[c,m]=this._firstTwoTouches,w=rl(u,a,c),b=rl(u,a,m);w&&b||(this._active&&U.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function rl(p,t,a){for(let u=0;u<p.length;u++)if(p[u].identifier===a)return t[u]}function $h(p,t){return Math.log(p/t)/Math.LN2}class il extends us{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs($h(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:$h(this._distance,u),pinchAround:a}}}function Cu(p,t){return 180*p.angleWith(t)/Math.PI}class Pu extends us{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a,u){const c=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Cu(this._vector,c),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,u=Cu(t,this._startVector);return Math.abs(u)<a}}function Mu(p){return Math.abs(p.y)>Math.abs(p.x)}class Zh extends us{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,u){super.touchstart(t,a,u),this._currentTouchCount=u.length}_start(t){this._lastPoints=t,Mu(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=t[0].sub(this._lastPoints[0]),m=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,m,u.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(c.y+m.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,u){if(this._valid!==void 0)return this._valid;const c=t.mag()>=2,m=a.mag()>=2;if(!c&&!m)return;if(!c||!m)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const w=t.y>0==a.y>0;return Mu(t)&&Mu(a)&&w}}const Do={panStep:100,bearingStep:15,pitchStep:10};class rr{constructor(t){this._tr=new Ti(t);const a=Do;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,u=0,c=0,m=0,w=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),m=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),m=1);break;case 38:t.shiftKey?c=1:(t.preventDefault(),w=-1);break;case 40:t.shiftKey?c=-1:(t.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(u=0,c=0),{cameraAnimation:b=>{const I=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:nl,zoom:a?Math.round(I.zoom)+a*(t.shiftKey?2:1):I.zoom,bearing:I.bearing+u*this._bearingStep,pitch:I.pitch+c*this._pitchStep,offset:[-m*this._panStep,-w*this._panStep],center:I.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function nl(p){return p*(2-p)}const ol=4.000244140625;class zu{constructor(t,a){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=t,this._tr=new Ti(t),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!t[this._map.cooperativeGestures._bypassKey])return;let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=q.now(),c=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,a!==0&&a%ol==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(c*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=U.mousePos(this._map.getCanvas(),t),u=this._tr;this._around=a.y>u.transform.height/2-u.transform.getHorizon()?d.M.convert(this._aroundCenter?u.center:u.unproject(a)):d.M.convert(u.center),this._aroundPoint=u.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const b=this._type==="wheel"&&Math.abs(this._delta)>ol?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&I!==0&&(I=1/I);const C=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(C*I))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,u=this._startZoom,c=this._easing;let m,w=!1;if(this._type==="wheel"&&u&&c){const b=Math.min((q.now()-this._lastWheelEventTime)/200,1),I=c(b);m=d.z.number(u,a,I),b<1?this._frameId||(this._frameId=!0):w=!0}else m=a,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:m-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=d.b7;if(this._prevEase){const u=this._prevEase,c=(q.now()-u.start)/u.duration,m=u.easing(c+.01)-u.easing(c),w=.27/Math.sqrt(m*m+1e-4)*.01,b=Math.sqrt(.0729-w*w);a=d.b6(w,b,.25,1)}return this._prevEase={start:q.now(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Au{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class qh{constructor(t){this._tr=new Ti(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tf{constructor(){this._tap=new Iu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,u){if(!this._swipePoint)if(this._tapTime){const c=a[0],m=t.timeStamp-this._tapTime<500,w=this._tapPoint.dist(c)<30;m&&w?u.length>0&&(this._swipePoint=c,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(t,a,u)}touchmove(t,a,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const c=a[0],m=c.y-this._swipePoint.y;return this._swipePoint=c,t.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(t,a,u)}touchend(t,a,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const c=this._tap.touchend(t,a,u);c&&(this._tapTime=t.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dn{constructor(t,a,u){this._el=t,this._mousePan=a,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class cs{constructor(t,a,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class it{constructor(t,a,u,c){this._el=t,this._touchZoom=a,this._touchRotate=u,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class at{constructor(t,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=U.create("div","maplibregl-cooperative-gesture-screen",t);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=a,this._container.appendChild(c);const m=document.createElement("div");m.className="maplibregl-mobile-message",m.textContent=u,this._container.appendChild(m),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(U.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(t){this._onCooperativeGesture(t.touches.length===1)}wheel(t){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!t[this._bypassKey])}_onCooperativeGesture(t){this._enabled&&t&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Lo=p=>p.zoom||p.drag||p.pitch||p.rotate;class Du extends d.k{}function hs(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Ii{constructor(t,a){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,m)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=c.type==="renderFrame"?void 0:c,b={needsRenderFrame:!1},I={},C={},A=c.touches,L=A?this._getMapTouches(A):void 0,N=L?U.touchPos(this._map.getCanvas(),L):U.mousePos(this._map.getCanvas(),c);for(const{handlerName:J,handler:V,allowed:le}of this._handlers){if(!V.isEnabled())continue;let me;this._blockedByActive(C,le,J)?V.reset():V[m||c.type]&&(me=V[m||c.type](c,N,L),this.mergeHandlerResult(b,I,me,J,w),me&&me.needsRenderFrame&&this._triggerRenderFrame()),(me||V.isActive())&&(C[J]=V)}const Y={};for(const J in this._previousActiveHandlers)C[J]||(Y[J]=w);this._previousActiveHandlers=C,(Object.keys(Y).length||hs(b))&&(this._changes.push([b,I,Y]),this._triggerRenderFrame()),(Object.keys(C).length||hs(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=b;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new jh(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,m,w]of this._listeners)U.addEventListener(c,m,c===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[t,a,u]of this._listeners)U.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(t){const a=this._map,u=a.getCanvasContainer();this._add("mapEvent",new Ln(a,t));const c=a.boxZoom=new ya(a,t);this._add("boxZoom",c),t.interactive&&t.boxZoom&&c.enable();const m=a.cooperativeGestures=new at(a,t.cooperativeGestures);this._add("cooperativeGestures",m),t.cooperativeGestures&&m.enable();const w=new Vh(a),b=new qh(a);a.doubleClickZoom=new Au(b,w),this._add("tapZoom",w),this._add("clickZoom",b),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const I=new tf;this._add("tapDragZoom",I);const C=a.touchPitch=new Zh(a);this._add("touchPitch",C),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const A=_a(t),L=Eu(t);a.dragRotate=new cs(t,A,L),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const N=(({enable:me,clickTolerance:ee})=>{const he=new Ke({checkCorrectEvent:ge=>U.mouseButton(ge)===0&&!ge.ctrlKey});return new Yn({clickTolerance:ee,move:(ge,ye)=>({around:ye,panDelta:ye.sub(ge)}),activateOnStart:!0,moveStateManager:he,enable:me,assignEvents:Ao})})(t),Y=new He(t,a);a.dragPan=new dn(u,N,Y),this._add("mousePan",N),this._add("touchPan",Y,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const G=new Pu,J=new il;a.touchZoomRotate=new it(u,J,G,I),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate);const V=a.scrollZoom=new zu(a,()=>this._triggerRenderFrame());this._add("scrollZoom",V,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const le=a.keyboard=new rr(a);this._add("keyboard",le),t.interactive&&t.keyboard&&a.keyboard.enable(),this._add("blockableMapEvent",new Uh(a))}_add(t,a,u){this._handlers.push({handlerName:t,handler:a,allowed:u}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Lo(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,u){for(const c in t)if(c!==u&&(!a||a.indexOf(c)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const u of t)this._el.contains(u.target)&&a.push(u);return a}mergeHandlerResult(t,a,u,c,m){if(!u)return;d.e(t,u);const w={handlerName:c,originalEvent:u.originalEvent||m};u.zoomDelta!==void 0&&(a.zoom=w),u.panDelta!==void 0&&(a.drag=w),u.pitchDelta!==void 0&&(a.pitch=w),u.bearingDelta!==void 0&&(a.rotate=w)}_applyChanges(){const t={},a={},u={};for(const[c,m,w]of this._changes)c.panDelta&&(t.panDelta=(t.panDelta||new d.P(0,0))._add(c.panDelta)),c.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(t.around=c.around),c.pinchAround!==void 0&&(t.pinchAround=c.pinchAround),c.noInertia&&(t.noInertia=c.noInertia),d.e(a,m),d.e(u,w);this._updateMapTransform(t,a,u),this._changes=[]}_updateMapTransform(t,a,u){const c=this._map,m=c._getTransformForUpdate(),w=c.terrain;if(!(hs(t)||w&&this._terrainMovement))return this._fireEvents(a,u,!0);let{panDelta:b,zoomDelta:I,bearingDelta:C,pitchDelta:A,around:L,pinchAround:N}=t;N!==void 0&&(L=N),c._stop(!0),L=L||c.transform.centerPoint;const Y=m.pointLocation(b?L.sub(b):L);C&&(m.bearing+=C),A&&(m.pitch+=A),I&&(m.zoom+=I),w?this._terrainMovement||!a.drag&&!a.zoom?a.drag&&this._terrainMovement?m.center=m.pointLocation(m.centerPoint.sub(b)):m.setLocationAtPoint(Y,L):(this._terrainMovement=!0,this._map._elevationFreeze=!0,m.setLocationAtPoint(Y,L),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,m.recalculateZoom(c.terrain)})):m.setLocationAtPoint(Y,L),c._applyUpdatedTransform(m),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,u,!0)}_fireEvents(t,a,u){const c=Lo(this._eventsInProgress),m=Lo(t),w={};for(const A in t){const{originalEvent:L}=t[A];this._eventsInProgress[A]||(w[`${A}start`]=L),this._eventsInProgress[A]=t[A]}!c&&m&&this._fireEvent("movestart",m.originalEvent);for(const A in w)this._fireEvent(A,w[A]);m&&this._fireEvent("move",m.originalEvent);for(const A in t){const{originalEvent:L}=t[A];this._fireEvent(A,L)}const b={};let I;for(const A in this._eventsInProgress){const{handlerName:L,originalEvent:N}=this._eventsInProgress[A];this._handlersById[L].isActive()||(delete this._eventsInProgress[A],I=a[L]||N,b[`${A}end`]=I)}for(const A in b)this._fireEvent(A,b[A]);const C=Lo(this._eventsInProgress);if(u&&(c||m)&&!C){this._updatingCamera=!0;const A=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=N=>N!==0&&-this._bearingSnap<N&&N<this._bearingSnap;!A||!A.essential&&q.prefersReducedMotion?(this._map.fire(new d.k("moveend",{originalEvent:I})),L(this._map.getBearing())&&this._map.resetNorth()):(L(A.bearing||this._map.getBearing())&&(A.bearing=0),A.freezeElevation=!0,this._map.easeTo(A,{originalEvent:I})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new d.k(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Du("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Gh extends d.E{constructor(t,a){super(),this._renderFrameCallback=()=>{const u=Math.min((q.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new d.M(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,u){return t=d.P.convert(t).mult(-1),this.panTo(this.transform.center,d.e({offset:t},a),u)}panTo(t,a,u){return this.easeTo(d.e({center:t},a),u)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,u){return this.easeTo(d.e({zoom:t},a),u)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,u){return this.easeTo(d.e({bearing:t},a),u)}resetNorth(t,a){return this.rotateTo(0,d.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(d.e({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){t=Xt.convert(t);const u=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),u,a)}_cameraForBoxAndBearing(t,a,u,c){const m={top:0,bottom:0,right:0,left:0};if(typeof(c=d.e({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const Ye=c.padding;c.padding={top:Ye,bottom:Ye,right:Ye,left:Ye}}c.padding=d.e(m,c.padding);const w=this.transform,b=w.padding,I=new Xt(t,a),C=w.project(I.getNorthWest()),A=w.project(I.getNorthEast()),L=w.project(I.getSouthEast()),N=w.project(I.getSouthWest()),Y=d.b8(-u),G=C.rotate(Y),J=A.rotate(Y),V=L.rotate(Y),le=N.rotate(Y),me=new d.P(Math.max(G.x,J.x,le.x,V.x),Math.max(G.y,J.y,le.y,V.y)),ee=new d.P(Math.min(G.x,J.x,le.x,V.x),Math.min(G.y,J.y,le.y,V.y)),he=me.sub(ee),ge=(w.width-(b.left+b.right+c.padding.left+c.padding.right))/he.x,ye=(w.height-(b.top+b.bottom+c.padding.top+c.padding.bottom))/he.y;if(ye<0||ge<0)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Se=Math.min(w.scaleZoom(w.scale*Math.min(ge,ye)),c.maxZoom),Ae=d.P.convert(c.offset),Pe=new d.P((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(d.b8(u)),ze=Ae.add(Pe).mult(w.scale/w.zoomScale(Se));return{center:w.unproject(C.add(L).div(2).sub(ze)),zoom:Se,bearing:u}}fitBounds(t,a,u){return this._fitInternal(this.cameraForBounds(t,a),a,u)}fitScreenCoordinates(t,a,u,c,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.P.convert(t)),this.transform.pointLocation(d.P.convert(a)),u,c),c,m)}_fitInternal(t,a,u){return t?(delete(a=d.e(t,a)).padding,a.linear?this.easeTo(a,u):this.flyTo(a,u)):this}jumpTo(t,a){this.stop();const u=this._getTransformForUpdate();let c=!1,m=!1,w=!1;return"zoom"in t&&u.zoom!==+t.zoom&&(c=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=d.M.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(m=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(w=!0,u.pitch=+t.pitch),t.padding==null||u.isPaddingEqual(t.padding)||(u.padding=t.padding),this._applyUpdatedTransform(u),this.fire(new d.k("movestart",a)).fire(new d.k("move",a)),c&&this.fire(new d.k("zoomstart",a)).fire(new d.k("zoom",a)).fire(new d.k("zoomend",a)),m&&this.fire(new d.k("rotatestart",a)).fire(new d.k("rotate",a)).fire(new d.k("rotateend",a)),w&&this.fire(new d.k("pitchstart",a)).fire(new d.k("pitch",a)).fire(new d.k("pitchend",a)),this.fire(new d.k("moveend",a))}calculateCameraOptionsFromTo(t,a,u,c=0){const m=d.Y.fromLngLat(t,a),w=d.Y.fromLngLat(u,c),b=w.x-m.x,I=w.y-m.y,C=w.z-m.z,A=Math.hypot(b,I,C);if(A===0)throw new Error("Can't calculate camera options with same From and To");const L=Math.hypot(b,I),N=this.transform.scaleZoom(this.transform.cameraToCenterDistance/A/this.transform.tileSize),Y=180*Math.atan2(b,-I)/Math.PI;let G=180*Math.acos(L/A)/Math.PI;return G=C<0?90-G:90+G,{center:w.toLngLat(),zoom:N,pitch:G,bearing:Y}}easeTo(t,a){var u;this._stop(!1,t.easeId),((t=d.e({offset:[0,0],duration:500,easing:d.b7},t)).animate===!1||!t.essential&&q.prefersReducedMotion)&&(t.duration=0);const c=this._getTransformForUpdate(),m=this.getZoom(),w=this.getBearing(),b=this.getPitch(),I=this.getPadding(),C="bearing"in t?this._normalizeBearing(t.bearing,w):w,A="pitch"in t?+t.pitch:b,L="padding"in t?t.padding:c.padding,N=d.P.convert(t.offset);let Y=c.centerPoint.add(N);const G=c.pointLocation(Y),{center:J,zoom:V}=c.getConstrained(d.M.convert(t.center||G),(u=t.zoom)!==null&&u!==void 0?u:m);this._normalizeCenter(J);const le=c.project(G),me=c.project(J).sub(le),ee=c.zoomScale(V-m);let he,ge;t.around&&(he=d.M.convert(t.around),ge=c.locationPoint(he));const ye={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||V!==m,this._rotating=this._rotating||w!==C,this._pitching=this._pitching||A!==b,this._padding=!c.isPaddingEqual(L),this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,ye),this.terrain&&this._prepareElevation(J),this._ease(Se=>{if(this._zooming&&(c.zoom=d.z.number(m,V,Se)),this._rotating&&(c.bearing=d.z.number(w,C,Se)),this._pitching&&(c.pitch=d.z.number(b,A,Se)),this._padding&&(c.interpolatePadding(I,L,Se),Y=c.centerPoint.add(N)),this.terrain&&!t.freezeElevation&&this._updateElevation(Se),he)c.setLocationAtPoint(he,ge);else{const Ae=c.zoomScale(c.zoom-m),Pe=V>m?Math.min(2,ee):Math.max(.5,ee),ze=Math.pow(Pe,1-Se),Ye=c.unproject(le.add(me.mult(Se*ze)).mult(Ae));c.setLocationAtPoint(c.renderWorldCopies?Ye.wrap():Ye,Y)}this._applyUpdatedTransform(c),this._fireMoveEvents(a)},Se=>{this.terrain&&this._finalizeElevation(),this._afterEase(a,Se)},t),this}_prepareEase(t,a,u={}){this._moving=!0,a||u.moving||this.fire(new d.k("movestart",t)),this._zooming&&!u.zooming&&this.fire(new d.k("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new d.k("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new d.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(u-(a-(u*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.elevation=d.z.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const a=t.clone(),{center:u,zoom:c,pitch:m,bearing:w,elevation:b}=this.transformCameraUpdate(a);u&&(a.center=u),c!==void 0&&(a.zoom=c),m!==void 0&&(a.pitch=m),w!==void 0&&(a.bearing=w),b!==void 0&&(a.elevation=b),this.transform.apply(a)}_fireMoveEvents(t){this.fire(new d.k("move",t)),this._zooming&&this.fire(new d.k("zoom",t)),this._rotating&&this.fire(new d.k("rotate",t)),this._pitching&&this.fire(new d.k("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const u=this._zooming,c=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new d.k("zoomend",t)),c&&this.fire(new d.k("rotateend",t)),m&&this.fire(new d.k("pitchend",t)),this.fire(new d.k("moveend",t))}flyTo(t,a){var u;if(!t.essential&&q.prefersReducedMotion){const zt=d.L(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(zt,a)}this.stop(),t=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.b7},t);const c=this._getTransformForUpdate(),m=this.getZoom(),w=this.getBearing(),b=this.getPitch(),I=this.getPadding(),C="bearing"in t?this._normalizeBearing(t.bearing,w):w,A="pitch"in t?+t.pitch:b,L="padding"in t?t.padding:c.padding,N=d.P.convert(t.offset);let Y=c.centerPoint.add(N);const G=c.pointLocation(Y),{center:J,zoom:V}=c.getConstrained(d.M.convert(t.center||G),(u=t.zoom)!==null&&u!==void 0?u:m);this._normalizeCenter(J);const le=c.zoomScale(V-m),me=c.project(G),ee=c.project(J).sub(me);let he=t.curve;const ge=Math.max(c.width,c.height),ye=ge/le,Se=ee.mag();if("minZoom"in t){const zt=d.ac(Math.min(t.minZoom,m,V),c.minZoom,c.maxZoom),ft=ge/c.zoomScale(zt-m);he=Math.sqrt(ft/Se*2)}const Ae=he*he;function Pe(zt){const ft=(ye*ye-ge*ge+(zt?-1:1)*Ae*Ae*Se*Se)/(2*(zt?ye:ge)*Ae*Se);return Math.log(Math.sqrt(ft*ft+1)-ft)}function ze(zt){return(Math.exp(zt)-Math.exp(-zt))/2}function Ye(zt){return(Math.exp(zt)+Math.exp(-zt))/2}const _t=Pe(!1);let Ue=function(zt){return Ye(_t)/Ye(_t+he*zt)},ut=function(zt){return ge*((Ye(_t)*(ze(ft=_t+he*zt)/Ye(ft))-ze(_t))/Ae)/Se;var ft},wt=(Pe(!0)-_t)/he;if(Math.abs(Se)<1e-6||!isFinite(wt)){if(Math.abs(ge-ye)<1e-6)return this.easeTo(t,a);const zt=ye<ge?-1:1;wt=Math.abs(Math.log(ye/ge))/he,ut=function(){return 0},Ue=function(ft){return Math.exp(zt*he*ft)}}return t.duration="duration"in t?+t.duration:1e3*wt/("screenSpeed"in t?+t.screenSpeed/he:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=w!==C,this._pitching=A!==b,this._padding=!c.isPaddingEqual(L),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(J),this._ease(zt=>{const ft=zt*wt,St=1/Ue(ft);c.zoom=zt===1?V:m+c.scaleZoom(St),this._rotating&&(c.bearing=d.z.number(w,C,zt)),this._pitching&&(c.pitch=d.z.number(b,A,zt)),this._padding&&(c.interpolatePadding(I,L,zt),Y=c.centerPoint.add(N)),this.terrain&&!t.freezeElevation&&this._updateElevation(zt);const Tt=zt===1?J:c.unproject(me.add(ee.mult(ut(ft))).mult(St));c.setLocationAtPoint(c.renderWorldCopies?Tt.wrap():Tt,Y),this._applyUpdatedTransform(c),this._fireMoveEvents(a)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(a)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,a)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,a,u){u.animate===!1||u.duration===0?(t(1),a()):(this._easeStart=q.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=d.b1(t,-180,180);const u=Math.abs(t-a);return Math.abs(t-360-a)<u&&(t-=360),Math.abs(t+360-a)<u&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(!a.renderWorldCopies||a.lngRange)return;const u=t.lng-a.center.lng;t.lng+=u>180?-360:u<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(d.M.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const pn={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Hh{constructor(t=pn){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=U.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=U.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){U.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const u=this._map._getUIString(`AttributionControl.${a}`);t.title=u,t.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const a=this._map.style.sourceCaches;for(const c in a){const m=a[c];if(m.used||m.usedForTerrain){const w=m.getSource();w.attribution&&t.indexOf(w.attribution)<0&&t.push(w.attribution)}}t=t.filter(c=>String(c).trim()),t.sort((c,m)=>c.length-m.length),t=t.filter((c,m)=>{for(let w=m+1;w<t.length;w++)if(t[w].indexOf(c)>=0)return!1;return!0});const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class va{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const u=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=U.create("div","maplibregl-ctrl");const a=U.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){U.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class fr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,u=a?this._queue.concat(a):this._queue;for(const c of u)if(c.id===t)return void(c.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const u of a)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Tr=d.X([{name:"a_pos3d",type:"Int16",components:3}]);class Wh extends d.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,a){this.sourceCache.update(t,a),this._renderableTilesKeys=[];const u={};for(const c of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a}))u[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),d.aN(c.posMatrix,0,d.W,0,d.W,0,1),this._tiles[c.key]=new Qr(c,this.tileSize));for(const c in this._tiles)u[c]||delete this._tiles[c]}freeRtt(t){for(const a in this._tiles){const u=this._tiles[a];(!t||u.tileID.equals(t)||u.tileID.isChildOf(t)||t.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const a={};for(const u of this._renderableTilesKeys){const c=this._tiles[u].tileID;if(c.canonical.equals(t.canonical)){const m=t.clone();m.posMatrix=new Float64Array(16),d.aN(m.posMatrix,0,d.W,0,d.W,0,1),a[u]=m}else if(c.canonical.isChildOf(t.canonical)){const m=t.clone();m.posMatrix=new Float64Array(16);const w=c.canonical.z-t.canonical.z,b=c.canonical.x-(c.canonical.x>>w<<w),I=c.canonical.y-(c.canonical.y>>w<<w),C=d.W>>w;d.aN(m.posMatrix,0,C,0,C,0,1),d.H(m.posMatrix,m.posMatrix,[-b*C,-I*C,0]),a[u]=m}else if(t.canonical.isChildOf(c.canonical)){const m=t.clone();m.posMatrix=new Float64Array(16);const w=t.canonical.z-c.canonical.z,b=t.canonical.x-(t.canonical.x>>w<<w),I=t.canonical.y-(t.canonical.y>>w<<w),C=d.W>>w;d.aN(m.posMatrix,0,d.W,0,d.W,0,1),d.H(m.posMatrix,m.posMatrix,[b*C,I*C,0]),d.J(m.posMatrix,m.posMatrix,[1/2**w,1/2**w,0]),a[u]=m}}return a}getSourceTile(t,a){const u=this.sourceCache._source;let c=t.overscaledZ-this.deltaZoom;if(c>u.maxzoom&&(c=u.maxzoom),c<u.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(c).key);let m=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!m||!m.dem)&&a)for(;c>=u.minzoom&&(!m||!m.dem);)m=this.sourceCache.getTileByID(t.scaledTo(c--).key);return m}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(a=>a.timeAdded>=t)}}class ds{constructor(t,a,u){this.painter=t,this.sourceCache=new Wh(a),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,u,c=d.W){var m;if(!(a>=0&&a<c&&u>=0&&u<c))return 0;const w=this.getTerrainData(t),b=(m=w.tile)===null||m===void 0?void 0:m.dem;if(!b)return 0;const I=function(G,J,V){var le=J[0],me=J[1];return G[0]=V[0]*le+V[4]*me+V[12],G[1]=V[1]*le+V[5]*me+V[13],G}([],[a/c*d.W,u/c*d.W],w.u_terrain_matrix),C=[I[0]*b.dim,I[1]*b.dim],A=Math.floor(C[0]),L=Math.floor(C[1]),N=C[0]-A,Y=C[1]-L;return b.get(A,L)*(1-N)*(1-Y)+b.get(A+1,L)*N*(1-Y)+b.get(A,L+1)*(1-N)*Y+b.get(A+1,L+1)*N*Y}getElevationForLngLatZoom(t,a){const{tileID:u,mercatorX:c,mercatorY:m}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(u,c%d.W,m%d.W,d.W)}getElevation(t,a,u,c=d.W){return this.getDEMElevation(t,a,u,c)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const c=this.painter.context,m=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new kt(c,m,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new kt(c,new d.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.an([])}const a=this.sourceCache.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const c=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new kt(c,a.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),a.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const u=a&&a+a.tileID.key+t.key;if(u&&!this._demMatrixCache[u]){const c=this.sourceCache.sourceCache._source.maxzoom;let m=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=c?m=t.canonical.z-c:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=t.canonical.x-(t.canonical.x>>m<<m),b=t.canonical.y-(t.canonical.y>>m<<m),I=d.b9(new Float64Array(16),[1/(d.W<<m),1/(d.W<<m),0]);d.H(I,I,[w*d.W,b*d.W,0]),this._demMatrixCache[t.key]={matrix:I,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,u=a.width/devicePixelRatio,c=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new kt(a.context,{width:u,height:c,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new kt(a.context,{width:u,height:c,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(u,c,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,u,c))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let m=0,w=0;m<this._coordsTextureSize;m++)for(let b=0;b<this._coordsTextureSize;b++,w+=4)a[w+0]=255&b,a[w+1]=255&m,a[w+2]=b>>8<<4|m>>8,a[w+3]=0;const u=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),c=new kt(t,u,t.gl.RGBA,{premultiply:!1});return c.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),u=this.painter.context,c=u.gl;u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,a),u.bindFramebuffer.set(null);const m=a[0]+(a[2]>>4<<8),w=a[1]+((15&a[2])<<8),b=this.coordsIndex[255-a[3]],I=b&&this.sourceCache.getTileByID(b);if(!I)return null;const C=this._coordsTextureSize,A=(1<<I.tileID.canonical.z)*C;return new d.Y((I.tileID.canonical.x*C+m)/A+I.tileID.wrap,(I.tileID.canonical.y*C+w)/A,this.getElevation(I.tileID,m,w,C))}depthAtPoint(t){const a=new Uint8Array(4),u=this.painter.context,c=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,a),u.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,a=new d.ba,u=new d.aX,c=this.meshSize,m=d.W/c,w=c*c;for(let L=0;L<=c;L++)for(let N=0;N<=c;N++)a.emplaceBack(N*m,L*m,0);for(let L=0;L<w;L+=c+1)for(let N=0;N<c;N++)u.emplaceBack(N+L,c+N+L+1,c+N+L+2),u.emplaceBack(N+L,c+N+L+2,N+L+1);const b=a.length,I=b+2*(c+1);for(const L of[0,1])for(let N=0;N<=c;N++)for(const Y of[0,1])a.emplaceBack(N*m,L*d.W,Y);for(let L=0;L<2*c;L+=2)u.emplaceBack(I+L,I+L+1,I+L+3),u.emplaceBack(I+L,I+L+3,I+L+2),u.emplaceBack(b+L,b+L+3,b+L+1),u.emplaceBack(b+L,b+L+2,b+L+3);const C=a.length,A=C+2*(c+1);for(const L of[0,1])for(let N=0;N<=c;N++)for(const Y of[0,1])a.emplaceBack(L*d.W,N*m,Y);for(let L=0;L<2*c;L+=2)u.emplaceBack(C+L,C+L+1,C+L+3),u.emplaceBack(C+L,C+L+3,C+L+2),u.emplaceBack(A+L,A+L+3,A+L+1),u.emplaceBack(A+L,A+L+2,A+L+3);return this._mesh={indexBuffer:t.createIndexBuffer(u),vertexBuffer:t.createVertexBuffer(a,Tr.members),segments:d.$.simpleSegment(0,0,a.length,u.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*d.bb/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,a){var u;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(u=this.getMinMaxElevation(c).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,u={minElevation:null,maxElevation:null};return a&&a.dem&&(u.minElevation=a.dem.min*this.exaggeration,u.maxElevation=a.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(t,a){const u=d.Y.fromLngLat(t.wrap()),c=(1<<a)*d.W,m=u.x*c,w=u.y*c,b=Math.floor(m/d.W),I=Math.floor(w/d.W);return{tileID:new d.Q(a,0,a,b,I),mercatorX:m,mercatorY:w}}}class al{constructor(t,a,u){this._context=t,this._size=a,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new kt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(u.texture),{id:t,fbo:a,texture:u,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(a=>t.id!==a),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const mo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Lu{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new al(t.context,30,a.sourceCache.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(u=>!t._layers[u].isHidden(a)),this._coordsDescendingInv={};for(const u in t.sourceCaches){this._coordsDescendingInv[u]={};const c=t.sourceCaches[u].getVisibleCoordinates();for(const m of c){const w=this.terrain.sourceCache.getTerrainCoords(m);for(const b in w)this._coordsDescendingInv[u][b]||(this._coordsDescendingInv[u][b]=[]),this._coordsDescendingInv[u][b].push(w[b])}}this._coordsDescendingInvStr={};for(const u of t._order){const c=t._layers[u],m=c.source;if(mo[c.type]&&!this._coordsDescendingInvStr[m]){this._coordsDescendingInvStr[m]={};for(const w in this._coordsDescendingInv[m])this._coordsDescendingInvStr[m][w]=this._coordsDescendingInv[m][w].map(b=>b.key).sort().join()}}for(const u of this._renderableTiles)for(const c in this._coordsDescendingInvStr){const m=this._coordsDescendingInvStr[c][u.tileID.key];m&&m!==u.rttCoords[c]&&(u.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const a=t.type,u=this.painter,c=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(mo[a]&&(this._prevType&&mo[this._prevType]||this._stacks.push([]),this._prevType=a,this._stacks[this._stacks.length-1].push(t.id),!c))return!0;if(mo[this._prevType]||mo[a]&&c){this._prevType=a;const m=this._stacks.length-1,w=this._stacks[m]||[];for(const b of this._renderableTiles){if(this.pool.isFull()&&(xu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(b),b.rtt[m]){const C=this.pool.getObjectForId(b.rtt[m].id);if(C.stamp===b.rtt[m].stamp){this.pool.useObject(C);continue}}const I=this.pool.getOrCreateFreeObject();this.pool.useObject(I),this.pool.stampObject(I),b.rtt[m]={id:I.id,stamp:I.stamp},u.context.bindFramebuffer.set(I.fbo.framebuffer),u.context.clear({color:d.aO.transparent,stencil:0}),u.currentStencilSource=void 0;for(let C=0;C<w.length;C++){const A=u.style._layers[w[C]],L=A.source?this._coordsDescendingInv[A.source][b.tileID.key]:[b.tileID];u.context.viewport.set([0,0,I.fbo.width,I.fbo.height]),u._renderTileClippingMasks(A,L),u.renderLayer(u,u.style.sourceCaches[A.source],A,L),A.source&&(b.rttCoords[A.source]=this._coordsDescendingInvStr[A.source][b.tileID.key])}}return xu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),mo[a]}return!1}}const Ru={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},ps=F,Fu={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:pn,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},sl=p=>{p.touchstart=p.dragStart,p.touchmoveWindow=p.dragMove,p.touchend=p.dragEnd},Bu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ou{constructor(t,a,u=!1){this.mousedown=w=>{this.startMouse(d.e({},w,{ctrlKey:!0,preventDefault:()=>w.preventDefault()}),U.mousePos(this.element,w)),U.addEventListener(window,"mousemove",this.mousemove),U.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=w=>{this.moveMouse(w,U.mousePos(this.element,w))},this.mouseup=w=>{this.mouseRotate.dragEnd(w),this.mousePitch&&this.mousePitch.dragEnd(w),this.offTemp()},this.touchstart=w=>{w.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=U.touchPos(this.element,w.targetTouches)[0],this.startTouch(w,this._startPos),U.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.addEventListener(window,"touchend",this.touchend))},this.touchmove=w=>{w.targetTouches.length!==1?this.reset():(this._lastPos=U.touchPos(this.element,w.targetTouches)[0],this.moveTouch(w,this._lastPos))},this.touchend=w=>{w.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const c=t.dragRotate._mouseRotate.getClickTolerance(),m=t.dragRotate._mousePitch.getClickTolerance();this.element=a,this.mouseRotate=_a({clickTolerance:c,enable:!0}),this.touchRotate=(({enable:w,clickTolerance:b,bearingDegreesPerPixelMoved:I=.8})=>{const C=new ku;return new Yn({clickTolerance:b,move:(A,L)=>({bearingDelta:(L.x-A.x)*I}),moveStateManager:C,enable:w,assignEvents:sl})})({clickTolerance:c,enable:!0}),this.map=t,u&&(this.mousePitch=Eu({clickTolerance:m,enable:!0}),this.touchPitch=(({enable:w,clickTolerance:b,pitchDegreesPerPixelMoved:I=-.5})=>{const C=new ku;return new Yn({clickTolerance:b,move:(A,L)=>({pitchDelta:(L.y-A.y)*I}),moveStateManager:C,enable:w,assignEvents:sl})})({clickTolerance:m,enable:!0})),U.addEventListener(a,"mousedown",this.mousedown),U.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),U.addEventListener(a,"touchcancel",this.reset)}startMouse(t,a){this.mouseRotate.dragStart(t,a),this.mousePitch&&this.mousePitch.dragStart(t,a),U.disableDrag()}startTouch(t,a){this.touchRotate.dragStart(t,a),this.touchPitch&&this.touchPitch.dragStart(t,a),U.disableDrag()}moveMouse(t,a){const u=this.map,{bearingDelta:c}=this.mouseRotate.dragMove(t,a)||{};if(c&&u.setBearing(u.getBearing()+c),this.mousePitch){const{pitchDelta:m}=this.mousePitch.dragMove(t,a)||{};m&&u.setPitch(u.getPitch()+m)}}moveTouch(t,a){const u=this.map,{bearingDelta:c}=this.touchRotate.dragMove(t,a)||{};if(c&&u.setBearing(u.getBearing()+c),this.touchPitch){const{pitchDelta:m}=this.touchPitch.dragMove(t,a)||{};m&&u.setPitch(u.getPitch()+m)}}off(){const t=this.element;U.removeEventListener(t,"mousedown",this.mousedown),U.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),U.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.removeEventListener(window,"touchend",this.touchend),U.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){U.enableDrag(),U.removeEventListener(window,"mousemove",this.mousemove),U.removeEventListener(window,"mouseup",this.mouseup),U.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.removeEventListener(window,"touchend",this.touchend)}}let Kn;function ll(p,t,a){const u=new d.M(p.lng,p.lat);if(p=new d.M(p.lng,p.lat),t){const c=new d.M(p.lng-360,p.lat),m=new d.M(p.lng+360,p.lat),w=a.locationPoint(p).distSqr(t);a.locationPoint(c).distSqr(t)<w?p=c:a.locationPoint(m).distSqr(t)<w&&(p=m)}for(;Math.abs(p.lng-a.center.lng)>180;){const c=a.locationPoint(p);if(c.x>=0&&c.y>=0&&c.x<=a.width&&c.y<=a.height)break;p.lng>a.center.lng?p.lng-=360:p.lng+=360}return p.lng!==u.lng&&a.locationPoint(p).y>a.height/2-a.getHorizon()?p:u}const fs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ul(p,t,a){const u=p.classList;for(const c in fs)u.remove(`maplibregl-${a}-anchor-${c}`);u.add(`maplibregl-${a}-anchor-${t}`)}class xa extends d.E{constructor(t){if(super(),this._onKeyPress=a=>{const u=a.code,c=a.charCode||a.keyCode;u!=="Space"&&u!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=a=>{const u=a.originalEvent.target,c=this._element;this._popup&&(u===c||c.contains(u))&&this.togglePopup()},this._update=a=>{var u;if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();((a==null?void 0:a.type)==="terrain"||(a==null?void 0:a.type)==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?ll(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(m=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w=`rotateX(${this._map.getPitch()}deg)`),a&&a.type!=="moveend"||(this._pos=this._pos.round()),U.setTransform(this._element,`${fs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${w} ${m}`),q.frameAsync(new AbortController).then(()=>{this._updateOpacity(a&&a.type==="moveend")}).catch(()=>{})},this._onMove=a=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.k("dragstart"))),this.fire(new d.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.k("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=d.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=U.create("div"),this._element.setAttribute("aria-label","Map marker");const a=U.createNS("http://www.w3.org/2000/svg","svg"),u=41,c=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${u}px`),a.setAttributeNS(null,"width",`${c}px`),a.setAttributeNS(null,"viewBox",`0 0 ${c} ${u}`);const m=U.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"stroke","none"),m.setAttributeNS(null,"stroke-width","1"),m.setAttributeNS(null,"fill","none"),m.setAttributeNS(null,"fill-rule","evenodd");const w=U.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const b=U.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const le of I){const me=U.createNS("http://www.w3.org/2000/svg","ellipse");me.setAttributeNS(null,"opacity","0.04"),me.setAttributeNS(null,"cx","10.5"),me.setAttributeNS(null,"cy","5.80029008"),me.setAttributeNS(null,"rx",le.rx),me.setAttributeNS(null,"ry",le.ry),b.appendChild(me)}const C=U.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const A=U.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(A);const L=U.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"opacity","0.25"),L.setAttributeNS(null,"fill","#000000");const N=U.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),L.appendChild(N);const Y=U.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Y.setAttributeNS(null,"fill","#FFFFFF");const G=U.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(8.0, 8.0)");const J=U.createNS("http://www.w3.org/2000/svg","circle");J.setAttributeNS(null,"fill","#000000"),J.setAttributeNS(null,"opacity","0.25"),J.setAttributeNS(null,"cx","5.5"),J.setAttributeNS(null,"cy","5.5"),J.setAttributeNS(null,"r","5.4999962");const V=U.createNS("http://www.w3.org/2000/svg","circle");V.setAttributeNS(null,"fill","#FFFFFF"),V.setAttributeNS(null,"cx","5.5"),V.setAttributeNS(null,"cy","5.5"),V.setAttributeNS(null,"r","5.4999962"),G.appendChild(J),G.appendChild(V),w.appendChild(b),w.appendChild(C),w.appendChild(L),w.appendChild(Y),w.appendChild(G),a.appendChild(w),a.setAttributeNS(null,"height",u*this._scale+"px"),a.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(a),this._offset=d.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),ul(this._element,this._anchor,"marker"),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),U.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=d.M.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const c=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var a,u;if(!(!((a=this._map)===null||a===void 0)&&a.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const c=this._map,m=c.terrain.depthAtPoint(this._pos),w=c.terrain.getElevationForLngLatZoom(this._lngLat,c.transform.tileZoom);if(c.transform.lngLatToCameraDepth(this._lngLat,w)-m<.006)return void(this._element.style.opacity=this._opacity);const b=-this._offset.y/c.transform._pixelPerMeter,I=Math.sin(c.getPitch()*Math.PI/180)*b,C=c.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),A=c.transform.lngLatToCameraDepth(this._lngLat,w+I)-C>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&A&&this._popup.remove(),this._element.style.opacity=A?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=d.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,a){return t===void 0&&a===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const Nu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let wa=0,go=!1;const ju={maxWidth:100,unit:"metric"};function cl(p,t,a){const u=a&&a.maxWidth||100,c=p._container.clientHeight/2,m=p.unproject([0,c]),w=p.unproject([u,c]),b=m.distanceTo(w);if(a&&a.unit==="imperial"){const I=3.2808*b;I>5280?Ro(t,u,I/5280,p._getUIString("ScaleControl.Miles")):Ro(t,u,I,p._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Ro(t,u,b/1852,p._getUIString("ScaleControl.NauticalMiles")):b>=1e3?Ro(t,u,b/1e3,p._getUIString("ScaleControl.Kilometers")):Ro(t,u,b,p._getUIString("ScaleControl.Meters"))}function Ro(p,t,a,u){const c=function(m){const w=Math.pow(10,`${Math.floor(m)}`.length-1);let b=m/w;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(I){const C=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*C)/C}(b),w*b}(a);p.style.width=t*(c/a)+"px",p.innerHTML=`${c}&nbsp;${u}`}const Uu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Vu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function $u(p){if(p){if(typeof p=="number"){const t=Math.round(Math.abs(p)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,p),"top-left":new d.P(t,t),"top-right":new d.P(-t,t),bottom:new d.P(0,-p),"bottom-left":new d.P(t,-t),"bottom-right":new d.P(-t,-t),left:new d.P(p,0),right:new d.P(-p,0)}}if(p instanceof d.P||Array.isArray(p)){const t=d.P.convert(p);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:d.P.convert(p.center||[0,0]),top:d.P.convert(p.top||[0,0]),"top-left":d.P.convert(p["top-left"]||[0,0]),"top-right":d.P.convert(p["top-right"]||[0,0]),bottom:d.P.convert(p.bottom||[0,0]),"bottom-left":d.P.convert(p["bottom-left"]||[0,0]),"bottom-right":d.P.convert(p["bottom-right"]||[0,0]),left:d.P.convert(p.left||[0,0]),right:d.P.convert(p.right||[0,0])}}return $u(new d.P(0,0))}const Yh=F;x.AJAXError=d.be,x.Evented=d.E,x.LngLat=d.M,x.MercatorCoordinate=d.Y,x.Point=d.P,x.addProtocol=d.bf,x.config=d.a,x.removeProtocol=d.bg,x.AttributionControl=Hh,x.BoxZoomHandler=ya,x.CanvasSource=di,x.CooperativeGesturesHandler=at,x.DoubleClickZoomHandler=Au,x.DragPanHandler=dn,x.DragRotateHandler=cs,x.EdgeInsets=as,x.FullscreenControl=class extends d.E{constructor(p={}){super(),this._onFullscreenChange=()=>{var t;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=a==null?void 0:a.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){U.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=U.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);U.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},x.GeoJSONSource=Pt,x.GeolocateControl=class extends d.E{constructor(p){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new d.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new d.M(t.coords.longitude,t.coords.latitude),u=t.coords.accuracy,c=this._map.getBearing(),m=d.e({bearing:c},this.options.fitBoundsOptions),w=Xt.fromLngLat(a,u);this._map.fitBounds(w,m,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new d.M(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&go)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=U.create("button","maplibregl-ctrl-geolocate",this._container),U.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new xa({element:this._dotElement}),this._circleElement=U.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new xa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.k("trackuserlocationend")))})}},this.options=d.e({},Nu,p)}onAdd(p){return this._map=p,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return d._(this,arguments,void 0,function*(t=!1){if(Kn!==void 0&&!t)return Kn;if(window.navigator.permissions===void 0)return Kn=!!window.navigator.geolocation,Kn;try{Kn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Kn=!!window.navigator.geolocation}return Kn})}().then(t=>this._setupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),U.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,wa=0,go=!1}_isOutOfMapMaxBounds(p){const t=this._map.getMaxBounds(),a=p.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),t=p.getSouthEast(),a=p.getNorthEast(),u=t.distanceTo(a),c=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":wa--,go=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),wa++,wa>1?(p={maximumAge:6e5,timeout:0},go=!0):(p=this.options.positionOptions,go=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},x.Hash=Su,x.ImageSource=Bi,x.KeyboardHandler=rr,x.LngLatBounds=Xt,x.LogoControl=va,x.Map=class extends Gh{constructor(p){if(d.bc.mark(d.bd.create),(p=d.e({},Fu,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new tl(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),{bearingSnap:p.bearingSnap}),this._contextLost=t=>{t.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._maxTileCacheZoomLevels=p.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new fr,this._controls=[],this._mapId=d.a3(),this._locale=d.e({},Ru,p.locale),this._clickTolerance=p.clickTolerance,this._overridePixelRatio=p.pixelRatio,this._maxCanvasSize=p.maxCanvasSize,this.transformCameraUpdate=p.transformCameraUpdate,this._imageQueueHandle=ue.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ne(p.transformRequest),typeof p.container=="string"){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const a=bu(u=>{this._trackResize&&!this._removed&&this.resize(u)._update()},50);this._resizeObserver=new ResizeObserver(u=>{t?a(u):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ii(this,p),this._hash=p.hash&&new Su(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,d.e({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,this._validateStyle=p.validateStyle,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new Hh(typeof p.attributionControl=="boolean"?void 0:p.attributionControl)),p.maplibreLogo&&this.addControl(new va,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new d.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new d.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new d.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(p,t){if(t===void 0&&(t=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new d.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=p.onAdd(this);this._controls.push(p);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(a,u.firstChild):u.appendChild(a),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new d.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(p);return t>-1&&this._controls.splice(t,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,t,a,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,t,a,u)}resize(p){var t;const a=this._containerDimensions(),u=a[0],c=a[1],m=this._getClampedPixelRatio(u,c);if(this._resizeCanvas(u,c,m),this.painter.resize(u,c,m),this.painter.overLimit()){const b=this.painter.context.gl;this._maxCanvasSize=[b.drawingBufferWidth,b.drawingBufferHeight];const I=this._getClampedPixelRatio(u,c);this._resizeCanvas(u,c,I),this.painter.resize(u,c,I)}this.transform.resize(u,c),(t=this._requestedCameraState)===null||t===void 0||t.resize(u,c);const w=!this._moving;return w&&(this.stop(),this.fire(new d.k("movestart",p)).fire(new d.k("move",p))),this.fire(new d.k("resize",p)),w&&this.fire(new d.k("moveend",p)),this}_getClampedPixelRatio(p,t){const{0:a,1:u}=this._maxCanvasSize,c=this.getPixelRatio(),m=p*c,w=t*c;return Math.min(m>a?a/m:1,w>u?u/w:1)*c}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(Xt.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}project(p){return this.transform.locationPoint(d.M.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.pointLocation(d.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,t,a){if(p==="mouseenter"||p==="mouseover"){let u=!1;return{layer:t,listener:a,delegates:{mousemove:m=>{const w=this.getLayer(t)?this.queryRenderedFeatures(m.point,{layers:[t]}):[];w.length?u||(u=!0,a.call(this,new Kr(p,this,m.originalEvent,{features:w}))):u=!1},mouseout:()=>{u=!1}}}}if(p==="mouseleave"||p==="mouseout"){let u=!1;return{layer:t,listener:a,delegates:{mousemove:w=>{(this.getLayer(t)?this.queryRenderedFeatures(w.point,{layers:[t]}):[]).length?u=!0:u&&(u=!1,a.call(this,new Kr(p,this,w.originalEvent)))},mouseout:w=>{u&&(u=!1,a.call(this,new Kr(p,this,w.originalEvent)))}}}}{const u=c=>{const m=this.getLayer(t)?this.queryRenderedFeatures(c.point,{layers:[t]}):[];m.length&&(c.features=m,a.call(this,c),delete c.features)};return{layer:t,listener:a,delegates:{[p]:u}}}}on(p,t,a){if(a===void 0)return super.on(p,t);const u=this._createDelegatedListener(p,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(u);for(const c in u.delegates)this.on(c,u.delegates[c]);return this}once(p,t,a){if(a===void 0)return super.once(p,t);const u=this._createDelegatedListener(p,t,a);for(const c in u.delegates)this.once(c,u.delegates[c]);return this}off(p,t,a){return a===void 0?super.off(p,t):(this._delegatedListeners&&this._delegatedListeners[p]&&(u=>{const c=this._delegatedListeners[p];for(let m=0;m<c.length;m++){const w=c[m];if(w.layer===t&&w.listener===a){for(const b in w.delegates)this.off(b,w.delegates[b]);return c.splice(m,1),this}}})(),this)}queryRenderedFeatures(p,t){if(!this.style)return[];let a;const u=p instanceof d.P||Array.isArray(p),c=u?p:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(u?{}:p)||{},c instanceof d.P||typeof c[0]=="number")a=[d.P.convert(c)];else{const m=d.P.convert(c[0]),w=d.P.convert(c[1]);a=[m,new d.P(w.x,m.y),w,new d.P(m.x,w.y),m]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(p,t){return this.style.querySourceFeatures(p,t)}setStyle(p,t){return(t=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(p,t))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const t=this._locale[p];if(t==null)throw new Error(`Missing UI string '${p}'`);return t}_updateStyle(p,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(p,t));const a=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new Os(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,t,a):this.style.loadJSON(p,t,a),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Os(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,t){if(typeof p=="string"){const a=this._requestManager.transformRequest(p,Te.Style);d.h(a,new AbortController).then(u=>{this._updateDiff(u.data,t)}).catch(u=>{u&&this.fire(new d.j(u))})}else typeof p=="object"&&this._updateDiff(p,t)}_updateDiff(p,t){try{this.style.setState(p,t)&&this._update(!0)}catch(a){d.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(p,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(p,t){return this._lazyInitEmptyStyle(),this.style.addSource(p,t),this._update(!0)}isSourceLoaded(p){const t=this.style&&this.style.sourceCaches[p];if(t!==void 0)return t.loaded();this.fire(new d.j(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const t=this.style.sourceCaches[p.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);this.terrain===null&&t.reload();for(const a in this.style._layers){const u=this.style._layers[a];u.type==="hillshade"&&u.source===p.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ds(this.painter,t,p),this.painter.renderToTexture=new Lu(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=a=>{a.dataType==="style"?this.terrain.sourceCache.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==p.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new d.k("terrain",{terrain:p})),this}getTerrain(){var p,t;return(t=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const t in p){const a=p[t]._tiles;for(const u in a){const c=a[u];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,t,a={}){const{pixelRatio:u=1,sdf:c=!1,stretchX:m,stretchY:w,content:b}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||d.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:I,height:C,data:A}=t,L=t;return this.style.addImage(p,{data:new d.R({width:I,height:C},new Uint8Array(A)),pixelRatio:u,stretchX:m,stretchY:w,content:b,sdf:c,version:0,userImage:L}),L.onAdd&&L.onAdd(this,p),this}}{const{width:I,height:C,data:A}=q.getImageData(t);this.style.addImage(p,{data:new d.R({width:I,height:C},A),pixelRatio:u,stretchX:m,stretchY:w,content:b,sdf:c,version:0})}}updateImage(p,t){const a=this.style.getImage(p);if(!a)return this.fire(new d.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=t instanceof HTMLImageElement||d.b(t)?q.getImageData(t):t,{width:c,height:m,data:w}=u;if(c===void 0||m===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==a.data.width||m!==a.data.height)return this.fire(new d.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(t instanceof HTMLImageElement||d.b(t));return a.data.replace(w,b),this.style.updateImage(p,a),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new d.j(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p){return ue.getImage(this._requestManager.transformRequest(p,Te.Image),new AbortController)}listImages(){return this.style.listImages()}addLayer(p,t){return this._lazyInitEmptyStyle(),this.style.addLayer(p,t),this._update(!0)}moveLayer(p,t){return this.style.moveLayer(p,t),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,t,a){return this.style.setLayerZoomRange(p,t,a),this._update(!0)}setFilter(p,t,a={}){return this.style.setFilter(p,t,a),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,t,a,u={}){return this.style.setPaintProperty(p,t,a,u),this._update(!0)}getPaintProperty(p,t){return this.style.getPaintProperty(p,t)}setLayoutProperty(p,t,a,u={}){return this.style.setLayoutProperty(p,t,a,u),this._update(!0)}getLayoutProperty(p,t){return this.style.getLayoutProperty(p,t)}setGlyphs(p,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,t,a,u=>{u||this._update(!0)}),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,t,a=>{a||this._update(!0)}),this}setLight(p,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(p,t){return this.style.setFeatureState(p,t),this._update()}removeFeatureState(p,t){return this.style.removeFeatureState(p,t),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,t=0;return this._container&&(p=this._container.clientWidth||400,t=this._container.clientHeight||300),[p,t]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const t=this._canvasContainer=U.create("div","maplibregl-canvas-container",p);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=U.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),u=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],u);const c=this._controlContainer=U.create("div","maplibregl-control-container",p),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{m[w]=U.create("div",`maplibregl-ctrl-${w} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,t,a){this._canvas.width=Math.floor(a*p),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const p={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{t={requestedAttributes:p},u&&(t.statusMessage=u.statusMessage,t.type=u.type)},{once:!0});const a=this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p);if(!a){const u="Failed to initialize WebGL";throw t?(t.message=u,new Error(JSON.stringify(t))):new Error(u)}this.painter=new fa(a,this.transform),we.testSupport(a)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,m=q.now();this.style.zoomHistory.update(c,m);const w=new d.a8(c,{now:m,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),b=w.crossFadingFactor();b===1&&b===this._crossFadingFactor||(a=!0,this._crossFadingFactor=b),this.style.update(w)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new d.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.bc.mark(d.bd.load),this.fire(new d.k("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const u=this._sourcesDirty||this._styleDirty||this._placementDirty;return u||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.k("idle")),!this._loaded||this._fullyLoaded||u||(this._fullyLoaded=!0,d.bc.mark(d.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ue.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),U.remove(this._canvasContainer),U.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),d.bc.clearMetrics(),this._removed=!0,this.fire(new d.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,q.frameAsync(this._frameRequest).then(p=>{d.bc.frame(p),this._frameRequest=null,this._render(p)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return ps}getCameraTargetElevation(){return this.transform.elevation}},x.MapMouseEvent=Kr,x.MapTouchEvent=ga,x.MapWheelEvent=tn,x.Marker=xa,x.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),u=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,a)=>{const u=this._map._getUIString(`NavigationControl.${a}`);t.title=u,t.setAttribute("aria-label",u)},this.options=d.e({},Bu,p),this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),U.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),U.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=U.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ou(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){U.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,t){const a=U.create("button",p,this._container);return a.type="button",a.addEventListener("click",t),a}},x.Popup=class extends d.E{constructor(p){super(),this.remove=()=>(this._content&&U.remove(this._content),this._container&&(U.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.k("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var a;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=U.create("div","maplibregl-popup",this._map.getContainer()),this._tip=U.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const b of this.options.className.split(" "))this._container.classList.add(b);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?ll(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._trackPointer&&!t)return;const u=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationPoint(this._lngLat));let c=this.options.anchor;const m=$u(this.options.offset);if(!c){const b=this._container.offsetWidth,I=this._container.offsetHeight;let C;C=u.y+m.bottom.y<I?["top"]:u.y>this._map.transform.height-I?["bottom"]:[],u.x<b/2?C.push("left"):u.x>this._map.transform.width-b/2&&C.push("right"),c=C.length===0?"bottom":C.join("-")}let w=u.add(m[c]);this.options.subpixelPositioning||(w=w.round()),U.setTransform(this._container,`${fs[c]} translate(${w.x}px,${w.y}px)`),ul(this._container,c,"popup")},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(Uu),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=d.M.convert(p),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const t=document.createDocumentFragment(),a=document.createElement("body");let u;for(a.innerHTML=p;u=a.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=U.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){this._container&&this._container.classList.add(p)}removeClassName(p){this._container&&this._container.classList.remove(p)}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}setSubpixelPositioning(p){this.options.subpixelPositioning=p}_createCloseButton(){this.options.closeButton&&(this._closeButton=U.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Vu);p&&p.focus()}},x.RasterDEMTileSource=To,x.RasterTileSource=Hn,x.ScaleControl=class{constructor(p){this._onMove=()=>{cl(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,cl(this._map,this._container,this.options)},this.options=d.e({},ju,p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){U.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},x.ScrollZoomHandler=zu,x.Style=Os,x.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=p}onAdd(p){return this._map=p,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=U.create("button","maplibregl-ctrl-terrain",this._container),U.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){U.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},x.TwoFingersTouchPitchHandler=Zh,x.TwoFingersTouchRotateHandler=Pu,x.TwoFingersTouchZoomHandler=il,x.TwoFingersTouchZoomRotateHandler=it,x.VectorTileSource=Ie,x.VideoSource=Cn,x.addSourceType=(p,t)=>d._(void 0,void 0,void 0,function*(){if(Pn(p))throw new Error(`A source type called "${p}" already exists.`);((a,u)=>{Xi[a]=u})(p,t)}),x.clearPrewarmedResources=function(){const p=or;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(Hr),or=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},x.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},x.getRTLTextPluginStatus=function(){return ii().getRTLTextPluginStatus()},x.getVersion=function(){return Yh},x.getWorkerCount=function(){return Wt.workerCount},x.getWorkerUrl=function(){return d.a.WORKER_URL},x.importScriptInWorkers=function(p){return kn().broadcast("importScript",p)},x.prewarm=function(){Fi().acquire(Hr)},x.setMaxParallelImageRequests=function(p){d.a.MAX_PARALLEL_IMAGE_REQUESTS=p},x.setRTLTextPlugin=function(p,t){return ii().setRTLTextPlugin(p,t)},x.setWorkerCount=function(p){Wt.workerCount=p},x.setWorkerUrl=function(p){d.a.WORKER_URL=p}});var S=l;return S})})(tw);var YI=tw.exports;const Xl=vg(YI),Op=Le.createContext(),KI="eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6IjlhYjA0OGFlNjdmYmU5M2Y2M2Q3ZWU1NmFlYTM5Njg0OTkxYmVkNDI2NzljYmJkOTI5NzIyYjM0NTUxM2RkZTFkMWM4ZTFhNjY2YTgwNzQ4In0.eyJhdWQiOiIxMzQ5NiIsImp0aSI6IjlhYjA0OGFlNjdmYmU5M2Y2M2Q3ZWU1NmFlYTM5Njg0OTkxYmVkNDI2NzljYmJkOTI5NzIyYjM0NTUxM2RkZTFkMWM4ZTFhNjY2YTgwNzQ4IiwiaWF0IjoxNjE4MTI3NjY5LCJuYmYiOjE2MTgxMjc2NjksImV4cCI6MTYyMDcxOTY2OSwic3ViIjoiIiwic2NvcGVzIjpbImJhc2ljIl19.pb2aP7I5jba6Gzkw00QnBnOMn6vu1QguIr-t5UgPxfKHvmSgKz_lDL_bq_QINbo3phfedxqm-mnK0M3JTYhZza9FwkBOSTkdxlCf4qjbXwoogF2mcSQx8-5Lmb1ubnCMaX3KBSOGKxR7_aI3PAUZqS_AzdgZYevtlVDCYlLkOJ5sLeowK2S5oSEm3iwlMjpOwueQYkGmVSBVcWrO_77TMX2FQ_j1N0kquclid6sEvyYexXFKDhOMniQk6-81cid-5pREQDdC8rCjmmkgBn6ykluiOp7UalAFiXHaRybKURHB0NjiSBrJmUge_HgSekCeMnM1sa-SQUiTTcljdY-ZNQ";function XI(){const r=Le.useRef(null),o=Le.useContext(Op),l=51.4,f=35.72,_=11;return Le.useEffect(()=>{r.current&&(o.current||(o.current=new Xl.Map({container:r.current,style:"https://map.ir/vector/styles/main/mapir-xyz-style.json",center:[l,f],zoom:_,transformRequest:S=>({url:S,headers:{"x-api-key":KI}})})))},[]),It.jsx("div",{ref:r,className:"map-container"})}function JI(){const[r,o]=Le.useState(!1),l=dh();return It.jsxs("nav",{className:"navbar",children:[It.jsx(_g,{onClick:()=>o(!r),className:`navbar-item item-1 ${l.pathname==="/FindRoute"?"active":""}`,to:"FindRoute",children:"Find Route"}),It.jsx(_g,{className:`navbar-item item-2 ${l.pathname==="/Geofence"?"active":""} `,to:"Geofence",onClick:()=>o(!r),children:"Geofence"})]})}Xl.getRTLTextPluginStatus!=="loaded"&&Xl.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.0/mapbox-gl-rtl-text.js");function QI(){const r=Le.useRef(null);return It.jsx(Op.Provider,{value:r,children:It.jsxs("div",{className:"container",children:[It.jsx(EI,{}),It.jsx(XI,{}),It.jsx(JI,{})]})})}function ym(){return ew(),It.jsxs("div",{children:[It.jsx("h1",{className:"not-found",children:"Oops!"}),It.jsx("p",{className:"not-found-text",children:"Page not found :("}),It.jsx(_g,{to:"/",className:"backBtn",children:"Back to Home"})]})}const ek="eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6IjlhYjA0OGFlNjdmYmU5M2Y2M2Q3ZWU1NmFlYTM5Njg0OTkxYmVkNDI2NzljYmJkOTI5NzIyYjM0NTUxM2RkZTFkMWM4ZTFhNjY2YTgwNzQ4In0.eyJhdWQiOiIxMzQ5NiIsImp0aSI6IjlhYjA0OGFlNjdmYmU5M2Y2M2Q3ZWU1NmFlYTM5Njg0OTkxYmVkNDI2NzljYmJkOTI5NzIyYjM0NTUxM2RkZTFkMWM4ZTFhNjY2YTgwNzQ4IiwiaWF0IjoxNjE4MTI3NjY5LCJuYmYiOjE2MTgxMjc2NjksImV4cCI6MTYyMDcxOTY2OSwic3ViIjoiIiwic2NvcGVzIjpbImJhc2ljIl19.pb2aP7I5jba6Gzkw00QnBnOMn6vu1QguIr-t5UgPxfKHvmSgKz_lDL_bq_QINbo3phfedxqm-mnK0M3JTYhZza9FwkBOSTkdxlCf4qjbXwoogF2mcSQx8-5Lmb1ubnCMaX3KBSOGKxR7_aI3PAUZqS_AzdgZYevtlVDCYlLkOJ5sLeowK2S5oSEm3iwlMjpOwueQYkGmVSBVcWrO_77TMX2FQ_j1N0kquclid6sEvyYexXFKDhOMniQk6-81cid-5pREQDdC8rCjmmkgBn6ykluiOp7UalAFiXHaRybKURHB0NjiSBrJmUge_HgSekCeMnM1sa-SQUiTTcljdY-ZNQ",tk=async({url:r,startLng:o,startLat:l,destinationLng:f,destinationLat:_})=>{try{const S=await fetch(`${r}${o},${l};${f},${_}?alternatives=true&steps=true&geometries=geojson`,{headers:{"x-api-key":ek},method:"GET"});if(!S.ok)throw new Error(" Fetch not completed :(");return(await S.json()).routes[0].geometry}catch{return null}},Sc="route-layer",_m="route",vm={start:new Xl.Marker,destination:new Xl.Marker};function rk(){const r=Le.useContext(Op),[o,l]=Le.useState({start:!1,destination:!1}),[f,_]=Le.useState({startLng:null,startLat:null,destinationLng:null,destinationLat:null});function S(d){const F=vm[d];F.remove(),l(Q=>({...Q,[d]:!Q[d]}));function Z(Q){const q=Q.lngLat;F.setLngLat(q).addTo(r.current),_(U=>({...U,[`${d}Lng`]:q.lng,[`${d}Lat`]:q.lat})),l(U=>({...U,[d]:!U[d]})),r.current.off("click",Z)}r.current.on("click",Z)}async function x(){var xe,Ee;if(f.startLng===null||f.startLat===null||f.destinationLng===null||f.destinationLat===null){console.log("Start or destination coordinates are not set");return}const F="https://map.ir/routes/foot/v1/driving/",{startLng:Z,startLat:Q,destinationLng:q,destinationLat:U}=f,we=await tk({url:F,startLng:Z,startLat:Q,destinationLng:q,destinationLat:U});if(console.log("Geometry:",we),!we){console.log("Geometry is null");return}const be=(Ee=(xe=r.current)==null?void 0:xe.getSource)==null?void 0:Ee.call(xe,Sc);be?be==null||be.setData({type:"Feature",properties:{},geometry:we}):(r.current.addSource(Sc,{type:"geojson",data:{type:"Feature",geometry:we}}),r.current.addLayer({id:_m,type:"line",source:Sc,paint:{"line-color":"#eb4034","line-width":4}}))}return Le.useEffect(()=>()=>{try{r.current&&(r.current.getLayer(_m)&&r.current.removeLayer(_m),r.current.getSource(Sc)&&r.current.removeSource(Sc),vm.start.remove(),vm.destination.remove())}catch(d){console.log("Error:",d)}},[]),It.jsx("div",{className:"container",children:It.jsx("div",{className:"sidebar",children:It.jsxs("div",{className:"groupBtn",children:[It.jsx("button",{className:"btn",onClick:()=>S("start"),style:{backgroundColor:o.start?"#ccc1c0":"",color:o.start?"#f5f5f5":""},children:"Starting Point"}),It.jsx("button",{className:"btn",onClick:()=>S("destination"),style:{backgroundColor:o.destination?"#ccc1c0":"",color:o.destination?"#f5f5f5":""},children:"Destinaion Point"}),It.jsx("button",{className:"findBtn",onClick:x,children:"Find Route"})]})})})}const ik="eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6IjlhYjA0OGFlNjdmYmU5M2Y2M2Q3ZWU1NmFlYTM5Njg0OTkxYmVkNDI2NzljYmJkOTI5NzIyYjM0NTUxM2RkZTFkMWM4ZTFhNjY2YTgwNzQ4In0.eyJhdWQiOiIxMzQ5NiIsImp0aSI6IjlhYjA0OGFlNjdmYmU5M2Y2M2Q3ZWU1NmFlYTM5Njg0OTkxYmVkNDI2NzljYmJkOTI5NzIyYjM0NTUxM2RkZTFkMWM4ZTFhNjY2YTgwNzQ4IiwiaWF0IjoxNjE4MTI3NjY5LCJuYmYiOjE2MTgxMjc2NjksImV4cCI6MTYyMDcxOTY2OSwic3ViIjoiIiwic2NvcGVzIjpbImJhc2ljIl19.pb2aP7I5jba6Gzkw00QnBnOMn6vu1QguIr-t5UgPxfKHvmSgKz_lDL_bq_QINbo3phfedxqm-mnK0M3JTYhZza9FwkBOSTkdxlCf4qjbXwoogF2mcSQx8-5Lmb1ubnCMaX3KBSOGKxR7_aI3PAUZqS_AzdgZYevtlVDCYlLkOJ5sLeowK2S5oSEm3iwlMjpOwueQYkGmVSBVcWrO_77TMX2FQ_j1N0kquclid6sEvyYexXFKDhOMniQk6-81cid-5pREQDdC8rCjmmkgBn6ykluiOp7UalAFiXHaRybKURHB0NjiSBrJmUge_HgSekCeMnM1sa-SQUiTTcljdY-ZNQ",nk=async({coords:r})=>{const o=`https://map.ir/geofence/boundaries?lat=${r.lat}&lon=${r.lng}`,l={method:"GET",headers:{"x-api-key":ik}};try{const _=await(await fetch(o,l)).json();return console.log("check is point data",_),_.value.length>0}catch(f){return console.error(f),!1}},b0="eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6IjlhYjA0OGFlNjdmYmU5M2Y2M2Q3ZWU1NmFlYTM5Njg0OTkxYmVkNDI2NzljYmJkOTI5NzIyYjM0NTUxM2RkZTFkMWM4ZTFhNjY2YTgwNzQ4In0.eyJhdWQiOiIxMzQ5NiIsImp0aSI6IjlhYjA0OGFlNjdmYmU5M2Y2M2Q3ZWU1NmFlYTM5Njg0OTkxYmVkNDI2NzljYmJkOTI5NzIyYjM0NTUxM2RkZTFkMWM4ZTFhNjY2YTgwNzQ4IiwiaWF0IjoxNjE4MTI3NjY5LCJuYmYiOjE2MTgxMjc2NjksImV4cCI6MTYyMDcxOTY2OSwic3ViIjoiIiwic2NvcGVzIjpbImJhc2ljIl19.pb2aP7I5jba6Gzkw00QnBnOMn6vu1QguIr-t5UgPxfKHvmSgKz_lDL_bq_QINbo3phfedxqm-mnK0M3JTYhZza9FwkBOSTkdxlCf4qjbXwoogF2mcSQx8-5Lmb1ubnCMaX3KBSOGKxR7_aI3PAUZqS_AzdgZYevtlVDCYlLkOJ5sLeowK2S5oSEm3iwlMjpOwueQYkGmVSBVcWrO_77TMX2FQ_j1N0kquclid6sEvyYexXFKDhOMniQk6-81cid-5pREQDdC8rCjmmkgBn6ykluiOp7UalAFiXHaRybKURHB0NjiSBrJmUge_HgSekCeMnM1sa-SQUiTTcljdY-ZNQ",Tc="geofence-polygons-source",xm="geofence-polygons-layer",Ic=new Xl.Marker;function ok(){const r=Le.useContext(Op),o=Le.useRef(null),[l,f]=Le.useState(),[_,S]=Le.useState({}),[x,d]=Le.useState({lng:" ",lat:" "}),F=Le.useCallback(U=>{o.current&&o.current.remove();const we=U.lngLat;Ic.setLngLat(we).addTo(r.current),o.current=Ic,d(we)},[]),Z=U=>{f(U.target.files[0])},Q=async()=>{if(!l){alert("Please select a file first");return}let U=new FileReader;U.onloadend=async we=>{let be=new FormData;console.log("formData:",be),be.append("polygons",l);try{const xe=await fetch("https://map.ir/geofence/stages",{method:"POST",body:be,headers:{"x-api-key":`${b0}`}});if(!xe.ok)throw new Error(`HTTP error! status: ${xe.status}`);const Ee=await xe.json();console.log("File uploaded successfully:",Ee)}catch(xe){console.error("Failed to upload file:",xe);return}},U.readAsText(l)};Le.useEffect(()=>{(async()=>{try{const we=await fetch("https://map.ir/geofence/stages",{headers:{"x-api-key":`${b0}`}});if(!we.ok)throw new Error(`HTTP error! status: ${we.status}`);const be=await we.json();console.log("data is ready now:",be),S(be),console.log("stage is updated now:",_)}catch(we){console.log("Failed to get stages",we)}})()},[]),Le.useEffect(()=>{var U;return(U=r.current)==null||U.on("click",F),()=>{var we;(we=r.current)==null||we.off("click",F)}},[]);async function q(){if(!x.lat||!x.lng)return;const U=await nk({coords:x});Ic.setLngLat(x).addTo(r.current),alert(U?"Yey, point is verified :)":"No, Point is not verified :("),d({lng:" ",lat:" "})}return Le.useEffect(()=>{var xe,Ee,ne,te;if(!r.current||!((xe=_==null?void 0:_.value)!=null&&xe.length))return;const we={type:"FeatureCollection",features:(Ee=_==null?void 0:_.value)==null?void 0:Ee.map(ue=>({geometry:ue.boundary,properties:{},type:"Feature"}))},be=(te=(ne=r.current)==null?void 0:ne.getSource)==null?void 0:te.call(ne,Tc);return be?(console.log("featureCollection",we),be.setData({type:"geojson",data:we})):(r.current.addSource(Tc,{type:"geojson",data:we}),r.current.addLayer({id:xm,type:"fill",source:Tc,paint:{"fill-color":"#0080ff","fill-opacity":.5}})),()=>{var ue;try{const Te=r.current;if(!Te)return;Te.getLayer(xm)&&Te.removeLayer(xm),Te.getSource(Tc)&&Te.removeSource(Tc),(ue=o.current)==null||ue.remove()}catch(Te){console.log(Te)}}},[_,r.current]),It.jsx("div",{className:"container",children:It.jsxs("div",{className:"sidebar",children:[_&&_["odata.count"]?It.jsxs("div",{className:"uploadStage",children:[It.jsx("h2",{children:"Uploaded Stages"}),It.jsxs("p",{children:["You have uploaded ",_&&(_==null?void 0:_["odata.count"])," stages so far."]})]}):It.jsx("p",{children:"Loading"}),It.jsxs("div",{className:"uploadBtn",children:[It.jsx("input",{type:"file",onChange:Z,className:""}),It.jsx("button",{onClick:Q,className:"btn",children:"Upload GeoJSON"})]}),It.jsx("div",{className:"divider"}),It.jsxs("div",{className:"addCoords",children:[It.jsx("p",{style:{lineHeight:"1.5rem",marginBottom:"2rem"},children:"Select a point on the map or insert the coordinates to Verify its Location."}),It.jsxs("div",{className:"uploadBtn",children:[It.jsx("label",{htmlFor:"latInput",children:"Latitude: "}),It.jsx("input",{type:"text",name:"lat",id:"latInput",value:x.lat,onChange:U=>{d(we=>({...we,lat:U.target.value})),Ic.setLngLat(x).addTo(r.current)}})]}),It.jsxs("div",{className:"uploadBtn",children:[It.jsx("label",{htmlFor:"latInput",children:"Longitude: "}),It.jsx("input",{type:"text",name:"lng",id:"lngInput",value:x.lng,onChange:U=>{d(we=>({...we,lng:U.target.value})),Ic.setLngLat(x).addTo(r.current)}})]}),It.jsx("button",{className:"btn",onClick:q,children:"Verify Point"})]})]})})}const ak=RI([{path:"/",element:It.jsx(QI,{}),errorElement:It.jsx(ym,{}),children:[{path:"/FindRoute",element:It.jsx(rk,{}),errorElement:It.jsx(ym,{})},{path:"/Geofence",element:It.jsx(ok,{}),errorElement:It.jsx(ym,{})}]}]);wm.createRoot(document.getElementById("root")).render(It.jsx(D0.StrictMode,{children:It.jsx(ZI,{router:ak})}));
